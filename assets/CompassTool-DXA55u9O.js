import{a as W,j as e,C as I}from"./index-Cc3QSN8n.js";import{r as o}from"./vendor-DDTLr4RV.js";import{a1 as H,S as D,a6 as h,i as T,ae as B}from"./utils-kLxd5vEQ.js";const J=({onClose:E})=>{var S;const{preferences:C}=W(),_=((S=C.location)==null?void 0:S.name)||"Local",[l,w]=o.useState(0),[p,g]=o.useState(""),[z,c]=o.useState(!1),[L,k]=o.useState(null),[A,v]=o.useState(!1),[M,j]=o.useState(!1),d=o.useRef(null),N=o.useRef(0);o.useEffect(()=>{let t=!0;const n=async()=>{if(typeof window<"u"&&"AbsoluteOrientationSensor"in window)try{if((await Promise.all([navigator.permissions.query({name:"accelerometer"}).catch(()=>({state:"unknown"})),navigator.permissions.query({name:"magnetometer"}).catch(()=>({state:"unknown"})),navigator.permissions.query({name:"gyroscope"}).catch(()=>({state:"unknown"}))])).some(a=>a.state==="denied"))throw new Error("Permissions denied");const s=new AbsoluteOrientationSensor({frequency:60,referenceFrame:"device"});return s.addEventListener("reading",()=>{if(s.quaternion&&t){const[a,x,m,$]=s.quaternion,O=2*($*m+a*x),R=1-2*(x*x+m*m);let f=Math.atan2(O,R)*(180/Math.PI);f<0&&(f+=360),w(360-f),k("Absolute"),c(!0)}}),s.addEventListener("error",a=>{a.error&&a.error.name==="NotReadableError"&&console.log("Sensor not readable")}),s.start(),d.current=s,!0}catch(r){return console.log("AbsoluteOrientationSensor failed to init",r),!1}return!1},i=r=>{if(d.current&&d.current.activated||!t)return;let s=0,a=null;r.webkitCompassHeading?(s=r.webkitCompassHeading,a="iOS"):r.absolute===!0&&r.alpha!==null&&(s=360-r.alpha,a="Standard"),a&&(w(s),k(a),c(!0),r.webkitCompassAccuracy&&r.webkitCompassAccuracy>15?v(!0):v(!1))},b=()=>{window.addEventListener("deviceorientation",i,!0),window.addEventListener("deviceorientationabsolute",i,!0)};return n().then(r=>{r||b()}),()=>{t=!1,d.current&&d.current.stop(),window.removeEventListener("deviceorientation",i,!0),window.removeEventListener("deviceorientationabsolute",i,!0)}},[]),o.useEffect(()=>{const t=Math.abs(l)<2||Math.abs(l-360)<2,n=Date.now();t&&n-N.current>1e3&&(navigator.vibrate&&navigator.vibrate(10),N.current=n)},[l]);const q=async()=>{if(typeof DeviceOrientationEvent.requestPermission=="function")try{await DeviceOrientationEvent.requestPermission()==="granted"?c(!0):g("Permission was denied.")}catch{g("Permission request failed. Please check browser settings.")}else c(!0)},P=t=>{t=(t+360)%360;const n=["N","NE","E","SE","S","SW","W","NW"],i=Math.round(t/45)%8;return n[i]},u=Math.abs(l)<2||Math.abs(l-360)<2,y=[];for(let t=0;t<360;t+=2){const n=t%30===0,i=t%90===0,b=i?"h-5":n?"h-3":"h-1.5",r=i?"w-1":n?"w-0.5":"w-px",s=i?"bg-spiritual-900 dark:bg-white":"bg-spiritual-300 dark:bg-white/30";y.push(e.jsx("div",{className:"absolute top-0 left-1/2 w-4 -ml-2 h-1/2 origin-bottom flex justify-center pt-4",style:{transform:`rotate(${t}deg)`},children:e.jsx("div",{className:`${b} ${r} ${s}`})},t))}return e.jsxs("div",{className:"fixed inset-0 bg-spiritual-50 dark:bg-spiritual-deep z-[60] flex flex-col animate-fade-in transition-colors overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-spiritual-50 via-white to-spiritual-100 dark:from-slate-900 dark:via-spiritual-900 dark:to-black"}),e.jsx("div",{className:`absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[500px] h-[500px] bg-spiritual-gold/20 dark:bg-spiritual-gold/5 rounded-full blur-[100px] transition-opacity duration-1000 ${u?"opacity-100 scale-110":"opacity-50"}`}),e.jsxs("div",{className:"px-6 pt-14 pb-4 flex justify-between items-center relative z-10 w-full",children:[e.jsx("button",{onClick:E,className:"p-3 bg-spiritual-900/5 dark:bg-white/10 rounded-full hover:bg-spiritual-900/10 dark:hover:bg-white/20 text-spiritual-900 dark:text-spiritual-100 transition-colors backdrop-blur-md border border-spiritual-900/5 dark:border-white/5","aria-label":"Back",children:e.jsx(H,{size:24})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs font-bold text-spiritual-500 dark:text-spiritual-400 uppercase tracking-widest",children:_}),e.jsxs("span",{className:"text-lg font-serif font-bold text-spiritual-900 dark:text-spiritual-50 flex items-center gap-2",children:["Alignment ",u&&e.jsx(D,{size:14,className:"text-spiritual-gold animate-pulse"})]})]}),e.jsx("button",{onClick:()=>j(!0),className:"p-3 bg-spiritual-900/5 dark:bg-white/10 rounded-full hover:bg-spiritual-900/10 dark:hover:bg-white/20 text-spiritual-900 dark:text-spiritual-100 transition-colors backdrop-blur-md border border-spiritual-900/5 dark:border-white/5","aria-label":"Info",children:e.jsx(h,{size:24})})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center relative z-10 p-6 pb-24",children:[e.jsxs("div",{className:"relative w-72 h-72 sm:w-80 sm:h-80 mb-12 shrink-0 aspect-square",children:[e.jsx("div",{className:"absolute -inset-8 rounded-full border border-spiritual-900/5 dark:border-white/5"}),e.jsx("div",{className:"absolute -inset-4 rounded-full border border-spiritual-900/10 dark:border-white/10"}),e.jsx("div",{className:`absolute -top-12 left-1/2 -translate-x-1/2 w-1 h-4 bg-spiritual-gold shadow-[0_0_15px_3px_rgba(197,160,89,0.5)] transition-opacity duration-300 ${u?"opacity-100":"opacity-0"}`}),e.jsxs("div",{className:"w-full h-full rounded-full bg-white/80 dark:bg-slate-900/90 border-4 border-white dark:border-slate-800 shadow-[0_20px_50px_-10px_rgba(0,0,0,0.1)] dark:shadow-[0_20px_50px_-10px_rgba(0,0,0,0.7)] flex items-center justify-center relative transition-transform duration-300 ease-out will-change-transform backdrop-blur-md",style:{transform:`rotate(${-l}deg)`},children:[e.jsxs("div",{className:"absolute inset-0 rounded-full",children:[y,[0,90,180,270].map(t=>e.jsx("div",{className:"absolute w-full h-full top-0 left-0 pointer-events-none",style:{transform:`rotate(${t}deg)`},children:e.jsx("div",{className:"absolute top-6 left-1/2 -translate-x-1/2 text-center",children:e.jsx("div",{className:"font-bold text-xs",style:{transform:`rotate(${-t}deg)`},children:t===0?e.jsx("span",{className:"text-red-500 text-xl drop-shadow-md",children:"N"}):t===90?e.jsx("span",{className:"text-spiritual-900 dark:text-white/90 text-lg",children:"E"}):t===180?e.jsx("span",{className:"text-spiritual-900 dark:text-white/90 text-lg",children:"S"}):e.jsx("span",{className:"text-spiritual-900 dark:text-white/90 text-lg",children:"W"})})})},`label-${t}`))]}),e.jsx("div",{className:"absolute inset-20 rounded-full border border-spiritual-900/5 dark:border-white/5"}),e.jsx("div",{className:"absolute inset-24 rounded-full border border-dashed border-spiritual-900/10 dark:border-white/10 opacity-50"}),e.jsxs("div",{className:"w-32 h-32 rounded-full bg-gradient-to-br from-spiritual-50 to-white dark:from-slate-800 dark:to-black border border-spiritual-900/10 dark:border-white/10 shadow-inner flex items-center justify-center relative backdrop-blur-xl",children:[e.jsx(T,{size:60,strokeWidth:.5,className:"text-spiritual-900/10 dark:text-spiritual-500/20"}),e.jsx("div",{className:"absolute w-2 h-2 bg-spiritual-gold rounded-full shadow-glow z-20 border border-white dark:border-slate-900"})]})]}),e.jsx("div",{className:"absolute -top-5 left-1/2 -translate-x-1/2 z-30 filter drop-shadow-lg",children:e.jsx("svg",{width:"45px",height:"45px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M19 20L12 3L5 20L12 17L19 20Z",stroke:"#000000",fill:"#C5A059",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),!z&&!p&&e.jsx("div",{className:"absolute inset-0 z-40 flex items-center justify-center backdrop-blur-sm bg-white/60 dark:bg-black/60 rounded-full",children:e.jsx("button",{onClick:q,className:"px-6 py-3 bg-spiritual-900 dark:bg-spiritual-100 text-white dark:text-spiritual-900 rounded-2xl font-bold shadow-[0_0_30px_rgba(197,160,89,0.2)] animate-pulse hover:scale-105 transition-transform",children:"Tap to Activate"})})]}),e.jsxs("div",{className:"text-center space-y-2 relative z-20",children:[e.jsxs("h3",{className:"text-6xl font-serif font-bold text-spiritual-900 dark:text-white tabular-nums tracking-tighter drop-shadow-sm dark:drop-shadow-2xl",children:[Math.round(l),"Â°"]}),e.jsx("p",{className:`text-2xl font-medium tracking-widest transition-colors duration-300 ${u?"text-spiritual-gold":"text-spiritual-500 dark:text-spiritual-300"}`,children:P(l)})]}),e.jsxs("div",{className:"mt-10 flex items-center gap-4 opacity-80",children:[L==="Absolute"?e.jsxs("div",{className:"flex items-center gap-2 px-4 py-1.5 rounded-full bg-green-100 dark:bg-green-900/20 border border-green-500/20 text-green-700 dark:text-green-400 text-xs font-bold backdrop-blur-sm",children:[e.jsx(h,{size:12})," Precise Mode"]}):e.jsxs("div",{className:"flex items-center gap-2 px-4 py-1.5 rounded-full bg-spiritual-900/5 dark:bg-white/5 border border-spiritual-900/10 dark:border-white/10 text-spiritual-600 dark:text-spiritual-400 text-xs font-bold backdrop-blur-sm",children:[e.jsx(h,{size:12})," Standard Mode"]}),A&&e.jsxs("div",{className:"flex items-center gap-2 px-4 py-1.5 rounded-full bg-amber-100 dark:bg-amber-900/20 border border-amber-500/20 text-amber-700 dark:text-amber-400 text-xs font-bold animate-pulse backdrop-blur-sm",children:[e.jsx(B,{size:12})," Calibrate (Wave 8)"]})]}),p&&e.jsx("p",{className:"absolute bottom-10 text-red-500 dark:text-red-400 text-sm bg-red-100 dark:bg-red-900/20 px-6 py-3 rounded-xl border border-red-500/20 font-medium",children:p})]}),M&&e.jsx(I,{onClose:()=>j(!1)})]})};export{J as default};
