import{u as be,a as we,r as i,g as ge,s as je,j as e,C as ve,I as Ne,H as Z,B as ke,W as S,X as ye,V as Se,b as Ce,c as Ie,P as ee,A as ze,t as Ee,p as Pe}from"./index-DDyiaaW3.js";import{u as $e,S as Re}from"./useAmbience-KZ6HN9t-.js";import{V as Ae}from"./volume-x-BJH1Phtb.js";import{P as Me}from"./pause-BLfxYcgt.js";const Ve=({onClose:L,initialId:g})=>{const{library:C}=be(),{preferences:u}=we(),I=C.breathwork,te=C.ambientSounds,V=C.chimeThemes,[r,z]=i.useState(null),[h,E]=i.useState(!1),[se,ae]=i.useState(ge()),[P,D]=i.useState(0),[f,F]=i.useState(0),[ie,B]=i.useState(0),[j,_]=i.useState(0),[$,O]=i.useState(!1),[U,G]=i.useState(!1),[X,re]=i.useState(u.audio.ambienceId),[v,ne]=i.useState(u.audio.masterVolume),[b,le]=i.useState(u.audio.voiceEnabled),[N,oe]=i.useState(!0),R=i.useRef(-1);$e(X,h,v);const A=i.useRef(0),k=i.useRef(0),M=i.useRef(0),H=i.useRef(Date.now()),W=i.useRef(null),Q=i.useRef(0);i.useEffect(()=>{W.current=r,Q.current=j},[r,j]);const w=V.find(t=>t.id===u.audio.chimeThemeId)||V[0];i.useEffect(()=>{if(g){const t=I.find(a=>a.id===g);t&&(z(t),H.current=Date.now())}},[g,I]);const T=i.useCallback(()=>{const t=W.current,a=Q.current;if(t&&a>0){const s=Math.floor((Date.now()-H.current)/1e3);je({id:Date.now().toString(),date:new Date().toISOString(),type:"breathwork",title:t.title,durationSeconds:s>0?s:0})}},[]);i.useEffect(()=>()=>{T()},[T]);const ce=i.useCallback(t=>{if(!b||typeof window>"u")return;window.speechSynthesis.cancel();const a=new SpeechSynthesisUtterance(t);if(u.audio.voiceURI){const s=window.speechSynthesis.getVoices().find(n=>n.voiceURI===u.audio.voiceURI);s&&(a.voice=s)}a.rate=.9,a.volume=.7,window.speechSynthesis.speak(a)},[b,u.audio.voiceURI]),Y=t=>{if(!r)return;const{config:a}=r,s=[{name:"Inhale",duration:a.inhale,freq:w.frequencies.inhale},{name:"Hold",duration:a.holdIn,freq:w.frequencies.hold},{name:"Exhale",duration:a.exhale,freq:w.frequencies.exhale},{name:"Hold",duration:a.holdOut,freq:w.frequencies.hold}].filter(o=>o.duration>0),n=s.reduce((o,y)=>o+y.duration,0)*1e3;let l=t-A.current+M.current,x=l%n,m=Math.floor(l/n),p=0,c=0,d=0;for(let o=0;o<s.length;o++){const y=s[o].duration*1e3;if(x<p+y){c=o,d=x-p;break}p+=y}const q=s[c].duration*1e3,pe=Math.min(d/q,1),fe=Math.ceil((q-d)/1e3);if(D(c),F(pe),B(fe),_(m),c!==R.current){const o=s[c];N&&Pe(o.freq,w.soundType,1.5,v),ce(o.name),R.current=c}k.current=requestAnimationFrame(Y)},de=()=>{h?(E(!1),cancelAnimationFrame(k.current),window.speechSynthesis.pause(),M.current+=performance.now()-A.current):(E(!0),A.current=performance.now(),k.current=requestAnimationFrame(Y),window.speechSynthesis.resume())},he=()=>{E(!1),cancelAnimationFrame(k.current),window.speechSynthesis.cancel(),M.current=0,_(0),D(0),F(0),B(0),R.current=-1},ue=()=>{T(),he(),g?L():z(null)},J=(t,a)=>{t&&t.stopPropagation();const s=Ee({id:a.id,title:a.title,type:"breathwork"});ae(s)},K=t=>se.some(a=>a.id===t&&a.type==="breathwork"),xe=()=>{var c;if(!r)return null;const{config:t,theme:a}=r,s=[{name:"Inhale",duration:t.inhale},{name:"Hold",duration:t.holdIn},{name:"Exhale",duration:t.exhale},{name:"Hold",duration:t.holdOut}].filter(d=>d.duration>0),n=(c=s[P])==null?void 0:c.name;let l=1;const x=1,m=1.6,p=d=>-(Math.cos(Math.PI*d)-1)/2;if(n==="Inhale")l=x+(m-x)*p(f);else if(n==="Exhale")l=m-(m-x)*p(f);else if(n==="Hold"){const d=(P-1+s.length)%s.length;l=s[d].name==="Inhale"?m:x}return e.jsxs("div",{className:"relative flex items-center justify-center w-64 h-64 sm:w-80 sm:h-80 md:w-96 md:h-96 landscape:w-56 landscape:h-56 landscape:lg:w-80 landscape:lg:h-80",children:[e.jsx("div",{className:`absolute inset-0 rounded-full ${a.blob} blur-3xl opacity-20 will-change-transform`,style:{transform:`scale(${l*1.2})`}}),e.jsx("div",{className:`w-40 h-40 sm:w-52 sm:h-52 md:w-60 md:h-60 rounded-full ${a.core} backdrop-blur-md border border-white/20 flex items-center justify-center shadow-[0_0_40px_rgba(0,0,0,0.2)] relative z-20 will-change-transform`,style:{transform:`scale(${l})`,boxShadow:h&&(n==="Inhale"||n==="Hold"&&l>1.2)?"0 0 60px rgba(255,255,255,0.3)":"0 0 20px rgba(0,0,0,0.1)"},children:e.jsx("div",{className:"flex flex-col items-center justify-center",children:e.jsx("span",{className:`text-5xl sm:text-6xl font-light font-serif ${a.text}`,children:h?ie:e.jsx(S,{size:40,className:"opacity-50 animate-pulse-slow"})})})})]})},me=()=>{if(!r||!h)return null;const{config:t}=r,a=[{name:"Inhale",duration:t.inhale},{name:"Hold",duration:t.holdIn},{name:"Exhale",duration:t.exhale},{name:"Hold",duration:t.holdOut}].filter(s=>s.duration>0);return e.jsx("div",{className:"w-full max-w-md px-8 mt-12 landscape:mt-6 mb-4 relative h-12 flex items-center justify-between gap-2",children:a.map((s,n)=>{const l=n===P;return e.jsxs("div",{className:"flex-1 flex flex-col items-center relative group",children:[e.jsx("span",{className:`text-xs font-bold uppercase tracking-widest mb-3 transition-all duration-300 ${l?"text-white scale-110":"text-white/30"}`,children:s.name}),e.jsx("div",{className:"w-full h-1 bg-white/10 rounded-full overflow-hidden relative",children:l&&e.jsx("div",{className:"h-full bg-white rounded-full absolute left-0 top-0 will-change-transform",style:{width:`${f*100}%`}})}),l&&e.jsx("div",{className:"absolute top-[22px] w-3 h-3 bg-white rounded-full shadow-[0_0_10px_rgba(255,255,255,0.8)] z-10 will-change-transform",style:{left:`${f*100}%`,transform:`translate(-50%, 0) translateY(${Math.sin(f*Math.PI)*-8}px)`}})]},n)})})};if(r){const t=r.theme,a=K(r.id);return e.jsxs("div",{className:"fixed inset-0 z-[60] flex flex-col landscape:flex-row bg-spiritual-deep overflow-hidden animate-fade-in",children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-b ${t.bgGradient} transition-colors duration-1000`}),e.jsxs("div",{className:"absolute top-0 left-0 w-full z-30 flex justify-between items-center p-6 pt-8 landscape:pt-6 landscape:p-6 text-white/80",children:[e.jsx("button",{onClick:ue,className:"p-3 bg-white/10 rounded-full hover:bg-white/20 transition backdrop-blur-md",children:e.jsx(ve,{size:24})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>G(!0),className:`p-3 rounded-full backdrop-blur-md transition-colors ${U?"bg-white/30 text-white":"bg-white/10 hover:bg-white/20"}`,children:e.jsx(Ne,{size:22})}),e.jsx("button",{onClick:()=>O(!$),className:`p-3 rounded-full backdrop-blur-md transition-colors ${$?"bg-white/30 text-white":"bg-white/10 hover:bg-white/20"}`,children:e.jsx(Re,{size:22})}),e.jsx("button",{onClick:s=>J(s,r),className:`p-3 rounded-full backdrop-blur-md transition-colors ${a?"bg-red-500/20 text-red-400":"bg-white/10 hover:bg-white/20"}`,children:e.jsx(Z,{size:22,fill:a?"currentColor":"none"})})]})]}),U&&e.jsxs(ke,{onClose:()=>G(!1),title:r.title,subtitle:"Technique Guide",icon:e.jsx(S,{size:24}),children:[e.jsx("div",{className:"p-6 bg-white/5 rounded-3xl border border-white/5",children:e.jsx("p",{className:"text-lg text-white/80 leading-relaxed font-medium",children:r.description})}),e.jsx("div",{className:"p-6 bg-white/5 rounded-3xl border border-white/5",children:e.jsx("p",{className:"text-lg text-white/80 leading-relaxed font-medium",children:" Important : Breathwork should be practiced strictly under the guidance of an authentic teacher. Do not practice holding patterns if you have high blood pressure, heart ailments or during pregnency or menstruation."})}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs font-bold text-white/40 uppercase tracking-widest mb-3",children:"Rhythm Pattern (Seconds)"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5 text-center",children:[e.jsx("span",{className:"block text-2xl font-bold text-white mb-1",children:r.config.inhale}),e.jsx("span",{className:"text-[10px] font-bold text-white/40 uppercase tracking-wider",children:"Inhale"})]}),e.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5 text-center",children:[e.jsx("span",{className:"block text-2xl font-bold text-white mb-1",children:r.config.holdIn}),e.jsx("span",{className:"text-[10px] font-bold text-white/40 uppercase tracking-wider",children:"Hold"})]}),e.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5 text-center",children:[e.jsx("span",{className:"block text-2xl font-bold text-white mb-1",children:r.config.exhale}),e.jsx("span",{className:"text-[10px] font-bold text-white/40 uppercase tracking-wider",children:"Exhale"})]}),e.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5 text-center",children:[e.jsx("span",{className:"block text-2xl font-bold text-white mb-1",children:r.config.holdOut}),e.jsx("span",{className:"text-[10px] font-bold text-white/40 uppercase tracking-wider",children:"Hold"})]})]})]})]}),$&&e.jsxs("div",{className:"absolute top-24 right-6 z-40 w-72 bg-black/60 backdrop-blur-xl border border-white/10 rounded-[2rem] p-6 shadow-2xl animate-slide-in-right",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h4",{className:"text-white font-bold text-lg",children:"Soundscape"}),e.jsx("button",{onClick:()=>O(!1),children:e.jsx(ye,{size:20,className:"text-white/50 hover:text-white"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-3 gap-2",children:te.map(s=>e.jsx("button",{onClick:()=>re(s.id),className:`p-2 rounded-xl text-xs font-bold transition-all ${X===s.id?"bg-white text-spiritual-900":"bg-white/10 text-white/60 hover:bg-white/20"}`,children:s.name},s.id))}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-xs text-white/50 font-bold mb-2",children:[e.jsx("span",{children:"Ambience Vol"}),e.jsxs("span",{children:[Math.round(v*100),"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:v,onChange:s=>ne(parseFloat(s.target.value)),className:"w-full h-1.5 bg-white/20 rounded-full appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:bg-white [&::-webkit-slider-thumb]:rounded-full"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>le(!b),className:`flex-1 py-3 rounded-xl flex items-center justify-center gap-2 font-bold text-sm transition-colors ${b?"bg-white/20 text-white":"bg-white/5 text-white/40"}`,children:[b?e.jsx(Se,{size:16}):e.jsx(Ae,{size:16})," Voice"]}),e.jsxs("button",{onClick:()=>oe(!N),className:`flex-1 py-3 rounded-xl flex items-center justify-center gap-2 font-bold text-sm transition-colors ${N?"bg-white/20 text-white":"bg-white/5 text-white/40"}`,children:[N?e.jsx(Ce,{size:16}):e.jsx(Ie,{size:16})," Chime"]})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center landscape:items-end landscape:pr-12 w-full landscape:w-1/2 pt-20 landscape:pt-0 relative z-10",children:[e.jsxs("div",{className:"landscape:hidden text-center mb-8 px-6",children:[e.jsx("h2",{className:`text-3xl font-bold tracking-[0.2em] uppercase opacity-80 ${t.text}`,children:r.title}),h&&e.jsxs("p",{className:"text-white/40 text-sm mt-2 font-mono tracking-wider",children:["Cycle ",j+1]})]}),xe()]}),e.jsxs("div",{className:"w-full landscape:w-1/2 flex flex-col items-center justify-start landscape:justify-center p-6 landscape:pl-0 landscape:pr-12 pb-12 landscape:pb-0 z-20",children:[e.jsxs("div",{className:"hidden landscape:block text-center mb-6",children:[e.jsx("h2",{className:`text-3xl font-bold tracking-[0.2em] uppercase opacity-80 ${t.text}`,children:r.title}),h&&e.jsxs("p",{className:"text-white/40 text-sm mt-2 font-mono tracking-wider",children:["Cycle ",j+1]})]}),me(),e.jsx("div",{className:"mt-8 landscape:mt-6",children:e.jsx("button",{onClick:de,className:`w-20 h-20 rounded-full flex items-center justify-center shadow-2xl ${t.button} text-white transition-transform hover:scale-105 active:scale-95 ring-4 ring-white/5`,children:h?e.jsx(Me,{size:32,fill:"currentColor"}):e.jsx(ee,{size:32,fill:"currentColor",className:"ml-1"})})})]})]})}return e.jsxs("div",{className:"p-6 pb-40 animate-fade-in max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-end mb-10 mt-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-sky-600 dark:text-sky-400",children:[e.jsx(S,{size:20}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-widest",children:"Pranayama"})]}),e.jsx("h2",{className:"text-4xl font-bold text-spiritual-900 dark:text-spiritual-50 mb-2",children:"Breathwork"}),e.jsx("p",{className:"text-lg text-spiritual-500 dark:text-spiritual-400",children:"Control the breath, control the mind"})]}),e.jsx("button",{onClick:L,className:"w-14 h-14 rounded-full border border-sky-200 dark:border-sky-800 text-sky-400 flex items-center justify-center hover:bg-sky-500 hover:text-white transition-all hover:scale-110",children:e.jsx(ze,{size:24})})]}),e.jsx("div",{className:"space-y-5",children:I.map(t=>{const a=K(t.id);return e.jsxs("div",{onClick:()=>{z(t),H.current=Date.now()},className:"relative overflow-hidden bg-white dark:bg-spiritual-900/40 p-6 rounded-[2.5rem] shadow-soft border border-spiritual-100 dark:border-spiritual-700/50 flex items-center gap-6 cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-all group",children:[e.jsx("div",{className:`absolute inset-0 opacity-0 group-hover:opacity-10 transition-opacity bg-gradient-to-br ${t.theme.bgGradient}`}),e.jsx("div",{className:`w-20 h-20 rounded-3xl ${t.theme.iconBg} flex items-center justify-center flex-shrink-0 group-hover:scale-105 transition-transform relative z-10 shadow-md`,children:e.jsx(S,{size:32,className:t.theme.iconColor})}),e.jsxs("div",{className:"flex-1 min-w-0 relative z-10",children:[e.jsx("h3",{className:"text-xl font-bold text-spiritual-900 dark:text-spiritual-100 mb-1",children:t.title}),e.jsx("p",{className:"text-spiritual-500 dark:text-spiritual-400 text-sm line-clamp-2 leading-relaxed",children:t.description})]}),e.jsxs("div",{className:"flex flex-col items-center gap-3 relative z-10",children:[e.jsx("button",{onClick:s=>J(s,t),className:`p-2 rounded-full transition-colors ${a?"text-red-500 bg-red-50 dark:bg-red-900/20":"text-spiritual-300 dark:text-spiritual-600 hover:text-red-400 hover:bg-spiritual-50 dark:hover:bg-spiritual-800"}`,children:e.jsx(Z,{size:20,fill:a?"currentColor":"none"})}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-spiritual-50 dark:bg-spiritual-800 flex items-center justify-center text-spiritual-400 dark:text-spiritual-500 group-hover:bg-spiritual-800 group-hover:text-white dark:group-hover:bg-spiritual-100 dark:group-hover:text-spiritual-800 transition-colors",children:e.jsx(ee,{size:16,fill:"currentColor"})})]})]},t.id)})})]})};export{Ve as default};
