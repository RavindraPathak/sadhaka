import{b as ie,j as e,c as $,B as R,V as A,d as le,e as ne,i as oe,f as de}from"./index-rmReRlAf.js";import{r as c}from"./vendor-DDTLr4RV.js";import{E as ce}from"./EmptyState-DbK6_uT7.js";import{a1 as xe,N as ue,aj as pe,z as F,r as he,q as me,ak as be,O as ge,al as fe,Y as C,C as we,a9 as je,am as ke,I as ve,J as Ne}from"./utils-CRISSmvu.js";const Me=({onBack:S,onNavigate:m})=>{const[b,J]=c.useState([]),[U,g]=c.useState(!1),[E,T]=c.useState(!1),[o,M]=c.useState(new Date),[h,q]=c.useState(()=>{const t=new Date;return new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().split("T")[0]}),[p,f]=c.useState(null),[w,Y]=c.useState("export"),[j,B]=c.useState(""),[k,V]=c.useState(""),v=c.useCallback(()=>{J(ie())},[]);c.useEffect(()=>{v();const t=()=>v();return window.addEventListener("sadhaka_journal_updated",t),()=>window.removeEventListener("sadhaka_journal_updated",t)},[v]);const z=c.useMemo(()=>{const t={};return b.forEach(s=>{const n=s.date.split("T")[0];t[n]=s}),t},[b]),_=(()=>{const t=o.getFullYear(),s=o.getMonth(),n=new Date(t,s,1),x=new Date(t,s+1,0),l=new Date(n);l.setDate(l.getDate()-l.getDay());const a=new Date(x);a.setDate(a.getDate()+(6-a.getDay()));const r=[];let i=new Date(l);for(;i<=a;)r.push(new Date(i)),i.setDate(i.getDate()+1);return r})(),P=["S","M","T","W","T","F","S"],N=o.toLocaleString("default",{month:"long",year:"numeric"}),W=()=>M(new Date(o.getFullYear(),o.getMonth()-1,1)),G=()=>M(new Date(o.getFullYear(),o.getMonth()+1,1)),Z=t=>{const s=t.getTimezoneOffset(),x=new Date(t.getTime()-s*6e4).toISOString().split("T")[0];q(x)},I=()=>{m&&m(A.JOURNAL_EDIT,void 0,{isNested:!0,initialDate:h})},K=t=>{m&&m(A.JOURNAL_EDIT,t.id,{isNested:!0,initialDate:h})},H=(t,s)=>{t.preventDefault(),t.stopPropagation(),f({title:"Delete Entry?",message:"Are you sure you want to permanently delete this entry?",confirmText:"Delete Entry",onConfirm:()=>{le(s)}})},Q=()=>{const t=b.filter(a=>{if(!j&&!k)return!0;const r=new Date(a.date).getTime(),i=j?new Date(`${j}T00:00:00.000Z`).getTime():0,y=k?new Date(`${k}T23:59:59.999Z`).getTime():1/0;return r>=i&&r<=y});if(t.length===0){alert("No entries found in the selected date range.");return}const s=ne(t);if(!s)return;const n=new Blob([s],{type:"text/csv"}),x=window.URL.createObjectURL(n),l=document.createElement("a");l.href=x,l.download=`sadhaka-journal-${new Date().toISOString().split("T")[0]}.csv`,l.click(),window.URL.revokeObjectURL(x)},X=t=>{var x;const s=(x=t.target.files)==null?void 0:x[0];if(!s)return;const n=new FileReader;n.onload=l=>{var r;const a=(r=l.target)==null?void 0:r.result;if(a){const i=oe(a);alert(`Successfully imported ${i} entries.`),v(),g(!1)}},n.readAsText(s)},ee=()=>{f({title:"Delete All Entries?",message:"This will permanently remove all journal entries. This action cannot be undone.",confirmText:"Delete Everything",onConfirm:()=>{de(),g(!1)}})},te=()=>{const t=b.filter(a=>{const r=new Date(a.date);return r.getMonth()===o.getMonth()&&r.getFullYear()===o.getFullYear()});if(t.length===0)return null;const s={};t.forEach(a=>{const r=$(a.mood),i=r.rootLabel||"Unknown";s[i]||(s[i]={count:0,color:r.rootColor,label:i}),s[i].count++});const n=Object.values(s).sort((a,r)=>r.count-a.count),l=(t.reduce((a,r)=>{var i;return a+(((i=r.completedDisciplines)==null?void 0:i.length)||0)},0)/t.length).toFixed(1);return{totalEntries:t.length,moodStats:n,dominantMood:n[0],avgSadhana:l,daysInMonth:new Date(o.getFullYear(),o.getMonth()+1,0).getDate()}},d=z[h],se=t=>e.jsxs("div",{className:"space-y-4 text-base font-serif",children:[t.q1&&e.jsxs("div",{className:"bg-white/50 dark:bg-black/20 p-4 rounded-xl border border-white/20",children:[e.jsx("p",{className:"text-xs font-bold text-spiritual-400 uppercase tracking-widest mb-2",children:"Intention & Confession"}),e.jsxs("p",{className:"text-spiritual-800 dark:text-spiritual-200 leading-relaxed italic",children:['"',t.q1,'"']})]}),t.q2&&e.jsxs("div",{className:"bg-white/50 dark:bg-black/20 p-4 rounded-xl border border-white/20",children:[e.jsx("p",{className:"text-xs font-bold text-spiritual-400 uppercase tracking-widest mb-2",children:"Reaction & Interaction"}),e.jsxs("p",{className:"text-spiritual-800 dark:text-spiritual-200 leading-relaxed italic",children:['"',t.q2,'"']})]}),t.q3&&e.jsxs("div",{className:"bg-white/50 dark:bg-black/20 p-4 rounded-xl border border-white/20",children:[e.jsx("p",{className:"text-xs font-bold text-spiritual-400 uppercase tracking-widest mb-2",children:"Balance & Service"}),e.jsxs("p",{className:"text-spiritual-800 dark:text-spiritual-200 leading-relaxed italic",children:['"',t.q3,'"']})]})]}),ae=new Date(h).toLocaleDateString(void 0,{weekday:"long",day:"numeric",month:"long"}),u=E?te():null;return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"pb-36 min-h-screen bg-spiritual-50 dark:bg-spiritual-deep flex flex-col animate-fade-in",children:[e.jsxs("div",{className:"sticky top-0 z-50 pt-8 pb-4 px-6 rounded-b-[2rem] shadow-soft flex items-center justify-between bg-gradient-to-br from-spiritual-50 via-white to-spiritual-gold/20 dark:from-spiritual-900 dark:via-spiritual-deep dark:to-spiritual-gold/10 backdrop-blur-md",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[S?e.jsx("button",{onClick:S,className:"p-3 bg-white dark:bg-white/10 rounded-full shadow-sm hover:scale-105 transition-transform text-spiritual-600 dark:text-spiritual-200","aria-label":"Back",children:e.jsx(xe,{size:20})}):e.jsx("div",{className:"p-3 bg-spiritual-gold/10 rounded-full text-spiritual-600 dark:text-spiritual-400",children:e.jsx(ue,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-spiritual-900 dark:text-spiritual-50",children:"Chintan"}),e.jsx("p",{className:"text-xs text-spiritual-600 dark:text-spiritual-400 font-bold uppercase tracking-wider",children:"Reflect on your day"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>T(!0),className:"p-3 bg-white dark:bg-white/10 rounded-full shadow-sm text-spiritual-500 hover:text-spiritual-800 dark:text-spiritual-400 dark:hover:text-white transition-colors",title:"Insights",children:e.jsx(pe,{size:24})}),e.jsx("button",{onClick:()=>g(!0),className:"p-3 bg-white dark:bg-white/10 rounded-full shadow-sm text-spiritual-500 hover:text-spiritual-800 dark:text-spiritual-400 dark:hover:text-white transition-colors",title:"Manage Data",children:e.jsx(F,{size:24})})]})]}),e.jsxs("div",{className:"flex-1 p-4 md:p-6 max-w-2xl mx-auto w-full relative z-20 space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-spiritual-900/60 p-6 rounded-[2.5rem] shadow-soft border border-spiritual-100 dark:border-spiritual-700/50 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("button",{onClick:W,className:"p-2 rounded-full hover:bg-spiritual-100 dark:hover:bg-spiritual-800 text-spiritual-600 dark:text-spiritual-300 transition-colors",children:e.jsx(he,{size:20})}),e.jsx("span",{className:"text-lg font-bold text-spiritual-900 dark:text-spiritual-100 uppercase tracking-widest",children:N}),e.jsx("button",{onClick:G,className:"p-2 rounded-full hover:bg-spiritual-100 dark:hover:bg-spiritual-800 text-spiritual-600 dark:text-spiritual-300 transition-colors",children:e.jsx(me,{size:20})})]}),e.jsx("div",{className:"grid grid-cols-7 mb-2",children:P.map((t,s)=>e.jsx("div",{className:"text-center text-xs font-bold text-spiritual-400 dark:text-spiritual-500 py-2",children:t},s))}),e.jsx("div",{className:"grid grid-cols-7 gap-y-2",children:_.map((t,s)=>{const n=t.getTimezoneOffset(),l=new Date(t.getTime()-n*6e4).toISOString().split("T")[0],a=z[l],r=l===h,i=t.getMonth()===o.getMonth(),y=l===new Date().toISOString().split("T")[0];let O="transparent",L=i?"text-spiritual-700 dark:text-spiritual-300":"text-spiritual-300 dark:text-spiritual-700",D="transparent";if(a){const{rootColor:re}=$(a.mood);O=re,L="text-white font-bold"}return r?D="ring-2 ring-spiritual-800 dark:ring-white ring-offset-2 dark:ring-offset-spiritual-900":y&&!a&&(D="ring-1 ring-spiritual-300 dark:ring-spiritual-600"),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{onClick:()=>Z(t),className:`w-9 h-9 rounded-full flex items-center justify-center text-sm transition-all duration-300 ${L} ${D} hover:scale-110 active:scale-95`,style:{backgroundColor:O},children:t.getDate()})},s)})})]}),e.jsxs("div",{className:"animate-slide-in-bottom",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 px-2",children:[e.jsxs("h3",{className:"text-xl font-bold text-spiritual-900 dark:text-spiritual-50 flex items-center gap-2",children:[ae,d&&e.jsx("span",{className:"text-xs font-bold px-2 py-1 rounded-lg bg-spiritual-100 dark:bg-spiritual-800 text-spiritual-600 dark:text-spiritual-300 uppercase tracking-wider",children:d.mood})]}),d?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>K(d),className:"p-2 bg-white dark:bg-white/10 rounded-full shadow-sm text-spiritual-500 hover:text-spiritual-800 dark:hover:text-white transition-colors",children:e.jsx(be,{size:18})}),e.jsx("button",{onClick:t=>H(t,d.id),className:"p-2 bg-white dark:bg-white/10 rounded-full shadow-sm text-spiritual-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/10 transition-colors",children:e.jsx(ge,{size:18})})]}):e.jsxs("button",{onClick:I,className:"flex items-center gap-2 px-4 py-2 bg-spiritual-800 dark:bg-spiritual-100 text-white dark:text-spiritual-900 rounded-full text-sm font-bold shadow-md hover:scale-105 transition-transform",children:[e.jsx(fe,{size:16}),e.jsx("span",{children:"Write Entry"})]})]}),d?e.jsxs("div",{className:"bg-white dark:bg-spiritual-900/60 p-6 rounded-[2.5rem] shadow-soft border border-spiritual-100 dark:border-spiritual-700/50 backdrop-blur-sm",children:[se(d),d.learning&&e.jsxs("div",{className:"mt-6 flex items-start gap-2 text-spiritual-500 bg-spiritual-50 dark:bg-spiritual-800/50 p-3 rounded-xl",children:[e.jsx(C,{size:24,className:"mt-0.5 text-spiritual-400"}),e.jsxs("span",{className:"italic",children:['"',d.learning,'"']})]}),d.completedDisciplines&&d.completedDisciplines.length>0&&e.jsxs("div",{className:"mt-6 pt-4 border-t border-spiritual-100 dark:border-spiritual-700/50",children:[e.jsx("p",{className:"text-xs font-bold text-spiritual-400 uppercase tracking-widest mb-3",children:"Completed Goals"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:d.completedDisciplines.map((t,s)=>e.jsxs("span",{className:"px-2.5 py-1 bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 text-xs font-bold rounded-lg flex items-center gap-1",children:[e.jsx(we,{size:12})," ",t]},s))})]})]}):e.jsx(ce,{icon:e.jsx(je,{size:32}),message:"No entry for this day.",subMessage:"Tap 'Write Entry' to record your thoughts.",onAction:I,actionLabel:"Write Entry"})]})]}),E&&e.jsx(R,{onClose:()=>T(!1),title:`${N} Simhavalokana`,subtitle:"Overview of this month",icon:e.jsx(ke,{size:24}),children:u?e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white/5 p-4 rounded-2xl border border-white/5",children:[e.jsx("span",{className:"text-xs text-white/40 font-bold uppercase tracking-wider block mb-1",children:"Chintan Consistency"}),e.jsxs("span",{className:"text-2xl font-bold text-white font-mono",children:[Math.round(u.totalEntries/u.daysInMonth*100),"%"]}),e.jsxs("span",{className:"text-xs text-white/40 ml-2",children:["(",u.totalEntries,"/",u.daysInMonth," days)"]})]}),e.jsxs("div",{className:"bg-white/5 p-4 rounded-2xl border border-white/5",children:[e.jsx("span",{className:"text-xs text-white/40 font-bold uppercase tracking-wider block mb-1",children:"Avg Goal Completion"}),e.jsx("span",{className:"text-2xl font-bold text-white font-mono",children:u.avgSadhana}),e.jsx("span",{className:"text-xs text-white/40 ml-2",children:"tasks / entry"})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-bold text-white/80 mb-4 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:u.dominantMood.color}}),"Dominant Mood: ",u.dominantMood.label]}),e.jsx("div",{className:"space-y-3",children:u.moodStats.map((t,s)=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs font-bold text-white/60",children:[e.jsx("span",{children:t.label}),e.jsx("span",{children:t.count})]}),e.jsx("div",{className:"h-2 w-full bg-white/5 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full",style:{width:`${t.count/u.totalEntries*100}%`,backgroundColor:t.color}})})]},s))})]})]}):e.jsx("div",{className:"text-center py-12 opacity-50 border border-dashed border-white/10 rounded-2xl",children:e.jsxs("p",{className:"text-sm text-white/60",children:["No entries recorded for ",N,"."]})})}),U&&e.jsxs(R,{onClose:()=>g(!1),title:"Data Control",subtitle:"Manage your history",icon:e.jsx(F,{size:24}),children:[e.jsx("div",{className:"flex p-2 mb-6 dark:bg-slate-800 rounded-2xl",children:["export","import","clear"].map(t=>e.jsx("button",{onClick:()=>Y(t),className:`flex-1 py-2.5 rounded-xl text-sm font-bold capitalize transition-all ${w===t?"bg-white dark:bg-slate-700 shadow-sm text-spiritual-900 dark:text-spiritual-100":"text-spiritual-400"}`,children:t==="clear"?e.jsx("span",{className:"text-red-400",children:t}):t},t))}),e.jsxs("div",{className:"min-h-[200px]",children:[e.jsxs("div",{className:`space-y-6 ${w==="export"?"animate-fade-in":"hidden"}`,children:[e.jsxs("div",{className:"dark:bg-slate-800/50 p-6 rounded-[2rem]",children:[e.jsx("label",{className:"text-xs font-bold text-spiritual-400 uppercase tracking-wider mb-4 block",children:"Date Range (Optional)"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-bold text-spiritual-300 uppercase ml-1",children:"Start"}),e.jsx("input",{type:"date",value:j,onChange:t=>B(t.target.value),className:"w-full p-3 rounded-xl bg-white dark:bg-slate-900 border border-spiritual-200 dark:border-slate-700 focus:outline-none text-spiritual-800 dark:text-spiritual-200"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-bold text-spiritual-300 uppercase ml-1",children:"End"}),e.jsx("input",{type:"date",value:k,onChange:t=>V(t.target.value),className:"w-full p-3 rounded-xl bg-white dark:bg-slate-900 border border-spiritual-200 dark:border-slate-700 focus:outline-none text-spiritual-800 dark:text-spiritual-200"})]})]})]}),e.jsxs("button",{onClick:Q,className:"w-full py-4 bg-spiritual-800 dark:bg-spiritual-700 text-white rounded-2xl font-bold flex items-center justify-center gap-2 hover:scale-[1.02] active:scale-95 transition-all shadow-lg",children:[e.jsx(ve,{size:20})," Download CSV"]})]}),e.jsxs("div",{className:`space-y-6 text-center py-4 ${w==="import"?"animate-fade-in":"hidden"}`,children:[e.jsx("div",{className:"w-20 h-20 bg-spiritual-50 dark:bg-slate-800 rounded-full flex items-center justify-center mx-auto",children:e.jsx(Ne,{size:32,className:"text-spiritual-400"})}),e.jsx("p",{className:"text-spiritual-500 dark:text-spiritual-400 px-4",children:"Restore entries from a previously exported CSV."}),e.jsxs("label",{className:"block w-full py-4 bg-spiritual-100 dark:bg-slate-800 text-spiritual-800 dark:text-spiritual-100 rounded-2xl font-bold cursor-pointer hover:bg-spiritual-200 transition-colors",children:["Choose File",e.jsx("input",{type:"file",accept:".csv",className:"hidden",onChange:X})]})]}),e.jsxs("div",{className:`space-y-6 text-center py-4 ${w==="clear"?"animate-fade-in":"hidden"}`,children:[e.jsx("div",{className:"w-20 h-20 bg-red-50 dark:bg-red-900/20 rounded-full flex items-center justify-center mx-auto animate-pulse",children:e.jsx(C,{size:32,className:"text-red-500"})}),e.jsx("p",{className:"text-red-500/80 px-4 font-medium",children:"Warning: This will permanently delete all journal entries."}),e.jsx("button",{onClick:ee,className:"w-full py-4 bg-red-500 text-white rounded-2xl font-bold hover:bg-red-600 transition-colors shadow-lg shadow-red-500/20",children:"Delete Everything"})]})]})]}),p&&e.jsx("div",{className:"fixed inset-0 bg-spiritual-deep/80 backdrop-blur-md z-[70] flex items-center justify-center p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-spiritual-900 w-full max-w-sm rounded-[2.5rem] p-8 shadow-2xl border border-white/10",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`w-16 h-16 ${p.confirmText.toLowerCase().includes("delete")?"bg-red-50 dark:bg-red-900/20":"bg-amber-50 dark:bg-amber-900/20"} rounded-full flex items-center justify-center mx-auto mb-6`,children:e.jsx(C,{size:32,className:`${p.confirmText.toLowerCase().includes("delete")?"text-red-500":"text-amber-500"}`})}),e.jsx("h3",{className:"text-2xl font-bold text-spiritual-900 dark:text-spiritual-100 mb-2",children:p.title}),e.jsx("p",{className:"text-spiritual-500 dark:text-spiritual-400 mb-8",children:p.message})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("button",{onClick:()=>{p.onConfirm(),f(null)},className:`w-full py-4 text-white rounded-2xl font-bold transition-colors ${p.confirmText.toLowerCase().includes("delete")?"bg-red-500 hover:bg-red-600":"bg-spiritual-800 hover:bg-spiritual-900"}`,children:p.confirmText}),e.jsx("button",{onClick:()=>f(null),className:"w-full py-3 text-spiritual-500 dark:text-spiritual-400 font-bold hover:bg-spiritual-100 dark:hover:bg-spiritual-800 rounded-2xl transition-colors",children:"Cancel"})]})]})})]})})};export{Me as default};
