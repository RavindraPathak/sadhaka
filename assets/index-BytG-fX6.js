const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Breathwork-B5ZUP_b-.js","assets/vendor-DDTLr4RV.js","assets/FilterBar-Bum94_p2.js","assets/utils-CadWPAO0.js","assets/Journal-Bp3O11X2.js","assets/EmptyState-Dd8iFAnK.js","assets/JournalEntryEditor-SXCVKtD9.js","assets/CompassTool-CLwDCtkd.js","assets/TrackerSettings-BMEZFy03.js","assets/Mindfulness-Bck9g5_0.js","assets/YogaStretches-DCiTPyey.js","assets/MantraChanting-BKTpuF28.js","assets/Sadhana-DJus5JV2.js","assets/PracticeMenu-QHRmESbo.js","assets/Gurukul-DYRSGatH.js","assets/RoutineBuilder-C2foYisI.js","assets/ResourcesView-CYaY1tU7.js"])))=>i.map(i=>d[i]);
var h0=Object.defineProperty;var m0=(r,e,t)=>e in r?h0(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var xr=(r,e,t)=>m0(r,typeof e!="symbol"?e+"":e,t);import{r as S,a as Yh,R as Me,b as Jh}from"./vendor-DDTLr4RV.js";import{U as Xh,B as f0,N as Zh,C as Qt,H as p0,S as Sr,a as em,L as Vl,D as g0,K as x0,E as y0,b as b0,A as oa,c as Fn,d as Da,M as Ol,e as Ml,f as Us,g as Qn,h as v0,i as _0,j as w0,W as Bs,k as zs,l as tm,m as I0,n as T0,F as Ll,o as Ho,p as nm,q as E0,r as Dt,s as rm,X as Qr,t as k0,u as A0,v as qu,w as un,x as Bt,V as S0,P as N0,y as R0,T as sm,z as Wo,Z as Qo,G as la,I as C0,R as D0,J as P0,O as j0,Q as V0,Y as O0,_ as M0,$ as L0,a0 as im,a1 as am,a2 as F0,a3 as Ku,a4 as Nr,a5 as om,a6 as Pa,a7 as U0,a8 as B0,a9 as Fl,aa as li,ab as Hu,ac as z0,ad as $0,ae as Ao,af as G0,ag as q0,ah as K0,ai as H0,aj as Wu,ak as W0,al as lm}from"./utils-CadWPAO0.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();var cm={exports:{}},ja={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Q0=S,Y0=Symbol.for("react.element"),J0=Symbol.for("react.fragment"),X0=Object.prototype.hasOwnProperty,Z0=Q0.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ex={key:!0,ref:!0,__self:!0,__source:!0};function um(r,e,t){var n,s={},i=null,a=null;t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(n in e)X0.call(e,n)&&!ex.hasOwnProperty(n)&&(s[n]=e[n]);if(r&&r.defaultProps)for(n in e=r.defaultProps,e)s[n]===void 0&&(s[n]=e[n]);return{$$typeof:Y0,type:r,key:i,ref:a,props:s,_owner:Z0.current}}ja.Fragment=J0;ja.jsx=um;ja.jsxs=um;cm.exports=ja;var o=cm.exports,Yo={},Qu=Yh;Yo.createRoot=Qu.createRoot,Yo.hydrateRoot=Qu.hydrateRoot;const tx="modulepreload",nx=function(r){return"/sadhaka/"+r},Yu={},xt=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),c=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=Promise.allSettled(t.map(u=>{if(u=nx(u),u in Yu)return;Yu[u]=!0;const d=u.endsWith(".css"),m=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${m}`))return;const p=document.createElement("link");if(p.rel=d?"stylesheet":tx,d||(p.as="script"),p.crossOrigin="",p.href=u,c&&p.setAttribute("nonce",c),document.head.appendChild(p),d)return new Promise((x,b)=>{p.addEventListener("load",x),p.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(a){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=a,window.dispatchEvent(c),!c.defaultPrevented)throw a}return s.then(a=>{for(const c of a||[])c.status==="rejected"&&i(c.reason);return e().catch(i)})};var X=(r=>(r.DASHBOARD="DASHBOARD",r.PRACTICE_MENU="PRACTICE_MENU",r.BREATHWORK="BREATHWORK",r.MEDITATION="MEDITATION",r.YOGA="YOGA",r.MANTRA="MANTRA",r.JOURNAL="JOURNAL",r.JOURNAL_EDIT="JOURNAL_EDIT",r.SADHANA="SADHANA",r.SADHANA_EDIT="SADHANA_EDIT",r.GURUKUL="GURUKUL",r.PROFILE="PROFILE",r.COMPASS="COMPASS",r.ROUTINE="ROUTINE",r.RESOURCES="RESOURCES",r.PANCHANG="PANCHANG",r))(X||{}),wr=(r=>(r.DEEP_BELLY="Deep Belly",r.BOX="Box Breathing",r.RELAX_4_7_8="4-7-8 Relax",r.ANULOM_VILOM="Anulom Vilom",r.KAPALBHATI="Kapalbhati",r.KRIYA_PRANAYAM="kriya-pranayam",r))(wr||{});const rx=({currentView:r,onChange:e})=>{const t=[{view:X.DASHBOARD,label:"Sankalp",icon:Xh},{view:X.PRACTICE_MENU,label:"Swadhyay",icon:f0},{view:X.JOURNAL,label:"Chintan",icon:Zh},{view:X.SADHANA,label:"Sadhana",icon:Qt},{view:X.GURUKUL,label:"Gurukul",icon:p0}];return o.jsx("div",{className:"fixed bottom-8 left-0 right-0 z-40 pb-safe safe-area-pb pointer-events-none flex justify-center",children:o.jsx("div",{className:"glass dark:bg-spiritual-900/90 backdrop-blur-2xl rounded-full shadow-float flex justify-between items-center px-6 h-20 pointer-events-auto gap-4 sm:gap-10 transition-all duration-500",children:t.map(n=>{const s=r===n.view||n.view===X.PRACTICE_MENU&&(r===X.BREATHWORK||r===X.MEDITATION||r===X.YOGA);return o.jsxs("button",{onClick:()=>e(n.view),className:"relative flex items-center justify-center group min-w-[48px] min-h-[48px]","aria-label":n.label,children:[o.jsx("div",{className:`p-3 rounded-full transition-all duration-700 ease-out ${s?"bg-spiritual-800 dark:bg-spiritual-100 text-spiritual-50 dark:text-spiritual-900 transform scale-110":"text-spiritual-400 dark:text-spiritual-500 group-hover:text-spiritual-600 dark:group-hover:text-spiritual-300"}`,children:o.jsx(n.icon,{size:24,strokeWidth:1.5,className:"transition-transform duration-500"})}),s&&o.jsx("div",{className:"absolute -bottom-2 w-1 h-1 rounded-full bg-spiritual-800 dark:bg-spiritual-100 opacity-0 animate-fade-in"})]},n.label)})})})},Ju=()=>o.jsx("div",{className:"fixed inset-0 z-50 bg-spiritual-50 dark:bg-spiritual-deep flex items-center justify-center transition-colors duration-500",children:o.jsxs("div",{className:"relative",children:[o.jsx("div",{className:"w-16 h-16 border-4 border-spiritual-200 dark:border-spiritual-800 rounded-full opacity-50"}),o.jsx("div",{className:"absolute top-0 left-0 w-16 h-16 border-4 border-spiritual-gold rounded-full border-t-transparent animate-spin"}),o.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:o.jsx(Sr,{size:20,className:"text-spiritual-400 animate-pulse"})})]})}),Va="sadhaka_security_pin_hash",Ul="sadhaka_bio_cred_id",dm=async r=>{const e=new TextEncoder().encode(r),t=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(s=>s.toString(16).padStart(2,"0")).join("")},hm=async r=>{const e=await dm(r);localStorage.setItem(Va,e)},mm=async r=>{const e=localStorage.getItem(Va);return e?await dm(r)===e:!0},Jo=()=>!!localStorage.getItem(Va),sx=()=>{localStorage.removeItem(Va),localStorage.removeItem(Ul)};function ix(r){return btoa(String.fromCharCode(...new Uint8Array(r)))}function ax(r){const e=atob(r),t=e.length,n=new Uint8Array(t);for(let s=0;s<t;s++)n[s]=e.charCodeAt(s);return n.buffer}const fm=async()=>window.PublicKeyCredential?!!await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable():!1,pm=async()=>{try{const r=new Uint8Array(32);window.crypto.getRandomValues(r);const e={challenge:r,rp:{name:"Sadhaka App",id:window.location.hostname},user:{id:new Uint8Array(16),name:"Sadhaka User",displayName:"Sadhaka Practitioner"},pubKeyCredParams:[{type:"public-key",alg:-7},{type:"public-key",alg:-257}],authenticatorSelection:{authenticatorAttachment:"platform",userVerification:"required"},timeout:6e4,attestation:"none"},t=await navigator.credentials.create({publicKey:e});return t?(localStorage.setItem(Ul,ix(t.rawId)),!0):!1}catch(r){return console.error("Biometric enrollment failed:",r),!1}},ox=async()=>{try{const r=localStorage.getItem(Ul),e=new Uint8Array(32);window.crypto.getRandomValues(e);const t={challenge:e,timeout:6e4,userVerification:"required",allowCredentials:r?[{id:ax(r),type:"public-key",transports:["internal"]}]:void 0};return!!await navigator.credentials.get({publicKey:t})}catch(r){return console.warn("Biometric verification failed/cancelled:",r),!1}},Is=[{id:"solarClock",isEnabled:!0,order:0},{id:"quote",isEnabled:!0,order:1},{id:"mandala",isEnabled:!0,order:2},{id:"moodRadial",isEnabled:!0,order:3},{id:"quickActions",isEnabled:!0,order:4},{id:"panchang",isEnabled:!0,order:5},{id:"compass",isEnabled:!0,order:6}],Bl={name:"New Delhi",coords:{lat:28.6139,lng:77.209},timezone:"Asia/Kolkata"},$t={theme:"light",location:null,defaults:{yogaPace:"normal",mantraSpeed:"normal",breathPatternId:null},audio:{masterVolume:.5,ambienceId:"none",voiceEnabled:!1,voiceURI:null,chimeThemeId:"classic",alarmToneId:"celestial",instrumentId:"sine"},goals:{breathworkMinutes:5,meditationMinutes:10,yogaMinutes:15,mantraMinutes:15},notifications:{alarmsEnabled:!0},security:{pinEnabled:!1,lockType:"none",biometricsEnabled:!1},dashboardLayout:Is,morningRoutine:[],eveningRoutine:[]},Xu="sadhaka_user_prefs_v1",lx="sadhaka_theme",cx="sadhaka_location",gm=S.createContext({preferences:$t,toggleTheme:()=>{},updateLocation:()=>{},updateDefaults:()=>{},updateGoals:()=>{},updateAudioSettings:()=>{},updateNotificationSettings:()=>{},updateSecuritySettings:()=>{},toggleWidget:()=>{},reorderWidget:()=>{},updateRoutine:()=>{}}),xm=({children:r})=>{const e=()=>{var V,P,U,L,G,I;const w=localStorage.getItem(Xu);if(w)try{const y=JSON.parse(w),v={...$t.audio,...y.audio||{}};y.defaults&&(y.defaults.voiceEnabled!==void 0&&((V=y.audio)==null?void 0:V.voiceEnabled)===void 0&&(v.voiceEnabled=y.defaults.voiceEnabled),y.defaults.voiceURI!==void 0&&((P=y.audio)==null?void 0:P.voiceURI)===void 0&&(v.voiceURI=y.defaults.voiceURI),y.defaults.chimeThemeId!==void 0&&((U=y.audio)==null?void 0:U.chimeThemeId)===void 0&&(v.chimeThemeId=y.defaults.chimeThemeId)),v.alarmToneId||(v.alarmToneId=$t.audio.alarmToneId),v.instrumentId||(v.instrumentId="sine");let E=y.dashboardLayout?y.dashboardLayout:Is;const T=new Set(E.map(ce=>ce.id));Is.forEach(ce=>{T.has(ce.id)||E.push(ce)});const A={...$t.goals,...y.goals||{}};A.mantraMinutes===void 0&&(A.mantraMinutes=$t.goals.mantraMinutes);const _=Jo();let se=(L=y.security)==null?void 0:L.lockType;se||(se=(G=y.security)!=null&&G.pinEnabled?"pin":"none"),_||(se="none");const ie={pinEnabled:se!=="none",lockType:se,biometricsEnabled:((I=y.security)==null?void 0:I.biometricsEnabled)??!1},de={...$t.defaults,...y.defaults||{}};return de.yogaPace||(de.yogaPace="normal"),de.mantraSpeed||(de.mantraSpeed="normal"),{...$t,...y,defaults:de,goals:A,audio:v,notifications:{...$t.notifications,...y.notifications||{}},security:ie,dashboardLayout:E}}catch(y){console.error("Failed to parse preferences",y)}const k=localStorage.getItem(lx);let N=null;const D=localStorage.getItem(cx);if(D)try{N=JSON.parse(D)}catch{}return{...$t,theme:k||"light",location:N||null}},[t,n]=S.useState(e);S.useEffect(()=>{const w=()=>{n(e())};return window.addEventListener("sadhaka_prefs_updated",w),()=>window.removeEventListener("sadhaka_prefs_updated",w)},[]),S.useEffect(()=>{localStorage.setItem(Xu,JSON.stringify(t)),t.theme==="dark"?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[t]);const s=()=>{n(w=>({...w,theme:w.theme==="light"?"dark":"light"}))},i=w=>{n(k=>({...k,location:w}))},a=w=>{n(k=>({...k,defaults:{...k.defaults,...w}}))},c=w=>{n(k=>({...k,goals:{...k.goals,...w}}))},u=w=>{n(k=>({...k,audio:{...k.audio,...w}}))},d=w=>{n(k=>({...k,notifications:{...k.notifications,...w}}))},m=w=>{n(k=>({...k,security:{...k.security,...w}}))},p=w=>{n(k=>{const D=(k.dashboardLayout||Is).map(V=>V.id===w?{...V,isEnabled:!V.isEnabled}:V);return{...k,dashboardLayout:D}})},x=(w,k)=>{n(N=>{const D=[...N.dashboardLayout||Is],V=D.findIndex(U=>U.id===w);if(V===-1)return N;const P=V+k;return P>=0&&P<D.length?([D[V],D[P]]=[D[P],D[V]],D.forEach((U,L)=>U.order=L),{...N,dashboardLayout:D}):N})},b=(w,k)=>{n(N=>({...N,[w==="morning"?"morningRoutine":"eveningRoutine"]:k}))};return o.jsx(gm.Provider,{value:{preferences:t,toggleTheme:s,updateLocation:i,updateDefaults:a,updateGoals:c,updateAudioSettings:u,updateNotificationSettings:d,updateSecuritySettings:m,toggleWidget:p,reorderWidget:x,updateRoutine:b},children:r})},Mt=()=>S.useContext(gm),zl=({mode:r,onSuccess:e,onCancel:t})=>{const[n,s]=S.useState(""),[i,a]=S.useState("enter"),[c,u]=S.useState(""),[d,m]=S.useState(null),[p,x]=S.useState(!1);S.useEffect(()=>{a(r==="setup"?"create":"enter")},[r]),S.useEffect(()=>{n.length===4&&N(n)},[n]);const b=P=>{n.length<4&&(s(U=>U+P),navigator.vibrate&&navigator.vibrate(10))},w=()=>{s(P=>P.slice(0,-1)),navigator.vibrate&&navigator.vibrate(10)},k=P=>{m(P),x(!0),navigator.vibrate&&navigator.vibrate([50,50,50]),setTimeout(()=>{s(""),x(!1),m(null)},500)},N=async P=>{await new Promise(U=>setTimeout(U,100)),r==="verify"?await mm(P)?(navigator.vibrate&&navigator.vibrate(20),e()):k("Incorrect PIN"):r==="setup"&&(i==="create"?(u(P),s(""),a("confirm")):i==="confirm"&&(P===c?(await hm(P),navigator.vibrate&&navigator.vibrate(20),e()):(k("PINs do not match"),a("create"))))},D=()=>r==="verify"?"Enter Sanctuary PIN":i==="create"?"Create New PIN":i==="confirm"?"Confirm PIN":"",V=()=>d||(r==="verify"?"Unlock your space":i==="create"?"Enter 4 digits":i==="confirm"?"Re-enter to verify":"");return o.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] w-full max-w-sm mx-auto p-6 animate-fade-in text-spiritual-900 text-spiritual-50",children:[o.jsxs("div",{className:"mb-8 text-center",children:[o.jsx("div",{className:"w-16 h-16 bg-spiritual-100 dark:bg-spiritual-800 rounded-full flex items-center justify-center mx-auto mb-4 shadow-inner",children:d?o.jsx(em,{size:32,className:"text-red-500"}):o.jsx(Vl,{size:32,className:"text-spiritual-500 dark:text-spiritual-400"})}),o.jsx("h2",{className:"text-2xl bg-spiritual-50 dark:bg-white/5 font-bold text-black/100 dark:text-white/100 font-serif mb-1",children:D()}),o.jsx("p",{className:`text-sm font-medium uppercase tracking-widest ${d?"text-red-500":"text-spiritual-400"}`,children:V()})]}),o.jsxs("div",{className:`flex gap-4 mb-10 ${p?"animate-shake":""}`,children:[o.jsx("style",{children:`
          @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
          }
          .animate-shake { animation: shake 0.3s ease-in-out; }
        `}),[0,1,2,3].map(P=>o.jsx("div",{className:`w-4 h-4 rounded-full transition-all duration-300 ${P<n.length?"bg-spiritual-800 dark:bg-spiritual-100 scale-110":"bg-spiritual-200 dark:bg-spiritual-800"}`},P))]}),o.jsxs("div",{className:"grid grid-cols-3 gap-x-8 gap-y-6 w-full max-w-[280px]",children:[[1,2,3,4,5,6,7,8,9].map(P=>o.jsx("button",{onClick:()=>b(P),className:"w-16 h-16 rounded-full bg-spiritual-50 dark:bg-white/5 text-2xl font-bold text-spiritual-800 dark:text-spiritual-100 hover:bg-spiritual-200 dark:hover:bg-white/20 active:scale-95 transition-all shadow-sm flex items-center justify-center",children:P},P)),o.jsx("div",{className:"flex items-center justify-center",children:t&&o.jsx("button",{onClick:t,className:"text-sm font-bold text-spiritual-500 uppercase tracking-wider hover:text-spiritual-800 dark:hover:text-white",children:"Cancel"})}),o.jsx("button",{onClick:()=>b(0),className:"w-16 h-16 rounded-full bg-spiritual-50 dark:bg-white/5 text-2xl font-bold text-spiritual-800 dark:text-spiritual-100 hover:bg-spiritual-200 dark:hover:bg-white/20 active:scale-95 transition-all shadow-sm flex items-center justify-center",children:"0"}),o.jsx("button",{onClick:w,className:"w-16 h-16 rounded-full flex items-center justify-center text-spiritual-500 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition-all active:scale-95",children:o.jsx(g0,{size:24})})]})]})},$l=({mode:r,onSuccess:e,onCancel:t})=>{const[n,s]=S.useState(""),[i,a]=S.useState("enter"),[c,u]=S.useState(""),[d,m]=S.useState(null),[p,x]=S.useState(!1),[b,w]=S.useState(!1),k=S.useRef(null);S.useEffect(()=>{a(r==="setup"?"create":"enter"),setTimeout(()=>{var U;return(U=k.current)==null?void 0:U.focus()},300)},[r]);const N=U=>{m(U),x(!0),navigator.vibrate&&navigator.vibrate([50,50,50]),setTimeout(()=>{x(!1),m(null),i==="confirm"&&s("")},1e3)},D=async U=>{var L;U==null||U.preventDefault(),n.trim()&&(r==="verify"?await mm(n)?e():N("Incorrect Passphrase"):r==="setup"&&(i==="create"?(u(n),s(""),a("confirm"),(L=k.current)==null||L.focus()):i==="confirm"&&(n===c?(await hm(n),e()):(N("Passphrases do not match"),a("create"),s("")))))},V=()=>r==="verify"?"Enter Passphrase":i==="create"?"Create Passphrase":i==="confirm"?"Confirm Passphrase":"",P=()=>d||(r==="verify"?"Unlock your sanctuary":i==="create"?"Enter a memorable phrase":i==="confirm"?"Re-enter to verify":"");return o.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] w-full max-w-sm mx-auto p-6 animate-fade-in text-spiritual-900 text-spiritual-50",children:[o.jsxs("div",{className:"mb-8 text-center",children:[o.jsx("div",{className:"w-16 h-16 bg-spiritual-100 dark:bg-spiritual-800 rounded-full flex items-center justify-center mx-auto mb-4 shadow-inner",children:d?o.jsx(em,{size:32,className:"text-red-500"}):o.jsx(x0,{size:32,className:"text-spiritual-500 dark:text-spiritual-400"})}),o.jsx("h2",{className:"text-2xl font-bold font-serif mb-1",children:V()}),o.jsx("p",{className:`text-sm font-medium uppercase tracking-widest ${d?"text-red-500":"text-spiritual-400"}`,children:P()})]}),o.jsxs("form",{onSubmit:D,className:`w-full max-w-[300px] space-y-6 ${p?"animate-shake":""}`,children:[o.jsx("style",{children:`
            @keyframes shake {
              0%, 100% { transform: translateX(0); }
              25% { transform: translateX(-10px); }
              75% { transform: translateX(10px); }
            }
            .animate-shake { animation: shake 0.3s ease-in-out; }
          `}),o.jsxs("div",{className:"relative",children:[o.jsx("input",{ref:k,type:b?"text":"password",value:n,onChange:U=>s(U.target.value),className:"w-full bg-spiritual-50 dark:bg-white/10 border-b-2 border-spiritual-200 dark:border-white/20 text-center text-xl p-4 font-medium placeholder-spiritual-300 dark:placeholder-spiritual-600 focus:outline-none focus:border-spiritual-gold transition-colors rounded-t-xl",placeholder:i==="create"?"e.g., I am peace":"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off"}),o.jsx("button",{type:"button",onClick:()=>w(!b),className:"absolute right-3 top-1/2 -translate-y-1/2 text-spiritual-400 dark:text-spiritual-500 hover:text-spiritual-600 dark:hover:text-spiritual-300 p-2",children:b?o.jsx(y0,{size:20}):o.jsx(b0,{size:20})})]}),o.jsxs("button",{type:"submit",disabled:!n.trim(),className:"w-full py-4 bg-spiritual-800 dark:bg-spiritual-100 text-white dark:text-spiritual-900 rounded-2xl font-bold shadow-lg hover:scale-[1.02] active:scale-95 transition-all disabled:opacity-50 disabled:scale-100 flex items-center justify-center gap-2",children:[i==="confirm"?"Confirm":"Enter Sanctuary"," ",o.jsx(oa,{size:18})]}),t&&o.jsx("button",{type:"button",onClick:t,className:"w-full py-2 text-sm font-bold text-spiritual-500 hover:text-spiritual-800 dark:hover:text-white uppercase tracking-wider transition-colors",children:"Cancel"})]})]})},ux=[{name:"New Delhi",coords:{lat:28.6139,lng:77.209},timezone:"Asia/Kolkata"},{name:"Mumbai",coords:{lat:19.076,lng:72.8777},timezone:"Asia/Kolkata"},{name:"Varanasi",coords:{lat:25.3176,lng:82.9739},timezone:"Asia/Kolkata"},{name:"Rishikesh",coords:{lat:30.0869,lng:78.2676},timezone:"Asia/Kolkata"},{name:"Chennai",coords:{lat:13.0827,lng:80.2707},timezone:"Asia/Kolkata"},{name:"Kolkata",coords:{lat:22.5726,lng:88.3639},timezone:"Asia/Kolkata"},{name:"Bangalore",coords:{lat:12.9716,lng:77.5946},timezone:"Asia/Kolkata"},{name:"London",coords:{lat:51.5074,lng:-.1278},timezone:"Europe/London"},{name:"New York",coords:{lat:40.7128,lng:-74.006},timezone:"America/New_York"},{name:"San Francisco",coords:{lat:37.7749,lng:-122.4194},timezone:"America/Los_Angeles"},{name:"Tokyo",coords:{lat:35.6762,lng:139.6503},timezone:"Asia/Tokyo"},{name:"Kyoto",coords:{lat:35.0116,lng:135.7681},timezone:"Asia/Tokyo"},{name:"Sydney",coords:{lat:-33.8688,lng:151.2093},timezone:"Australia/Sydney"},{name:"Dubai",coords:{lat:25.2048,lng:55.2708},timezone:"Asia/Dubai"},{name:"Singapore",coords:{lat:1.3521,lng:103.8198},timezone:"Asia/Singapore"},{name:"Bali (Ubud)",coords:{lat:-8.5069,lng:115.2625},timezone:"Asia/Makassar"}],Gl=()=>new Promise((r,e)=>{if(!("geolocation"in navigator)){e(new Error("Geolocation not supported"));return}navigator.geolocation.getCurrentPosition(async t=>{const n={lat:t.coords.latitude,lng:t.coords.longitude};let s=Intl.DateTimeFormat().resolvedOptions().timeZone,i="GPS Location";try{const a=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${n.lat}&lon=${n.lng}&zoom=10`);if(a.ok){const u=(await a.json()).address;i=u.city||u.town||u.village||u.municipality||u.county||u.state||"GPS Location",u.country_code==="in"&&(s="Asia/Kolkata")}}catch(a){console.warn("Reverse geocoding/timezone detection failed, falling back to generic values",a)}r({name:i,coords:n,timezone:s})},t=>{e(t)},{enableHighAccuracy:!1,timeout:1e4,maximumAge:6e4})}),dx=r=>{if(!r.reminderTime)return"";const[e,t]=r.reminderTime.split(":").map(Number),n=new Date,s=new Date(n);s.setHours(e,t,0,0);const i=b=>b.toISOString().replace(/[-:]/g,"").split(".")[0]+"Z",a=i(new Date),c=i(s),u=new Date(s.getTime()+15*6e4),d=i(u),m=`Sadhaka: ${r.title}`,p=`Time for your daily spiritual practice: ${r.title}. Open Sadhaka App to log your progress.`;return["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Sadhaka//Spiritual Practice//EN","CALSCALE:GREGORIAN","BEGIN:VEVENT",`DTSTAMP:${a}`,`DTSTART:${c}`,`DTEND:${d}`,`SUMMARY:${m}`,`DESCRIPTION:${p}`,"RRULE:FREQ=DAILY","STATUS:CONFIRMED","BEGIN:VALARM","TRIGGER:-PT0M","ACTION:DISPLAY","DESCRIPTION:Reminder","END:VALARM","END:VEVENT","END:VCALENDAR"].join(`\r
`)},hx=r=>{const e=dx(r);if(!e)return;const t=new Blob([e],{type:"text/calendar;charset=utf-8"}),n=window.URL.createObjectURL(t),s=document.createElement("a");s.href=n,s.setAttribute("download",`sadhaka-${r.title.replace(/\s+/g,"-").toLowerCase()}.ics`),document.body.appendChild(s),s.click(),document.body.removeChild(s),window.URL.revokeObjectURL(n)},ym=async()=>"Notification"in window?Notification.permission==="granted"?!0:Notification.permission!=="denied"?await Notification.requestPermission()==="granted":!1:!1,mx=async(r,e,t)=>{if("serviceWorker"in navigator&&Notification.permission==="granted")try{const n=await navigator.serviceWorker.ready,s="images/sadhaka_512.png";await n.showNotification(r,{body:e,icon:s,badge:s,vibrate:[200,100,200],tag:t||"sadhaka-alert",renotify:!0,requireInteraction:!1})}catch(n){console.warn("Notification failed",n)}},bk=async r=>(hx(r),"Calendar event downloaded");var Zu={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bm=function(r){const e=[];let t=0;for(let n=0;n<r.length;n++){let s=r.charCodeAt(n);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(s=65536+((s&1023)<<10)+(r.charCodeAt(++n)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},fx=function(r){const e=[];let t=0,n=0;for(;t<r.length;){const s=r[t++];if(s<128)e[n++]=String.fromCharCode(s);else if(s>191&&s<224){const i=r[t++];e[n++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=r[t++],a=r[t++],c=r[t++],u=((s&7)<<18|(i&63)<<12|(a&63)<<6|c&63)-65536;e[n++]=String.fromCharCode(55296+(u>>10)),e[n++]=String.fromCharCode(56320+(u&1023))}else{const i=r[t++],a=r[t++];e[n++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return e.join("")},vm={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let s=0;s<r.length;s+=3){const i=r[s],a=s+1<r.length,c=a?r[s+1]:0,u=s+2<r.length,d=u?r[s+2]:0,m=i>>2,p=(i&3)<<4|c>>4;let x=(c&15)<<2|d>>6,b=d&63;u||(b=64,a||(x=64)),n.push(t[m],t[p],t[x],t[b])}return n.join("")},encodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(r):this.encodeByteArray(bm(r),e)},decodeString(r,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(r):fx(this.decodeStringToByteArray(r,e))},decodeStringToByteArray(r,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let s=0;s<r.length;){const i=t[r.charAt(s++)],c=s<r.length?t[r.charAt(s)]:0;++s;const d=s<r.length?t[r.charAt(s)]:64;++s;const p=s<r.length?t[r.charAt(s)]:64;if(++s,i==null||c==null||d==null||p==null)throw new px;const x=i<<2|c>>4;if(n.push(x),d!==64){const b=c<<4&240|d>>2;if(n.push(b),p!==64){const w=d<<6&192|p;n.push(w)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let r=0;r<this.ENCODED_VALS.length;r++)this.byteToCharMap_[r]=this.ENCODED_VALS.charAt(r),this.charToByteMap_[this.byteToCharMap_[r]]=r,this.byteToCharMapWebSafe_[r]=this.ENCODED_VALS_WEBSAFE.charAt(r),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[r]]=r,r>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(r)]=r,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(r)]=r)}}};class px extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const gx=function(r){const e=bm(r);return vm.encodeByteArray(e,!0)},_m=function(r){return gx(r).replace(/\./g,"")},wm=function(r){try{return vm.decodeString(r,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xx(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yx=()=>xx().__FIREBASE_DEFAULTS__,bx=()=>{if(typeof process>"u"||typeof Zu>"u")return;const r=Zu.__FIREBASE_DEFAULTS__;if(r)return JSON.parse(r)},vx=()=>{if(typeof document>"u")return;let r;try{r=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=r&&wm(r[1]);return e&&JSON.parse(e)},Oa=()=>{try{return yx()||bx()||vx()}catch(r){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${r}`);return}},_x=r=>{var e,t;return(t=(e=Oa())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[r]},Im=()=>{var r;return(r=Oa())===null||r===void 0?void 0:r.config},Tm=r=>{var e;return(e=Oa())===null||e===void 0?void 0:e[`_${r}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wx{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,n))}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qe(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Ix(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Qe())}function Tx(){var r;const e=(r=Oa())===null||r===void 0?void 0:r.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Ex(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function kx(){const r=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof r=="object"&&r.id!==void 0}function Ax(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Sx(){const r=Qe();return r.indexOf("MSIE ")>=0||r.indexOf("Trident/")>=0}function Em(){return!Tx()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function km(){try{return typeof indexedDB=="object"}catch{return!1}}function Nx(){return new Promise((r,e)=>{try{let t=!0;const n="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(n);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(n),r(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var i;e(((i=s.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rx="FirebaseError";class tn extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=Rx,Object.setPrototypeOf(this,tn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ci.prototype.create)}}class ci{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],a=i?Cx(i,n):"Error",c=`${this.serviceName}: ${a} (${s}).`;return new tn(s,c,n)}}function Cx(r,e){return r.replace(Dx,(t,n)=>{const s=e[n];return s!=null?String(s):`<${n}?>`})}const Dx=/\{\$([^}]+)}/g;function Px(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}function $s(r,e){if(r===e)return!0;const t=Object.keys(r),n=Object.keys(e);for(const s of t){if(!n.includes(s))return!1;const i=r[s],a=e[s];if(ed(i)&&ed(a)){if(!$s(i,a))return!1}else if(i!==a)return!1}for(const s of n)if(!t.includes(s))return!1;return!0}function ed(r){return r!==null&&typeof r=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ui(r){const e=[];for(const[t,n]of Object.entries(r))Array.isArray(n)?n.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n));return e.length?"&"+e.join("&"):""}function Ts(r){const e={};return r.replace(/^\?/,"").split("&").forEach(n=>{if(n){const[s,i]=n.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function Es(r){const e=r.indexOf("?");if(!e)return"";const t=r.indexOf("#",e);return r.substring(e,t>0?t:void 0)}function jx(r,e){const t=new Vx(r,e);return t.subscribe.bind(t)}class Vx{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(n=>{this.error(n)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let s;if(e===void 0&&t===void 0&&n===void 0)throw new Error("Missing Observer.");Ox(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:n},s.next===void 0&&(s.next=So),s.error===void 0&&(s.error=So),s.complete===void 0&&(s.complete=So);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(n){typeof console<"u"&&console.error&&console.error(n)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Ox(r,e){if(typeof r!="object"||r===null)return!1;for(const t of e)if(t in r&&typeof r[t]=="function")return!0;return!1}function So(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ke(r){return r&&r._delegate?r._delegate:r}class Zn{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Un="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mx{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const n=new wx;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&n.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Fx(e))try{this.getOrInitializeService({instanceIdentifier:Un})}catch{}for(const[t,n]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});n.resolve(i)}catch{}}}}clearInstance(e=Un){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Un){return this.instances.has(e)}getOptions(e=Un){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,a]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(i);n===c&&a.resolve(s)}return s}onInit(e,t){var n;const s=this.normalizeInstanceIdentifier(t),i=(n=this.onInitCallbacks.get(s))!==null&&n!==void 0?n:new Set;i.add(e),this.onInitCallbacks.set(s,i);const a=this.instances.get(s);return a&&e(a,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const s of n)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:Lx(e),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch{}return n||null}normalizeInstanceIdentifier(e=Un){return this.component?this.component.multipleInstances?e:Un:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Lx(r){return r===Un?void 0:r}function Fx(r){return r.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ux{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Mx(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var fe;(function(r){r[r.DEBUG=0]="DEBUG",r[r.VERBOSE=1]="VERBOSE",r[r.INFO=2]="INFO",r[r.WARN=3]="WARN",r[r.ERROR=4]="ERROR",r[r.SILENT=5]="SILENT"})(fe||(fe={}));const Bx={debug:fe.DEBUG,verbose:fe.VERBOSE,info:fe.INFO,warn:fe.WARN,error:fe.ERROR,silent:fe.SILENT},zx=fe.INFO,$x={[fe.DEBUG]:"log",[fe.VERBOSE]:"log",[fe.INFO]:"info",[fe.WARN]:"warn",[fe.ERROR]:"error"},Gx=(r,e,...t)=>{if(e<r.logLevel)return;const n=new Date().toISOString(),s=$x[e];if(s)console[s](`[${n}]  ${r.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class ql{constructor(e){this.name=e,this._logLevel=zx,this._logHandler=Gx,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in fe))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Bx[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,fe.DEBUG,...e),this._logHandler(this,fe.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,fe.VERBOSE,...e),this._logHandler(this,fe.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,fe.INFO,...e),this._logHandler(this,fe.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,fe.WARN,...e),this._logHandler(this,fe.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,fe.ERROR,...e),this._logHandler(this,fe.ERROR,...e)}}const qx=(r,e)=>e.some(t=>r instanceof t);let td,nd;function Kx(){return td||(td=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Hx(){return nd||(nd=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Am=new WeakMap,Xo=new WeakMap,Sm=new WeakMap,No=new WeakMap,Kl=new WeakMap;function Wx(r){const e=new Promise((t,n)=>{const s=()=>{r.removeEventListener("success",i),r.removeEventListener("error",a)},i=()=>{t(bn(r.result)),s()},a=()=>{n(r.error),s()};r.addEventListener("success",i),r.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Am.set(t,r)}).catch(()=>{}),Kl.set(e,r),e}function Qx(r){if(Xo.has(r))return;const e=new Promise((t,n)=>{const s=()=>{r.removeEventListener("complete",i),r.removeEventListener("error",a),r.removeEventListener("abort",a)},i=()=>{t(),s()},a=()=>{n(r.error||new DOMException("AbortError","AbortError")),s()};r.addEventListener("complete",i),r.addEventListener("error",a),r.addEventListener("abort",a)});Xo.set(r,e)}let Zo={get(r,e,t){if(r instanceof IDBTransaction){if(e==="done")return Xo.get(r);if(e==="objectStoreNames")return r.objectStoreNames||Sm.get(r);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return bn(r[e])},set(r,e,t){return r[e]=t,!0},has(r,e){return r instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in r}};function Yx(r){Zo=r(Zo)}function Jx(r){return r===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const n=r.call(Ro(this),e,...t);return Sm.set(n,e.sort?e.sort():[e]),bn(n)}:Hx().includes(r)?function(...e){return r.apply(Ro(this),e),bn(Am.get(this))}:function(...e){return bn(r.apply(Ro(this),e))}}function Xx(r){return typeof r=="function"?Jx(r):(r instanceof IDBTransaction&&Qx(r),qx(r,Kx())?new Proxy(r,Zo):r)}function bn(r){if(r instanceof IDBRequest)return Wx(r);if(No.has(r))return No.get(r);const e=Xx(r);return e!==r&&(No.set(r,e),Kl.set(e,r)),e}const Ro=r=>Kl.get(r);function Zx(r,e,{blocked:t,upgrade:n,blocking:s,terminated:i}={}){const a=indexedDB.open(r,e),c=bn(a);return n&&a.addEventListener("upgradeneeded",u=>{n(bn(a.result),u.oldVersion,u.newVersion,bn(a.transaction),u)}),t&&a.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),c.then(u=>{i&&u.addEventListener("close",()=>i()),s&&u.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),c}const ey=["get","getKey","getAll","getAllKeys","count"],ty=["put","add","delete","clear"],Co=new Map;function rd(r,e){if(!(r instanceof IDBDatabase&&!(e in r)&&typeof e=="string"))return;if(Co.get(e))return Co.get(e);const t=e.replace(/FromIndex$/,""),n=e!==t,s=ty.includes(t);if(!(t in(n?IDBIndex:IDBObjectStore).prototype)||!(s||ey.includes(t)))return;const i=async function(a,...c){const u=this.transaction(a,s?"readwrite":"readonly");let d=u.store;return n&&(d=d.index(c.shift())),(await Promise.all([d[t](...c),s&&u.done]))[0]};return Co.set(e,i),i}Yx(r=>({...r,get:(e,t,n)=>rd(e,t)||r.get(e,t,n),has:(e,t)=>!!rd(e,t)||r.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ny{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(ry(t)){const n=t.getImmediate();return`${n.library}/${n.version}`}else return null}).filter(t=>t).join(" ")}}function ry(r){const e=r.getComponent();return(e==null?void 0:e.type)==="VERSION"}const el="@firebase/app",sd="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xt=new ql("@firebase/app"),sy="@firebase/app-compat",iy="@firebase/analytics-compat",ay="@firebase/analytics",oy="@firebase/app-check-compat",ly="@firebase/app-check",cy="@firebase/auth",uy="@firebase/auth-compat",dy="@firebase/database",hy="@firebase/data-connect",my="@firebase/database-compat",fy="@firebase/functions",py="@firebase/functions-compat",gy="@firebase/installations",xy="@firebase/installations-compat",yy="@firebase/messaging",by="@firebase/messaging-compat",vy="@firebase/performance",_y="@firebase/performance-compat",wy="@firebase/remote-config",Iy="@firebase/remote-config-compat",Ty="@firebase/storage",Ey="@firebase/storage-compat",ky="@firebase/firestore",Ay="@firebase/vertexai-preview",Sy="@firebase/firestore-compat",Ny="firebase",Ry="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tl="[DEFAULT]",Cy={[el]:"fire-core",[sy]:"fire-core-compat",[ay]:"fire-analytics",[iy]:"fire-analytics-compat",[ly]:"fire-app-check",[oy]:"fire-app-check-compat",[cy]:"fire-auth",[uy]:"fire-auth-compat",[dy]:"fire-rtdb",[hy]:"fire-data-connect",[my]:"fire-rtdb-compat",[fy]:"fire-fn",[py]:"fire-fn-compat",[gy]:"fire-iid",[xy]:"fire-iid-compat",[yy]:"fire-fcm",[by]:"fire-fcm-compat",[vy]:"fire-perf",[_y]:"fire-perf-compat",[wy]:"fire-rc",[Iy]:"fire-rc-compat",[Ty]:"fire-gcs",[Ey]:"fire-gcs-compat",[ky]:"fire-fst",[Sy]:"fire-fst-compat",[Ay]:"fire-vertex","fire-js":"fire-js",[Ny]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ca=new Map,Dy=new Map,nl=new Map;function id(r,e){try{r.container.addComponent(e)}catch(t){Xt.debug(`Component ${e.name} failed to register with FirebaseApp ${r.name}`,t)}}function Vr(r){const e=r.name;if(nl.has(e))return Xt.debug(`There were multiple attempts to register component ${e}.`),!1;nl.set(e,r);for(const t of ca.values())id(t,r);for(const t of Dy.values())id(t,r);return!0}function Hl(r,e){const t=r.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),r.container.getProvider(e)}function St(r){return r.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Py={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},vn=new ci("app","Firebase",Py);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jy{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new Zn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw vn.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yr=Ry;function Nm(r,e={}){let t=r;typeof e!="object"&&(e={name:e});const n=Object.assign({name:tl,automaticDataCollectionEnabled:!1},e),s=n.name;if(typeof s!="string"||!s)throw vn.create("bad-app-name",{appName:String(s)});if(t||(t=Im()),!t)throw vn.create("no-options");const i=ca.get(s);if(i){if($s(t,i.options)&&$s(n,i.config))return i;throw vn.create("duplicate-app",{appName:s})}const a=new Ux(s);for(const u of nl.values())a.addComponent(u);const c=new jy(t,n,a);return ca.set(s,c),c}function Vy(r=tl){const e=ca.get(r);if(!e&&r===tl&&Im())return Nm();if(!e)throw vn.create("no-app",{appName:r});return e}function _n(r,e,t){var n;let s=(n=Cy[r])!==null&&n!==void 0?n:r;t&&(s+=`-${t}`);const i=s.match(/\s|\//),a=e.match(/\s|\//);if(i||a){const c=[`Unable to register library "${s}" with version "${e}":`];i&&c.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&a&&c.push("and"),a&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Xt.warn(c.join(" "));return}Vr(new Zn(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oy="firebase-heartbeat-database",My=1,Gs="firebase-heartbeat-store";let Do=null;function Rm(){return Do||(Do=Zx(Oy,My,{upgrade:(r,e)=>{switch(e){case 0:try{r.createObjectStore(Gs)}catch(t){console.warn(t)}}}}).catch(r=>{throw vn.create("idb-open",{originalErrorMessage:r.message})})),Do}async function Ly(r){try{const t=(await Rm()).transaction(Gs),n=await t.objectStore(Gs).get(Cm(r));return await t.done,n}catch(e){if(e instanceof tn)Xt.warn(e.message);else{const t=vn.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Xt.warn(t.message)}}}async function ad(r,e){try{const n=(await Rm()).transaction(Gs,"readwrite");await n.objectStore(Gs).put(e,Cm(r)),await n.done}catch(t){if(t instanceof tn)Xt.warn(t.message);else{const n=vn.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Xt.warn(n.message)}}}function Cm(r){return`${r.name}!${r.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fy=1024,Uy=30*24*60*60*1e3;class By{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new $y(t),this._heartbeatsCachePromise=this._storage.read().then(n=>(this._heartbeatsCache=n,n))}async triggerHeartbeat(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=od();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(a=>a.date===i)?void 0:(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(a=>{const c=new Date(a.date).valueOf();return Date.now()-c<=Uy}),this._storage.overwrite(this._heartbeatsCache))}catch(n){Xt.warn(n)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=od(),{heartbeatsToSend:n,unsentEntries:s}=zy(this._heartbeatsCache.heartbeats),i=_m(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return Xt.warn(t),""}}}function od(){return new Date().toISOString().substring(0,10)}function zy(r,e=Fy){const t=[];let n=r.slice();for(const s of r){const i=t.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),ld(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),ld(t)>e){t.pop();break}n=n.slice(1)}return{heartbeatsToSend:t,unsentEntries:n}}class $y{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return km()?Nx().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Ly(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return ad(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const s=await this.read();return ad(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function ld(r){return _m(JSON.stringify({version:2,heartbeats:r})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gy(r){Vr(new Zn("platform-logger",e=>new ny(e),"PRIVATE")),Vr(new Zn("heartbeat",e=>new By(e),"PRIVATE")),_n(el,sd,r),_n(el,sd,"esm2017"),_n("fire-js","")}Gy("");function Wl(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(r);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(r,n[s])&&(t[n[s]]=r[n[s]]);return t}function Dm(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const qy=Dm,Pm=new ci("auth","Firebase",Dm());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ua=new ql("@firebase/auth");function Ky(r,...e){ua.logLevel<=fe.WARN&&ua.warn(`Auth (${Yr}): ${r}`,...e)}function Ki(r,...e){ua.logLevel<=fe.ERROR&&ua.error(`Auth (${Yr}): ${r}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Et(r,...e){throw Yl(r,...e)}function Nt(r,...e){return Yl(r,...e)}function Ql(r,e,t){const n=Object.assign(Object.assign({},qy()),{[e]:t});return new ci("auth","Firebase",n).create(e,{appName:r.name})}function Yt(r){return Ql(r,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Hy(r,e,t){const n=t;if(!(e instanceof n))throw n.name!==e.constructor.name&&Et(r,"argument-error"),Ql(r,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Yl(r,...e){if(typeof r!="string"){const t=e[0],n=[...e.slice(1)];return n[0]&&(n[0].appName=r.name),r._errorFactory.create(t,...n)}return Pm.create(r,...e)}function le(r,e,...t){if(!r)throw Yl(e,...t)}function qt(r){const e="INTERNAL ASSERTION FAILED: "+r;throw Ki(e),new Error(e)}function Zt(r,e){r||qt(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rl(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.href)||""}function Wy(){return cd()==="http:"||cd()==="https:"}function cd(){var r;return typeof self<"u"&&((r=self.location)===null||r===void 0?void 0:r.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qy(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Wy()||kx()||"connection"in navigator)?navigator.onLine:!0}function Yy(){if(typeof navigator>"u")return null;const r=navigator;return r.languages&&r.languages[0]||r.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class di{constructor(e,t){this.shortDelay=e,this.longDelay=t,Zt(t>e,"Short delay should be less than long delay!"),this.isMobile=Ix()||Ax()}get(){return Qy()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jl(r,e){Zt(r.emulator,"Emulator should always be set here");const{url:t}=r.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jm{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;qt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;qt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;qt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jy={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xy=new di(3e4,6e4);function nn(r,e){return r.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:r.tenantId}):e}async function rn(r,e,t,n,s={}){return Vm(r,s,async()=>{let i={},a={};n&&(e==="GET"?a=n:i={body:JSON.stringify(n)});const c=ui(Object.assign({key:r.config.apiKey},a)).slice(1),u=await r._getAdditionalHeaders();u["Content-Type"]="application/json",r.languageCode&&(u["X-Firebase-Locale"]=r.languageCode);const d=Object.assign({method:e,headers:u},i);return Ex()||(d.referrerPolicy="no-referrer"),jm.fetch()(Om(r,r.config.apiHost,t,c),d)})}async function Vm(r,e,t){r._canInitEmulator=!1;const n=Object.assign(Object.assign({},Jy),e);try{const s=new eb(r),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw Li(r,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const c=i.ok?a.errorMessage:a.error.message,[u,d]=c.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw Li(r,"credential-already-in-use",a);if(u==="EMAIL_EXISTS")throw Li(r,"email-already-in-use",a);if(u==="USER_DISABLED")throw Li(r,"user-disabled",a);const m=n[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw Ql(r,m,d);Et(r,m)}}catch(s){if(s instanceof tn)throw s;Et(r,"network-request-failed",{message:String(s)})}}async function hi(r,e,t,n,s={}){const i=await rn(r,e,t,n,s);return"mfaPendingCredential"in i&&Et(r,"multi-factor-auth-required",{_serverResponse:i}),i}function Om(r,e,t,n){const s=`${e}${t}?${n}`;return r.config.emulator?Jl(r.config,s):`${r.config.apiScheme}://${s}`}function Zy(r){switch(r){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class eb{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,n)=>{this.timer=setTimeout(()=>n(Nt(this.auth,"network-request-failed")),Xy.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Li(r,e,t){const n={appName:r.name};t.email&&(n.email=t.email),t.phoneNumber&&(n.phoneNumber=t.phoneNumber);const s=Nt(r,e,n);return s.customData._tokenResponse=t,s}function ud(r){return r!==void 0&&r.enterprise!==void 0}class tb{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Zy(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function nb(r,e){return rn(r,"GET","/v2/recaptchaConfig",nn(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rb(r,e){return rn(r,"POST","/v1/accounts:delete",e)}async function Mm(r,e){return rn(r,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ds(r){if(r)try{const e=new Date(Number(r));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function sb(r,e=!1){const t=Ke(r),n=await t.getIdToken(e),s=Xl(n);le(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,a=i==null?void 0:i.sign_in_provider;return{claims:s,token:n,authTime:Ds(Po(s.auth_time)),issuedAtTime:Ds(Po(s.iat)),expirationTime:Ds(Po(s.exp)),signInProvider:a||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Po(r){return Number(r)*1e3}function Xl(r){const[e,t,n]=r.split(".");if(e===void 0||t===void 0||n===void 0)return Ki("JWT malformed, contained fewer than 3 sections"),null;try{const s=wm(t);return s?JSON.parse(s):(Ki("Failed to decode base64 JWT payload"),null)}catch(s){return Ki("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function dd(r){const e=Xl(r);return le(e,"internal-error"),le(typeof e.exp<"u","internal-error"),le(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qs(r,e,t=!1){if(t)return e;try{return await e}catch(n){throw n instanceof tn&&ib(n)&&r.auth.currentUser===r&&await r.auth.signOut(),n}}function ib({code:r}){return r==="auth/user-disabled"||r==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ab{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sl{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ds(this.lastLoginAt),this.creationTime=Ds(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function da(r){var e;const t=r.auth,n=await r.getIdToken(),s=await qs(r,Mm(t,{idToken:n}));le(s==null?void 0:s.users.length,t,"internal-error");const i=s.users[0];r._notifyReloadListener(i);const a=!((e=i.providerUserInfo)===null||e===void 0)&&e.length?Lm(i.providerUserInfo):[],c=lb(r.providerData,a),u=r.isAnonymous,d=!(r.email&&i.passwordHash)&&!(c!=null&&c.length),m=u?d:!1,p={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:c,metadata:new sl(i.createdAt,i.lastLoginAt),isAnonymous:m};Object.assign(r,p)}async function ob(r){const e=Ke(r);await da(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function lb(r,e){return[...r.filter(n=>!e.some(s=>s.providerId===n.providerId)),...e]}function Lm(r){return r.map(e=>{var{providerId:t}=e,n=Wl(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cb(r,e){const t=await Vm(r,{},async()=>{const n=ui({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=r.config,a=Om(r,s,"/v1/token",`key=${i}`),c=await r._getAdditionalHeaders();return c["Content-Type"]="application/x-www-form-urlencoded",jm.fetch()(a,{method:"POST",headers:c,body:n})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function ub(r,e){return rn(r,"POST","/v2/accounts:revokeToken",nn(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rr{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){le(e.idToken,"internal-error"),le(typeof e.idToken<"u","internal-error"),le(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):dd(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){le(e.length!==0,"internal-error");const t=dd(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(le(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:s,expiresIn:i}=await cb(e,t);this.updateTokensAndExpiration(n,s,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+n*1e3}static fromJSON(e,t){const{refreshToken:n,accessToken:s,expirationTime:i}=t,a=new Rr;return n&&(le(typeof n=="string","internal-error",{appName:e}),a.refreshToken=n),s&&(le(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),i&&(le(typeof i=="number","internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Rr,this.toJSON())}_performRefresh(){return qt("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dn(r,e){le(typeof r=="string"||typeof r>"u","internal-error",{appName:e})}class Kt{constructor(e){var{uid:t,auth:n,stsTokenManager:s}=e,i=Wl(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new ab(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new sl(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await qs(this,this.stsTokenManager.getToken(this.auth,e));return le(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return sb(this,e)}reload(){return ob(this)}_assign(e){this!==e&&(le(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Kt(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){le(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await da(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(St(this.auth.app))return Promise.reject(Yt(this.auth));const e=await this.getIdToken();return await qs(this,rb(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,s,i,a,c,u,d,m;const p=(n=t.displayName)!==null&&n!==void 0?n:void 0,x=(s=t.email)!==null&&s!==void 0?s:void 0,b=(i=t.phoneNumber)!==null&&i!==void 0?i:void 0,w=(a=t.photoURL)!==null&&a!==void 0?a:void 0,k=(c=t.tenantId)!==null&&c!==void 0?c:void 0,N=(u=t._redirectEventId)!==null&&u!==void 0?u:void 0,D=(d=t.createdAt)!==null&&d!==void 0?d:void 0,V=(m=t.lastLoginAt)!==null&&m!==void 0?m:void 0,{uid:P,emailVerified:U,isAnonymous:L,providerData:G,stsTokenManager:I}=t;le(P&&I,e,"internal-error");const y=Rr.fromJSON(this.name,I);le(typeof P=="string",e,"internal-error"),dn(p,e.name),dn(x,e.name),le(typeof U=="boolean",e,"internal-error"),le(typeof L=="boolean",e,"internal-error"),dn(b,e.name),dn(w,e.name),dn(k,e.name),dn(N,e.name),dn(D,e.name),dn(V,e.name);const v=new Kt({uid:P,auth:e,email:x,emailVerified:U,displayName:p,isAnonymous:L,photoURL:w,phoneNumber:b,tenantId:k,stsTokenManager:y,createdAt:D,lastLoginAt:V});return G&&Array.isArray(G)&&(v.providerData=G.map(E=>Object.assign({},E))),N&&(v._redirectEventId=N),v}static async _fromIdTokenResponse(e,t,n=!1){const s=new Rr;s.updateFromServerResponse(t);const i=new Kt({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:n});return await da(i),i}static async _fromGetAccountInfoResponse(e,t,n){const s=t.users[0];le(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?Lm(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),c=new Rr;c.updateFromIdToken(n);const u=new Kt({uid:s.localId,auth:e,stsTokenManager:c,isAnonymous:a}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new sl(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(u,d),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hd=new Map;function Ht(r){Zt(r instanceof Function,"Expected a class definition");let e=hd.get(r);return e?(Zt(e instanceof r,"Instance stored in cache mismatched with class"),e):(e=new r,hd.set(r,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fm{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Fm.type="NONE";const md=Fm;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hi(r,e,t){return`firebase:${r}:${e}:${t}`}class Cr{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:s,name:i}=this.auth;this.fullUserKey=Hi(this.userKey,s.apiKey,i),this.fullPersistenceKey=Hi("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Kt._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Cr(Ht(md),e,n);const s=(await Promise.all(t.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||Ht(md);const a=Hi(n,e.config.apiKey,e.name);let c=null;for(const d of t)try{const m=await d._get(a);if(m){const p=Kt._fromJSON(e,m);d!==i&&(c=p),i=d;break}}catch{}const u=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!u.length?new Cr(i,e,n):(i=u[0],c&&await i._set(a,c.toJSON()),await Promise.all(t.map(async d=>{if(d!==i)try{await d._remove(a)}catch{}})),new Cr(i,e,n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fd(r){const e=r.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if($m(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Um(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(qm(e))return"Blackberry";if(Km(e))return"Webos";if(Bm(e))return"Safari";if((e.includes("chrome/")||zm(e))&&!e.includes("edge/"))return"Chrome";if(Gm(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=r.match(t);if((n==null?void 0:n.length)===2)return n[1]}return"Other"}function Um(r=Qe()){return/firefox\//i.test(r)}function Bm(r=Qe()){const e=r.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function zm(r=Qe()){return/crios\//i.test(r)}function $m(r=Qe()){return/iemobile/i.test(r)}function Gm(r=Qe()){return/android/i.test(r)}function qm(r=Qe()){return/blackberry/i.test(r)}function Km(r=Qe()){return/webos/i.test(r)}function Zl(r=Qe()){return/iphone|ipad|ipod/i.test(r)||/macintosh/i.test(r)&&/mobile/i.test(r)}function db(r=Qe()){var e;return Zl(r)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function hb(){return Sx()&&document.documentMode===10}function Hm(r=Qe()){return Zl(r)||Gm(r)||Km(r)||qm(r)||/windows phone/i.test(r)||$m(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wm(r,e=[]){let t;switch(r){case"Browser":t=fd(Qe());break;case"Worker":t=`${fd(Qe())}-${r}`;break;default:t=r}const n=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Yr}/${n}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mb{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=i=>new Promise((a,c)=>{try{const u=e(i);a(u)}catch(u){c(u)}});n.onAbort=t,this.queue.push(n);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:n==null?void 0:n.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fb(r,e={}){return rn(r,"GET","/v2/passwordPolicy",nn(r,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pb=6;class gb{constructor(e){var t,n,s,i;const a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=a.minPasswordLength)!==null&&t!==void 0?t:pb,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(n=e.allowedNonAlphanumericCharacters)===null||n===void 0?void 0:n.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(i=e.forceUpgradeOnSignin)!==null&&i!==void 0?i:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,s,i,a,c;const u={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,u),this.validatePasswordCharacterOptions(e,u),u.isValid&&(u.isValid=(t=u.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),u.isValid&&(u.isValid=(n=u.meetsMaxPasswordLength)!==null&&n!==void 0?n:!0),u.isValid&&(u.isValid=(s=u.containsLowercaseLetter)!==null&&s!==void 0?s:!0),u.isValid&&(u.isValid=(i=u.containsUppercaseLetter)!==null&&i!==void 0?i:!0),u.isValid&&(u.isValid=(a=u.containsNumericCharacter)!==null&&a!==void 0?a:!0),u.isValid&&(u.isValid=(c=u.containsNonAlphanumericCharacter)!==null&&c!==void 0?c:!0),u}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let n;for(let s=0;s<e.length;s++)n=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xb{constructor(e,t,n,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new pd(this),this.idTokenSubscription=new pd(this),this.beforeStateQueue=new mb(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Pm,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ht(t)),this._initializationPromise=this.queue(async()=>{var n,s;if(!this._deleted&&(this.persistenceManager=await Cr.create(this,e),!this._deleted)){if(!((n=this._popupRedirectResolver)===null||n===void 0)&&n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await Mm(this,{idToken:e}),n=await Kt._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(St(this.app)){const a=this.app.settings.authIdToken;return a?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(a).then(c,c))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let s=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,c=s==null?void 0:s._redirectEventId,u=await this.tryRedirectSignIn(e);(!a||a===c)&&(u!=null&&u.user)&&(s=u.user,i=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(s)}catch(a){s=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return le(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await da(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Yy()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(St(this.app))return Promise.reject(Yt(this));const t=e?Ke(e):null;return t&&le(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&le(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return St(this.app)?Promise.reject(Yt(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return St(this.app)?Promise.reject(Yt(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ht(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await fb(this),t=new gb(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new ci("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),n={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(n.tenantId=this.tenantId),await ub(this,n)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return e===null?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Ht(e)||this._popupRedirectResolver;le(t,this,"argument-error"),this.redirectPersistenceManager=await Cr.create(this,[Ht(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let a=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(le(c,this,"internal-error"),c.then(()=>{a||i(this.currentUser)}),typeof t=="function"){const u=e.addObserver(t,n,s);return()=>{a=!0,u()}}else{const u=e.addObserver(t);return()=>{a=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return le(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Wm(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const s=await this._getAppCheckToken();return s&&(t["X-Firebase-AppCheck"]=s),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&Ky(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function sn(r){return Ke(r)}class pd{constructor(e){this.auth=e,this.observer=null,this.addObserver=jx(t=>this.observer=t)}get next(){return le(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ma={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function yb(r){Ma=r}function Qm(r){return Ma.loadJS(r)}function bb(){return Ma.recaptchaEnterpriseScript}function vb(){return Ma.gapiScript}function _b(r){return`__${r}${Math.floor(Math.random()*1e6)}`}const wb="recaptcha-enterprise",Ib="NO_RECAPTCHA";class Tb{constructor(e){this.type=wb,this.auth=sn(e)}async verify(e="verify",t=!1){async function n(i){if(!t){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(a,c)=>{nb(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)c(new Error("recaptcha Enterprise site key undefined"));else{const d=new tb(u);return i.tenantId==null?i._agentRecaptchaConfig=d:i._tenantRecaptchaConfigs[i.tenantId]=d,a(d.siteKey)}}).catch(u=>{c(u)})})}function s(i,a,c){const u=window.grecaptcha;ud(u)?u.enterprise.ready(()=>{u.enterprise.execute(i,{action:e}).then(d=>{a(d)}).catch(()=>{a(Ib)})}):c(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((i,a)=>{n(this.auth).then(c=>{if(!t&&ud(window.grecaptcha))s(c,i,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}let u=bb();u.length!==0&&(u+=c),Qm(u).then(()=>{s(c,i,a)}).catch(d=>{a(d)})}}).catch(c=>{a(c)})})}}async function gd(r,e,t,n=!1){const s=new Tb(r);let i;try{i=await s.verify(t)}catch{i=await s.verify(t,!0)}const a=Object.assign({},e);return n?Object.assign(a,{captchaResp:i}):Object.assign(a,{captchaResponse:i}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function ha(r,e,t,n){var s;if(!((s=r._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await gd(r,e,t,t==="getOobCode");return n(r,i)}else return n(r,e).catch(async i=>{if(i.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await gd(r,e,t,t==="getOobCode");return n(r,a)}else return Promise.reject(i)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eb(r,e){const t=Hl(r,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if($s(i,e??{}))return s;Et(s,"already-initialized")}return t.initialize({options:e})}function kb(r,e){const t=(e==null?void 0:e.persistence)||[],n=(Array.isArray(t)?t:[t]).map(Ht);e!=null&&e.errorMap&&r._updateErrorMap(e.errorMap),r._initializeWithPersistence(n,e==null?void 0:e.popupRedirectResolver)}function Ab(r,e,t){const n=sn(r);le(n._canInitEmulator,n,"emulator-config-failed"),le(/^https?:\/\//.test(e),n,"invalid-emulator-scheme");const s=!1,i=Ym(e),{host:a,port:c}=Sb(e),u=c===null?"":`:${c}`;n.config.emulator={url:`${i}//${a}${u}/`},n.settings.appVerificationDisabledForTesting=!0,n.emulatorConfig=Object.freeze({host:a,port:c,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),Nb()}function Ym(r){const e=r.indexOf(":");return e<0?"":r.substr(0,e+1)}function Sb(r){const e=Ym(r),t=/(\/\/)?([^?#/]+)/.exec(r.substr(e.length));if(!t)return{host:"",port:null};const n=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(n);if(s){const i=s[1];return{host:i,port:xd(n.substr(i.length+1))}}else{const[i,a]=n.split(":");return{host:i,port:xd(a)}}}function xd(r){if(!r)return null;const e=Number(r);return isNaN(e)?null:e}function Nb(){function r(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",r):r())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ec{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return qt("not implemented")}_getIdTokenResponse(e){return qt("not implemented")}_linkToIdToken(e,t){return qt("not implemented")}_getReauthenticationResolver(e){return qt("not implemented")}}async function Rb(r,e){return rn(r,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Cb(r,e){return hi(r,"POST","/v1/accounts:signInWithPassword",nn(r,e))}async function Db(r,e){return rn(r,"POST","/v1/accounts:sendOobCode",nn(r,e))}async function Pb(r,e){return Db(r,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jb(r,e){return hi(r,"POST","/v1/accounts:signInWithEmailLink",nn(r,e))}async function Vb(r,e){return hi(r,"POST","/v1/accounts:signInWithEmailLink",nn(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ks extends ec{constructor(e,t,n,s=null){super("password",n),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Ks(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Ks(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ha(e,t,"signInWithPassword",Cb);case"emailLink":return jb(e,{email:this._email,oobCode:this._password});default:Et(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const n={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ha(e,n,"signUpPassword",Rb);case"emailLink":return Vb(e,{idToken:t,email:this._email,oobCode:this._password});default:Et(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Dr(r,e){return hi(r,"POST","/v1/accounts:signInWithIdp",nn(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ob="http://localhost";class er extends ec{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new er(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Et("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:n,signInMethod:s}=t,i=Wl(t,["providerId","signInMethod"]);if(!n||!s)return null;const a=new er(n,s);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return Dr(e,t)}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Dr(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Dr(e,t)}buildRequest(){const e={requestUri:Ob,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=ui(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mb(r){switch(r){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Lb(r){const e=Ts(Es(r)).link,t=e?Ts(Es(e)).deep_link_id:null,n=Ts(Es(r)).deep_link_id;return(n?Ts(Es(n)).link:null)||n||t||e||r}class tc{constructor(e){var t,n,s,i,a,c;const u=Ts(Es(e)),d=(t=u.apiKey)!==null&&t!==void 0?t:null,m=(n=u.oobCode)!==null&&n!==void 0?n:null,p=Mb((s=u.mode)!==null&&s!==void 0?s:null);le(d&&m&&p,"argument-error"),this.apiKey=d,this.operation=p,this.code=m,this.continueUrl=(i=u.continueUrl)!==null&&i!==void 0?i:null,this.languageCode=(a=u.languageCode)!==null&&a!==void 0?a:null,this.tenantId=(c=u.tenantId)!==null&&c!==void 0?c:null}static parseLink(e){const t=Lb(e);try{return new tc(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jr{constructor(){this.providerId=Jr.PROVIDER_ID}static credential(e,t){return Ks._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=tc.parseLink(t);return le(n,"argument-error"),Ks._fromEmailAndCode(e,n.code,n.tenantId)}}Jr.PROVIDER_ID="password";Jr.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Jr.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nc{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mi extends nc{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fn extends mi{constructor(){super("facebook.com")}static credential(e){return er._fromParams({providerId:fn.PROVIDER_ID,signInMethod:fn.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return fn.credentialFromTaggedObject(e)}static credentialFromError(e){return fn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return fn.credential(e.oauthAccessToken)}catch{return null}}}fn.FACEBOOK_SIGN_IN_METHOD="facebook.com";fn.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gt extends mi{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return er._fromParams({providerId:Gt.PROVIDER_ID,signInMethod:Gt.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Gt.credentialFromTaggedObject(e)}static credentialFromError(e){return Gt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Gt.credential(t,n)}catch{return null}}}Gt.GOOGLE_SIGN_IN_METHOD="google.com";Gt.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pn extends mi{constructor(){super("github.com")}static credential(e){return er._fromParams({providerId:pn.PROVIDER_ID,signInMethod:pn.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return pn.credentialFromTaggedObject(e)}static credentialFromError(e){return pn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return pn.credential(e.oauthAccessToken)}catch{return null}}}pn.GITHUB_SIGN_IN_METHOD="github.com";pn.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gn extends mi{constructor(){super("twitter.com")}static credential(e,t){return er._fromParams({providerId:gn.PROVIDER_ID,signInMethod:gn.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return gn.credentialFromTaggedObject(e)}static credentialFromError(e){return gn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return gn.credential(t,n)}catch{return null}}}gn.TWITTER_SIGN_IN_METHOD="twitter.com";gn.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fb(r,e){return hi(r,"POST","/v1/accounts:signUp",nn(r,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,s=!1){const i=await Kt._fromIdTokenResponse(e,n,s),a=yd(n);return new tr({user:i,providerId:a,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const s=yd(n);return new tr({user:e,providerId:s,_tokenResponse:n,operationType:t})}}function yd(r){return r.providerId?r.providerId:"phoneNumber"in r?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ma extends tn{constructor(e,t,n,s){var i;super(t.code,t.message),this.operationType=n,this.user=s,Object.setPrototypeOf(this,ma.prototype),this.customData={appName:e.name,tenantId:(i=e.tenantId)!==null&&i!==void 0?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,s){return new ma(e,t,n,s)}}function Jm(r,e,t,n){return(e==="reauthenticate"?t._getReauthenticationResolver(r):t._getIdTokenResponse(r)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?ma._fromErrorAndOperation(r,i,e,n):i})}async function Ub(r,e,t=!1){const n=await qs(r,e._linkToIdToken(r.auth,await r.getIdToken()),t);return tr._forOperation(r,"link",n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bb(r,e,t=!1){const{auth:n}=r;if(St(n.app))return Promise.reject(Yt(n));const s="reauthenticate";try{const i=await qs(r,Jm(n,s,e,r),t);le(i.idToken,n,"internal-error");const a=Xl(i.idToken);le(a,n,"internal-error");const{sub:c}=a;return le(r.uid===c,n,"user-mismatch"),tr._forOperation(r,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&Et(n,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xm(r,e,t=!1){if(St(r.app))return Promise.reject(Yt(r));const n="signIn",s=await Jm(r,n,e),i=await tr._fromIdTokenResponse(r,n,s);return t||await r._updateCurrentUser(i.user),i}async function zb(r,e){return Xm(sn(r),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zm(r){const e=sn(r);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function $b(r,e,t){const n=sn(r);await ha(n,{requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"},"getOobCode",Pb)}async function ef(r,e,t){if(St(r.app))return Promise.reject(Yt(r));const n=sn(r),a=await ha(n,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Fb).catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&Zm(r),u}),c=await tr._fromIdTokenResponse(n,"signIn",a);return await n._updateCurrentUser(c.user),c}function tf(r,e,t){return St(r.app)?Promise.reject(Yt(r)):zb(Ke(r),Jr.credential(e,t)).catch(async n=>{throw n.code==="auth/password-does-not-meet-requirements"&&Zm(r),n})}function Gb(r,e,t,n){return Ke(r).onIdTokenChanged(e,t,n)}function qb(r,e,t){return Ke(r).beforeAuthStateChanged(e,t)}function Kb(r,e,t,n){return Ke(r).onAuthStateChanged(e,t,n)}function Hb(r){return Ke(r).signOut()}const fa="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nf{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(fa,"1"),this.storage.removeItem(fa),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wb=1e3,Qb=10;class rf extends nf{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Hm(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),s=this.localCache[t];n!==s&&e(t,s,n)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,c,u)=>{this.notifyListeners(a,u)});return}const n=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(n);!t&&this.localCache[n]===a||this.notifyListeners(n,a)},i=this.storage.getItem(n);hb()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,Qb):s()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const s of Array.from(n))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},Wb)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}rf.type="LOCAL";const Yb=rf;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sf extends nf{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}sf.type="SESSION";const af=sf;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jb(r){return Promise.all(r.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class La{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const n=new La(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:s,data:i}=t.data,a=this.handlersMap[s];if(!(a!=null&&a.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:s});const c=Array.from(a).map(async d=>d(t.origin,i)),u=await Jb(c);t.ports[0].postMessage({status:"done",eventId:n,eventType:s,response:u})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}La.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rc(r="",e=10){let t="";for(let n=0;n<e;n++)t+=Math.floor(Math.random()*10);return r+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xb{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,a;return new Promise((c,u)=>{const d=rc("",20);s.port1.start();const m=setTimeout(()=>{u(new Error("unsupported_event"))},n);a={messageChannel:s,onMessage(p){const x=p;if(x.data.eventId===d)switch(x.data.status){case"ack":clearTimeout(m),i=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),c(x.data.response);break;default:clearTimeout(m),clearTimeout(i),u(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vt(){return window}function Zb(r){Vt().location.href=r}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function of(){return typeof Vt().WorkerGlobalScope<"u"&&typeof Vt().importScripts=="function"}async function ev(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function tv(){var r;return((r=navigator==null?void 0:navigator.serviceWorker)===null||r===void 0?void 0:r.controller)||null}function nv(){return of()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lf="firebaseLocalStorageDb",rv=1,pa="firebaseLocalStorage",cf="fbase_key";class fi{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Fa(r,e){return r.transaction([pa],e?"readwrite":"readonly").objectStore(pa)}function sv(){const r=indexedDB.deleteDatabase(lf);return new fi(r).toPromise()}function il(){const r=indexedDB.open(lf,rv);return new Promise((e,t)=>{r.addEventListener("error",()=>{t(r.error)}),r.addEventListener("upgradeneeded",()=>{const n=r.result;try{n.createObjectStore(pa,{keyPath:cf})}catch(s){t(s)}}),r.addEventListener("success",async()=>{const n=r.result;n.objectStoreNames.contains(pa)?e(n):(n.close(),await sv(),e(await il()))})})}async function bd(r,e,t){const n=Fa(r,!0).put({[cf]:e,value:t});return new fi(n).toPromise()}async function iv(r,e){const t=Fa(r,!1).get(e),n=await new fi(t).toPromise();return n===void 0?null:n.value}function vd(r,e){const t=Fa(r,!0).delete(e);return new fi(t).toPromise()}const av=800,ov=3;class uf{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await il(),this.db)}async _withRetries(e){let t=0;for(;;)try{const n=await this._openDb();return await e(n)}catch(n){if(t++>ov)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return of()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=La._getInstance(nv()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await ev(),!this.activeServiceWorker)return;this.sender=new Xb(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&!((e=n[0])===null||e===void 0)&&e.fulfilled&&!((t=n[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||tv()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await il();return await bd(e,fa,"1"),await vd(e,fa),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>bd(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(n=>iv(n,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>vd(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=Fa(s,!1).getAll();return new fi(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],n=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)n.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!n.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const s of Array.from(n))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),av)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}uf.type="LOCAL";const lv=uf;new di(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function df(r,e){return e?Ht(e):(le(r._popupRedirectResolver,r,"argument-error"),r._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sc extends ec{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Dr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Dr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Dr(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function cv(r){return Xm(r.auth,new sc(r),r.bypassAuthState)}function uv(r){const{auth:e,user:t}=r;return le(t,e,"internal-error"),Bb(t,new sc(r),r.bypassAuthState)}async function dv(r){const{auth:e,user:t}=r;return le(t,e,"internal-error"),Ub(t,new sc(r),r.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hf{constructor(e,t,n,s,i=!1){this.auth=e,this.resolver=n,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:s,tenantId:i,error:a,type:c}=e;if(a){this.reject(a);return}const u={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(u))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return cv;case"linkViaPopup":case"linkViaRedirect":return dv;case"reauthViaPopup":case"reauthViaRedirect":return uv;default:Et(this.auth,"internal-error")}}resolve(e){Zt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Zt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hv=new di(2e3,1e4);async function mf(r,e,t){if(St(r.app))return Promise.reject(Nt(r,"operation-not-supported-in-this-environment"));const n=sn(r);Hy(r,e,nc);const s=df(n,t);return new Hn(n,"signInViaPopup",e,s).executeNotNull()}class Hn extends hf{constructor(e,t,n,s,i){super(e,t,s,i),this.provider=n,this.authWindow=null,this.pollId=null,Hn.currentPopupAction&&Hn.currentPopupAction.cancel(),Hn.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return le(e,this.auth,"internal-error"),e}async onExecution(){Zt(this.filter.length===1,"Popup operations only handle one event");const e=rc();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Nt(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Nt(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Hn.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;if(!((n=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||n===void 0)&&n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Nt(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,hv.get())};e()}}Hn.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mv="pendingRedirect",Wi=new Map;class fv extends hf{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Wi.get(this.auth._key());if(!e){try{const n=await pv(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}Wi.set(this.auth._key(),e)}return this.bypassAuthState||Wi.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function pv(r,e){const t=yv(e),n=xv(r);if(!await n._isAvailable())return!1;const s=await n._get(t)==="true";return await n._remove(t),s}function gv(r,e){Wi.set(r._key(),e)}function xv(r){return Ht(r._redirectPersistence)}function yv(r){return Hi(mv,r.config.apiKey,r.name)}async function bv(r,e,t=!1){if(St(r.app))return Promise.reject(Yt(r));const n=sn(r),s=df(n,e),a=await new fv(n,s,t).execute();return a&&!t&&(delete a.user._redirectEventId,await n._persistUserIfCurrent(a.user),await n._setRedirectUser(null,e)),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vv=10*60*1e3;class _v{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!wv(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!ff(e)){const s=((n=e.error.code)===null||n===void 0?void 0:n.split("auth/")[1])||"internal-error";t.onError(Nt(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=vv&&this.cachedEventUids.clear(),this.cachedEventUids.has(_d(e))}saveEventToCache(e){this.cachedEventUids.add(_d(e)),this.lastProcessedEventTime=Date.now()}}function _d(r){return[r.type,r.eventId,r.sessionId,r.tenantId].filter(e=>e).join("-")}function ff({type:r,error:e}){return r==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function wv(r){switch(r.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ff(r);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Iv(r,e={}){return rn(r,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tv=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Ev=/^https?/;async function kv(r){if(r.config.emulator)return;const{authorizedDomains:e}=await Iv(r);for(const t of e)try{if(Av(t))return}catch{}Et(r,"unauthorized-domain")}function Av(r){const e=rl(),{protocol:t,hostname:n}=new URL(e);if(r.startsWith("chrome-extension://")){const a=new URL(r);return a.hostname===""&&n===""?t==="chrome-extension:"&&r.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===n}if(!Ev.test(t))return!1;if(Tv.test(r))return n===r;const s=r.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(n)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sv=new di(3e4,6e4);function wd(){const r=Vt().___jsl;if(r!=null&&r.H){for(const e of Object.keys(r.H))if(r.H[e].r=r.H[e].r||[],r.H[e].L=r.H[e].L||[],r.H[e].r=[...r.H[e].L],r.CP)for(let t=0;t<r.CP.length;t++)r.CP[t]=null}}function Nv(r){return new Promise((e,t)=>{var n,s,i;function a(){wd(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{wd(),t(Nt(r,"network-request-failed"))},timeout:Sv.get()})}if(!((s=(n=Vt().gapi)===null||n===void 0?void 0:n.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((i=Vt().gapi)===null||i===void 0)&&i.load)a();else{const c=_b("iframefcb");return Vt()[c]=()=>{gapi.load?a():t(Nt(r,"network-request-failed"))},Qm(`${vb()}?onload=${c}`).catch(u=>t(u))}}).catch(e=>{throw Qi=null,e})}let Qi=null;function Rv(r){return Qi=Qi||Nv(r),Qi}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cv=new di(5e3,15e3),Dv="__/auth/iframe",Pv="emulator/auth/iframe",jv={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Vv=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Ov(r){const e=r.config;le(e.authDomain,r,"auth-domain-config-required");const t=e.emulator?Jl(e,Pv):`https://${r.config.authDomain}/${Dv}`,n={apiKey:e.apiKey,appName:r.name,v:Yr},s=Vv.get(r.config.apiHost);s&&(n.eid=s);const i=r._getFrameworks();return i.length&&(n.fw=i.join(",")),`${t}?${ui(n).slice(1)}`}async function Mv(r){const e=await Rv(r),t=Vt().gapi;return le(t,r,"internal-error"),e.open({where:document.body,url:Ov(r),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:jv,dontclear:!0},n=>new Promise(async(s,i)=>{await n.restyle({setHideOnLeave:!1});const a=Nt(r,"network-request-failed"),c=Vt().setTimeout(()=>{i(a)},Cv.get());function u(){Vt().clearTimeout(c),s(n)}n.ping(u).then(u,()=>{i(a)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lv={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Fv=500,Uv=600,Bv="_blank",zv="http://localhost";class Id{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function $v(r,e,t,n=Fv,s=Uv){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-n)/2,0).toString();let c="";const u=Object.assign(Object.assign({},Lv),{width:n.toString(),height:s.toString(),top:i,left:a}),d=Qe().toLowerCase();t&&(c=zm(d)?Bv:t),Um(d)&&(e=e||zv,u.scrollbars="yes");const m=Object.entries(u).reduce((x,[b,w])=>`${x}${b}=${w},`,"");if(db(d)&&c!=="_self")return Gv(e||"",c),new Id(null);const p=window.open(e||"",c,m);le(p,r,"popup-blocked");try{p.focus()}catch{}return new Id(p)}function Gv(r,e){const t=document.createElement("a");t.href=r,t.target=e;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qv="__/auth/handler",Kv="emulator/auth/handler",Hv=encodeURIComponent("fac");async function Td(r,e,t,n,s,i){le(r.config.authDomain,r,"auth-domain-config-required"),le(r.config.apiKey,r,"invalid-api-key");const a={apiKey:r.config.apiKey,appName:r.name,authType:t,redirectUrl:n,v:Yr,eventId:s};if(e instanceof nc){e.setDefaultLanguage(r.languageCode),a.providerId=e.providerId||"",Px(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[m,p]of Object.entries({}))a[m]=p}if(e instanceof mi){const m=e.getScopes().filter(p=>p!=="");m.length>0&&(a.scopes=m.join(","))}r.tenantId&&(a.tid=r.tenantId);const c=a;for(const m of Object.keys(c))c[m]===void 0&&delete c[m];const u=await r._getAppCheckToken(),d=u?`#${Hv}=${encodeURIComponent(u)}`:"";return`${Wv(r)}?${ui(c).slice(1)}${d}`}function Wv({config:r}){return r.emulator?Jl(r,Kv):`https://${r.authDomain}/${qv}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jo="webStorageSupport";class Qv{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=af,this._completeRedirectFn=bv,this._overrideRedirectResult=gv}async _openPopup(e,t,n,s){var i;Zt((i=this.eventManagers[e._key()])===null||i===void 0?void 0:i.manager,"_initialize() not called before _openPopup()");const a=await Td(e,t,n,rl(),s);return $v(e,a,rc())}async _openRedirect(e,t,n,s){await this._originValidation(e);const i=await Td(e,t,n,rl(),s);return Zb(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(Zt(i,"If manager is not set, promise should be"),i)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){const t=await Mv(e),n=new _v(e);return t.register("authEvent",s=>(le(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:n.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(jo,{type:jo},s=>{var i;const a=(i=s==null?void 0:s[0])===null||i===void 0?void 0:i[jo];a!==void 0&&t(!!a),Et(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=kv(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Hm()||Bm()||Zl()}}const Yv=Qv;var Ed="@firebase/auth",kd="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jv{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(n=>{e((n==null?void 0:n.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){le(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xv(r){switch(r){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Zv(r){Vr(new Zn("auth",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:c}=n.options;le(a&&!a.includes(":"),"invalid-api-key",{appName:n.name});const u={apiKey:a,authDomain:c,clientPlatform:r,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Wm(r)},d=new xb(n,s,i,u);return kb(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),Vr(new Zn("auth-internal",e=>{const t=sn(e.getProvider("auth").getImmediate());return(n=>new Jv(n))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),_n(Ed,kd,Xv(r)),_n(Ed,kd,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e_=5*60,t_=Tm("authIdTokenMaxAge")||e_;let Ad=null;const n_=r=>async e=>{const t=e&&await e.getIdTokenResult(),n=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>t_)return;const s=t==null?void 0:t.token;Ad!==s&&(Ad=s,await fetch(r,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function r_(r=Vy()){const e=Hl(r,"auth");if(e.isInitialized())return e.getImmediate();const t=Eb(r,{popupRedirectResolver:Yv,persistence:[lv,Yb,af]}),n=Tm("authTokenSyncURL");if(n&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(n,location.origin);if(location.origin===i.origin){const a=n_(i.toString());qb(t,a,()=>a(t.currentUser)),Gb(t,c=>a(c))}}const s=_x("auth");return s&&Ab(t,`http://${s}`),t}function s_(){var r,e;return(e=(r=document.getElementsByTagName("head"))===null||r===void 0?void 0:r[0])!==null&&e!==void 0?e:document}yb({loadJS(r){return new Promise((e,t)=>{const n=document.createElement("script");n.setAttribute("src",r),n.onload=e,n.onerror=s=>{const i=Nt("internal-error");i.customData=s,t(i)},n.type="text/javascript",n.charset="UTF-8",s_().appendChild(n)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Zv("Browser");var i_="firebase",a_="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */_n(i_,a_,"app");var Sd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Yn,pf;(function(){var r;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(I,y){function v(){}v.prototype=y.prototype,I.D=y.prototype,I.prototype=new v,I.prototype.constructor=I,I.C=function(E,T,A){for(var _=Array(arguments.length-2),se=2;se<arguments.length;se++)_[se-2]=arguments[se];return y.prototype[T].apply(E,_)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(I,y,v){v||(v=0);var E=Array(16);if(typeof y=="string")for(var T=0;16>T;++T)E[T]=y.charCodeAt(v++)|y.charCodeAt(v++)<<8|y.charCodeAt(v++)<<16|y.charCodeAt(v++)<<24;else for(T=0;16>T;++T)E[T]=y[v++]|y[v++]<<8|y[v++]<<16|y[v++]<<24;y=I.g[0],v=I.g[1],T=I.g[2];var A=I.g[3],_=y+(A^v&(T^A))+E[0]+3614090360&4294967295;y=v+(_<<7&4294967295|_>>>25),_=A+(T^y&(v^T))+E[1]+3905402710&4294967295,A=y+(_<<12&4294967295|_>>>20),_=T+(v^A&(y^v))+E[2]+606105819&4294967295,T=A+(_<<17&4294967295|_>>>15),_=v+(y^T&(A^y))+E[3]+3250441966&4294967295,v=T+(_<<22&4294967295|_>>>10),_=y+(A^v&(T^A))+E[4]+4118548399&4294967295,y=v+(_<<7&4294967295|_>>>25),_=A+(T^y&(v^T))+E[5]+1200080426&4294967295,A=y+(_<<12&4294967295|_>>>20),_=T+(v^A&(y^v))+E[6]+2821735955&4294967295,T=A+(_<<17&4294967295|_>>>15),_=v+(y^T&(A^y))+E[7]+4249261313&4294967295,v=T+(_<<22&4294967295|_>>>10),_=y+(A^v&(T^A))+E[8]+1770035416&4294967295,y=v+(_<<7&4294967295|_>>>25),_=A+(T^y&(v^T))+E[9]+2336552879&4294967295,A=y+(_<<12&4294967295|_>>>20),_=T+(v^A&(y^v))+E[10]+4294925233&4294967295,T=A+(_<<17&4294967295|_>>>15),_=v+(y^T&(A^y))+E[11]+2304563134&4294967295,v=T+(_<<22&4294967295|_>>>10),_=y+(A^v&(T^A))+E[12]+1804603682&4294967295,y=v+(_<<7&4294967295|_>>>25),_=A+(T^y&(v^T))+E[13]+4254626195&4294967295,A=y+(_<<12&4294967295|_>>>20),_=T+(v^A&(y^v))+E[14]+2792965006&4294967295,T=A+(_<<17&4294967295|_>>>15),_=v+(y^T&(A^y))+E[15]+1236535329&4294967295,v=T+(_<<22&4294967295|_>>>10),_=y+(T^A&(v^T))+E[1]+4129170786&4294967295,y=v+(_<<5&4294967295|_>>>27),_=A+(v^T&(y^v))+E[6]+3225465664&4294967295,A=y+(_<<9&4294967295|_>>>23),_=T+(y^v&(A^y))+E[11]+643717713&4294967295,T=A+(_<<14&4294967295|_>>>18),_=v+(A^y&(T^A))+E[0]+3921069994&4294967295,v=T+(_<<20&4294967295|_>>>12),_=y+(T^A&(v^T))+E[5]+3593408605&4294967295,y=v+(_<<5&4294967295|_>>>27),_=A+(v^T&(y^v))+E[10]+38016083&4294967295,A=y+(_<<9&4294967295|_>>>23),_=T+(y^v&(A^y))+E[15]+3634488961&4294967295,T=A+(_<<14&4294967295|_>>>18),_=v+(A^y&(T^A))+E[4]+3889429448&4294967295,v=T+(_<<20&4294967295|_>>>12),_=y+(T^A&(v^T))+E[9]+568446438&4294967295,y=v+(_<<5&4294967295|_>>>27),_=A+(v^T&(y^v))+E[14]+3275163606&4294967295,A=y+(_<<9&4294967295|_>>>23),_=T+(y^v&(A^y))+E[3]+4107603335&4294967295,T=A+(_<<14&4294967295|_>>>18),_=v+(A^y&(T^A))+E[8]+1163531501&4294967295,v=T+(_<<20&4294967295|_>>>12),_=y+(T^A&(v^T))+E[13]+2850285829&4294967295,y=v+(_<<5&4294967295|_>>>27),_=A+(v^T&(y^v))+E[2]+4243563512&4294967295,A=y+(_<<9&4294967295|_>>>23),_=T+(y^v&(A^y))+E[7]+1735328473&4294967295,T=A+(_<<14&4294967295|_>>>18),_=v+(A^y&(T^A))+E[12]+2368359562&4294967295,v=T+(_<<20&4294967295|_>>>12),_=y+(v^T^A)+E[5]+4294588738&4294967295,y=v+(_<<4&4294967295|_>>>28),_=A+(y^v^T)+E[8]+2272392833&4294967295,A=y+(_<<11&4294967295|_>>>21),_=T+(A^y^v)+E[11]+1839030562&4294967295,T=A+(_<<16&4294967295|_>>>16),_=v+(T^A^y)+E[14]+4259657740&4294967295,v=T+(_<<23&4294967295|_>>>9),_=y+(v^T^A)+E[1]+2763975236&4294967295,y=v+(_<<4&4294967295|_>>>28),_=A+(y^v^T)+E[4]+1272893353&4294967295,A=y+(_<<11&4294967295|_>>>21),_=T+(A^y^v)+E[7]+4139469664&4294967295,T=A+(_<<16&4294967295|_>>>16),_=v+(T^A^y)+E[10]+3200236656&4294967295,v=T+(_<<23&4294967295|_>>>9),_=y+(v^T^A)+E[13]+681279174&4294967295,y=v+(_<<4&4294967295|_>>>28),_=A+(y^v^T)+E[0]+3936430074&4294967295,A=y+(_<<11&4294967295|_>>>21),_=T+(A^y^v)+E[3]+3572445317&4294967295,T=A+(_<<16&4294967295|_>>>16),_=v+(T^A^y)+E[6]+76029189&4294967295,v=T+(_<<23&4294967295|_>>>9),_=y+(v^T^A)+E[9]+3654602809&4294967295,y=v+(_<<4&4294967295|_>>>28),_=A+(y^v^T)+E[12]+3873151461&4294967295,A=y+(_<<11&4294967295|_>>>21),_=T+(A^y^v)+E[15]+530742520&4294967295,T=A+(_<<16&4294967295|_>>>16),_=v+(T^A^y)+E[2]+3299628645&4294967295,v=T+(_<<23&4294967295|_>>>9),_=y+(T^(v|~A))+E[0]+4096336452&4294967295,y=v+(_<<6&4294967295|_>>>26),_=A+(v^(y|~T))+E[7]+1126891415&4294967295,A=y+(_<<10&4294967295|_>>>22),_=T+(y^(A|~v))+E[14]+2878612391&4294967295,T=A+(_<<15&4294967295|_>>>17),_=v+(A^(T|~y))+E[5]+4237533241&4294967295,v=T+(_<<21&4294967295|_>>>11),_=y+(T^(v|~A))+E[12]+1700485571&4294967295,y=v+(_<<6&4294967295|_>>>26),_=A+(v^(y|~T))+E[3]+2399980690&4294967295,A=y+(_<<10&4294967295|_>>>22),_=T+(y^(A|~v))+E[10]+4293915773&4294967295,T=A+(_<<15&4294967295|_>>>17),_=v+(A^(T|~y))+E[1]+2240044497&4294967295,v=T+(_<<21&4294967295|_>>>11),_=y+(T^(v|~A))+E[8]+1873313359&4294967295,y=v+(_<<6&4294967295|_>>>26),_=A+(v^(y|~T))+E[15]+4264355552&4294967295,A=y+(_<<10&4294967295|_>>>22),_=T+(y^(A|~v))+E[6]+2734768916&4294967295,T=A+(_<<15&4294967295|_>>>17),_=v+(A^(T|~y))+E[13]+1309151649&4294967295,v=T+(_<<21&4294967295|_>>>11),_=y+(T^(v|~A))+E[4]+4149444226&4294967295,y=v+(_<<6&4294967295|_>>>26),_=A+(v^(y|~T))+E[11]+3174756917&4294967295,A=y+(_<<10&4294967295|_>>>22),_=T+(y^(A|~v))+E[2]+718787259&4294967295,T=A+(_<<15&4294967295|_>>>17),_=v+(A^(T|~y))+E[9]+3951481745&4294967295,I.g[0]=I.g[0]+y&4294967295,I.g[1]=I.g[1]+(T+(_<<21&4294967295|_>>>11))&4294967295,I.g[2]=I.g[2]+T&4294967295,I.g[3]=I.g[3]+A&4294967295}n.prototype.u=function(I,y){y===void 0&&(y=I.length);for(var v=y-this.blockSize,E=this.B,T=this.h,A=0;A<y;){if(T==0)for(;A<=v;)s(this,I,A),A+=this.blockSize;if(typeof I=="string"){for(;A<y;)if(E[T++]=I.charCodeAt(A++),T==this.blockSize){s(this,E),T=0;break}}else for(;A<y;)if(E[T++]=I[A++],T==this.blockSize){s(this,E),T=0;break}}this.h=T,this.o+=y},n.prototype.v=function(){var I=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);I[0]=128;for(var y=1;y<I.length-8;++y)I[y]=0;var v=8*this.o;for(y=I.length-8;y<I.length;++y)I[y]=v&255,v/=256;for(this.u(I),I=Array(16),y=v=0;4>y;++y)for(var E=0;32>E;E+=8)I[v++]=this.g[y]>>>E&255;return I};function i(I,y){var v=c;return Object.prototype.hasOwnProperty.call(v,I)?v[I]:v[I]=y(I)}function a(I,y){this.h=y;for(var v=[],E=!0,T=I.length-1;0<=T;T--){var A=I[T]|0;E&&A==y||(v[T]=A,E=!1)}this.g=v}var c={};function u(I){return-128<=I&&128>I?i(I,function(y){return new a([y|0],0>y?-1:0)}):new a([I|0],0>I?-1:0)}function d(I){if(isNaN(I)||!isFinite(I))return p;if(0>I)return N(d(-I));for(var y=[],v=1,E=0;I>=v;E++)y[E]=I/v|0,v*=4294967296;return new a(y,0)}function m(I,y){if(I.length==0)throw Error("number format error: empty string");if(y=y||10,2>y||36<y)throw Error("radix out of range: "+y);if(I.charAt(0)=="-")return N(m(I.substring(1),y));if(0<=I.indexOf("-"))throw Error('number format error: interior "-" character');for(var v=d(Math.pow(y,8)),E=p,T=0;T<I.length;T+=8){var A=Math.min(8,I.length-T),_=parseInt(I.substring(T,T+A),y);8>A?(A=d(Math.pow(y,A)),E=E.j(A).add(d(_))):(E=E.j(v),E=E.add(d(_)))}return E}var p=u(0),x=u(1),b=u(16777216);r=a.prototype,r.m=function(){if(k(this))return-N(this).m();for(var I=0,y=1,v=0;v<this.g.length;v++){var E=this.i(v);I+=(0<=E?E:4294967296+E)*y,y*=4294967296}return I},r.toString=function(I){if(I=I||10,2>I||36<I)throw Error("radix out of range: "+I);if(w(this))return"0";if(k(this))return"-"+N(this).toString(I);for(var y=d(Math.pow(I,6)),v=this,E="";;){var T=U(v,y).g;v=D(v,T.j(y));var A=((0<v.g.length?v.g[0]:v.h)>>>0).toString(I);if(v=T,w(v))return A+E;for(;6>A.length;)A="0"+A;E=A+E}},r.i=function(I){return 0>I?0:I<this.g.length?this.g[I]:this.h};function w(I){if(I.h!=0)return!1;for(var y=0;y<I.g.length;y++)if(I.g[y]!=0)return!1;return!0}function k(I){return I.h==-1}r.l=function(I){return I=D(this,I),k(I)?-1:w(I)?0:1};function N(I){for(var y=I.g.length,v=[],E=0;E<y;E++)v[E]=~I.g[E];return new a(v,~I.h).add(x)}r.abs=function(){return k(this)?N(this):this},r.add=function(I){for(var y=Math.max(this.g.length,I.g.length),v=[],E=0,T=0;T<=y;T++){var A=E+(this.i(T)&65535)+(I.i(T)&65535),_=(A>>>16)+(this.i(T)>>>16)+(I.i(T)>>>16);E=_>>>16,A&=65535,_&=65535,v[T]=_<<16|A}return new a(v,v[v.length-1]&-2147483648?-1:0)};function D(I,y){return I.add(N(y))}r.j=function(I){if(w(this)||w(I))return p;if(k(this))return k(I)?N(this).j(N(I)):N(N(this).j(I));if(k(I))return N(this.j(N(I)));if(0>this.l(b)&&0>I.l(b))return d(this.m()*I.m());for(var y=this.g.length+I.g.length,v=[],E=0;E<2*y;E++)v[E]=0;for(E=0;E<this.g.length;E++)for(var T=0;T<I.g.length;T++){var A=this.i(E)>>>16,_=this.i(E)&65535,se=I.i(T)>>>16,ie=I.i(T)&65535;v[2*E+2*T]+=_*ie,V(v,2*E+2*T),v[2*E+2*T+1]+=A*ie,V(v,2*E+2*T+1),v[2*E+2*T+1]+=_*se,V(v,2*E+2*T+1),v[2*E+2*T+2]+=A*se,V(v,2*E+2*T+2)}for(E=0;E<y;E++)v[E]=v[2*E+1]<<16|v[2*E];for(E=y;E<2*y;E++)v[E]=0;return new a(v,0)};function V(I,y){for(;(I[y]&65535)!=I[y];)I[y+1]+=I[y]>>>16,I[y]&=65535,y++}function P(I,y){this.g=I,this.h=y}function U(I,y){if(w(y))throw Error("division by zero");if(w(I))return new P(p,p);if(k(I))return y=U(N(I),y),new P(N(y.g),N(y.h));if(k(y))return y=U(I,N(y)),new P(N(y.g),y.h);if(30<I.g.length){if(k(I)||k(y))throw Error("slowDivide_ only works with positive integers.");for(var v=x,E=y;0>=E.l(I);)v=L(v),E=L(E);var T=G(v,1),A=G(E,1);for(E=G(E,2),v=G(v,2);!w(E);){var _=A.add(E);0>=_.l(I)&&(T=T.add(v),A=_),E=G(E,1),v=G(v,1)}return y=D(I,T.j(y)),new P(T,y)}for(T=p;0<=I.l(y);){for(v=Math.max(1,Math.floor(I.m()/y.m())),E=Math.ceil(Math.log(v)/Math.LN2),E=48>=E?1:Math.pow(2,E-48),A=d(v),_=A.j(y);k(_)||0<_.l(I);)v-=E,A=d(v),_=A.j(y);w(A)&&(A=x),T=T.add(A),I=D(I,_)}return new P(T,I)}r.A=function(I){return U(this,I).h},r.and=function(I){for(var y=Math.max(this.g.length,I.g.length),v=[],E=0;E<y;E++)v[E]=this.i(E)&I.i(E);return new a(v,this.h&I.h)},r.or=function(I){for(var y=Math.max(this.g.length,I.g.length),v=[],E=0;E<y;E++)v[E]=this.i(E)|I.i(E);return new a(v,this.h|I.h)},r.xor=function(I){for(var y=Math.max(this.g.length,I.g.length),v=[],E=0;E<y;E++)v[E]=this.i(E)^I.i(E);return new a(v,this.h^I.h)};function L(I){for(var y=I.g.length+1,v=[],E=0;E<y;E++)v[E]=I.i(E)<<1|I.i(E-1)>>>31;return new a(v,I.h)}function G(I,y){var v=y>>5;y%=32;for(var E=I.g.length-v,T=[],A=0;A<E;A++)T[A]=0<y?I.i(A+v)>>>y|I.i(A+v+1)<<32-y:I.i(A+v);return new a(T,I.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,pf=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=m,Yn=a}).apply(typeof Sd<"u"?Sd:typeof self<"u"?self:typeof window<"u"?window:{});var Fi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var gf,ks,xf,Yi,al,yf,bf,vf;(function(){var r,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(l,h,f){return l==Array.prototype||l==Object.prototype||(l[h]=f.value),l};function t(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof Fi=="object"&&Fi];for(var h=0;h<l.length;++h){var f=l[h];if(f&&f.Math==Math)return f}throw Error("Cannot find global object")}var n=t(this);function s(l,h){if(h)e:{var f=n;l=l.split(".");for(var g=0;g<l.length-1;g++){var R=l[g];if(!(R in f))break e;f=f[R]}l=l[l.length-1],g=f[l],h=h(g),h!=g&&h!=null&&e(f,l,{configurable:!0,writable:!0,value:h})}}function i(l,h){l instanceof String&&(l+="");var f=0,g=!1,R={next:function(){if(!g&&f<l.length){var j=f++;return{value:h(j,l[j]),done:!1}}return g=!0,{done:!0,value:void 0}}};return R[Symbol.iterator]=function(){return R},R}s("Array.prototype.values",function(l){return l||function(){return i(this,function(h,f){return f})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},c=this||self;function u(l){var h=typeof l;return h=h!="object"?h:l?Array.isArray(l)?"array":h:"null",h=="array"||h=="object"&&typeof l.length=="number"}function d(l){var h=typeof l;return h=="object"&&l!=null||h=="function"}function m(l,h,f){return l.call.apply(l.bind,arguments)}function p(l,h,f){if(!l)throw Error();if(2<arguments.length){var g=Array.prototype.slice.call(arguments,2);return function(){var R=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(R,g),l.apply(h,R)}}return function(){return l.apply(h,arguments)}}function x(l,h,f){return x=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?m:p,x.apply(null,arguments)}function b(l,h){var f=Array.prototype.slice.call(arguments,1);return function(){var g=f.slice();return g.push.apply(g,arguments),l.apply(this,g)}}function w(l,h){function f(){}f.prototype=h.prototype,l.aa=h.prototype,l.prototype=new f,l.prototype.constructor=l,l.Qb=function(g,R,j){for(var z=Array(arguments.length-2),Ne=2;Ne<arguments.length;Ne++)z[Ne-2]=arguments[Ne];return h.prototype[R].apply(g,z)}}function k(l){const h=l.length;if(0<h){const f=Array(h);for(let g=0;g<h;g++)f[g]=l[g];return f}return[]}function N(l,h){for(let f=1;f<arguments.length;f++){const g=arguments[f];if(u(g)){const R=l.length||0,j=g.length||0;l.length=R+j;for(let z=0;z<j;z++)l[R+z]=g[z]}else l.push(g)}}class D{constructor(h,f){this.i=h,this.j=f,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function V(l){return/^[\s\xa0]*$/.test(l)}function P(){var l=c.navigator;return l&&(l=l.userAgent)?l:""}function U(l){return U[" "](l),l}U[" "]=function(){};var L=P().indexOf("Gecko")!=-1&&!(P().toLowerCase().indexOf("webkit")!=-1&&P().indexOf("Edge")==-1)&&!(P().indexOf("Trident")!=-1||P().indexOf("MSIE")!=-1)&&P().indexOf("Edge")==-1;function G(l,h,f){for(const g in l)h.call(f,l[g],g,l)}function I(l,h){for(const f in l)h.call(void 0,l[f],f,l)}function y(l){const h={};for(const f in l)h[f]=l[f];return h}const v="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(l,h){let f,g;for(let R=1;R<arguments.length;R++){g=arguments[R];for(f in g)l[f]=g[f];for(let j=0;j<v.length;j++)f=v[j],Object.prototype.hasOwnProperty.call(g,f)&&(l[f]=g[f])}}function T(l){var h=1;l=l.split(":");const f=[];for(;0<h&&l.length;)f.push(l.shift()),h--;return l.length&&f.push(l.join(":")),f}function A(l){c.setTimeout(()=>{throw l},0)}function _(){var l=Ee;let h=null;return l.g&&(h=l.g,l.g=l.g.next,l.g||(l.h=null),h.next=null),h}class se{constructor(){this.h=this.g=null}add(h,f){const g=ie.get();g.set(h,f),this.h?this.h.next=g:this.g=g,this.h=g}}var ie=new D(()=>new de,l=>l.reset());class de{constructor(){this.next=this.g=this.h=null}set(h,f){this.h=h,this.g=f,this.next=null}reset(){this.next=this.g=this.h=null}}let ce,Re=!1,Ee=new se,Ae=()=>{const l=c.Promise.resolve(void 0);ce=()=>{l.then(xe)}};var xe=()=>{for(var l;l=_();){try{l.h.call(l.g)}catch(f){A(f)}var h=ie;h.j(l),100>h.h&&(h.h++,l.next=h.g,h.g=l)}Re=!1};function De(){this.s=this.s,this.C=this.C}De.prototype.s=!1,De.prototype.ma=function(){this.s||(this.s=!0,this.N())},De.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function H(l,h){this.type=l,this.g=this.target=h,this.defaultPrevented=!1}H.prototype.h=function(){this.defaultPrevented=!0};var q=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var l=!1,h=Object.defineProperty({},"passive",{get:function(){l=!0}});try{const f=()=>{};c.addEventListener("test",f,h),c.removeEventListener("test",f,h)}catch{}return l}();function te(l,h){if(H.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var f=this.type=l.type,g=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=h,h=l.relatedTarget){if(L){e:{try{U(h.nodeName);var R=!0;break e}catch{}R=!1}R||(h=null)}}else f=="mouseover"?h=l.fromElement:f=="mouseout"&&(h=l.toElement);this.relatedTarget=h,g?(this.clientX=g.clientX!==void 0?g.clientX:g.pageX,this.clientY=g.clientY!==void 0?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=l.clientX!==void 0?l.clientX:l.pageX,this.clientY=l.clientY!==void 0?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType=typeof l.pointerType=="string"?l.pointerType:he[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&te.aa.h.call(this)}}w(te,H);var he={2:"touch",3:"pen",4:"mouse"};te.prototype.h=function(){te.aa.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var ye="closure_listenable_"+(1e6*Math.random()|0),ne=0;function Y(l,h,f,g,R){this.listener=l,this.proxy=null,this.src=h,this.type=f,this.capture=!!g,this.ha=R,this.key=++ne,this.da=this.fa=!1}function ae(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function be(l){this.src=l,this.g={},this.h=0}be.prototype.add=function(l,h,f,g,R){var j=l.toString();l=this.g[j],l||(l=this.g[j]=[],this.h++);var z=nt(l,h,g,R);return-1<z?(h=l[z],f||(h.fa=!1)):(h=new Y(h,this.src,j,!!g,R),h.fa=f,l.push(h)),h};function tt(l,h){var f=h.type;if(f in l.g){var g=l.g[f],R=Array.prototype.indexOf.call(g,h,void 0),j;(j=0<=R)&&Array.prototype.splice.call(g,R,1),j&&(ae(h),l.g[f].length==0&&(delete l.g[f],l.h--))}}function nt(l,h,f,g){for(var R=0;R<l.length;++R){var j=l[R];if(!j.da&&j.listener==h&&j.capture==!!f&&j.ha==g)return R}return-1}var yt="closure_lm_"+(1e6*Math.random()|0),Tt={};function Rt(l,h,f,g,R){if(Array.isArray(h)){for(var j=0;j<h.length;j++)Rt(l,h[j],f,g,R);return null}return f=O(f),l&&l[ye]?l.K(h,f,d(g)?!!g.capture:!1,R):$(l,h,f,!1,g,R)}function $(l,h,f,g,R,j){if(!h)throw Error("Invalid event type");var z=d(R)?!!R.capture:!!R,Ne=Ct(l);if(Ne||(l[yt]=Ne=new be(l)),f=Ne.add(h,f,g,z,j),f.proxy)return f;if(g=we(),f.proxy=g,g.src=l,g.listener=f,l.addEventListener)q||(R=z),R===void 0&&(R=!1),l.addEventListener(h.toString(),g,R);else if(l.attachEvent)l.attachEvent($e(h.toString()),g);else if(l.addListener&&l.removeListener)l.addListener(g);else throw Error("addEventListener and attachEvent are unavailable.");return f}function we(){function l(f){return h.call(l.src,l.listener,f)}const h=kt;return l}function Ve(l,h,f,g,R){if(Array.isArray(h))for(var j=0;j<h.length;j++)Ve(l,h[j],f,g,R);else g=d(g)?!!g.capture:!!g,f=O(f),l&&l[ye]?(l=l.i,h=String(h).toString(),h in l.g&&(j=l.g[h],f=nt(j,f,g,R),-1<f&&(ae(j[f]),Array.prototype.splice.call(j,f,1),j.length==0&&(delete l.g[h],l.h--)))):l&&(l=Ct(l))&&(h=l.g[h.toString()],l=-1,h&&(l=nt(h,f,g,R)),(f=-1<l?h[l]:null)&&He(f))}function He(l){if(typeof l!="number"&&l&&!l.da){var h=l.src;if(h&&h[ye])tt(h.i,l);else{var f=l.type,g=l.proxy;h.removeEventListener?h.removeEventListener(f,g,l.capture):h.detachEvent?h.detachEvent($e(f),g):h.addListener&&h.removeListener&&h.removeListener(g),(f=Ct(h))?(tt(f,l),f.h==0&&(f.src=null,h[yt]=null)):ae(l)}}}function $e(l){return l in Tt?Tt[l]:Tt[l]="on"+l}function kt(l,h){if(l.da)l=!0;else{h=new te(h,this);var f=l.listener,g=l.ha||l.src;l.fa&&He(l),l=f.call(g,h)}return l}function Ct(l){return l=l[yt],l instanceof be?l:null}var Z="__closure_events_fn_"+(1e9*Math.random()>>>0);function O(l){return typeof l=="function"?l:(l[Z]||(l[Z]=function(h){return l.handleEvent(h)}),l[Z])}function J(){De.call(this),this.i=new be(this),this.M=this,this.F=null}w(J,De),J.prototype[ye]=!0,J.prototype.removeEventListener=function(l,h,f,g){Ve(this,l,h,f,g)};function oe(l,h){var f,g=l.F;if(g)for(f=[];g;g=g.F)f.push(g);if(l=l.M,g=h.type||h,typeof h=="string")h=new H(h,l);else if(h instanceof H)h.target=h.target||l;else{var R=h;h=new H(g,l),E(h,R)}if(R=!0,f)for(var j=f.length-1;0<=j;j--){var z=h.g=f[j];R=Ie(z,g,!0,h)&&R}if(z=h.g=l,R=Ie(z,g,!0,h)&&R,R=Ie(z,g,!1,h)&&R,f)for(j=0;j<f.length;j++)z=h.g=f[j],R=Ie(z,g,!1,h)&&R}J.prototype.N=function(){if(J.aa.N.call(this),this.i){var l=this.i,h;for(h in l.g){for(var f=l.g[h],g=0;g<f.length;g++)ae(f[g]);delete l.g[h],l.h--}}this.F=null},J.prototype.K=function(l,h,f,g){return this.i.add(String(l),h,!1,f,g)},J.prototype.L=function(l,h,f,g){return this.i.add(String(l),h,!0,f,g)};function Ie(l,h,f,g){if(h=l.i.g[String(h)],!h)return!0;h=h.concat();for(var R=!0,j=0;j<h.length;++j){var z=h[j];if(z&&!z.da&&z.capture==f){var Ne=z.listener,Xe=z.ha||z.src;z.fa&&tt(l.i,z),R=Ne.call(Xe,g)!==!1&&R}}return R&&!g.defaultPrevented}function ct(l,h,f){if(typeof l=="function")f&&(l=x(l,f));else if(l&&typeof l.handleEvent=="function")l=x(l.handleEvent,l);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:c.setTimeout(l,h||0)}function bt(l){l.g=ct(()=>{l.g=null,l.i&&(l.i=!1,bt(l))},l.l);const h=l.h;l.h=null,l.m.apply(null,h)}class Lt extends De{constructor(h,f){super(),this.m=h,this.l=f,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:bt(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function hr(l){De.call(this),this.h=l,this.g={}}w(hr,De);var Xc=[];function Zc(l){G(l.g,function(h,f){this.g.hasOwnProperty(f)&&He(h)},l),l.g={}}hr.prototype.N=function(){hr.aa.N.call(this),Zc(this)},hr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var uo=c.JSON.stringify,Bg=c.JSON.parse,zg=class{stringify(l){return c.JSON.stringify(l,void 0)}parse(l){return c.JSON.parse(l,void 0)}};function ho(){}ho.prototype.h=null;function eu(l){return l.h||(l.h=l.i())}function tu(){}var as={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function mo(){H.call(this,"d")}w(mo,H);function fo(){H.call(this,"c")}w(fo,H);var jn={},nu=null;function Ii(){return nu=nu||new J}jn.La="serverreachability";function ru(l){H.call(this,jn.La,l)}w(ru,H);function os(l){const h=Ii();oe(h,new ru(h))}jn.STAT_EVENT="statevent";function su(l,h){H.call(this,jn.STAT_EVENT,l),this.stat=h}w(su,H);function ut(l){const h=Ii();oe(h,new su(h,l))}jn.Ma="timingevent";function iu(l,h){H.call(this,jn.Ma,l),this.size=h}w(iu,H);function ls(l,h){if(typeof l!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){l()},h)}function cs(){this.g=!0}cs.prototype.xa=function(){this.g=!1};function $g(l,h,f,g,R,j){l.info(function(){if(l.g)if(j)for(var z="",Ne=j.split("&"),Xe=0;Xe<Ne.length;Xe++){var ve=Ne[Xe].split("=");if(1<ve.length){var rt=ve[0];ve=ve[1];var st=rt.split("_");z=2<=st.length&&st[1]=="type"?z+(rt+"="+ve+"&"):z+(rt+"=redacted&")}}else z=null;else z=j;return"XMLHTTP REQ ("+g+") [attempt "+R+"]: "+h+`
`+f+`
`+z})}function Gg(l,h,f,g,R,j,z){l.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+R+"]: "+h+`
`+f+`
`+j+" "+z})}function mr(l,h,f,g){l.info(function(){return"XMLHTTP TEXT ("+h+"): "+Kg(l,f)+(g?" "+g:"")})}function qg(l,h){l.info(function(){return"TIMEOUT: "+h})}cs.prototype.info=function(){};function Kg(l,h){if(!l.g)return h;if(!h)return null;try{var f=JSON.parse(h);if(f){for(l=0;l<f.length;l++)if(Array.isArray(f[l])){var g=f[l];if(!(2>g.length)){var R=g[1];if(Array.isArray(R)&&!(1>R.length)){var j=R[0];if(j!="noop"&&j!="stop"&&j!="close")for(var z=1;z<R.length;z++)R[z]=""}}}}return uo(f)}catch{return h}}var Ti={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},au={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},po;function Ei(){}w(Ei,ho),Ei.prototype.g=function(){return new XMLHttpRequest},Ei.prototype.i=function(){return{}},po=new Ei;function on(l,h,f,g){this.j=l,this.i=h,this.l=f,this.R=g||1,this.U=new hr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ou}function ou(){this.i=null,this.g="",this.h=!1}var lu={},go={};function xo(l,h,f){l.L=1,l.v=Ni(Ft(h)),l.m=f,l.P=!0,cu(l,null)}function cu(l,h){l.F=Date.now(),ki(l),l.A=Ft(l.v);var f=l.A,g=l.R;Array.isArray(g)||(g=[String(g)]),Iu(f.i,"t",g),l.C=0,f=l.j.J,l.h=new ou,l.g=Bu(l.j,f?h:null,!l.m),0<l.O&&(l.M=new Lt(x(l.Y,l,l.g),l.O)),h=l.U,f=l.g,g=l.ca;var R="readystatechange";Array.isArray(R)||(R&&(Xc[0]=R.toString()),R=Xc);for(var j=0;j<R.length;j++){var z=Rt(f,R[j],g||h.handleEvent,!1,h.h||h);if(!z)break;h.g[z.key]=z}h=l.H?y(l.H):{},l.m?(l.u||(l.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.A,l.u,l.m,h)):(l.u="GET",l.g.ea(l.A,l.u,null,h)),os(),$g(l.i,l.u,l.A,l.l,l.R,l.m)}on.prototype.ca=function(l){l=l.target;const h=this.M;h&&Ut(l)==3?h.j():this.Y(l)},on.prototype.Y=function(l){try{if(l==this.g)e:{const st=Ut(this.g);var h=this.g.Ba();const gr=this.g.Z();if(!(3>st)&&(st!=3||this.g&&(this.h.h||this.g.oa()||Ru(this.g)))){this.J||st!=4||h==7||(h==8||0>=gr?os(3):os(2)),yo(this);var f=this.g.Z();this.X=f;t:if(uu(this)){var g=Ru(this.g);l="";var R=g.length,j=Ut(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Vn(this),us(this);var z="";break t}this.h.i=new c.TextDecoder}for(h=0;h<R;h++)this.h.h=!0,l+=this.h.i.decode(g[h],{stream:!(j&&h==R-1)});g.length=0,this.h.g+=l,this.C=0,z=this.h.g}else z=this.g.oa();if(this.o=f==200,Gg(this.i,this.u,this.A,this.l,this.R,st,f),this.o){if(this.T&&!this.K){t:{if(this.g){var Ne,Xe=this.g;if((Ne=Xe.g?Xe.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!V(Ne)){var ve=Ne;break t}}ve=null}if(f=ve)mr(this.i,this.l,f,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,bo(this,f);else{this.o=!1,this.s=3,ut(12),Vn(this),us(this);break e}}if(this.P){f=!0;let At;for(;!this.J&&this.C<z.length;)if(At=Hg(this,z),At==go){st==4&&(this.s=4,ut(14),f=!1),mr(this.i,this.l,null,"[Incomplete Response]");break}else if(At==lu){this.s=4,ut(15),mr(this.i,this.l,z,"[Invalid Chunk]"),f=!1;break}else mr(this.i,this.l,At,null),bo(this,At);if(uu(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),st!=4||z.length!=0||this.h.h||(this.s=1,ut(16),f=!1),this.o=this.o&&f,!f)mr(this.i,this.l,z,"[Invalid Chunked Response]"),Vn(this),us(this);else if(0<z.length&&!this.W){this.W=!0;var rt=this.j;rt.g==this&&rt.ba&&!rt.M&&(rt.j.info("Great, no buffering proxy detected. Bytes received: "+z.length),Eo(rt),rt.M=!0,ut(11))}}else mr(this.i,this.l,z,null),bo(this,z);st==4&&Vn(this),this.o&&!this.J&&(st==4?Mu(this.j,this):(this.o=!1,ki(this)))}else u0(this.g),f==400&&0<z.indexOf("Unknown SID")?(this.s=3,ut(12)):(this.s=0,ut(13)),Vn(this),us(this)}}}catch{}finally{}};function uu(l){return l.g?l.u=="GET"&&l.L!=2&&l.j.Ca:!1}function Hg(l,h){var f=l.C,g=h.indexOf(`
`,f);return g==-1?go:(f=Number(h.substring(f,g)),isNaN(f)?lu:(g+=1,g+f>h.length?go:(h=h.slice(g,g+f),l.C=g+f,h)))}on.prototype.cancel=function(){this.J=!0,Vn(this)};function ki(l){l.S=Date.now()+l.I,du(l,l.I)}function du(l,h){if(l.B!=null)throw Error("WatchDog timer not null");l.B=ls(x(l.ba,l),h)}function yo(l){l.B&&(c.clearTimeout(l.B),l.B=null)}on.prototype.ba=function(){this.B=null;const l=Date.now();0<=l-this.S?(qg(this.i,this.A),this.L!=2&&(os(),ut(17)),Vn(this),this.s=2,us(this)):du(this,this.S-l)};function us(l){l.j.G==0||l.J||Mu(l.j,l)}function Vn(l){yo(l);var h=l.M;h&&typeof h.ma=="function"&&h.ma(),l.M=null,Zc(l.U),l.g&&(h=l.g,l.g=null,h.abort(),h.ma())}function bo(l,h){try{var f=l.j;if(f.G!=0&&(f.g==l||vo(f.h,l))){if(!l.K&&vo(f.h,l)&&f.G==3){try{var g=f.Da.g.parse(h)}catch{g=null}if(Array.isArray(g)&&g.length==3){var R=g;if(R[0]==0){e:if(!f.u){if(f.g)if(f.g.F+3e3<l.F)Vi(f),Pi(f);else break e;To(f),ut(18)}}else f.za=R[1],0<f.za-f.T&&37500>R[2]&&f.F&&f.v==0&&!f.C&&(f.C=ls(x(f.Za,f),6e3));if(1>=fu(f.h)&&f.ca){try{f.ca()}catch{}f.ca=void 0}}else Mn(f,11)}else if((l.K||f.g==l)&&Vi(f),!V(h))for(R=f.Da.g.parse(h),h=0;h<R.length;h++){let ve=R[h];if(f.T=ve[0],ve=ve[1],f.G==2)if(ve[0]=="c"){f.K=ve[1],f.ia=ve[2];const rt=ve[3];rt!=null&&(f.la=rt,f.j.info("VER="+f.la));const st=ve[4];st!=null&&(f.Aa=st,f.j.info("SVER="+f.Aa));const gr=ve[5];gr!=null&&typeof gr=="number"&&0<gr&&(g=1.5*gr,f.L=g,f.j.info("backChannelRequestTimeoutMs_="+g)),g=f;const At=l.g;if(At){const Mi=At.g?At.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Mi){var j=g.h;j.g||Mi.indexOf("spdy")==-1&&Mi.indexOf("quic")==-1&&Mi.indexOf("h2")==-1||(j.j=j.l,j.g=new Set,j.h&&(_o(j,j.h),j.h=null))}if(g.D){const ko=At.g?At.g.getResponseHeader("X-HTTP-Session-Id"):null;ko&&(g.ya=ko,Pe(g.I,g.D,ko))}}f.G=3,f.l&&f.l.ua(),f.ba&&(f.R=Date.now()-l.F,f.j.info("Handshake RTT: "+f.R+"ms")),g=f;var z=l;if(g.qa=Uu(g,g.J?g.ia:null,g.W),z.K){pu(g.h,z);var Ne=z,Xe=g.L;Xe&&(Ne.I=Xe),Ne.B&&(yo(Ne),ki(Ne)),g.g=z}else Vu(g);0<f.i.length&&ji(f)}else ve[0]!="stop"&&ve[0]!="close"||Mn(f,7);else f.G==3&&(ve[0]=="stop"||ve[0]=="close"?ve[0]=="stop"?Mn(f,7):Io(f):ve[0]!="noop"&&f.l&&f.l.ta(ve),f.v=0)}}os(4)}catch{}}var Wg=class{constructor(l,h){this.g=l,this.map=h}};function hu(l){this.l=l||10,c.PerformanceNavigationTiming?(l=c.performance.getEntriesByType("navigation"),l=0<l.length&&(l[0].nextHopProtocol=="hq"||l[0].nextHopProtocol=="h2")):l=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function mu(l){return l.h?!0:l.g?l.g.size>=l.j:!1}function fu(l){return l.h?1:l.g?l.g.size:0}function vo(l,h){return l.h?l.h==h:l.g?l.g.has(h):!1}function _o(l,h){l.g?l.g.add(h):l.h=h}function pu(l,h){l.h&&l.h==h?l.h=null:l.g&&l.g.has(h)&&l.g.delete(h)}hu.prototype.cancel=function(){if(this.i=gu(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const l of this.g.values())l.cancel();this.g.clear()}};function gu(l){if(l.h!=null)return l.i.concat(l.h.D);if(l.g!=null&&l.g.size!==0){let h=l.i;for(const f of l.g.values())h=h.concat(f.D);return h}return k(l.i)}function Qg(l){if(l.V&&typeof l.V=="function")return l.V();if(typeof Map<"u"&&l instanceof Map||typeof Set<"u"&&l instanceof Set)return Array.from(l.values());if(typeof l=="string")return l.split("");if(u(l)){for(var h=[],f=l.length,g=0;g<f;g++)h.push(l[g]);return h}h=[],f=0;for(g in l)h[f++]=l[g];return h}function Yg(l){if(l.na&&typeof l.na=="function")return l.na();if(!l.V||typeof l.V!="function"){if(typeof Map<"u"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set<"u"&&l instanceof Set)){if(u(l)||typeof l=="string"){var h=[];l=l.length;for(var f=0;f<l;f++)h.push(f);return h}h=[],f=0;for(const g in l)h[f++]=g;return h}}}function xu(l,h){if(l.forEach&&typeof l.forEach=="function")l.forEach(h,void 0);else if(u(l)||typeof l=="string")Array.prototype.forEach.call(l,h,void 0);else for(var f=Yg(l),g=Qg(l),R=g.length,j=0;j<R;j++)h.call(void 0,g[j],f&&f[j],l)}var yu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Jg(l,h){if(l){l=l.split("&");for(var f=0;f<l.length;f++){var g=l[f].indexOf("="),R=null;if(0<=g){var j=l[f].substring(0,g);R=l[f].substring(g+1)}else j=l[f];h(j,R?decodeURIComponent(R.replace(/\+/g," ")):"")}}}function On(l){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,l instanceof On){this.h=l.h,Ai(this,l.j),this.o=l.o,this.g=l.g,Si(this,l.s),this.l=l.l;var h=l.i,f=new ms;f.i=h.i,h.g&&(f.g=new Map(h.g),f.h=h.h),bu(this,f),this.m=l.m}else l&&(h=String(l).match(yu))?(this.h=!1,Ai(this,h[1]||"",!0),this.o=ds(h[2]||""),this.g=ds(h[3]||"",!0),Si(this,h[4]),this.l=ds(h[5]||"",!0),bu(this,h[6]||"",!0),this.m=ds(h[7]||"")):(this.h=!1,this.i=new ms(null,this.h))}On.prototype.toString=function(){var l=[],h=this.j;h&&l.push(hs(h,vu,!0),":");var f=this.g;return(f||h=="file")&&(l.push("//"),(h=this.o)&&l.push(hs(h,vu,!0),"@"),l.push(encodeURIComponent(String(f)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f=this.s,f!=null&&l.push(":",String(f))),(f=this.l)&&(this.g&&f.charAt(0)!="/"&&l.push("/"),l.push(hs(f,f.charAt(0)=="/"?e0:Zg,!0))),(f=this.i.toString())&&l.push("?",f),(f=this.m)&&l.push("#",hs(f,n0)),l.join("")};function Ft(l){return new On(l)}function Ai(l,h,f){l.j=f?ds(h,!0):h,l.j&&(l.j=l.j.replace(/:$/,""))}function Si(l,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);l.s=h}else l.s=null}function bu(l,h,f){h instanceof ms?(l.i=h,r0(l.i,l.h)):(f||(h=hs(h,t0)),l.i=new ms(h,l.h))}function Pe(l,h,f){l.i.set(h,f)}function Ni(l){return Pe(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function ds(l,h){return l?h?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function hs(l,h,f){return typeof l=="string"?(l=encodeURI(l).replace(h,Xg),f&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function Xg(l){return l=l.charCodeAt(0),"%"+(l>>4&15).toString(16)+(l&15).toString(16)}var vu=/[#\/\?@]/g,Zg=/[#\?:]/g,e0=/[#\?]/g,t0=/[#\?@]/g,n0=/#/g;function ms(l,h){this.h=this.g=null,this.i=l||null,this.j=!!h}function ln(l){l.g||(l.g=new Map,l.h=0,l.i&&Jg(l.i,function(h,f){l.add(decodeURIComponent(h.replace(/\+/g," ")),f)}))}r=ms.prototype,r.add=function(l,h){ln(this),this.i=null,l=fr(this,l);var f=this.g.get(l);return f||this.g.set(l,f=[]),f.push(h),this.h+=1,this};function _u(l,h){ln(l),h=fr(l,h),l.g.has(h)&&(l.i=null,l.h-=l.g.get(h).length,l.g.delete(h))}function wu(l,h){return ln(l),h=fr(l,h),l.g.has(h)}r.forEach=function(l,h){ln(this),this.g.forEach(function(f,g){f.forEach(function(R){l.call(h,R,g,this)},this)},this)},r.na=function(){ln(this);const l=Array.from(this.g.values()),h=Array.from(this.g.keys()),f=[];for(let g=0;g<h.length;g++){const R=l[g];for(let j=0;j<R.length;j++)f.push(h[g])}return f},r.V=function(l){ln(this);let h=[];if(typeof l=="string")wu(this,l)&&(h=h.concat(this.g.get(fr(this,l))));else{l=Array.from(this.g.values());for(let f=0;f<l.length;f++)h=h.concat(l[f])}return h},r.set=function(l,h){return ln(this),this.i=null,l=fr(this,l),wu(this,l)&&(this.h-=this.g.get(l).length),this.g.set(l,[h]),this.h+=1,this},r.get=function(l,h){return l?(l=this.V(l),0<l.length?String(l[0]):h):h};function Iu(l,h,f){_u(l,h),0<f.length&&(l.i=null,l.g.set(fr(l,h),k(f)),l.h+=f.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const l=[],h=Array.from(this.g.keys());for(var f=0;f<h.length;f++){var g=h[f];const j=encodeURIComponent(String(g)),z=this.V(g);for(g=0;g<z.length;g++){var R=j;z[g]!==""&&(R+="="+encodeURIComponent(String(z[g]))),l.push(R)}}return this.i=l.join("&")};function fr(l,h){return h=String(h),l.j&&(h=h.toLowerCase()),h}function r0(l,h){h&&!l.j&&(ln(l),l.i=null,l.g.forEach(function(f,g){var R=g.toLowerCase();g!=R&&(_u(this,g),Iu(this,R,f))},l)),l.j=h}function s0(l,h){const f=new cs;if(c.Image){const g=new Image;g.onload=b(cn,f,"TestLoadImage: loaded",!0,h,g),g.onerror=b(cn,f,"TestLoadImage: error",!1,h,g),g.onabort=b(cn,f,"TestLoadImage: abort",!1,h,g),g.ontimeout=b(cn,f,"TestLoadImage: timeout",!1,h,g),c.setTimeout(function(){g.ontimeout&&g.ontimeout()},1e4),g.src=l}else h(!1)}function i0(l,h){const f=new cs,g=new AbortController,R=setTimeout(()=>{g.abort(),cn(f,"TestPingServer: timeout",!1,h)},1e4);fetch(l,{signal:g.signal}).then(j=>{clearTimeout(R),j.ok?cn(f,"TestPingServer: ok",!0,h):cn(f,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(R),cn(f,"TestPingServer: error",!1,h)})}function cn(l,h,f,g,R){try{R&&(R.onload=null,R.onerror=null,R.onabort=null,R.ontimeout=null),g(f)}catch{}}function a0(){this.g=new zg}function o0(l,h,f){const g=f||"";try{xu(l,function(R,j){let z=R;d(R)&&(z=uo(R)),h.push(g+j+"="+encodeURIComponent(z))})}catch(R){throw h.push(g+"type="+encodeURIComponent("_badmap")),R}}function Ri(l){this.l=l.Ub||null,this.j=l.eb||!1}w(Ri,ho),Ri.prototype.g=function(){return new Ci(this.l,this.j)},Ri.prototype.i=function(l){return function(){return l}}({});function Ci(l,h){J.call(this),this.D=l,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}w(Ci,J),r=Ci.prototype,r.open=function(l,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=l,this.A=h,this.readyState=1,ps(this)},r.send=function(l){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};l&&(h.body=l),(this.D||c).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,fs(this)),this.readyState=0},r.Sa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,ps(this)),this.g&&(this.readyState=3,ps(this),this.g)))if(this.responseType==="arraybuffer")l.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Tu(this)}else l.text().then(this.Ra.bind(this),this.ga.bind(this))};function Tu(l){l.j.read().then(l.Pa.bind(l)).catch(l.ga.bind(l))}r.Pa=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var h=l.value?l.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!l.done}))&&(this.response=this.responseText+=h)}l.done?fs(this):ps(this),this.readyState==3&&Tu(this)}},r.Ra=function(l){this.g&&(this.response=this.responseText=l,fs(this))},r.Qa=function(l){this.g&&(this.response=l,fs(this))},r.ga=function(){this.g&&fs(this)};function fs(l){l.readyState=4,l.l=null,l.j=null,l.v=null,ps(l)}r.setRequestHeader=function(l,h){this.u.append(l,h)},r.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const l=[],h=this.h.entries();for(var f=h.next();!f.done;)f=f.value,l.push(f[0]+": "+f[1]),f=h.next();return l.join(`\r
`)};function ps(l){l.onreadystatechange&&l.onreadystatechange.call(l)}Object.defineProperty(Ci.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(l){this.m=l?"include":"same-origin"}});function Eu(l){let h="";return G(l,function(f,g){h+=g,h+=":",h+=f,h+=`\r
`}),h}function wo(l,h,f){e:{for(g in f){var g=!1;break e}g=!0}g||(f=Eu(f),typeof l=="string"?f!=null&&encodeURIComponent(String(f)):Pe(l,h,f))}function Fe(l){J.call(this),this.headers=new Map,this.o=l||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}w(Fe,J);var l0=/^https?$/i,c0=["POST","PUT"];r=Fe.prototype,r.Ha=function(l){this.J=l},r.ea=function(l,h,f,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);h=h?h.toUpperCase():"GET",this.D=l,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():po.g(),this.v=this.o?eu(this.o):eu(po),this.g.onreadystatechange=x(this.Ea,this);try{this.B=!0,this.g.open(h,String(l),!0),this.B=!1}catch(j){ku(this,j);return}if(l=f||"",f=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var R in g)f.set(R,g[R]);else if(typeof g.keys=="function"&&typeof g.get=="function")for(const j of g.keys())f.set(j,g.get(j));else throw Error("Unknown input type for opt_headers: "+String(g));g=Array.from(f.keys()).find(j=>j.toLowerCase()=="content-type"),R=c.FormData&&l instanceof c.FormData,!(0<=Array.prototype.indexOf.call(c0,h,void 0))||g||R||f.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[j,z]of f)this.g.setRequestHeader(j,z);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Nu(this),this.u=!0,this.g.send(l),this.u=!1}catch(j){ku(this,j)}};function ku(l,h){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=h,l.m=5,Au(l),Di(l)}function Au(l){l.A||(l.A=!0,oe(l,"complete"),oe(l,"error"))}r.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=l||7,oe(this,"complete"),oe(this,"abort"),Di(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Di(this,!0)),Fe.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Su(this):this.bb())},r.bb=function(){Su(this)};function Su(l){if(l.h&&typeof a<"u"&&(!l.v[1]||Ut(l)!=4||l.Z()!=2)){if(l.u&&Ut(l)==4)ct(l.Ea,0,l);else if(oe(l,"readystatechange"),Ut(l)==4){l.h=!1;try{const z=l.Z();e:switch(z){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var f;if(!(f=h)){var g;if(g=z===0){var R=String(l.D).match(yu)[1]||null;!R&&c.self&&c.self.location&&(R=c.self.location.protocol.slice(0,-1)),g=!l0.test(R?R.toLowerCase():"")}f=g}if(f)oe(l,"complete"),oe(l,"success");else{l.m=6;try{var j=2<Ut(l)?l.g.statusText:""}catch{j=""}l.l=j+" ["+l.Z()+"]",Au(l)}}finally{Di(l)}}}}function Di(l,h){if(l.g){Nu(l);const f=l.g,g=l.v[0]?()=>{}:null;l.g=null,l.v=null,h||oe(l,"ready");try{f.onreadystatechange=g}catch{}}}function Nu(l){l.I&&(c.clearTimeout(l.I),l.I=null)}r.isActive=function(){return!!this.g};function Ut(l){return l.g?l.g.readyState:0}r.Z=function(){try{return 2<Ut(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(l){if(this.g){var h=this.g.responseText;return l&&h.indexOf(l)==0&&(h=h.substring(l.length)),Bg(h)}};function Ru(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.H){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function u0(l){const h={};l=(l.g&&2<=Ut(l)&&l.g.getAllResponseHeaders()||"").split(`\r
`);for(let g=0;g<l.length;g++){if(V(l[g]))continue;var f=T(l[g]);const R=f[0];if(f=f[1],typeof f!="string")continue;f=f.trim();const j=h[R]||[];h[R]=j,j.push(f)}I(h,function(g){return g.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function gs(l,h,f){return f&&f.internalChannelParams&&f.internalChannelParams[l]||h}function Cu(l){this.Aa=0,this.i=[],this.j=new cs,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=gs("failFast",!1,l),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=gs("baseRetryDelayMs",5e3,l),this.cb=gs("retryDelaySeedMs",1e4,l),this.Wa=gs("forwardChannelMaxRetries",2,l),this.wa=gs("forwardChannelRequestTimeoutMs",2e4,l),this.pa=l&&l.xmlHttpFactory||void 0,this.Xa=l&&l.Tb||void 0,this.Ca=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.h=new hu(l&&l.concurrentRequestLimit),this.Da=new a0,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=l&&l.Rb||!1,l&&l.xa&&this.j.xa(),l&&l.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&l&&l.detectBufferingProxy||!1,this.ja=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.ja=l.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=Cu.prototype,r.la=8,r.G=1,r.connect=function(l,h,f,g){ut(0),this.W=l,this.H=h||{},f&&g!==void 0&&(this.H.OSID=f,this.H.OAID=g),this.F=this.X,this.I=Uu(this,null,this.W),ji(this)};function Io(l){if(Du(l),l.G==3){var h=l.U++,f=Ft(l.I);if(Pe(f,"SID",l.K),Pe(f,"RID",h),Pe(f,"TYPE","terminate"),xs(l,f),h=new on(l,l.j,h),h.L=2,h.v=Ni(Ft(f)),f=!1,c.navigator&&c.navigator.sendBeacon)try{f=c.navigator.sendBeacon(h.v.toString(),"")}catch{}!f&&c.Image&&(new Image().src=h.v,f=!0),f||(h.g=Bu(h.j,null),h.g.ea(h.v)),h.F=Date.now(),ki(h)}Fu(l)}function Pi(l){l.g&&(Eo(l),l.g.cancel(),l.g=null)}function Du(l){Pi(l),l.u&&(c.clearTimeout(l.u),l.u=null),Vi(l),l.h.cancel(),l.s&&(typeof l.s=="number"&&c.clearTimeout(l.s),l.s=null)}function ji(l){if(!mu(l.h)&&!l.s){l.s=!0;var h=l.Ga;ce||Ae(),Re||(ce(),Re=!0),Ee.add(h,l),l.B=0}}function d0(l,h){return fu(l.h)>=l.h.j-(l.s?1:0)?!1:l.s?(l.i=h.D.concat(l.i),!0):l.G==1||l.G==2||l.B>=(l.Va?0:l.Wa)?!1:(l.s=ls(x(l.Ga,l,h),Lu(l,l.B)),l.B++,!0)}r.Ga=function(l){if(this.s)if(this.s=null,this.G==1){if(!l){this.U=Math.floor(1e5*Math.random()),l=this.U++;const R=new on(this,this.j,l);let j=this.o;if(this.S&&(j?(j=y(j),E(j,this.S)):j=this.S),this.m!==null||this.O||(R.H=j,j=null),this.P)e:{for(var h=0,f=0;f<this.i.length;f++){t:{var g=this.i[f];if("__data__"in g.map&&(g=g.map.__data__,typeof g=="string")){g=g.length;break t}g=void 0}if(g===void 0)break;if(h+=g,4096<h){h=f;break e}if(h===4096||f===this.i.length-1){h=f+1;break e}}h=1e3}else h=1e3;h=ju(this,R,h),f=Ft(this.I),Pe(f,"RID",l),Pe(f,"CVER",22),this.D&&Pe(f,"X-HTTP-Session-Id",this.D),xs(this,f),j&&(this.O?h="headers="+encodeURIComponent(String(Eu(j)))+"&"+h:this.m&&wo(f,this.m,j)),_o(this.h,R),this.Ua&&Pe(f,"TYPE","init"),this.P?(Pe(f,"$req",h),Pe(f,"SID","null"),R.T=!0,xo(R,f,null)):xo(R,f,h),this.G=2}}else this.G==3&&(l?Pu(this,l):this.i.length==0||mu(this.h)||Pu(this))};function Pu(l,h){var f;h?f=h.l:f=l.U++;const g=Ft(l.I);Pe(g,"SID",l.K),Pe(g,"RID",f),Pe(g,"AID",l.T),xs(l,g),l.m&&l.o&&wo(g,l.m,l.o),f=new on(l,l.j,f,l.B+1),l.m===null&&(f.H=l.o),h&&(l.i=h.D.concat(l.i)),h=ju(l,f,1e3),f.I=Math.round(.5*l.wa)+Math.round(.5*l.wa*Math.random()),_o(l.h,f),xo(f,g,h)}function xs(l,h){l.H&&G(l.H,function(f,g){Pe(h,g,f)}),l.l&&xu({},function(f,g){Pe(h,g,f)})}function ju(l,h,f){f=Math.min(l.i.length,f);var g=l.l?x(l.l.Na,l.l,l):null;e:{var R=l.i;let j=-1;for(;;){const z=["count="+f];j==-1?0<f?(j=R[0].g,z.push("ofs="+j)):j=0:z.push("ofs="+j);let Ne=!0;for(let Xe=0;Xe<f;Xe++){let ve=R[Xe].g;const rt=R[Xe].map;if(ve-=j,0>ve)j=Math.max(0,R[Xe].g-100),Ne=!1;else try{o0(rt,z,"req"+ve+"_")}catch{g&&g(rt)}}if(Ne){g=z.join("&");break e}}}return l=l.i.splice(0,f),h.D=l,g}function Vu(l){if(!l.g&&!l.u){l.Y=1;var h=l.Fa;ce||Ae(),Re||(ce(),Re=!0),Ee.add(h,l),l.v=0}}function To(l){return l.g||l.u||3<=l.v?!1:(l.Y++,l.u=ls(x(l.Fa,l),Lu(l,l.v)),l.v++,!0)}r.Fa=function(){if(this.u=null,Ou(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var l=2*this.R;this.j.info("BP detection timer enabled: "+l),this.A=ls(x(this.ab,this),l)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,ut(10),Pi(this),Ou(this))};function Eo(l){l.A!=null&&(c.clearTimeout(l.A),l.A=null)}function Ou(l){l.g=new on(l,l.j,"rpc",l.Y),l.m===null&&(l.g.H=l.o),l.g.O=0;var h=Ft(l.qa);Pe(h,"RID","rpc"),Pe(h,"SID",l.K),Pe(h,"AID",l.T),Pe(h,"CI",l.F?"0":"1"),!l.F&&l.ja&&Pe(h,"TO",l.ja),Pe(h,"TYPE","xmlhttp"),xs(l,h),l.m&&l.o&&wo(h,l.m,l.o),l.L&&(l.g.I=l.L);var f=l.g;l=l.ia,f.L=1,f.v=Ni(Ft(h)),f.m=null,f.P=!0,cu(f,l)}r.Za=function(){this.C!=null&&(this.C=null,Pi(this),To(this),ut(19))};function Vi(l){l.C!=null&&(c.clearTimeout(l.C),l.C=null)}function Mu(l,h){var f=null;if(l.g==h){Vi(l),Eo(l),l.g=null;var g=2}else if(vo(l.h,h))f=h.D,pu(l.h,h),g=1;else return;if(l.G!=0){if(h.o)if(g==1){f=h.m?h.m.length:0,h=Date.now()-h.F;var R=l.B;g=Ii(),oe(g,new iu(g,f)),ji(l)}else Vu(l);else if(R=h.s,R==3||R==0&&0<h.X||!(g==1&&d0(l,h)||g==2&&To(l)))switch(f&&0<f.length&&(h=l.h,h.i=h.i.concat(f)),R){case 1:Mn(l,5);break;case 4:Mn(l,10);break;case 3:Mn(l,6);break;default:Mn(l,2)}}}function Lu(l,h){let f=l.Ta+Math.floor(Math.random()*l.cb);return l.isActive()||(f*=2),f*h}function Mn(l,h){if(l.j.info("Error code "+h),h==2){var f=x(l.fb,l),g=l.Xa;const R=!g;g=new On(g||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||Ai(g,"https"),Ni(g),R?s0(g.toString(),f):i0(g.toString(),f)}else ut(2);l.G=0,l.l&&l.l.sa(h),Fu(l),Du(l)}r.fb=function(l){l?(this.j.info("Successfully pinged google.com"),ut(2)):(this.j.info("Failed to ping google.com"),ut(1))};function Fu(l){if(l.G=0,l.ka=[],l.l){const h=gu(l.h);(h.length!=0||l.i.length!=0)&&(N(l.ka,h),N(l.ka,l.i),l.h.i.length=0,k(l.i),l.i.length=0),l.l.ra()}}function Uu(l,h,f){var g=f instanceof On?Ft(f):new On(f);if(g.g!="")h&&(g.g=h+"."+g.g),Si(g,g.s);else{var R=c.location;g=R.protocol,h=h?h+"."+R.hostname:R.hostname,R=+R.port;var j=new On(null);g&&Ai(j,g),h&&(j.g=h),R&&Si(j,R),f&&(j.l=f),g=j}return f=l.D,h=l.ya,f&&h&&Pe(g,f,h),Pe(g,"VER",l.la),xs(l,g),g}function Bu(l,h,f){if(h&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=l.Ca&&!l.pa?new Fe(new Ri({eb:f})):new Fe(l.pa),h.Ha(l.J),h}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function zu(){}r=zu.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function Oi(){}Oi.prototype.g=function(l,h){return new vt(l,h)};function vt(l,h){J.call(this),this.g=new Cu(h),this.l=l,this.h=h&&h.messageUrlParams||null,l=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(l?l["X-WebChannel-Content-Type"]=h.messageContentType:l={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(l?l["X-WebChannel-Client-Profile"]=h.va:l={"X-WebChannel-Client-Profile":h.va}),this.g.S=l,(l=h&&h.Sb)&&!V(l)&&(this.g.m=l),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!V(h)&&(this.g.D=h,l=this.h,l!==null&&h in l&&(l=this.h,h in l&&delete l[h])),this.j=new pr(this)}w(vt,J),vt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},vt.prototype.close=function(){Io(this.g)},vt.prototype.o=function(l){var h=this.g;if(typeof l=="string"){var f={};f.__data__=l,l=f}else this.u&&(f={},f.__data__=uo(l),l=f);h.i.push(new Wg(h.Ya++,l)),h.G==3&&ji(h)},vt.prototype.N=function(){this.g.l=null,delete this.j,Io(this.g),delete this.g,vt.aa.N.call(this)};function $u(l){mo.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var h=l.__sm__;if(h){e:{for(const f in h){l=f;break e}l=void 0}(this.i=l)&&(l=this.i,h=h!==null&&l in h?h[l]:void 0),this.data=h}else this.data=l}w($u,mo);function Gu(){fo.call(this),this.status=1}w(Gu,fo);function pr(l){this.g=l}w(pr,zu),pr.prototype.ua=function(){oe(this.g,"a")},pr.prototype.ta=function(l){oe(this.g,new $u(l))},pr.prototype.sa=function(l){oe(this.g,new Gu)},pr.prototype.ra=function(){oe(this.g,"b")},Oi.prototype.createWebChannel=Oi.prototype.g,vt.prototype.send=vt.prototype.o,vt.prototype.open=vt.prototype.m,vt.prototype.close=vt.prototype.close,vf=function(){return new Oi},bf=function(){return Ii()},yf=jn,al={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ti.NO_ERROR=0,Ti.TIMEOUT=8,Ti.HTTP_ERROR=6,Yi=Ti,au.COMPLETE="complete",xf=au,tu.EventType=as,as.OPEN="a",as.CLOSE="b",as.ERROR="c",as.MESSAGE="d",J.prototype.listen=J.prototype.K,ks=tu,Fe.prototype.listenOnce=Fe.prototype.L,Fe.prototype.getLastError=Fe.prototype.Ka,Fe.prototype.getLastErrorCode=Fe.prototype.Ba,Fe.prototype.getStatus=Fe.prototype.Z,Fe.prototype.getResponseJson=Fe.prototype.Oa,Fe.prototype.getResponseText=Fe.prototype.oa,Fe.prototype.send=Fe.prototype.ea,Fe.prototype.setWithCredentials=Fe.prototype.Ha,gf=Fe}).apply(typeof Fi<"u"?Fi:typeof self<"u"?self:typeof window<"u"?window:{});const Nd="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class at{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}at.UNAUTHENTICATED=new at(null),at.GOOGLE_CREDENTIALS=new at("google-credentials-uid"),at.FIRST_PARTY=new at("first-party-uid"),at.MOCK_USER=new at("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Xr="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nr=new ql("@firebase/firestore");function Ir(){return nr.logLevel}function F(r,...e){if(nr.logLevel<=fe.DEBUG){const t=e.map(ic);nr.debug(`Firestore (${Xr}): ${r}`,...t)}}function Be(r,...e){if(nr.logLevel<=fe.ERROR){const t=e.map(ic);nr.error(`Firestore (${Xr}): ${r}`,...t)}}function Hs(r,...e){if(nr.logLevel<=fe.WARN){const t=e.map(ic);nr.warn(`Firestore (${Xr}): ${r}`,...t)}}function ic(r){if(typeof r=="string")return r;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(r)}catch{return r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W(r="Unexpected state"){const e=`FIRESTORE (${Xr}) INTERNAL ASSERTION FAILED: `+r;throw Be(e),new Error(e)}function ee(r,e){r||W()}function Q(r,e){return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class B extends tn{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jt{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o_{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class l_{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(at.UNAUTHENTICATED))}shutdown(){}}class c_{constructor(e){this.t=e,this.currentUser=at.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ee(this.o===void 0);let n=this.i;const s=u=>this.i!==n?(n=this.i,t(u)):Promise.resolve();let i=new Jt;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Jt,e.enqueueRetryable(()=>s(this.currentUser))};const a=()=>{const u=i;e.enqueueRetryable(async()=>{await u.promise,await s(this.currentUser)})},c=u=>{F("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(u=>c(u)),setTimeout(()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?c(u):(F("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Jt)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(F("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(ee(typeof n.accessToken=="string"),new o_(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ee(e===null||typeof e=="string"),new at(e)}}class u_{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=at.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class d_{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new u_(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(at.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class h_{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class m_{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){ee(this.o===void 0);const n=i=>{i.error!=null&&F("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.R;return this.R=i.token,F("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>n(i))};const s=i=>{F("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.A.getImmediate({optional:!0});i?s(i):F("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(ee(typeof t.token=="string"),this.R=t.token,new h_(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f_(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _f{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const s=f_(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<t&&(n+=e.charAt(s[i]%e.length))}return n}}function ue(r,e){return r<e?-1:r>e?1:0}function Or(r,e,t){return r.length===e.length&&r.every((n,s)=>t(n,e[s]))}function wf(r){return r+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _e{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new B(M.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new B(M.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new B(M.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new B(M.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return _e.fromMillis(Date.now())}static fromDate(e){return _e.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new _e(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ue(this.nanoseconds,e.nanoseconds):ue(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class re{constructor(e){this.timestamp=e}static fromTimestamp(e){return new re(e)}static min(){return new re(new _e(0,0))}static max(){return new re(new _e(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ws{constructor(e,t,n){t===void 0?t=0:t>e.length&&W(),n===void 0?n=e.length-t:n>e.length-t&&W(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return Ws.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ws?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let s=0;s<n;s++){const i=e.get(s),a=t.get(s);if(i<a)return-1;if(i>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Te extends Ws{construct(e,t,n){return new Te(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new B(M.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(s=>s.length>0))}return new Te(t)}static emptyPath(){return new Te([])}}const p_=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Le extends Ws{construct(e,t,n){return new Le(e,t,n)}static isValidIdentifier(e){return p_.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Le.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Le(["__name__"])}static fromServerFormat(e){const t=[];let n="",s=0;const i=()=>{if(n.length===0)throw new B(M.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let a=!1;for(;s<e.length;){const c=e[s];if(c==="\\"){if(s+1===e.length)throw new B(M.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new B(M.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=u,s+=2}else c==="`"?(a=!a,s++):c!=="."||a?(n+=c,s++):(i(),s++)}if(i(),a)throw new B(M.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Le(t)}static emptyPath(){return new Le([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K{constructor(e){this.path=e}static fromPath(e){return new K(Te.fromString(e))}static fromName(e){return new K(Te.fromString(e).popFirst(5))}static empty(){return new K(Te.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Te.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Te.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new K(new Te(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ga{constructor(e,t,n,s){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=s}}function ol(r){return r.fields.find(e=>e.kind===2)}function Bn(r){return r.fields.filter(e=>e.kind!==2)}ga.UNKNOWN_ID=-1;class Ji{constructor(e,t){this.fieldPath=e,this.kind=t}}class Qs{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Qs(0,It.min())}}function If(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,s=re.fromTimestamp(n===1e9?new _e(t+1,0):new _e(t,n));return new It(s,K.empty(),e)}function Tf(r){return new It(r.readTime,r.key,-1)}class It{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new It(re.min(),K.empty(),-1)}static max(){return new It(re.max(),K.empty(),-1)}}function ac(r,e){let t=r.readTime.compareTo(e.readTime);return t!==0?t:(t=K.comparator(r.documentKey,e.documentKey),t!==0?t:ue(r.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ef="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class kf{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Nn(r){if(r.code!==M.FAILED_PRECONDITION||r.message!==Ef)throw r;F("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&W(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new C((n,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(n,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(n,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof C?t:C.resolve(t)}catch(t){return C.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):C.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):C.reject(t)}static resolve(e){return new C((t,n)=>{t(e)})}static reject(e){return new C((t,n)=>{n(e)})}static waitFor(e){return new C((t,n)=>{let s=0,i=0,a=!1;e.forEach(c=>{++s,c.next(()=>{++i,a&&i===s&&t()},u=>n(u))}),a=!0,i===s&&t()})}static or(e){let t=C.resolve(!1);for(const n of e)t=t.next(s=>s?C.resolve(s):n());return t}static forEach(e,t){const n=[];return e.forEach((s,i)=>{n.push(t.call(this,s,i))}),this.waitFor(n)}static mapArray(e,t){return new C((n,s)=>{const i=e.length,a=new Array(i);let c=0;for(let u=0;u<i;u++){const d=u;t(e[d]).next(m=>{a[d]=m,++c,c===i&&n(a)},m=>s(m))}})}static doWhile(e,t){return new C((n,s)=>{const i=()=>{e()===!0?t().next(()=>{i()},s):n()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ua{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Jt,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Ps(e,t.error)):this.V.resolve()},this.transaction.onerror=n=>{const s=oc(n.target.error);this.V.reject(new Ps(e,s))}}static open(e,t,n,s){try{return new Ua(t,e.transaction(s,n))}catch(i){throw new Ps(t,i)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(F("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new x_(t)}}class wn{constructor(e,t,n){this.name=e,this.version=t,this.p=n,wn.S(Qe())===12.2&&Be("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return F("SimpleDb","Removing database:",e),$n(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!km())return!1;if(wn.v())return!0;const e=Qe(),t=wn.S(e),n=0<t&&t<10,s=Af(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}async M(e){return this.db||(F("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,n)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const a=i.target.result;t(a)},s.onblocked=()=>{n(new Ps(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const a=i.target.error;a.name==="VersionError"?n(new B(M.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?n(new B(M.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):n(new Ps(e,a))},s.onupgradeneeded=i=>{F("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const a=i.target.result;this.p.O(a,s.transaction,i.oldVersion,this.version).next(()=>{F("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=t=>this.N(t)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,s){const i=t==="readonly";let a=0;for(;;){++a;try{this.db=await this.M(e);const c=Ua.open(this.db,e,i?"readonly":"readwrite",n),u=s(c).next(d=>(c.g(),d)).catch(d=>(c.abort(d),C.reject(d))).toPromise();return u.catch(()=>{}),await c.m,u}catch(c){const u=c,d=u.name!=="FirebaseError"&&a<3;if(F("SimpleDb","Transaction failed with error:",u.message,"Retrying:",d),this.close(),!d)return Promise.reject(u)}}}close(){this.db&&this.db.close(),this.db=void 0}}function Af(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class g_{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return $n(this.B.delete())}}class Ps extends B{constructor(e,t){super(M.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Rn(r){return r.name==="IndexedDbTransactionError"}class x_{constructor(e){this.store=e}put(e,t){let n;return t!==void 0?(F("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(F("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),$n(n)}add(e){return F("SimpleDb","ADD",this.store.name,e,e),$n(this.store.add(e))}get(e){return $n(this.store.get(e)).next(t=>(t===void 0&&(t=null),F("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return F("SimpleDb","DELETE",this.store.name,e),$n(this.store.delete(e))}count(){return F("SimpleDb","COUNT",this.store.name),$n(this.store.count())}U(e,t){const n=this.options(e,t),s=n.index?this.store.index(n.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(n.range);return new C((a,c)=>{i.onerror=u=>{c(u.target.error)},i.onsuccess=u=>{a(u.target.result)}})}{const i=this.cursor(n),a=[];return this.W(i,(c,u)=>{a.push(u)}).next(()=>a)}}G(e,t){const n=this.store.getAll(e,t===null?void 0:t);return new C((s,i)=>{n.onerror=a=>{i(a.target.error)},n.onsuccess=a=>{s(a.target.result)}})}j(e,t){F("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.H=!1;const s=this.cursor(n);return this.W(s,(i,a,c)=>c.delete())}J(e,t){let n;t?n=e:(n={},t=e);const s=this.cursor(n);return this.W(s,t)}Y(e){const t=this.cursor({});return new C((n,s)=>{t.onerror=i=>{const a=oc(i.target.error);s(a)},t.onsuccess=i=>{const a=i.target.result;a?e(a.primaryKey,a.value).next(c=>{c?a.continue():n()}):n()}})}W(e,t){const n=[];return new C((s,i)=>{e.onerror=a=>{i(a.target.error)},e.onsuccess=a=>{const c=a.target.result;if(!c)return void s();const u=new g_(c),d=t(c.primaryKey,c.value,u);if(d instanceof C){const m=d.catch(p=>(u.done(),C.reject(p)));n.push(m)}u.isDone?s():u.K===null?c.continue():c.continue(u.K)}}).next(()=>C.waitFor(n))}options(e,t){let n;return e!==void 0&&(typeof e=="string"?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function $n(r){return new C((e,t)=>{r.onsuccess=n=>{const s=n.target.result;e(s)},r.onerror=n=>{const s=oc(n.target.error);t(s)}})}let Rd=!1;function oc(r){const e=wn.S(Qe());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(t)>=0){const n=new B("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Rd||(Rd=!0,setTimeout(()=>{throw n},0)),n}}return r}class y_{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){F("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{F("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(t){Rn(t)?F("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):await Nn(t)}await this.X(6e4)})}}class b_{constructor(e,t){this.localStore=e,this.persistence=t}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.te(t,e))}te(e,t){const n=new Set;let s=t,i=!0;return C.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(a=>{if(a!==null&&!n.has(a))return F("IndexBackfiller",`Processing collection: ${a}`),this.ne(e,a,s).next(c=>{s-=c,n.add(a)});i=!1})).next(()=>t-s)}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,n).next(i=>{const a=i.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next(()=>this.re(s,i)).next(c=>(F("IndexBackfiller",`Updating offset: ${c}`),this.localStore.indexManager.updateCollectionGroup(e,t,c))).next(()=>a.size)}))}re(e,t){let n=e;return t.changes.forEach((s,i)=>{const a=Tf(i);ac(a,n)>0&&(n=a)}),new It(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ft{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=n=>this.ie(n),this.se=n=>t.writeSequenceNumber(n))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}ft.oe=-1;function Ba(r){return r==null}function Ys(r){return r===0&&1/r==-1/0}function Sf(r){return typeof r=="number"&&Number.isInteger(r)&&!Ys(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dt(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=Cd(e)),e=v_(r.get(t),e);return Cd(e)}function v_(r,e){let t=e;const n=r.length;for(let s=0;s<n;s++){const i=r.charAt(s);switch(i){case"\0":t+="";break;case"":t+="";break;default:t+=i}}return t}function Cd(r){return r+""}function Pt(r){const e=r.length;if(ee(e>=2),e===2)return ee(r.charAt(0)===""&&r.charAt(1)===""),Te.emptyPath();const t=e-2,n=[];let s="";for(let i=0;i<e;){const a=r.indexOf("",i);switch((a<0||a>t)&&W(),r.charAt(a+1)){case"":const c=r.substring(i,a);let u;s.length===0?u=c:(s+=c,u=s,s=""),n.push(u);break;case"":s+=r.substring(i,a),s+="\0";break;case"":s+=r.substring(i,a+1);break;default:W()}i=a+2}return new Te(n)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dd=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xi(r,e){return[r,dt(e)]}function Nf(r,e,t){return[r,dt(e),t]}const __={},w_=["prefixPath","collectionGroup","readTime","documentId"],I_=["prefixPath","collectionGroup","documentId"],T_=["collectionGroup","readTime","prefixPath","documentId"],E_=["canonicalId","targetId"],k_=["targetId","path"],A_=["path","targetId"],S_=["collectionId","parent"],N_=["indexId","uid"],R_=["uid","sequenceNumber"],C_=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],D_=["indexId","uid","orderedDocumentKey"],P_=["userId","collectionPath","documentId"],j_=["userId","collectionPath","largestBatchId"],V_=["userId","collectionGroup","largestBatchId"],Rf=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],O_=[...Rf,"documentOverlays"],Cf=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Df=Cf,lc=[...Df,"indexConfiguration","indexState","indexEntries"],M_=lc,L_=[...lc,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ll extends kf{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function Ye(r,e){const t=Q(r);return wn.F(t._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pd(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function ur(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function Pf(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ce{constructor(e,t){this.comparator=e,this.root=t||Ze.EMPTY}insert(e,t){return new Ce(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ze.BLACK,null,null))}remove(e){return new Ce(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ze.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(e,n.key);if(s===0)return t+n.left.size;s<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ui(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ui(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ui(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ui(this.root,e,this.comparator,!0)}}class Ui{constructor(e,t,n,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ze{constructor(e,t,n,s,i){this.key=e,this.value=t,this.color=n??Ze.RED,this.left=s??Ze.EMPTY,this.right=i??Ze.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,s,i){return new Ze(e??this.key,t??this.value,n??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let s=this;const i=n(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,n),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Ze.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Ze.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ze.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ze.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw W();const e=this.left.check();if(e!==this.right.check())throw W();return e+(this.isRed()?0:1)}}Ze.EMPTY=null,Ze.RED=!0,Ze.BLACK=!1;Ze.EMPTY=new class{constructor(){this.size=0}get key(){throw W()}get value(){throw W()}get color(){throw W()}get left(){throw W()}get right(){throw W()}copy(e,t,n,s,i){return this}insert(e,t,n){return new Ze(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Se{constructor(e){this.comparator=e,this.data=new Ce(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new jd(this.data.getIterator())}getIteratorFrom(e){return new jd(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof Se)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=n.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Se(this.comparator);return t.data=e,t}}class jd{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function yr(r){return r.hasNext()?r.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pt{constructor(e){this.fields=e,e.sort(Le.comparator)}static empty(){return new pt([])}unionWith(e){let t=new Se(Le.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new pt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Or(this.fields,e.fields,(t,n)=>t.isEqual(n))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jf extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ze{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new jf("Invalid base64 string: "+i):i}}(e);return new ze(t)}static fromUint8Array(e){const t=function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i}(e);return new ze(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let s=0;s<t.length;s++)n[s]=t.charCodeAt(s);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ue(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ze.EMPTY_BYTE_STRING=new ze("");const F_=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function en(r){if(ee(!!r),typeof r=="string"){let e=0;const t=F_.exec(r);if(ee(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:Oe(r.seconds),nanos:Oe(r.nanos)}}function Oe(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function En(r){return typeof r=="string"?ze.fromBase64String(r):ze.fromUint8Array(r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cc(r){var e,t;return((t=(((e=r==null?void 0:r.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function uc(r){const e=r.mapValue.fields.__previous_value__;return cc(e)?uc(e):e}function Js(r){const e=en(r.mapValue.fields.__local_write_time__.timestampValue);return new _e(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U_{constructor(e,t,n,s,i,a,c,u,d){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=c,this.longPollingOptions=u,this.useFetchStreams=d}}class rr{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new rr("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof rr&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Zi={nullValue:"NULL_VALUE"};function sr(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?cc(r)?4:Vf(r)?9007199254740991:za(r)?10:11:W()}function Ot(r,e){if(r===e)return!0;const t=sr(r);if(t!==sr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return Js(r).isEqual(Js(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const a=en(s.timestampValue),c=en(i.timestampValue);return a.seconds===c.seconds&&a.nanos===c.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return function(s,i){return En(s.bytesValue).isEqual(En(i.bytesValue))}(r,e);case 7:return r.referenceValue===e.referenceValue;case 8:return function(s,i){return Oe(s.geoPointValue.latitude)===Oe(i.geoPointValue.latitude)&&Oe(s.geoPointValue.longitude)===Oe(i.geoPointValue.longitude)}(r,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return Oe(s.integerValue)===Oe(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const a=Oe(s.doubleValue),c=Oe(i.doubleValue);return a===c?Ys(a)===Ys(c):isNaN(a)&&isNaN(c)}return!1}(r,e);case 9:return Or(r.arrayValue.values||[],e.arrayValue.values||[],Ot);case 10:case 11:return function(s,i){const a=s.mapValue.fields||{},c=i.mapValue.fields||{};if(Pd(a)!==Pd(c))return!1;for(const u in a)if(a.hasOwnProperty(u)&&(c[u]===void 0||!Ot(a[u],c[u])))return!1;return!0}(r,e);default:return W()}}function Xs(r,e){return(r.values||[]).find(t=>Ot(t,e))!==void 0}function kn(r,e){if(r===e)return 0;const t=sr(r),n=sr(e);if(t!==n)return ue(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return ue(r.booleanValue,e.booleanValue);case 2:return function(i,a){const c=Oe(i.integerValue||i.doubleValue),u=Oe(a.integerValue||a.doubleValue);return c<u?-1:c>u?1:c===u?0:isNaN(c)?isNaN(u)?0:-1:1}(r,e);case 3:return Vd(r.timestampValue,e.timestampValue);case 4:return Vd(Js(r),Js(e));case 5:return ue(r.stringValue,e.stringValue);case 6:return function(i,a){const c=En(i),u=En(a);return c.compareTo(u)}(r.bytesValue,e.bytesValue);case 7:return function(i,a){const c=i.split("/"),u=a.split("/");for(let d=0;d<c.length&&d<u.length;d++){const m=ue(c[d],u[d]);if(m!==0)return m}return ue(c.length,u.length)}(r.referenceValue,e.referenceValue);case 8:return function(i,a){const c=ue(Oe(i.latitude),Oe(a.latitude));return c!==0?c:ue(Oe(i.longitude),Oe(a.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return Od(r.arrayValue,e.arrayValue);case 10:return function(i,a){var c,u,d,m;const p=i.fields||{},x=a.fields||{},b=(c=p.value)===null||c===void 0?void 0:c.arrayValue,w=(u=x.value)===null||u===void 0?void 0:u.arrayValue,k=ue(((d=b==null?void 0:b.values)===null||d===void 0?void 0:d.length)||0,((m=w==null?void 0:w.values)===null||m===void 0?void 0:m.length)||0);return k!==0?k:Od(b,w)}(r.mapValue,e.mapValue);case 11:return function(i,a){if(i===yn.mapValue&&a===yn.mapValue)return 0;if(i===yn.mapValue)return 1;if(a===yn.mapValue)return-1;const c=i.fields||{},u=Object.keys(c),d=a.fields||{},m=Object.keys(d);u.sort(),m.sort();for(let p=0;p<u.length&&p<m.length;++p){const x=ue(u[p],m[p]);if(x!==0)return x;const b=kn(c[u[p]],d[m[p]]);if(b!==0)return b}return ue(u.length,m.length)}(r.mapValue,e.mapValue);default:throw W()}}function Vd(r,e){if(typeof r=="string"&&typeof e=="string"&&r.length===e.length)return ue(r,e);const t=en(r),n=en(e),s=ue(t.seconds,n.seconds);return s!==0?s:ue(t.nanos,n.nanos)}function Od(r,e){const t=r.values||[],n=e.values||[];for(let s=0;s<t.length&&s<n.length;++s){const i=kn(t[s],n[s]);if(i)return i}return ue(t.length,n.length)}function Mr(r){return cl(r)}function cl(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=en(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(t){return En(t).toBase64()}(r.bytesValue):"referenceValue"in r?function(t){return K.fromName(t).toString()}(r.referenceValue):"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",s=!0;for(const i of t.values||[])s?s=!1:n+=",",n+=cl(i);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const a of n)i?i=!1:s+=",",s+=`${a}:${cl(t.fields[a])}`;return s+"}"}(r.mapValue):W()}function Zs(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function ul(r){return!!r&&"integerValue"in r}function ei(r){return!!r&&"arrayValue"in r}function Md(r){return!!r&&"nullValue"in r}function Ld(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function ea(r){return!!r&&"mapValue"in r}function za(r){var e,t;return((t=(((e=r==null?void 0:r.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="__vector__"}function js(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return ur(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=js(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=js(r.arrayValue.values[t]);return e}return Object.assign({},r)}function Vf(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const Of={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function B_(r){return"nullValue"in r?Zi:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?Zs(rr.empty(),K.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?za(r)?Of:{mapValue:{}}:W()}function z_(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?Zs(rr.empty(),K.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?Of:"mapValue"in r?za(r)?{mapValue:{}}:yn:W()}function Fd(r,e){const t=kn(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?-1:!r.inclusive&&e.inclusive?1:0}function Ud(r,e){const t=kn(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?1:!r.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ot{constructor(e){this.value=e}static empty(){return new ot({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!ea(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=js(t)}setAll(e){let t=Le.emptyPath(),n={},s=[];e.forEach((a,c)=>{if(!t.isImmediateParentOf(c)){const u=this.getFieldsMap(t);this.applyChanges(u,n,s),n={},s=[],t=c.popLast()}a?n[c.lastSegment()]=js(a):s.push(c.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,n,s)}delete(e){const t=this.field(e.popLast());ea(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ot(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let s=t.mapValue.fields[e.get(n)];ea(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,n){ur(t,(s,i)=>e[s]=i);for(const s of n)delete e[s]}clone(){return new ot(js(this.value))}}function Mf(r){const e=[];return ur(r.fields,(t,n)=>{const s=new Le([t]);if(ea(n)){const i=Mf(n.mapValue).fields;if(i.length===0)e.push(s);else for(const a of i)e.push(s.child(a))}else e.push(s)}),new pt(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ue{constructor(e,t,n,s,i,a,c){this.key=e,this.documentType=t,this.version=n,this.readTime=s,this.createTime=i,this.data=a,this.documentState=c}static newInvalidDocument(e){return new Ue(e,0,re.min(),re.min(),re.min(),ot.empty(),0)}static newFoundDocument(e,t,n,s){return new Ue(e,1,t,re.min(),n,s,0)}static newNoDocument(e,t){return new Ue(e,2,t,re.min(),re.min(),ot.empty(),0)}static newUnknownDocument(e,t){return new Ue(e,3,t,re.min(),re.min(),ot.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(re.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ot.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ot.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=re.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ue&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ue(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lr{constructor(e,t){this.position=e,this.inclusive=t}}function Bd(r,e,t){let n=0;for(let s=0;s<r.position.length;s++){const i=e[s],a=r.position[s];if(i.field.isKeyField()?n=K.comparator(K.fromName(a.referenceValue),t.key):n=kn(a,t.data.field(i.field)),i.dir==="desc"&&(n*=-1),n!==0)break}return n}function zd(r,e){if(r===null)return e===null;if(e===null||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!Ot(r.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ti{constructor(e,t="asc"){this.field=e,this.dir=t}}function $_(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lf{}class pe extends Lf{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new G_(e,t,n):t==="array-contains"?new H_(e,n):t==="in"?new Gf(e,n):t==="not-in"?new W_(e,n):t==="array-contains-any"?new Q_(e,n):new pe(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new q_(e,n):new K_(e,n)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(kn(t,this.value)):t!==null&&sr(this.value)===sr(t)&&this.matchesComparison(kn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return W()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ke extends Lf{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new ke(e,t)}matches(e){return Fr(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Fr(r){return r.op==="and"}function dl(r){return r.op==="or"}function dc(r){return Ff(r)&&Fr(r)}function Ff(r){for(const e of r.filters)if(e instanceof ke)return!1;return!0}function hl(r){if(r instanceof pe)return r.field.canonicalString()+r.op.toString()+Mr(r.value);if(dc(r))return r.filters.map(e=>hl(e)).join(",");{const e=r.filters.map(t=>hl(t)).join(",");return`${r.op}(${e})`}}function Uf(r,e){return r instanceof pe?function(n,s){return s instanceof pe&&n.op===s.op&&n.field.isEqual(s.field)&&Ot(n.value,s.value)}(r,e):r instanceof ke?function(n,s){return s instanceof ke&&n.op===s.op&&n.filters.length===s.filters.length?n.filters.reduce((i,a,c)=>i&&Uf(a,s.filters[c]),!0):!1}(r,e):void W()}function Bf(r,e){const t=r.filters.concat(e);return ke.create(t,r.op)}function zf(r){return r instanceof pe?function(t){return`${t.field.canonicalString()} ${t.op} ${Mr(t.value)}`}(r):r instanceof ke?function(t){return t.op.toString()+" {"+t.getFilters().map(zf).join(" ,")+"}"}(r):"Filter"}class G_ extends pe{constructor(e,t,n){super(e,t,n),this.key=K.fromName(n.referenceValue)}matches(e){const t=K.comparator(e.key,this.key);return this.matchesComparison(t)}}class q_ extends pe{constructor(e,t){super(e,"in",t),this.keys=$f("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class K_ extends pe{constructor(e,t){super(e,"not-in",t),this.keys=$f("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function $f(r,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>K.fromName(n.referenceValue))}class H_ extends pe{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return ei(t)&&Xs(t.arrayValue,this.value)}}class Gf extends pe{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Xs(this.value.arrayValue,t)}}class W_ extends pe{constructor(e,t){super(e,"not-in",t)}matches(e){if(Xs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!Xs(this.value.arrayValue,t)}}class Q_ extends pe{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ei(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>Xs(this.value.arrayValue,n))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y_{constructor(e,t=null,n=[],s=[],i=null,a=null,c=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=a,this.endAt=c,this.ue=null}}function ml(r,e=null,t=[],n=[],s=null,i=null,a=null){return new Y_(r,e,t,n,s,i,a)}function ir(r){const e=Q(r);if(e.ue===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>hl(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(i){return i.field.canonicalString()+i.dir}(n)).join(","),Ba(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>Mr(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>Mr(n)).join(",")),e.ue=t}return e.ue}function pi(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!$_(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!Uf(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!zd(r.startAt,e.startAt)&&zd(r.endAt,e.endAt)}function xa(r){return K.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function ya(r,e){return r.filters.filter(t=>t instanceof pe&&t.field.isEqual(e))}function $d(r,e,t){let n=Zi,s=!0;for(const i of ya(r,e)){let a=Zi,c=!0;switch(i.op){case"<":case"<=":a=B_(i.value);break;case"==":case"in":case">=":a=i.value;break;case">":a=i.value,c=!1;break;case"!=":case"not-in":a=Zi}Fd({value:n,inclusive:s},{value:a,inclusive:c})<0&&(n=a,s=c)}if(t!==null){for(let i=0;i<r.orderBy.length;++i)if(r.orderBy[i].field.isEqual(e)){const a=t.position[i];Fd({value:n,inclusive:s},{value:a,inclusive:t.inclusive})<0&&(n=a,s=t.inclusive);break}}return{value:n,inclusive:s}}function Gd(r,e,t){let n=yn,s=!0;for(const i of ya(r,e)){let a=yn,c=!0;switch(i.op){case">=":case">":a=z_(i.value),c=!1;break;case"==":case"in":case"<=":a=i.value;break;case"<":a=i.value,c=!1;break;case"!=":case"not-in":a=yn}Ud({value:n,inclusive:s},{value:a,inclusive:c})>0&&(n=a,s=c)}if(t!==null){for(let i=0;i<r.orderBy.length;++i)if(r.orderBy[i].field.isEqual(e)){const a=t.position[i];Ud({value:n,inclusive:s},{value:a,inclusive:t.inclusive})>0&&(n=a,s=t.inclusive);break}}return{value:n,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zr{constructor(e,t=null,n=[],s=[],i=null,a="F",c=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=s,this.limit=i,this.limitType=a,this.startAt=c,this.endAt=u,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function qf(r,e,t,n,s,i,a,c){return new Zr(r,e,t,n,s,i,a,c)}function $a(r){return new Zr(r)}function qd(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function Kf(r){return r.collectionGroup!==null}function Vs(r){const e=Q(r);if(e.ce===null){e.ce=[];const t=new Set;for(const i of e.explicitOrderBy)e.ce.push(i),t.add(i.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let c=new Se(Le.comparator);return a.filters.forEach(u=>{u.getFlattenedFilters().forEach(d=>{d.isInequality()&&(c=c.add(d.field))})}),c})(e).forEach(i=>{t.has(i.canonicalString())||i.isKeyField()||e.ce.push(new ti(i,n))}),t.has(Le.keyField().canonicalString())||e.ce.push(new ti(Le.keyField(),n))}return e.ce}function wt(r){const e=Q(r);return e.le||(e.le=J_(e,Vs(r))),e.le}function J_(r,e){if(r.limitType==="F")return ml(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new ti(s.field,i)});const t=r.endAt?new Lr(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new Lr(r.startAt.position,r.startAt.inclusive):null;return ml(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}function fl(r,e){const t=r.filters.concat([e]);return new Zr(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function pl(r,e,t){return new Zr(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function Ga(r,e){return pi(wt(r),wt(e))&&r.limitType===e.limitType}function Hf(r){return`${ir(wt(r))}|lt:${r.limitType}`}function Tr(r){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(s=>zf(s)).join(", ")}]`),Ba(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(s=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(s)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(s=>Mr(s)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(s=>Mr(s)).join(",")),`Target(${n})`}(wt(r))}; limitType=${r.limitType})`}function gi(r,e){return e.isFoundDocument()&&function(n,s){const i=s.key.path;return n.collectionGroup!==null?s.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):K.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)}(r,e)&&function(n,s){for(const i of Vs(n))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(r,e)&&function(n,s){for(const i of n.filters)if(!i.matches(s))return!1;return!0}(r,e)&&function(n,s){return!(n.startAt&&!function(a,c,u){const d=Bd(a,c,u);return a.inclusive?d<=0:d<0}(n.startAt,Vs(n),s)||n.endAt&&!function(a,c,u){const d=Bd(a,c,u);return a.inclusive?d>=0:d>0}(n.endAt,Vs(n),s))}(r,e)}function Wf(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Qf(r){return(e,t)=>{let n=!1;for(const s of Vs(r)){const i=X_(s,e,t);if(i!==0)return i;n=n||s.field.isKeyField()}return 0}}function X_(r,e,t){const n=r.field.isKeyField()?K.comparator(e.key,t.key):function(i,a,c){const u=a.data.field(i),d=c.data.field(i);return u!==null&&d!==null?kn(u,d):W()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return W()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(const[s,i]of n)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const n=this.mapKeyFn(e),s=this.inner[n];if(s===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],e))return n.length===1?delete this.inner[t]:n.splice(s,1),this.innerSize--,!0;return!1}forEach(e){ur(this.inner,(t,n)=>{for(const[s,i]of n)e(s,i)})}isEmpty(){return Pf(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z_=new Ce(K.comparator);function _t(){return Z_}const Yf=new Ce(K.comparator);function As(...r){let e=Yf;for(const t of r)e=e.insert(t.key,t);return e}function Jf(r){let e=Yf;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function jt(){return Os()}function Xf(){return Os()}function Os(){return new Cn(r=>r.toString(),(r,e)=>r.isEqual(e))}const ew=new Ce(K.comparator),tw=new Se(K.comparator);function me(...r){let e=tw;for(const t of r)e=e.add(t);return e}const nw=new Se(ue);function hc(){return nw}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mc(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ys(e)?"-0":e}}function Zf(r){return{integerValue:""+r}}function rw(r,e){return Sf(e)?Zf(e):mc(r,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qa{constructor(){this._=void 0}}function sw(r,e,t){return r instanceof ni?function(s,i){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&cc(i)&&(i=uc(i)),i&&(a.fields.__previous_value__=i),{mapValue:a}}(t,e):r instanceof Ur?tp(r,e):r instanceof Br?np(r,e):function(s,i){const a=ep(s,i),c=Kd(a)+Kd(s.Pe);return ul(a)&&ul(s.Pe)?Zf(c):mc(s.serializer,c)}(r,e)}function iw(r,e,t){return r instanceof Ur?tp(r,e):r instanceof Br?np(r,e):t}function ep(r,e){return r instanceof ri?function(n){return ul(n)||function(i){return!!i&&"doubleValue"in i}(n)}(e)?e:{integerValue:0}:null}class ni extends qa{}class Ur extends qa{constructor(e){super(),this.elements=e}}function tp(r,e){const t=rp(e);for(const n of r.elements)t.some(s=>Ot(s,n))||t.push(n);return{arrayValue:{values:t}}}class Br extends qa{constructor(e){super(),this.elements=e}}function np(r,e){let t=rp(e);for(const n of r.elements)t=t.filter(s=>!Ot(s,n));return{arrayValue:{values:t}}}class ri extends qa{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Kd(r){return Oe(r.integerValue||r.doubleValue)}function rp(r){return ei(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aw{constructor(e,t){this.field=e,this.transform=t}}function ow(r,e){return r.field.isEqual(e.field)&&function(n,s){return n instanceof Ur&&s instanceof Ur||n instanceof Br&&s instanceof Br?Or(n.elements,s.elements,Ot):n instanceof ri&&s instanceof ri?Ot(n.Pe,s.Pe):n instanceof ni&&s instanceof ni}(r.transform,e.transform)}class lw{constructor(e,t){this.version=e,this.transformResults=t}}class lt{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new lt}static exists(e){return new lt(void 0,e)}static updateTime(e){return new lt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ta(r,e){return r.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(r.updateTime):r.exists===void 0||r.exists===e.isFoundDocument()}class Ka{}function sp(r,e){if(!r.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return r.isNoDocument()?new Ha(r.key,lt.none()):new es(r.key,r.data,lt.none());{const t=r.data,n=ot.empty();let s=new Se(Le.comparator);for(let i of e.fields)if(!s.has(i)){let a=t.field(i);a===null&&i.length>1&&(i=i.popLast(),a=t.field(i)),a===null?n.delete(i):n.set(i,a),s=s.add(i)}return new an(r.key,n,new pt(s.toArray()),lt.none())}}function cw(r,e,t){r instanceof es?function(s,i,a){const c=s.value.clone(),u=Wd(s.fieldTransforms,i,a.transformResults);c.setAll(u),i.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(r,e,t):r instanceof an?function(s,i,a){if(!ta(s.precondition,i))return void i.convertToUnknownDocument(a.version);const c=Wd(s.fieldTransforms,i,a.transformResults),u=i.data;u.setAll(ip(s)),u.setAll(c),i.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,e,t):function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function Ms(r,e,t,n){return r instanceof es?function(i,a,c,u){if(!ta(i.precondition,a))return c;const d=i.value.clone(),m=Qd(i.fieldTransforms,u,a);return d.setAll(m),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(r,e,t,n):r instanceof an?function(i,a,c,u){if(!ta(i.precondition,a))return c;const d=Qd(i.fieldTransforms,u,a),m=a.data;return m.setAll(ip(i)),m.setAll(d),a.convertToFoundDocument(a.version,m).setHasLocalMutations(),c===null?null:c.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(p=>p.field))}(r,e,t,n):function(i,a,c){return ta(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):c}(r,e,t)}function uw(r,e){let t=null;for(const n of r.fieldTransforms){const s=e.data.field(n.field),i=ep(n.transform,s||null);i!=null&&(t===null&&(t=ot.empty()),t.set(n.field,i))}return t||null}function Hd(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&!!function(n,s){return n===void 0&&s===void 0||!(!n||!s)&&Or(n,s,(i,a)=>ow(i,a))}(r.fieldTransforms,e.fieldTransforms)&&(r.type===0?r.value.isEqual(e.value):r.type!==1||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask))}class es extends Ka{constructor(e,t,n,s=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class an extends Ka{constructor(e,t,n,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function ip(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function Wd(r,e,t){const n=new Map;ee(r.length===t.length);for(let s=0;s<t.length;s++){const i=r[s],a=i.transform,c=e.data.field(i.field);n.set(i.field,iw(a,c,t[s]))}return n}function Qd(r,e,t){const n=new Map;for(const s of r){const i=s.transform,a=t.data.field(s.field);n.set(s.field,sw(i,a,e))}return n}class Ha extends Ka{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ap extends Ka{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fc{constructor(e,t,n,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&cw(i,e,n[s])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Ms(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Ms(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Xf();return this.mutations.forEach(s=>{const i=e.get(s.key),a=i.overlayedDocument;let c=this.applyToLocalView(a,i.mutatedFields);c=t.has(s.key)?null:c;const u=sp(a,c);u!==null&&n.set(s.key,u),a.isValidDocument()||a.convertToNoDocument(re.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),me())}isEqual(e){return this.batchId===e.batchId&&Or(this.mutations,e.mutations,(t,n)=>Hd(t,n))&&Or(this.baseMutations,e.baseMutations,(t,n)=>Hd(t,n))}}class pc{constructor(e,t,n,s){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=s}static from(e,t,n){ee(e.mutations.length===n.length);let s=function(){return ew}();const i=e.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,n[a].version);return new pc(e,t,n,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gc{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dw{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ge,ge;function hw(r){switch(r){default:return W();case M.CANCELLED:case M.UNKNOWN:case M.DEADLINE_EXCEEDED:case M.RESOURCE_EXHAUSTED:case M.INTERNAL:case M.UNAVAILABLE:case M.UNAUTHENTICATED:return!1;case M.INVALID_ARGUMENT:case M.NOT_FOUND:case M.ALREADY_EXISTS:case M.PERMISSION_DENIED:case M.FAILED_PRECONDITION:case M.ABORTED:case M.OUT_OF_RANGE:case M.UNIMPLEMENTED:case M.DATA_LOSS:return!0}}function op(r){if(r===void 0)return Be("GRPC error has no .code"),M.UNKNOWN;switch(r){case Ge.OK:return M.OK;case Ge.CANCELLED:return M.CANCELLED;case Ge.UNKNOWN:return M.UNKNOWN;case Ge.DEADLINE_EXCEEDED:return M.DEADLINE_EXCEEDED;case Ge.RESOURCE_EXHAUSTED:return M.RESOURCE_EXHAUSTED;case Ge.INTERNAL:return M.INTERNAL;case Ge.UNAVAILABLE:return M.UNAVAILABLE;case Ge.UNAUTHENTICATED:return M.UNAUTHENTICATED;case Ge.INVALID_ARGUMENT:return M.INVALID_ARGUMENT;case Ge.NOT_FOUND:return M.NOT_FOUND;case Ge.ALREADY_EXISTS:return M.ALREADY_EXISTS;case Ge.PERMISSION_DENIED:return M.PERMISSION_DENIED;case Ge.FAILED_PRECONDITION:return M.FAILED_PRECONDITION;case Ge.ABORTED:return M.ABORTED;case Ge.OUT_OF_RANGE:return M.OUT_OF_RANGE;case Ge.UNIMPLEMENTED:return M.UNIMPLEMENTED;case Ge.DATA_LOSS:return M.DATA_LOSS;default:return W()}}(ge=Ge||(Ge={}))[ge.OK=0]="OK",ge[ge.CANCELLED=1]="CANCELLED",ge[ge.UNKNOWN=2]="UNKNOWN",ge[ge.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ge[ge.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ge[ge.NOT_FOUND=5]="NOT_FOUND",ge[ge.ALREADY_EXISTS=6]="ALREADY_EXISTS",ge[ge.PERMISSION_DENIED=7]="PERMISSION_DENIED",ge[ge.UNAUTHENTICATED=16]="UNAUTHENTICATED",ge[ge.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ge[ge.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ge[ge.ABORTED=10]="ABORTED",ge[ge.OUT_OF_RANGE=11]="OUT_OF_RANGE",ge[ge.UNIMPLEMENTED=12]="UNIMPLEMENTED",ge[ge.INTERNAL=13]="INTERNAL",ge[ge.UNAVAILABLE=14]="UNAVAILABLE",ge[ge.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mw(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fw=new Yn([4294967295,4294967295],0);function Yd(r){const e=mw().encode(r),t=new pf;return t.update(e),new Uint8Array(t.digest())}function Jd(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Yn([t,n],0),new Yn([s,i],0)]}class xc{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Ss(`Invalid padding: ${t}`);if(n<0)throw new Ss(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new Ss(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new Ss(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Yn.fromNumber(this.Ie)}Ee(e,t,n){let s=e.add(t.multiply(Yn.fromNumber(n)));return s.compare(fw)===1&&(s=new Yn([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const t=Yd(e),[n,s]=Jd(t);for(let i=0;i<this.hashCount;i++){const a=this.Ee(n,s,i);if(!this.de(a))return!1}return!0}static create(e,t,n){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new xc(i,s,t);return n.forEach(c=>a.insert(c)),a}insert(e){if(this.Ie===0)return;const t=Yd(e),[n,s]=Jd(t);for(let i=0;i<this.hashCount;i++){const a=this.Ee(n,s,i);this.Ae(a)}}Ae(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class Ss extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xi{constructor(e,t,n,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const s=new Map;return s.set(e,yi.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new xi(re.min(),s,new Ce(ue),_t(),me())}}class yi{constructor(e,t,n,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new yi(n,t,me(),me(),me())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class na{constructor(e,t,n,s){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=s}}class lp{constructor(e,t){this.targetId=e,this.me=t}}class cp{constructor(e,t,n=ze.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=s}}class Xd{constructor(){this.fe=0,this.ge=eh(),this.pe=ze.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=me(),t=me(),n=me();return this.ge.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:n=n.add(s);break;default:W()}}),new yi(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=eh()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,ee(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class pw{constructor(e){this.Le=e,this.Be=new Map,this.ke=_t(),this.qe=Zd(),this.Qe=new Ce(ue)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:W()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,s)=>{this.ze(s)&&t(s)})}He(e){const t=e.targetId,n=e.me.count,s=this.Je(t);if(s){const i=s.target;if(xa(i))if(n===0){const a=new K(i.path);this.Ue(t,a,Ue.newNoDocument(a,re.min()))}else ee(n===1);else{const a=this.Ye(t);if(a!==n){const c=this.Ze(e),u=c?this.Xe(c,e,a):1;if(u!==0){this.je(t);const d=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(t,d)}}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:s=0},hashCount:i=0}=t;let a,c;try{a=En(n).toUint8Array()}catch(u){if(u instanceof jf)return Hs("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{c=new xc(a,s,i)}catch(u){return Hs(u instanceof Ss?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return c.Ie===0?null:c}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let s=0;return n.forEach(i=>{const a=this.Le.tt(),c=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;e.mightContain(c)||(this.Ue(t,i,null),s++)}),s}rt(e){const t=new Map;this.Be.forEach((i,a)=>{const c=this.Je(a);if(c){if(i.current&&xa(c.target)){const u=new K(c.target.path);this.ke.get(u)!==null||this.it(a,u)||this.Ue(a,u,Ue.newNoDocument(u,e))}i.be&&(t.set(a,i.ve()),i.Ce())}});let n=me();this.qe.forEach((i,a)=>{let c=!0;a.forEachWhile(u=>{const d=this.Je(u);return!d||d.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(n=n.add(i))}),this.ke.forEach((i,a)=>a.setReadTime(e));const s=new xi(e,t,this.Qe,this.ke,n);return this.ke=_t(),this.qe=Zd(),this.Qe=new Ce(ue),s}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,t)?s.Fe(t,1):s.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new Xd,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new Se(ue),this.qe=this.qe.insert(e,t)),t}ze(e){const t=this.Je(e)!==null;return t||F("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Xd),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Zd(){return new Ce(K.comparator)}function eh(){return new Ce(K.comparator)}const gw={asc:"ASCENDING",desc:"DESCENDING"},xw={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},yw={and:"AND",or:"OR"};class bw{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function gl(r,e){return r.useProto3Json||Ba(e)?e:{value:e}}function zr(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function up(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function vw(r,e){return zr(r,e.toTimestamp())}function ht(r){return ee(!!r),re.fromTimestamp(function(t){const n=en(t);return new _e(n.seconds,n.nanos)}(r))}function yc(r,e){return xl(r,e).canonicalString()}function xl(r,e){const t=function(s){return new Te(["projects",s.projectId,"databases",s.database])}(r).child("documents");return e===void 0?t:t.child(e)}function dp(r){const e=Te.fromString(r);return ee(vp(e)),e}function ba(r,e){return yc(r.databaseId,e.path)}function Jn(r,e){const t=dp(e);if(t.get(1)!==r.databaseId.projectId)throw new B(M.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new B(M.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new K(fp(t))}function hp(r,e){return yc(r.databaseId,e)}function mp(r){const e=dp(r);return e.length===4?Te.emptyPath():fp(e)}function yl(r){return new Te(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function fp(r){return ee(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function th(r,e,t){return{name:ba(r,e),fields:t.value.mapValue.fields}}function _w(r,e,t){const n=Jn(r,e.name),s=ht(e.updateTime),i=e.createTime?ht(e.createTime):re.min(),a=new ot({mapValue:{fields:e.fields}}),c=Ue.newFoundDocument(n,s,i,a);return t&&c.setHasCommittedMutations(),t?c.setHasCommittedMutations():c}function ww(r,e){let t;if("targetChange"in e){e.targetChange;const n=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:W()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(d,m){return d.useProto3Json?(ee(m===void 0||typeof m=="string"),ze.fromBase64String(m||"")):(ee(m===void 0||m instanceof Buffer||m instanceof Uint8Array),ze.fromUint8Array(m||new Uint8Array))}(r,e.targetChange.resumeToken),a=e.targetChange.cause,c=a&&function(d){const m=d.code===void 0?M.UNKNOWN:op(d.code);return new B(m,d.message||"")}(a);t=new cp(n,s,i,c||null)}else if("documentChange"in e){e.documentChange;const n=e.documentChange;n.document,n.document.name,n.document.updateTime;const s=Jn(r,n.document.name),i=ht(n.document.updateTime),a=n.document.createTime?ht(n.document.createTime):re.min(),c=new ot({mapValue:{fields:n.document.fields}}),u=Ue.newFoundDocument(s,i,a,c),d=n.targetIds||[],m=n.removedTargetIds||[];t=new na(d,m,u.key,u)}else if("documentDelete"in e){e.documentDelete;const n=e.documentDelete;n.document;const s=Jn(r,n.document),i=n.readTime?ht(n.readTime):re.min(),a=Ue.newNoDocument(s,i),c=n.removedTargetIds||[];t=new na([],c,a.key,a)}else if("documentRemove"in e){e.documentRemove;const n=e.documentRemove;n.document;const s=Jn(r,n.document),i=n.removedTargetIds||[];t=new na([],i,s,null)}else{if(!("filter"in e))return W();{e.filter;const n=e.filter;n.targetId;const{count:s=0,unchangedNames:i}=n,a=new dw(s,i),c=n.targetId;t=new lp(c,a)}}return t}function va(r,e){let t;if(e instanceof es)t={update:th(r,e.key,e.value)};else if(e instanceof Ha)t={delete:ba(r,e.key)};else if(e instanceof an)t={update:th(r,e.key,e.data),updateMask:Sw(e.fieldMask)};else{if(!(e instanceof ap))return W();t={verify:ba(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(i,a){const c=a.transform;if(c instanceof ni)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof Ur)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof Br)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof ri)return{fieldPath:a.field.canonicalString(),increment:c.Pe};throw W()}(0,n))),e.precondition.isNone||(t.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:vw(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:W()}(r,e.precondition)),t}function bl(r,e){const t=e.currentDocument?function(i){return i.updateTime!==void 0?lt.updateTime(ht(i.updateTime)):i.exists!==void 0?lt.exists(i.exists):lt.none()}(e.currentDocument):lt.none(),n=e.updateTransforms?e.updateTransforms.map(s=>function(a,c){let u=null;if("setToServerValue"in c)ee(c.setToServerValue==="REQUEST_TIME"),u=new ni;else if("appendMissingElements"in c){const m=c.appendMissingElements.values||[];u=new Ur(m)}else if("removeAllFromArray"in c){const m=c.removeAllFromArray.values||[];u=new Br(m)}else"increment"in c?u=new ri(a,c.increment):W();const d=Le.fromServerFormat(c.fieldPath);return new aw(d,u)}(r,s)):[];if(e.update){e.update.name;const s=Jn(r,e.update.name),i=new ot({mapValue:{fields:e.update.fields}});if(e.updateMask){const a=function(u){const d=u.fieldPaths||[];return new pt(d.map(m=>Le.fromServerFormat(m)))}(e.updateMask);return new an(s,i,a,t,n)}return new es(s,i,t,n)}if(e.delete){const s=Jn(r,e.delete);return new Ha(s,t)}if(e.verify){const s=Jn(r,e.verify);return new ap(s,t)}return W()}function Iw(r,e){return r&&r.length>0?(ee(e!==void 0),r.map(t=>function(s,i){let a=s.updateTime?ht(s.updateTime):ht(i);return a.isEqual(re.min())&&(a=ht(i)),new lw(a,s.transformResults||[])}(t,e))):[]}function pp(r,e){return{documents:[hp(r,e.path)]}}function gp(r,e){const t={structuredQuery:{}},n=e.path;let s;e.collectionGroup!==null?(s=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=hp(r,s);const i=function(d){if(d.length!==0)return bp(ke.create(d,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const a=function(d){if(d.length!==0)return d.map(m=>function(x){return{field:Er(x.field),direction:Ew(x.dir)}}(m))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const c=gl(r,e.limit);return c!==null&&(t.structuredQuery.limit=c),e.startAt&&(t.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{_t:t,parent:s}}function xp(r){let e=mp(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let s=null;if(n>0){ee(n===1);const m=t.from[0];m.allDescendants?s=m.collectionId:e=e.child(m.collectionId)}let i=[];t.where&&(i=function(p){const x=yp(p);return x instanceof ke&&dc(x)?x.getFilters():[x]}(t.where));let a=[];t.orderBy&&(a=function(p){return p.map(x=>function(w){return new ti(kr(w.field),function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(w.direction))}(x))}(t.orderBy));let c=null;t.limit&&(c=function(p){let x;return x=typeof p=="object"?p.value:p,Ba(x)?null:x}(t.limit));let u=null;t.startAt&&(u=function(p){const x=!!p.before,b=p.values||[];return new Lr(b,x)}(t.startAt));let d=null;return t.endAt&&(d=function(p){const x=!p.before,b=p.values||[];return new Lr(b,x)}(t.endAt)),qf(e,s,a,i,c,"F",u,d)}function Tw(r,e){const t=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return W()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function yp(r){return r.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=kr(t.unaryFilter.field);return pe.create(n,"==",{doubleValue:NaN});case"IS_NULL":const s=kr(t.unaryFilter.field);return pe.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=kr(t.unaryFilter.field);return pe.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=kr(t.unaryFilter.field);return pe.create(a,"!=",{nullValue:"NULL_VALUE"});default:return W()}}(r):r.fieldFilter!==void 0?function(t){return pe.create(kr(t.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return W()}}(t.fieldFilter.op),t.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(t){return ke.create(t.compositeFilter.filters.map(n=>yp(n)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return W()}}(t.compositeFilter.op))}(r):W()}function Ew(r){return gw[r]}function kw(r){return xw[r]}function Aw(r){return yw[r]}function Er(r){return{fieldPath:r.canonicalString()}}function kr(r){return Le.fromServerFormat(r.fieldPath)}function bp(r){return r instanceof pe?function(t){if(t.op==="=="){if(Ld(t.value))return{unaryFilter:{field:Er(t.field),op:"IS_NAN"}};if(Md(t.value))return{unaryFilter:{field:Er(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Ld(t.value))return{unaryFilter:{field:Er(t.field),op:"IS_NOT_NAN"}};if(Md(t.value))return{unaryFilter:{field:Er(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Er(t.field),op:kw(t.op),value:t.value}}}(r):r instanceof ke?function(t){const n=t.getFilters().map(s=>bp(s));return n.length===1?n[0]:{compositeFilter:{op:Aw(t.op),filters:n}}}(r):W()}function Sw(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function vp(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wt{constructor(e,t,n,s,i=re.min(),a=re.min(),c=ze.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=c,this.expectedCount=u}withSequenceNumber(e){return new Wt(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Wt(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Wt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Wt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _p{constructor(e){this.ct=e}}function Nw(r,e){let t;if(e.document)t=_w(r.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const n=K.fromSegments(e.noDocument.path),s=or(e.noDocument.readTime);t=Ue.newNoDocument(n,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return W();{const n=K.fromSegments(e.unknownDocument.path),s=or(e.unknownDocument.version);t=Ue.newUnknownDocument(n,s)}}return e.readTime&&t.setReadTime(function(s){const i=new _e(s[0],s[1]);return re.fromTimestamp(i)}(e.readTime)),t}function nh(r,e){const t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:_a(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document=function(i,a){return{name:ba(i,a.key),fields:a.data.value.mapValue.fields,updateTime:zr(i,a.version.toTimestamp()),createTime:zr(i,a.createTime.toTimestamp())}}(r.ct,e);else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:ar(e.version)};else{if(!e.isUnknownDocument())return W();n.unknownDocument={path:t.path.toArray(),version:ar(e.version)}}return n}function _a(r){const e=r.toTimestamp();return[e.seconds,e.nanoseconds]}function ar(r){const e=r.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function or(r){const e=new _e(r.seconds,r.nanoseconds);return re.fromTimestamp(e)}function Gn(r,e){const t=(e.baseMutations||[]).map(i=>bl(r.ct,i));for(let i=0;i<e.mutations.length-1;++i){const a=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const c=e.mutations[i+1];a.updateTransforms=c.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const n=e.mutations.map(i=>bl(r.ct,i)),s=_e.fromMillis(e.localWriteTimeMs);return new fc(e.batchId,s,t,n)}function Ns(r){const e=or(r.readTime),t=r.lastLimboFreeSnapshotVersion!==void 0?or(r.lastLimboFreeSnapshotVersion):re.min();let n;return n=function(i){return i.documents!==void 0}(r.query)?function(i){return ee(i.documents.length===1),wt($a(mp(i.documents[0])))}(r.query):function(i){return wt(xp(i))}(r.query),new Wt(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,e,t,ze.fromBase64String(r.resumeToken))}function wp(r,e){const t=ar(e.snapshotVersion),n=ar(e.lastLimboFreeSnapshotVersion);let s;s=xa(e.target)?pp(r.ct,e.target):gp(r.ct,e.target)._t;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:ir(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:s}}function Ip(r){const e=xp({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?pl(e,e.limit,"L"):e}function Vo(r,e){return new gc(e.largestBatchId,bl(r.ct,e.overlayMutation))}function rh(r,e){const t=e.path.lastSegment();return[r,dt(e.path.popLast()),t]}function sh(r,e,t,n){return{indexId:r,uid:e,sequenceNumber:t,readTime:ar(n.readTime),documentKey:dt(n.documentKey.path),largestBatchId:n.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rw{getBundleMetadata(e,t){return ih(e).get(t).next(n=>{if(n)return function(i){return{id:i.bundleId,createTime:or(i.createTime),version:i.version}}(n)})}saveBundleMetadata(e,t){return ih(e).put(function(s){return{bundleId:s.id,createTime:ar(ht(s.createTime)),version:s.version}}(t))}getNamedQuery(e,t){return ah(e).get(t).next(n=>{if(n)return function(i){return{name:i.name,query:Ip(i.bundledQuery),readTime:or(i.readTime)}}(n)})}saveNamedQuery(e,t){return ah(e).put(function(s){return{name:s.name,readTime:ar(ht(s.readTime)),bundledQuery:s.bundledQuery}}(t))}}function ih(r){return Ye(r,"bundles")}function ah(r){return Ye(r,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wa{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){const n=t.uid||"";return new Wa(e,n)}getOverlay(e,t){return ys(e).get(rh(this.userId,t)).next(n=>n?Vo(this.serializer,n):null)}getOverlays(e,t){const n=jt();return C.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&n.set(s,i)})).next(()=>n)}saveOverlays(e,t,n){const s=[];return n.forEach((i,a)=>{const c=new gc(t,a);s.push(this.ht(e,c))}),C.waitFor(s)}removeOverlaysForBatchId(e,t,n){const s=new Set;t.forEach(a=>s.add(dt(a.getCollectionPath())));const i=[];return s.forEach(a=>{const c=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);i.push(ys(e).j("collectionPathOverlayIndex",c))}),C.waitFor(i)}getOverlaysForCollection(e,t,n){const s=jt(),i=dt(t),a=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return ys(e).U("collectionPathOverlayIndex",a).next(c=>{for(const u of c){const d=Vo(this.serializer,u);s.set(d.getKey(),d)}return s})}getOverlaysForCollectionGroup(e,t,n,s){const i=jt();let a;const c=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return ys(e).J({index:"collectionGroupOverlayIndex",range:c},(u,d,m)=>{const p=Vo(this.serializer,d);i.size()<s||p.largestBatchId===a?(i.set(p.getKey(),p),a=p.largestBatchId):m.done()}).next(()=>i)}ht(e,t){return ys(e).put(function(s,i,a){const[c,u,d]=rh(i,a.mutation.key);return{userId:i,collectionPath:u,documentId:d,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:va(s.ct,a.mutation)}}(this.serializer,this.userId,t))}}function ys(r){return Ye(r,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cw{Pt(e){return Ye(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const n=t==null?void 0:t.value;return n?ze.fromUint8Array(n):ze.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qn{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(Oe(e.integerValue));else if("doubleValue"in e){const n=Oe(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),Ys(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),typeof n=="string"&&(n=en(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(En(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?Vf(e)?this.dt(t,Number.MAX_SAFE_INTEGER):za(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):W()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const n=e.fields||{};this.dt(t,55);for(const s of Object.keys(n))this.Vt(s,t),this.Tt(n[s],t)}wt(e,t){var n,s;const i=e.fields||{};this.dt(t,53);const a="value",c=((s=(n=i[a].arrayValue)===null||n===void 0?void 0:n.values)===null||s===void 0?void 0:s.length)||0;this.dt(t,15),t.At(Oe(c)),this.Vt(a,t),this.Tt(i[a],t)}bt(e,t){const n=e.values||[];this.dt(t,50);for(const s of n)this.Tt(s,t)}yt(e,t){this.dt(t,37),K.fromName(e).path.forEach(n=>{this.dt(t,60),this.Dt(n,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}qn.vt=new qn;function Dw(r){if(r===0)return 8;let e=0;return!(r>>4)&&(e+=4,r<<=4),!(r>>6)&&(e+=2,r<<=2),!(r>>7)&&(e+=1),e}function oh(r){const e=64-function(n){let s=0;for(let i=0;i<8;++i){const a=Dw(255&n[i]);if(s+=a,a!==8)break}return s}(r);return Math.ceil(e/8)}class Pw{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ft(n.value),n=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ot(n.value),n=t.next();this.Nt()}Lt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Ft(n);else if(n<2048)this.Ft(960|n>>>6),this.Ft(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|n>>>12),this.Ft(128|63&n>>>6),this.Ft(128|63&n);else{const s=t.codePointAt(0);this.Ft(240|s>>>18),this.Ft(128|63&s>>>12),this.Ft(128|63&s>>>6),this.Ft(128|63&s)}}this.Mt()}Bt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Ot(n);else if(n<2048)this.Ot(960|n>>>6),this.Ot(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Ot(480|n>>>12),this.Ot(128|63&n>>>6),this.Ot(128|63&n);else{const s=t.codePointAt(0);this.Ot(240|s>>>18),this.Ot(128|63&s>>>12),this.Ot(128|63&s>>>6),this.Ot(128|63&s)}}this.Nt()}kt(e){const t=this.qt(e),n=oh(t);this.Qt(1+n),this.buffer[this.position++]=255&n;for(let s=t.length-n;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Kt(e){const t=this.qt(e),n=oh(t);this.Qt(1+n),this.buffer[this.position++]=~(255&n);for(let s=t.length-n;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(i){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,i,!1),new Uint8Array(a.buffer)}(e),n=(128&t[0])!=0;t[0]^=n?255:128;for(let s=1;s<t.length;++s)t[s]^=n?255:0;return t}Ft(e){const t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;t===0?(this.Gt(0),this.Gt(255)):t===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const s=new Uint8Array(n);s.set(this.buffer),this.buffer=s}}class jw{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class Vw{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class bs{constructor(){this.jt=new Pw,this.Ht=new jw(this.jt),this.Jt=new Vw(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kn{constructor(e,t,n,s){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=s}Zt(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new Kn(this.indexId,this.documentKey,this.arrayValue,n)}}function hn(r,e){let t=r.indexId-e.indexId;return t!==0?t:(t=lh(r.arrayValue,e.arrayValue),t!==0?t:(t=lh(r.directionalValue,e.directionalValue),t!==0?t:K.comparator(r.documentKey,e.documentKey)))}function lh(r,e){for(let t=0;t<r.length&&t<e.length;++t){const n=r[t]-e[t];if(n!==0)return n}return r.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ch{constructor(e){this.Xt=new Se((t,n)=>Le.comparator(t.field,n.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const n=t;n.isInequality()?this.Xt=this.Xt.add(n):this.tn.push(n)}}get nn(){return this.Xt.size>1}rn(e){if(ee(e.collectionGroup===this.collectionId),this.nn)return!1;const t=ol(e);if(t!==void 0&&!this.sn(t))return!1;const n=Bn(e);let s=new Set,i=0,a=0;for(;i<n.length&&this.sn(n[i]);++i)s=s.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.Xt.size>0){const c=this.Xt.getIterator().getNext();if(!s.has(c.field.canonicalString())){const u=n[i];if(!this.on(c,u)||!this._n(this.en[a++],u))return!1}++i}for(;i<n.length;++i){const c=n[i];if(a>=this.en.length||!this._n(this.en[a++],c))return!1}return!0}an(){if(this.nn)return null;let e=new Se(Le.comparator);const t=[];for(const n of this.tn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")t.push(new Ji(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new Ji(n.field,0))}for(const n of this.en)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new Ji(n.field,n.dir==="asc"?0:1)));return new ga(ga.UNKNOWN_ID,this.collectionId,t,Qs.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const n=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===n}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tp(r){var e,t;if(ee(r instanceof pe||r instanceof ke),r instanceof pe){if(r instanceof Gf){const s=((t=(e=r.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(i=>pe.create(r.field,"==",i)))||[];return ke.create(s,"or")}return r}const n=r.filters.map(s=>Tp(s));return ke.create(n,r.op)}function Ow(r){if(r.getFilters().length===0)return[];const e=wl(Tp(r));return ee(Ep(e)),vl(e)||_l(e)?[e]:e.getFilters()}function vl(r){return r instanceof pe}function _l(r){return r instanceof ke&&dc(r)}function Ep(r){return vl(r)||_l(r)||function(t){if(t instanceof ke&&dl(t)){for(const n of t.getFilters())if(!vl(n)&&!_l(n))return!1;return!0}return!1}(r)}function wl(r){if(ee(r instanceof pe||r instanceof ke),r instanceof pe)return r;if(r.filters.length===1)return wl(r.filters[0]);const e=r.filters.map(n=>wl(n));let t=ke.create(e,r.op);return t=wa(t),Ep(t)?t:(ee(t instanceof ke),ee(Fr(t)),ee(t.filters.length>1),t.filters.reduce((n,s)=>bc(n,s)))}function bc(r,e){let t;return ee(r instanceof pe||r instanceof ke),ee(e instanceof pe||e instanceof ke),t=r instanceof pe?e instanceof pe?function(s,i){return ke.create([s,i],"and")}(r,e):uh(r,e):e instanceof pe?uh(e,r):function(s,i){if(ee(s.filters.length>0&&i.filters.length>0),Fr(s)&&Fr(i))return Bf(s,i.getFilters());const a=dl(s)?s:i,c=dl(s)?i:s,u=a.filters.map(d=>bc(d,c));return ke.create(u,"or")}(r,e),wa(t)}function uh(r,e){if(Fr(e))return Bf(e,r.getFilters());{const t=e.filters.map(n=>bc(r,n));return ke.create(t,"or")}}function wa(r){if(ee(r instanceof pe||r instanceof ke),r instanceof pe)return r;const e=r.getFilters();if(e.length===1)return wa(e[0]);if(Ff(r))return r;const t=e.map(s=>wa(s)),n=[];return t.forEach(s=>{s instanceof pe?n.push(s):s instanceof ke&&(s.op===r.op?n.push(...s.filters):n.push(s))}),n.length===1?n[0]:ke.create(n,r.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mw{constructor(){this.un=new vc}addToCollectionParentIndex(e,t){return this.un.add(t),C.resolve()}getCollectionParents(e,t){return C.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return C.resolve()}deleteFieldIndex(e,t){return C.resolve()}deleteAllFieldIndexes(e){return C.resolve()}createTargetIndexes(e,t){return C.resolve()}getDocumentsMatchingTarget(e,t){return C.resolve(null)}getIndexType(e,t){return C.resolve(0)}getFieldIndexes(e,t){return C.resolve([])}getNextCollectionGroupToUpdate(e){return C.resolve(null)}getMinOffset(e,t){return C.resolve(It.min())}getMinOffsetFromCollectionGroup(e,t){return C.resolve(It.min())}updateCollectionGroup(e,t,n){return C.resolve()}updateIndexEntries(e,t){return C.resolve()}}class vc{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t]||new Se(Te.comparator),i=!s.has(n);return this.index[t]=s.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),s=this.index[t];return s&&s.has(n)}getEntries(e){return(this.index[e]||new Se(Te.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bi=new Uint8Array(0);class Lw{constructor(e,t){this.databaseId=t,this.cn=new vc,this.ln=new Cn(n=>ir(n),(n,s)=>pi(n,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const n=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const i={collectionId:n,parent:dt(s)};return dh(e).put(i)}return C.resolve()}getCollectionParents(e,t){const n=[],s=IDBKeyRange.bound([t,""],[wf(t),""],!1,!0);return dh(e).U(s).next(i=>{for(const a of i){if(a.collectionId!==t)break;n.push(Pt(a.parent))}return n})}addFieldIndex(e,t){const n=vs(e),s=function(c){return{indexId:c.indexId,collectionGroup:c.collectionGroup,fields:c.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(t);delete s.indexId;const i=n.add(s);if(t.indexState){const a=vr(e);return i.next(c=>{a.put(sh(c,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const n=vs(e),s=vr(e),i=br(e);return n.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=vs(e),n=br(e),s=vr(e);return t.j().next(()=>n.j()).next(()=>s.j())}createTargetIndexes(e,t){return C.forEach(this.hn(t),n=>this.getIndexType(e,n).next(s=>{if(s===0||s===1){const i=new ch(n).an();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,t){const n=br(e);let s=!0;const i=new Map;return C.forEach(this.hn(t),a=>this.Pn(e,a).next(c=>{s&&(s=!!c),i.set(a,c)})).next(()=>{if(s){let a=me();const c=[];return C.forEach(i,(u,d)=>{F("IndexedDbIndexManager",`Using index ${function(P){return`id=${P.indexId}|cg=${P.collectionGroup}|f=${P.fields.map(U=>`${U.fieldPath}:${U.kind}`).join(",")}`}(u)} to execute ${ir(t)}`);const m=function(P,U){const L=ol(U);if(L===void 0)return null;for(const G of ya(P,L.fieldPath))switch(G.op){case"array-contains-any":return G.value.arrayValue.values||[];case"array-contains":return[G.value]}return null}(d,u),p=function(P,U){const L=new Map;for(const G of Bn(U))for(const I of ya(P,G.fieldPath))switch(I.op){case"==":case"in":L.set(G.fieldPath.canonicalString(),I.value);break;case"not-in":case"!=":return L.set(G.fieldPath.canonicalString(),I.value),Array.from(L.values())}return null}(d,u),x=function(P,U){const L=[];let G=!0;for(const I of Bn(U)){const y=I.kind===0?$d(P,I.fieldPath,P.startAt):Gd(P,I.fieldPath,P.startAt);L.push(y.value),G&&(G=y.inclusive)}return new Lr(L,G)}(d,u),b=function(P,U){const L=[];let G=!0;for(const I of Bn(U)){const y=I.kind===0?Gd(P,I.fieldPath,P.endAt):$d(P,I.fieldPath,P.endAt);L.push(y.value),G&&(G=y.inclusive)}return new Lr(L,G)}(d,u),w=this.In(u,d,x),k=this.In(u,d,b),N=this.Tn(u,d,p),D=this.En(u.indexId,m,w,x.inclusive,k,b.inclusive,N);return C.forEach(D,V=>n.G(V,t.limit).next(P=>{P.forEach(U=>{const L=K.fromSegments(U.documentKey);a.has(L)||(a=a.add(L),c.push(L))})}))}).next(()=>c)}return C.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(e.filters.length===0?t=[e]:t=Ow(ke.create(e.filters,"and")).map(n=>ml(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,n,s,i,a,c){const u=(t!=null?t.length:1)*Math.max(n.length,i.length),d=u/(t!=null?t.length:1),m=[];for(let p=0;p<u;++p){const x=t?this.dn(t[p/d]):Bi,b=this.An(e,x,n[p%d],s),w=this.Rn(e,x,i[p%d],a),k=c.map(N=>this.An(e,x,N,!0));m.push(...this.createRange(b,w,k))}return m}An(e,t,n,s){const i=new Kn(e,K.empty(),t,n);return s?i:i.Zt()}Rn(e,t,n,s){const i=new Kn(e,K.empty(),t,n);return s?i.Zt():i}Pn(e,t){const n=new ch(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let a=null;for(const c of i)n.rn(c)&&(!a||c.fields.length>a.fields.length)&&(a=c);return a})}getIndexType(e,t){let n=2;const s=this.hn(t);return C.forEach(s,i=>this.Pn(e,i).next(a=>{a?n!==0&&a.fields.length<function(u){let d=new Se(Le.comparator),m=!1;for(const p of u.filters)for(const x of p.getFlattenedFilters())x.field.isKeyField()||(x.op==="array-contains"||x.op==="array-contains-any"?m=!0:d=d.add(x.field));for(const p of u.orderBy)p.field.isKeyField()||(d=d.add(p.field));return d.size+(m?1:0)}(i)&&(n=1):n=0})).next(()=>function(a){return a.limit!==null}(t)&&s.length>1&&n===2?1:n)}Vn(e,t){const n=new bs;for(const s of Bn(e)){const i=t.data.field(s.fieldPath);if(i==null)return null;const a=n.Yt(s.kind);qn.vt.It(i,a)}return n.zt()}dn(e){const t=new bs;return qn.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const n=new bs;return qn.vt.It(Zs(this.databaseId,t),n.Yt(function(i){const a=Bn(i);return a.length===0?0:a[a.length-1].kind}(e))),n.zt()}Tn(e,t,n){if(n===null)return[];let s=[];s.push(new bs);let i=0;for(const a of Bn(e)){const c=n[i++];for(const u of s)if(this.fn(t,a.fieldPath)&&ei(c))s=this.gn(s,a,c);else{const d=u.Yt(a.kind);qn.vt.It(c,d)}}return this.pn(s)}In(e,t,n){return this.Tn(e,t,n.position)}pn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].zt();return t}gn(e,t,n){const s=[...e],i=[];for(const a of n.arrayValue.values||[])for(const c of s){const u=new bs;u.seed(c.zt()),qn.vt.It(a,u.Yt(t.kind)),i.push(u)}return i}fn(e,t){return!!e.filters.find(n=>n instanceof pe&&n.field.isEqual(t)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(e,t){const n=vs(e),s=vr(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next(i=>{const a=[];return C.forEach(i,c=>s.get([c.indexId,this.uid]).next(u=>{a.push(function(m,p){const x=p?new Qs(p.sequenceNumber,new It(or(p.readTime),new K(Pt(p.documentKey)),p.largestBatchId)):Qs.empty(),b=m.fields.map(([w,k])=>new Ji(Le.fromServerFormat(w),k));return new ga(m.indexId,m.collectionGroup,b,x)}(c,u))})).next(()=>a)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((n,s)=>{const i=n.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:ue(n.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){const s=vs(e),i=vr(e);return this.yn(e).next(a=>s.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(c=>C.forEach(c,u=>i.put(sh(u.indexId,this.uid,a,n)))))}updateIndexEntries(e,t){const n=new Map;return C.forEach(t,(s,i)=>{const a=n.get(s.collectionGroup);return(a?C.resolve(a):this.getFieldIndexes(e,s.collectionGroup)).next(c=>(n.set(s.collectionGroup,c),C.forEach(c,u=>this.wn(e,s,u).next(d=>{const m=this.Sn(i,u);return d.isEqual(m)?C.resolve():this.bn(e,i,u,d,m)}))))})}Dn(e,t,n,s){return br(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.mn(n,t.key),documentKey:t.key.path.toArray()})}vn(e,t,n,s){return br(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.mn(n,t.key),t.key.path.toArray()])}wn(e,t,n){const s=br(e);let i=new Se(hn);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.mn(n,t)])},(a,c)=>{i=i.add(new Kn(n.indexId,t,c.arrayValue,c.directionalValue))}).next(()=>i)}Sn(e,t){let n=new Se(hn);const s=this.Vn(t,e);if(s==null)return n;const i=ol(t);if(i!=null){const a=e.data.field(i.fieldPath);if(ei(a))for(const c of a.arrayValue.values||[])n=n.add(new Kn(t.indexId,e.key,this.dn(c),s))}else n=n.add(new Kn(t.indexId,e.key,Bi,s));return n}bn(e,t,n,s,i){F("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const a=[];return function(u,d,m,p,x){const b=u.getIterator(),w=d.getIterator();let k=yr(b),N=yr(w);for(;k||N;){let D=!1,V=!1;if(k&&N){const P=m(k,N);P<0?V=!0:P>0&&(D=!0)}else k!=null?V=!0:D=!0;D?(p(N),N=yr(w)):V?(x(k),k=yr(b)):(k=yr(b),N=yr(w))}}(s,i,hn,c=>{a.push(this.Dn(e,t,n,c))},c=>{a.push(this.vn(e,t,n,c))}),C.waitFor(a)}yn(e){let t=1;return vr(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((a,c)=>hn(a,c)).filter((a,c,u)=>!c||hn(a,u[c-1])!==0);const s=[];s.push(e);for(const a of n){const c=hn(a,e),u=hn(a,t);if(c===0)s[0]=e.Zt();else if(c>0&&u<0)s.push(a),s.push(a.Zt());else if(u>0)break}s.push(t);const i=[];for(let a=0;a<s.length;a+=2){if(this.Cn(s[a],s[a+1]))return[];const c=[s[a].indexId,this.uid,s[a].arrayValue,s[a].directionalValue,Bi,[]],u=[s[a+1].indexId,this.uid,s[a+1].arrayValue,s[a+1].directionalValue,Bi,[]];i.push(IDBKeyRange.bound(c,u))}return i}Cn(e,t){return hn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(hh)}getMinOffset(e,t){return C.mapArray(this.hn(t),n=>this.Pn(e,n).next(s=>s||W())).next(hh)}}function dh(r){return Ye(r,"collectionParents")}function br(r){return Ye(r,"indexEntries")}function vs(r){return Ye(r,"indexConfiguration")}function vr(r){return Ye(r,"indexState")}function hh(r){ee(r.length!==0);let e=r[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<r.length;n++){const s=r[n].indexState.offset;ac(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new It(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class mt{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new mt(e,mt.DEFAULT_COLLECTION_PERCENTILE,mt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kp(r,e,t){const n=r.store("mutations"),s=r.store("documentMutations"),i=[],a=IDBKeyRange.only(t.batchId);let c=0;const u=n.J({range:a},(m,p,x)=>(c++,x.delete()));i.push(u.next(()=>{ee(c===1)}));const d=[];for(const m of t.mutations){const p=Nf(e,m.key.path,t.batchId);i.push(s.delete(p)),d.push(m.key)}return C.waitFor(i).next(()=>d)}function Ia(r){if(!r)return 0;let e;if(r.document)e=r.document;else if(r.unknownDocument)e=r.unknownDocument;else{if(!r.noDocument)throw W();e=r.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */mt.DEFAULT_COLLECTION_PERCENTILE=10,mt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,mt.DEFAULT=new mt(41943040,mt.DEFAULT_COLLECTION_PERCENTILE,mt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),mt.DISABLED=new mt(-1,0,0);class Qa{constructor(e,t,n,s){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=s,this.Fn={}}static lt(e,t,n,s){ee(e.uid!=="");const i=e.isAuthenticated()?e.uid:"";return new Qa(i,t,n,s)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return mn(e).J({index:"userMutationsIndex",range:n},(s,i,a)=>{t=!1,a.done()}).next(()=>t)}addMutationBatch(e,t,n,s){const i=Ar(e),a=mn(e);return a.add({}).next(c=>{ee(typeof c=="number");const u=new fc(c,t,n,s),d=function(b,w,k){const N=k.baseMutations.map(V=>va(b.ct,V)),D=k.mutations.map(V=>va(b.ct,V));return{userId:w,batchId:k.batchId,localWriteTimeMs:k.localWriteTime.toMillis(),baseMutations:N,mutations:D}}(this.serializer,this.userId,u),m=[];let p=new Se((x,b)=>ue(x.canonicalString(),b.canonicalString()));for(const x of s){const b=Nf(this.userId,x.key.path,c);p=p.add(x.key.path.popLast()),m.push(a.put(d)),m.push(i.put(b,__))}return p.forEach(x=>{m.push(this.indexManager.addToCollectionParentIndex(e,x))}),e.addOnCommittedListener(()=>{this.Fn[c]=u.keys()}),C.waitFor(m).next(()=>u)})}lookupMutationBatch(e,t){return mn(e).get(t).next(n=>n?(ee(n.userId===this.userId),Gn(this.serializer,n)):null)}Mn(e,t){return this.Fn[t]?C.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){const s=n.keys();return this.Fn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const n=t+1,s=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return mn(e).J({index:"userMutationsIndex",range:s},(a,c,u)=>{c.userId===this.userId&&(ee(c.batchId>=n),i=Gn(this.serializer,c)),u.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return mn(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,i,a)=>{n=i.batchId,a.done()}).next(()=>n)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return mn(e).U("userMutationsIndex",t).next(n=>n.map(s=>Gn(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=Xi(this.userId,t.path),s=IDBKeyRange.lowerBound(n),i=[];return Ar(e).J({range:s},(a,c,u)=>{const[d,m,p]=a,x=Pt(m);if(d===this.userId&&t.path.isEqual(x))return mn(e).get(p).next(b=>{if(!b)throw W();ee(b.userId===this.userId),i.push(Gn(this.serializer,b))});u.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Se(ue);const s=[];return t.forEach(i=>{const a=Xi(this.userId,i.path),c=IDBKeyRange.lowerBound(a),u=Ar(e).J({range:c},(d,m,p)=>{const[x,b,w]=d,k=Pt(b);x===this.userId&&i.path.isEqual(k)?n=n.add(w):p.done()});s.push(u)}),C.waitFor(s).next(()=>this.xn(e,n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,s=n.length+1,i=Xi(this.userId,n),a=IDBKeyRange.lowerBound(i);let c=new Se(ue);return Ar(e).J({range:a},(u,d,m)=>{const[p,x,b]=u,w=Pt(x);p===this.userId&&n.isPrefixOf(w)?w.length===s&&(c=c.add(b)):m.done()}).next(()=>this.xn(e,c))}xn(e,t){const n=[],s=[];return t.forEach(i=>{s.push(mn(e).get(i).next(a=>{if(a===null)throw W();ee(a.userId===this.userId),n.push(Gn(this.serializer,a))}))}),C.waitFor(s).next(()=>n)}removeMutationBatch(e,t){return kp(e._e,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),C.forEach(n,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return C.resolve();const n=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),s=[];return Ar(e).J({range:n},(i,a,c)=>{if(i[0]===this.userId){const u=Pt(i[1]);s.push(u)}else c.done()}).next(()=>{ee(s.length===0)})})}containsKey(e,t){return Ap(e,this.userId,t)}Nn(e){return Sp(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Ap(r,e,t){const n=Xi(e,t.path),s=n[1],i=IDBKeyRange.lowerBound(n);let a=!1;return Ar(r).J({range:i,H:!0},(c,u,d)=>{const[m,p,x]=c;m===e&&p===s&&(a=!0),d.done()}).next(()=>a)}function mn(r){return Ye(r,"mutations")}function Ar(r){return Ye(r,"documentMutations")}function Sp(r){return Ye(r,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lr{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new lr(0)}static kn(){return new lr(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fw{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const n=new lr(t.highestTargetId);return t.highestTargetId=n.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>re.fromTimestamp(new _e(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.qn(e).next(s=>(s.highestListenSequenceNumber=t,n&&(s.lastRemoteSnapshotVersion=n.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Qn(e,s)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(n=>(n.targetCount+=1,this.$n(t,n),this.Qn(e,n))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>_r(e).delete(t.targetId)).next(()=>this.qn(e)).next(n=>(ee(n.targetCount>0),n.targetCount-=1,this.Qn(e,n)))}removeTargets(e,t,n){let s=0;const i=[];return _r(e).J((a,c)=>{const u=Ns(c);u.sequenceNumber<=t&&n.get(u.targetId)===null&&(s++,i.push(this.removeTargetData(e,u)))}).next(()=>C.waitFor(i)).next(()=>s)}forEachTarget(e,t){return _r(e).J((n,s)=>{const i=Ns(s);t(i)})}qn(e){return fh(e).get("targetGlobalKey").next(t=>(ee(t!==null),t))}Qn(e,t){return fh(e).put("targetGlobalKey",t)}Kn(e,t){return _r(e).put(wp(this.serializer,t))}$n(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const n=ir(t),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return _r(e).J({range:s,index:"queryTargetsIndex"},(a,c,u)=>{const d=Ns(c);pi(t,d.target)&&(i=d,u.done())}).next(()=>i)}addMatchingKeys(e,t,n){const s=[],i=xn(e);return t.forEach(a=>{const c=dt(a.path);s.push(i.put({targetId:n,path:c})),s.push(this.referenceDelegate.addReference(e,n,a))}),C.waitFor(s)}removeMatchingKeys(e,t,n){const s=xn(e);return C.forEach(t,i=>{const a=dt(i.path);return C.waitFor([s.delete([n,a]),this.referenceDelegate.removeReference(e,n,i)])})}removeMatchingKeysForTargetId(e,t){const n=xn(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(s)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),s=xn(e);let i=me();return s.J({range:n,H:!0},(a,c,u)=>{const d=Pt(a[1]),m=new K(d);i=i.add(m)}).next(()=>i)}containsKey(e,t){const n=dt(t.path),s=IDBKeyRange.bound([n],[wf(n)],!1,!0);let i=0;return xn(e).J({index:"documentTargetsIndex",H:!0,range:s},([a,c],u,d)=>{a!==0&&(i++,d.done())}).next(()=>i>0)}ot(e,t){return _r(e).get(t).next(n=>n?Ns(n):null)}}function _r(r){return Ye(r,"targets")}function fh(r){return Ye(r,"targetGlobal")}function xn(r){return Ye(r,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ph([r,e],[t,n]){const s=ue(r,t);return s===0?ue(e,n):s}class Uw{constructor(e){this.Un=e,this.buffer=new Se(ph),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();ph(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Bw{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){F("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Rn(t)?F("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Nn(t)}await this.Hn(3e5)})}}class zw{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(t===0)return C.resolve(ft.oe);const n=new Uw(t);return this.Jn.forEachTarget(e,s=>n.zn(s.sequenceNumber)).next(()=>this.Jn.Zn(e,s=>n.zn(s))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(F("LruGarbageCollector","Garbage collection skipped; disabled"),C.resolve(mh)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(F("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),mh):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let n,s,i,a,c,u,d;const m=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(F("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),s=this.params.maximumSequenceNumbersToCollect):s=p,a=Date.now(),this.nthSequenceNumber(e,s))).next(p=>(n=p,c=Date.now(),this.removeTargets(e,n,t))).next(p=>(i=p,u=Date.now(),this.removeOrphanedDocuments(e,n))).next(p=>(d=Date.now(),Ir()<=fe.DEBUG&&F("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-m}ms
	Determined least recently used ${s} in `+(c-a)+`ms
	Removed ${i} targets in `+(u-c)+`ms
	Removed ${p} documents in `+(d-u)+`ms
Total Duration: ${d-m}ms`),C.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:p})))}}function $w(r,e){return new zw(r,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gw{constructor(e,t){this.db=e,this.garbageCollector=$w(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(s=>n+s))}er(e){let t=0;return this.Zn(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(n,s)=>t(s))}addReference(e,t,n){return zi(e,n)}removeReference(e,t,n){return zi(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return zi(e,t)}nr(e,t){return function(s,i){let a=!1;return Sp(s).Y(c=>Ap(s,c,i).next(u=>(u&&(a=!0),C.resolve(!u)))).next(()=>a)}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.tr(e,(a,c)=>{if(c<=t){const u=this.nr(e,a).next(d=>{if(!d)return i++,n.getEntry(e,a).next(()=>(n.removeEntry(a,re.min()),xn(e).delete(function(p){return[0,dt(p.path)]}(a))))});s.push(u)}}).next(()=>C.waitFor(s)).next(()=>n.apply(e)).next(()=>i)}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return zi(e,t)}tr(e,t){const n=xn(e);let s,i=ft.oe;return n.J({index:"documentTargetsIndex"},([a,c],{path:u,sequenceNumber:d})=>{a===0?(i!==ft.oe&&t(new K(Pt(s)),i),i=d,s=u):i=ft.oe}).next(()=>{i!==ft.oe&&t(new K(Pt(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function zi(r,e){return xn(r).put(function(n,s){return{targetId:0,path:dt(n.path),sequenceNumber:s}}(e,r.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Np{constructor(){this.changes=new Cn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ue.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return n!==void 0?C.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qw{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return Ln(e).put(n)}removeEntry(e,t,n){return Ln(e).delete(function(i,a){const c=i.path.toArray();return[c.slice(0,c.length-2),c[c.length-2],_a(a),c[c.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.rr(e,n)))}getEntry(e,t){let n=Ue.newInvalidDocument(t);return Ln(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(_s(t))},(s,i)=>{n=this.ir(t,i)}).next(()=>n)}sr(e,t){let n={size:0,document:Ue.newInvalidDocument(t)};return Ln(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(_s(t))},(s,i)=>{n={document:this.ir(t,i),size:Ia(i)}}).next(()=>n)}getEntries(e,t){let n=_t();return this._r(e,t,(s,i)=>{const a=this.ir(s,i);n=n.insert(s,a)}).next(()=>n)}ar(e,t){let n=_t(),s=new Ce(K.comparator);return this._r(e,t,(i,a)=>{const c=this.ir(i,a);n=n.insert(i,c),s=s.insert(i,Ia(a))}).next(()=>({documents:n,ur:s}))}_r(e,t,n){if(t.isEmpty())return C.resolve();let s=new Se(yh);t.forEach(u=>s=s.add(u));const i=IDBKeyRange.bound(_s(s.first()),_s(s.last())),a=s.getIterator();let c=a.getNext();return Ln(e).J({index:"documentKeyIndex",range:i},(u,d,m)=>{const p=K.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;c&&yh(c,p)<0;)n(c,null),c=a.getNext();c&&c.isEqual(p)&&(n(c,d),c=a.hasNext()?a.getNext():null),c?m.$(_s(c)):m.done()}).next(()=>{for(;c;)n(c,null),c=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(e,t,n,s,i){const a=t.path,c=[a.popLast().toArray(),a.lastSegment(),_a(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],u=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Ln(e).U(IDBKeyRange.bound(c,u,!0)).next(d=>{i==null||i.incrementDocumentReadCount(d.length);let m=_t();for(const p of d){const x=this.ir(K.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);x.isFoundDocument()&&(gi(t,x)||s.has(x.key))&&(m=m.insert(x.key,x))}return m})}getAllFromCollectionGroup(e,t,n,s){let i=_t();const a=xh(t,n),c=xh(t,It.max());return Ln(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,c,!0)},(u,d,m)=>{const p=this.ir(K.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);i=i.insert(p.key,p),i.size===s&&m.done()}).next(()=>i)}newChangeBuffer(e){return new Kw(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return gh(e).get("remoteDocumentGlobalKey").next(t=>(ee(!!t),t))}rr(e,t){return gh(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const n=Nw(this.serializer,t);if(!(n.isNoDocument()&&n.version.isEqual(re.min())))return n}return Ue.newInvalidDocument(e)}}function Rp(r){return new qw(r)}class Kw extends Np{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new Cn(n=>n.toString(),(n,s)=>n.isEqual(s))}applyChanges(e){const t=[];let n=0,s=new Se((i,a)=>ue(i.canonicalString(),a.canonicalString()));return this.changes.forEach((i,a)=>{const c=this.lr.get(i);if(t.push(this.cr.removeEntry(e,i,c.readTime)),a.isValidDocument()){const u=nh(this.cr.serializer,a);s=s.add(i.path.popLast());const d=Ia(u);n+=d-c.size,t.push(this.cr.addEntry(e,i,u))}else if(n-=c.size,this.trackRemovals){const u=nh(this.cr.serializer,a.convertToNoDocument(re.min()));t.push(this.cr.addEntry(e,i,u))}}),s.forEach(i=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.cr.updateMetadata(e,n)),C.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(n=>(this.lr.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:n,ur:s})=>(s.forEach((i,a)=>{this.lr.set(i,{size:a,readTime:n.get(i).readTime})}),n))}}function gh(r){return Ye(r,"remoteDocumentGlobal")}function Ln(r){return Ye(r,"remoteDocumentsV14")}function _s(r){const e=r.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function xh(r,e){const t=e.documentKey.path.toArray();return[r,_a(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function yh(r,e){const t=r.path.toArray(),n=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<n.length-2;++i)if(s=ue(t[i],n[i]),s)return s;return s=ue(t.length,n.length),s||(s=ue(t[t.length-2],n[n.length-2]),s||ue(t[t.length-1],n[n.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hw{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cp{constructor(e,t,n,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=s}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(n=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(n!==null&&Ms(n.mutation,s,pt.empty(),_e.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,me()).next(()=>n))}getLocalViewOfDocuments(e,t,n=me()){const s=jt();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,n).next(i=>{let a=As();return i.forEach((c,u)=>{a=a.insert(c,u.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const n=jt();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,me()))}populateOverlays(e,t,n){const s=[];return n.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((a,c)=>{t.set(a,c)})})}computeViews(e,t,n,s){let i=_t();const a=Os(),c=function(){return Os()}();return t.forEach((u,d)=>{const m=n.get(d.key);s.has(d.key)&&(m===void 0||m.mutation instanceof an)?i=i.insert(d.key,d):m!==void 0?(a.set(d.key,m.mutation.getFieldMask()),Ms(m.mutation,d,m.mutation.getFieldMask(),_e.now())):a.set(d.key,pt.empty())}),this.recalculateAndSaveOverlays(e,i).next(u=>(u.forEach((d,m)=>a.set(d,m)),t.forEach((d,m)=>{var p;return c.set(d,new Hw(m,(p=a.get(d))!==null&&p!==void 0?p:null))}),c))}recalculateAndSaveOverlays(e,t){const n=Os();let s=new Ce((a,c)=>a-c),i=me();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const c of a)c.keys().forEach(u=>{const d=t.get(u);if(d===null)return;let m=n.get(u)||pt.empty();m=c.applyToLocalView(d,m),n.set(u,m);const p=(s.get(c.batchId)||me()).add(u);s=s.insert(c.batchId,p)})}).next(()=>{const a=[],c=s.getReverseIterator();for(;c.hasNext();){const u=c.getNext(),d=u.key,m=u.value,p=Xf();m.forEach(x=>{if(!i.has(x)){const b=sp(t.get(x),n.get(x));b!==null&&p.set(x,b),i=i.add(x)}}),a.push(this.documentOverlayCache.saveOverlays(e,d,p))}return C.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,s){return function(a){return K.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Kf(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,s):this.getDocumentsMatchingCollectionQuery(e,t,n,s)}getNextDocuments(e,t,n,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,s).next(i=>{const a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,s-i.size):C.resolve(jt());let c=-1,u=i;return a.next(d=>C.forEach(d,(m,p)=>(c<p.largestBatchId&&(c=p.largestBatchId),i.get(m)?C.resolve():this.remoteDocumentCache.getEntry(e,m).next(x=>{u=u.insert(m,x)}))).next(()=>this.populateOverlays(e,d,i)).next(()=>this.computeViews(e,u,d,me())).next(m=>({batchId:c,changes:Jf(m)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new K(t)).next(n=>{let s=As();return n.isFoundDocument()&&(s=s.insert(n.key,n)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,n,s){const i=t.collectionGroup;let a=As();return this.indexManager.getCollectionParents(e,i).next(c=>C.forEach(c,u=>{const d=function(p,x){return new Zr(x,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)}(t,u.child(i));return this.getDocumentsMatchingCollectionQuery(e,d,n,s).next(m=>{m.forEach((p,x)=>{a=a.insert(p,x)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,n,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,s))).next(a=>{i.forEach((u,d)=>{const m=d.getKey();a.get(m)===null&&(a=a.insert(m,Ue.newInvalidDocument(m)))});let c=As();return a.forEach((u,d)=>{const m=i.get(u);m!==void 0&&Ms(m.mutation,d,pt.empty(),_e.now()),gi(t,d)&&(c=c.insert(u,d))}),c})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ww{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return C.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,function(s){return{id:s.id,version:s.version,createTime:ht(s.createTime)}}(t)),C.resolve()}getNamedQuery(e,t){return C.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,function(s){return{name:s.name,query:Ip(s.bundledQuery),readTime:ht(s.readTime)}}(t)),C.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qw{constructor(){this.overlays=new Ce(K.comparator),this.Ir=new Map}getOverlay(e,t){return C.resolve(this.overlays.get(t))}getOverlays(e,t){const n=jt();return C.forEach(t,s=>this.getOverlay(e,s).next(i=>{i!==null&&n.set(s,i)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((s,i)=>{this.ht(e,t,i)}),C.resolve()}removeOverlaysForBatchId(e,t,n){const s=this.Ir.get(n);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.Ir.delete(n)),C.resolve()}getOverlaysForCollection(e,t,n){const s=jt(),i=t.length+1,a=new K(t.child("")),c=this.overlays.getIteratorFrom(a);for(;c.hasNext();){const u=c.getNext().value,d=u.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===i&&u.largestBatchId>n&&s.set(u.getKey(),u)}return C.resolve(s)}getOverlaysForCollectionGroup(e,t,n,s){let i=new Ce((d,m)=>d-m);const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>n){let m=i.get(d.largestBatchId);m===null&&(m=jt(),i=i.insert(d.largestBatchId,m)),m.set(d.getKey(),d)}}const c=jt(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((d,m)=>c.set(d,m)),!(c.size()>=s)););return C.resolve(c)}ht(e,t,n){const s=this.overlays.get(n.key);if(s!==null){const a=this.Ir.get(s.largestBatchId).delete(n.key);this.Ir.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new gc(t,n));let i=this.Ir.get(t);i===void 0&&(i=me(),this.Ir.set(t,i)),this.Ir.set(t,i.add(n.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yw{constructor(){this.sessionToken=ze.EMPTY_BYTE_STRING}getSessionToken(e){return C.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,C.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _c{constructor(){this.Tr=new Se(Je.Er),this.dr=new Se(Je.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const n=new Je(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Vr(new Je(e,t))}mr(e,t){e.forEach(n=>this.removeReference(n,t))}gr(e){const t=new K(new Te([])),n=new Je(t,e),s=new Je(t,e+1),i=[];return this.dr.forEachInRange([n,s],a=>{this.Vr(a),i.push(a.key)}),i}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new K(new Te([])),n=new Je(t,e),s=new Je(t,e+1);let i=me();return this.dr.forEachInRange([n,s],a=>{i=i.add(a.key)}),i}containsKey(e){const t=new Je(e,0),n=this.Tr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}}class Je{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return K.comparator(e.key,t.key)||ue(e.wr,t.wr)}static Ar(e,t){return ue(e.wr,t.wr)||K.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jw{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new Se(Je.Er)}checkEmpty(e){return C.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,s){const i=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new fc(i,t,n,s);this.mutationQueue.push(a);for(const c of s)this.br=this.br.add(new Je(c.key,i)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return C.resolve(a)}lookupMutationBatch(e,t){return C.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,s=this.vr(n),i=s<0?0:s;return C.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return C.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return C.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Je(t,0),s=new Je(t,Number.POSITIVE_INFINITY),i=[];return this.br.forEachInRange([n,s],a=>{const c=this.Dr(a.wr);i.push(c)}),C.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Se(ue);return t.forEach(s=>{const i=new Je(s,0),a=new Je(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([i,a],c=>{n=n.add(c.wr)})}),C.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,s=n.length+1;let i=n;K.isDocumentKey(i)||(i=i.child(""));const a=new Je(new K(i),0);let c=new Se(ue);return this.br.forEachWhile(u=>{const d=u.key.path;return!!n.isPrefixOf(d)&&(d.length===s&&(c=c.add(u.wr)),!0)},a),C.resolve(this.Cr(c))}Cr(e){const t=[];return e.forEach(n=>{const s=this.Dr(n);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){ee(this.Fr(t.batchId,"removed")===0),this.mutationQueue.shift();let n=this.br;return C.forEach(t.mutations,s=>{const i=new Je(s.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){const n=new Je(t,0),s=this.br.firstAfterOrEqual(n);return C.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,C.resolve()}Fr(e,t){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xw{constructor(e){this.Mr=e,this.docs=function(){return new Ce(K.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,s=this.docs.get(n),i=s?s.size:0,a=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return C.resolve(n?n.document.mutableCopy():Ue.newInvalidDocument(t))}getEntries(e,t){let n=_t();return t.forEach(s=>{const i=this.docs.get(s);n=n.insert(s,i?i.document.mutableCopy():Ue.newInvalidDocument(s))}),C.resolve(n)}getDocumentsMatchingQuery(e,t,n,s){let i=_t();const a=t.path,c=new K(a.child("")),u=this.docs.getIteratorFrom(c);for(;u.hasNext();){const{key:d,value:{document:m}}=u.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||ac(Tf(m),n)<=0||(s.has(m.key)||gi(t,m))&&(i=i.insert(m.key,m.mutableCopy()))}return C.resolve(i)}getAllFromCollectionGroup(e,t,n,s){W()}Or(e,t){return C.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new Zw(this)}getSize(e){return C.resolve(this.size)}}class Zw extends Np{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((n,s)=>{s.isValidDocument()?t.push(this.cr.addEntry(e,s)):this.cr.removeEntry(n)}),C.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eI{constructor(e){this.persistence=e,this.Nr=new Cn(t=>ir(t),pi),this.lastRemoteSnapshotVersion=re.min(),this.highestTargetId=0,this.Lr=0,this.Br=new _c,this.targetCount=0,this.kr=lr.Bn()}forEachTarget(e,t){return this.Nr.forEach((n,s)=>t(s)),C.resolve()}getLastRemoteSnapshotVersion(e){return C.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return C.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),C.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),C.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new lr(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,C.resolve()}updateTargetData(e,t){return this.Kn(t),C.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,C.resolve()}removeTargets(e,t,n){let s=0;const i=[];return this.Nr.forEach((a,c)=>{c.sequenceNumber<=t&&n.get(c.targetId)===null&&(this.Nr.delete(a),i.push(this.removeMatchingKeysForTargetId(e,c.targetId)),s++)}),C.waitFor(i).next(()=>s)}getTargetCount(e){return C.resolve(this.targetCount)}getTargetData(e,t){const n=this.Nr.get(t)||null;return C.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),C.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(a=>{i.push(s.markPotentiallyOrphaned(e,a))}),C.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),C.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Br.yr(t);return C.resolve(n)}containsKey(e,t){return C.resolve(this.Br.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dp{constructor(e,t){this.qr={},this.overlays={},this.Qr=new ft(0),this.Kr=!1,this.Kr=!0,this.$r=new Yw,this.referenceDelegate=e(this),this.Ur=new eI(this),this.indexManager=new Mw,this.remoteDocumentCache=function(s){return new Xw(s)}(n=>this.referenceDelegate.Wr(n)),this.serializer=new _p(t),this.Gr=new Ww(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Qw,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new Jw(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){F("MemoryPersistence","Starting transaction:",e);const s=new tI(this.Qr.next());return this.referenceDelegate.zr(),n(s).next(i=>this.referenceDelegate.jr(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Hr(e,t){return C.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}}class tI extends kf{constructor(e){super(),this.currentSequenceNumber=e}}class Ya{constructor(e){this.persistence=e,this.Jr=new _c,this.Yr=null}static Zr(e){return new Ya(e)}get Xr(){if(this.Yr)return this.Yr;throw W()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),C.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),C.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),C.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(s=>this.Xr.add(s.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Xr.add(i.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return C.forEach(this.Xr,n=>{const s=K.fromPath(n);return this.ei(e,s).next(i=>{i||t.removeEntry(s,re.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(n=>{n?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return C.or([()=>C.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nI{constructor(e){this.serializer=e}O(e,t,n,s){const i=new Ua("createOrUpgrade",t);n<1&&s>=1&&(function(u){u.createObjectStore("owner")}(e),function(u){u.createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Dd,{unique:!0}),u.createObjectStore("documentMutations")}(e),bh(e),function(u){u.createObjectStore("remoteDocuments")}(e));let a=C.resolve();return n<3&&s>=3&&(n!==0&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(e),bh(e)),a=a.next(()=>function(u){const d=u.store("targetGlobal"),m={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:re.min().toTimestamp(),targetCount:0};return d.put("targetGlobalKey",m)}(i))),n<4&&s>=4&&(n!==0&&(a=a.next(()=>function(u,d){return d.store("mutations").U().next(m=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Dd,{unique:!0});const p=d.store("mutations"),x=m.map(b=>p.put(b));return C.waitFor(x)})}(e,i))),a=a.next(()=>{(function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),n<5&&s>=5&&(a=a.next(()=>this.ni(i))),n<6&&s>=6&&(a=a.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(e),this.ri(i)))),n<7&&s>=7&&(a=a.next(()=>this.ii(i))),n<8&&s>=8&&(a=a.next(()=>this.si(e,i))),n<9&&s>=9&&(a=a.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)})),n<10&&s>=10&&(a=a.next(()=>this.oi(i))),n<11&&s>=11&&(a=a.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&s>=12&&(a=a.next(()=>{(function(u){const d=u.createObjectStore("documentOverlays",{keyPath:P_});d.createIndex("collectionPathOverlayIndex",j_,{unique:!1}),d.createIndex("collectionGroupOverlayIndex",V_,{unique:!1})})(e)})),n<13&&s>=13&&(a=a.next(()=>function(u){const d=u.createObjectStore("remoteDocumentsV14",{keyPath:w_});d.createIndex("documentKeyIndex",I_),d.createIndex("collectionGroupIndex",T_)}(e)).next(()=>this._i(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&s>=14&&(a=a.next(()=>this.ai(e,i))),n<15&&s>=15&&(a=a.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:N_}).createIndex("sequenceNumberIndex",R_,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:C_}).createIndex("documentKeyIndex",D_,{unique:!1})}(e))),n<16&&s>=16&&(a=a.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),n<17&&s>=17&&(a=a.next(()=>{(function(u){u.createObjectStore("globals",{keyPath:"name"})})(e)})),a}ri(e){let t=0;return e.store("remoteDocuments").J((n,s)=>{t+=Ia(s)}).next(()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}ni(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next(s=>C.forEach(s,i=>{const a=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",a).next(c=>C.forEach(c,u=>{ee(u.userId===i.userId);const d=Gn(this.serializer,u);return kp(e,i.userId,d).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return n.J((a,c)=>{const u=new Te(a),d=function(p){return[0,dt(p)]}(u);i.push(t.get(d).next(m=>m?C.resolve():(p=>t.put({targetId:0,path:dt(p),sequenceNumber:s.highestListenSequenceNumber}))(u)))}).next(()=>C.waitFor(i))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:S_});const n=t.store("collectionParents"),s=new vc,i=a=>{if(s.add(a)){const c=a.lastSegment(),u=a.popLast();return n.put({collectionId:c,parent:dt(u)})}};return t.store("remoteDocuments").J({H:!0},(a,c)=>{const u=new Te(a);return i(u.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([a,c,u],d)=>{const m=Pt(c);return i(m.popLast())}))}oi(e){const t=e.store("targets");return t.J((n,s)=>{const i=Ns(s),a=wp(this.serializer,i);return t.put(a)})}_i(e,t){const n=t.store("remoteDocuments"),s=[];return n.J((i,a)=>{const c=t.store("remoteDocumentsV14"),u=function(p){return p.document?new K(Te.fromString(p.document.name).popFirst(5)):p.noDocument?K.fromSegments(p.noDocument.path):p.unknownDocument?K.fromSegments(p.unknownDocument.path):W()}(a).path.toArray(),d={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};s.push(c.put(d))}).next(()=>C.waitFor(s))}ai(e,t){const n=t.store("mutations"),s=Rp(this.serializer),i=new Dp(Ya.Zr,this.serializer.ct);return n.U().next(a=>{const c=new Map;return a.forEach(u=>{var d;let m=(d=c.get(u.userId))!==null&&d!==void 0?d:me();Gn(this.serializer,u).keys().forEach(p=>m=m.add(p)),c.set(u.userId,m)}),C.forEach(c,(u,d)=>{const m=new at(d),p=Wa.lt(this.serializer,m),x=i.getIndexManager(m),b=Qa.lt(m,this.serializer,x,i.referenceDelegate);return new Cp(s,b,p,x).recalculateAndSaveOverlaysForDocumentKeys(new ll(t,ft.oe),u).next()})})}}function bh(r){r.createObjectStore("targetDocuments",{keyPath:k_}).createIndex("documentTargetsIndex",A_,{unique:!0}),r.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",E_,{unique:!0}),r.createObjectStore("targetGlobal")}const Oo="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class wc{constructor(e,t,n,s,i,a,c,u,d,m,p=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ui=i,this.window=a,this.document=c,this.ci=d,this.li=m,this.hi=p,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=x=>Promise.resolve(),!wc.D())throw new B(M.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Gw(this,s),this.Ai=t+"main",this.serializer=new _p(u),this.Ri=new wn(this.Ai,this.hi,new nI(this.serializer)),this.$r=new Cw,this.Ur=new Fw(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Rp(this.serializer),this.Gr=new Rw,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,m===!1&&Be("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new B(M.FAILED_PRECONDITION,Oo);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new ft(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>$i(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(Rn(e))return F("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return F("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return ws(e).get("owner").next(t=>C.resolve(this.vi(t)))}Ci(e){return $i(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const n=Ye(t,"clientMetadata");return n.U().next(s=>{const i=this.xi(s,18e5),a=s.filter(c=>i.indexOf(c)===-1);return C.forEach(a,c=>n.delete(c.clientId)).next(()=>a)})}).catch(()=>[]);if(this.Vi)for(const t of e)this.Vi.removeItem(this.Oi(t.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?C.resolve(!0):ws(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new B(M.FAILED_PRECONDITION,Oo);return!1}}return!(!this.networkEnabled||!this.inForeground)||$i(e).U().next(n=>this.xi(n,5e3).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,a=!this.inForeground&&s.inForeground,c=this.networkEnabled===s.networkEnabled;if(i||a&&c)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&F("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new ll(e,ft.oe);return this.bi(t).next(()=>this.Ci(t))}),this.Ri.close(),this.qi()}xi(e,t){return e.filter(n=>this.Mi(n.updateTimeMs,t)&&!this.Ni(n.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>$i(e).U().next(t=>this.xi(t,18e5).map(n=>n.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return Qa.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Lw(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return Wa.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,n){F("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",i=function(u){return u===17?L_:u===16?M_:u===15?lc:u===14?Df:u===13?Cf:u===12?O_:u===11?Rf:void W()}(this.hi);let a;return this.Ri.runTransaction(e,s,i,c=>(a=new ll(c,this.Qr?this.Qr.next():ft.oe),t==="readwrite-primary"?this.wi(a).next(u=>!!u||this.Si(a)).next(u=>{if(!u)throw Be(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new B(M.FAILED_PRECONDITION,Ef);return n(a)}).next(u=>this.Di(a).next(()=>u)):this.Ki(a).next(()=>n(a)))).then(c=>(a.raiseOnCommittedEvent(),c))}Ki(e){return ws(e).get("owner").next(t=>{if(t!==null&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new B(M.FAILED_PRECONDITION,Oo)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return ws(e).put("owner",t)}static D(){return wn.D()}bi(e){const t=ws(e);return t.get("owner").next(n=>this.vi(n)?(F("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):C.resolve())}Mi(e,t){const n=Date.now();return!(e<n-t)&&(!(e>n)||(Be(`Detected an update time that is in the future: ${e} > ${n}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;Em()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const n=((t=this.Vi)===null||t===void 0?void 0:t.getItem(this.Oi(e)))!==null;return F("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return Be("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Be("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function ws(r){return Ye(r,"owner")}function $i(r){return Ye(r,"clientMetadata")}function Pp(r,e){let t=r.projectId;return r.isDefaultDatabase||(t+="."+r.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ic{constructor(e,t,n,s){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=s}static Wi(e,t){let n=me(),s=me();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Ic(e,t.fromCache,n,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rI{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jp{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return Em()?8:Af(Qe())>0?6:4}()}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,s){const i={result:null};return this.Yi(e,t).next(a=>{i.result=a}).next(()=>{if(!i.result)return this.Zi(e,t,s,n).next(a=>{i.result=a})}).next(()=>{if(i.result)return;const a=new rI;return this.Xi(e,t,a).next(c=>{if(i.result=c,this.zi)return this.es(e,t,a,c.size)})}).next(()=>i.result)}es(e,t,n,s){return n.documentReadCount<this.ji?(Ir()<=fe.DEBUG&&F("QueryEngine","SDK will not create cache indexes for query:",Tr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),C.resolve()):(Ir()<=fe.DEBUG&&F("QueryEngine","Query:",Tr(t),"scans",n.documentReadCount,"local documents and returns",s,"documents as results."),n.documentReadCount>this.Hi*s?(Ir()<=fe.DEBUG&&F("QueryEngine","The SDK decides to create cache indexes for query:",Tr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,wt(t))):C.resolve())}Yi(e,t){if(qd(t))return C.resolve(null);let n=wt(t);return this.indexManager.getIndexType(e,n).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=pl(t,null,"F"),n=wt(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(i=>{const a=me(...i);return this.Ji.getDocuments(e,a).next(c=>this.indexManager.getMinOffset(e,n).next(u=>{const d=this.ts(t,c);return this.ns(t,d,a,u.readTime)?this.Yi(e,pl(t,null,"F")):this.rs(e,d,t,u)}))})))}Zi(e,t,n,s){return qd(t)||s.isEqual(re.min())?C.resolve(null):this.Ji.getDocuments(e,n).next(i=>{const a=this.ts(t,i);return this.ns(t,a,n,s)?C.resolve(null):(Ir()<=fe.DEBUG&&F("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Tr(t)),this.rs(e,a,t,If(s,-1)).next(c=>c))})}ts(e,t){let n=new Se(Qf(e));return t.forEach((s,i)=>{gi(e,i)&&(n=n.add(i))}),n}ns(e,t,n,s){if(e.limit===null)return!1;if(n.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Xi(e,t,n){return Ir()<=fe.DEBUG&&F("QueryEngine","Using full collection scan to execute query:",Tr(t)),this.Ji.getDocumentsMatchingQuery(e,t,It.min(),n)}rs(e,t,n,s){return this.Ji.getDocumentsMatchingQuery(e,n,s).next(i=>(t.forEach(a=>{i=i.insert(a.key,a)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sI{constructor(e,t,n,s){this.persistence=e,this.ss=t,this.serializer=s,this.os=new Ce(ue),this._s=new Cn(i=>ir(i),pi),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Cp(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function Vp(r,e,t,n){return new sI(r,e,t,n)}async function Op(r,e){const t=Q(r);return await t.persistence.runTransaction("Handle user change","readonly",n=>{let s;return t.mutationQueue.getAllMutationBatches(n).next(i=>(s=i,t.ls(e),t.mutationQueue.getAllMutationBatches(n))).next(i=>{const a=[],c=[];let u=me();for(const d of s){a.push(d.batchId);for(const m of d.mutations)u=u.add(m.key)}for(const d of i){c.push(d.batchId);for(const m of d.mutations)u=u.add(m.key)}return t.localDocuments.getDocuments(n,u).next(d=>({hs:d,removedBatchIds:a,addedBatchIds:c}))})})}function iI(r,e){const t=Q(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const s=e.batch.keys(),i=t.cs.newChangeBuffer({trackRemovals:!0});return function(c,u,d,m){const p=d.batch,x=p.keys();let b=C.resolve();return x.forEach(w=>{b=b.next(()=>m.getEntry(u,w)).next(k=>{const N=d.docVersions.get(w);ee(N!==null),k.version.compareTo(N)<0&&(p.applyToRemoteDocument(k,d),k.isValidDocument()&&(k.setReadTime(d.commitVersion),m.addEntry(k)))})}),b.next(()=>c.mutationQueue.removeMutationBatch(u,p))}(t,n,e,i).next(()=>i.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(c){let u=me();for(let d=0;d<c.mutationResults.length;++d)c.mutationResults[d].transformResults.length>0&&(u=u.add(c.batch.mutations[d].key));return u}(e))).next(()=>t.localDocuments.getDocuments(n,s))})}function Mp(r){const e=Q(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function aI(r,e){const t=Q(r),n=e.snapshotVersion;let s=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const a=t.cs.newChangeBuffer({trackRemovals:!0});s=t.os;const c=[];e.targetChanges.forEach((m,p)=>{const x=s.get(p);if(!x)return;c.push(t.Ur.removeMatchingKeys(i,m.removedDocuments,p).next(()=>t.Ur.addMatchingKeys(i,m.addedDocuments,p)));let b=x.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(p)!==null?b=b.withResumeToken(ze.EMPTY_BYTE_STRING,re.min()).withLastLimboFreeSnapshotVersion(re.min()):m.resumeToken.approximateByteSize()>0&&(b=b.withResumeToken(m.resumeToken,n)),s=s.insert(p,b),function(k,N,D){return k.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=3e8?!0:D.addedDocuments.size+D.modifiedDocuments.size+D.removedDocuments.size>0}(x,b,m)&&c.push(t.Ur.updateTargetData(i,b))});let u=_t(),d=me();if(e.documentUpdates.forEach(m=>{e.resolvedLimboDocuments.has(m)&&c.push(t.persistence.referenceDelegate.updateLimboDocument(i,m))}),c.push(oI(i,a,e.documentUpdates).next(m=>{u=m.Ps,d=m.Is})),!n.isEqual(re.min())){const m=t.Ur.getLastRemoteSnapshotVersion(i).next(p=>t.Ur.setTargetsMetadata(i,i.currentSequenceNumber,n));c.push(m)}return C.waitFor(c).next(()=>a.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,u,d)).next(()=>u)}).then(i=>(t.os=s,i))}function oI(r,e,t){let n=me(),s=me();return t.forEach(i=>n=n.add(i)),e.getEntries(r,n).next(i=>{let a=_t();return t.forEach((c,u)=>{const d=i.get(c);u.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(c)),u.isNoDocument()&&u.version.isEqual(re.min())?(e.removeEntry(c,u.readTime),a=a.insert(c,u)):!d.isValidDocument()||u.version.compareTo(d.version)>0||u.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(u),a=a.insert(c,u)):F("LocalStore","Ignoring outdated watch update for ",c,". Current version:",d.version," Watch version:",u.version)}),{Ps:a,Is:s}})}function lI(r,e){const t=Q(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function Ta(r,e){const t=Q(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let s;return t.Ur.getTargetData(n,e).next(i=>i?(s=i,C.resolve(s)):t.Ur.allocateTargetId(n).next(a=>(s=new Wt(e,a,"TargetPurposeListen",n.currentSequenceNumber),t.Ur.addTargetData(n,s).next(()=>s))))}).then(n=>{const s=t.os.get(n.targetId);return(s===null||n.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.os=t.os.insert(n.targetId,n),t._s.set(e,n.targetId)),n})}async function $r(r,e,t){const n=Q(r),s=n.os.get(e),i=t?"readwrite":"readwrite-primary";try{t||await n.persistence.runTransaction("Release target",i,a=>n.persistence.referenceDelegate.removeTarget(a,s))}catch(a){if(!Rn(a))throw a;F("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}n.os=n.os.remove(e),n._s.delete(s.target)}function Il(r,e,t){const n=Q(r);let s=re.min(),i=me();return n.persistence.runTransaction("Execute query","readwrite",a=>function(u,d,m){const p=Q(u),x=p._s.get(m);return x!==void 0?C.resolve(p.os.get(x)):p.Ur.getTargetData(d,m)}(n,a,wt(e)).next(c=>{if(c)return s=c.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(a,c.targetId).next(u=>{i=u})}).next(()=>n.ss.getDocumentsMatchingQuery(a,e,t?s:re.min(),t?i:me())).next(c=>(Up(n,Wf(e),c),{documents:c,Ts:i})))}function Lp(r,e){const t=Q(r),n=Q(t.Ur),s=t.os.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>n.ot(i,e).next(a=>a?a.target:null))}function Fp(r,e){const t=Q(r),n=t.us.get(e)||re.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.cs.getAllFromCollectionGroup(s,e,If(n,-1),Number.MAX_SAFE_INTEGER)).then(s=>(Up(t,e,s),s))}function Up(r,e,t){let n=r.us.get(e)||re.min();t.forEach((s,i)=>{i.readTime.compareTo(n)>0&&(n=i.readTime)}),r.us.set(e,n)}function vh(r,e){return`firestore_clients_${r}_${e}`}function _h(r,e,t){let n=`firestore_mutations_${r}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}function Mo(r,e){return`firestore_targets_${r}_${e}`}class Ea{constructor(e,t,n,s){this.user=e,this.batchId=t,this.state=n,this.error=s}static Rs(e,t,n){const s=JSON.parse(n);let i,a=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return a&&s.error&&(a=typeof s.error.message=="string"&&typeof s.error.code=="string",a&&(i=new B(s.error.code,s.error.message))),a?new Ea(e,t,s.state,i):(Be("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ls{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Rs(e,t){const n=JSON.parse(t);let s,i=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return i&&n.error&&(i=typeof n.error.message=="string"&&typeof n.error.code=="string",i&&(s=new B(n.error.code,n.error.message))),i?new Ls(e,n.state,s):(Be("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ka{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const n=JSON.parse(t);let s=typeof n=="object"&&n.activeTargetIds instanceof Array,i=hc();for(let a=0;s&&a<n.activeTargetIds.length;++a)s=Sf(n.activeTargetIds[a]),i=i.add(n.activeTargetIds[a]);return s?new ka(e,i):(Be("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Tc{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Tc(t.clientId,t.onlineState):(Be("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Tl{constructor(){this.activeTargetIds=hc()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Lo{constructor(e,t,n,s,i){this.window=e,this.ui=t,this.persistenceKey=n,this.ps=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Ce(ue),this.started=!1,this.bs=[];const a=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ds=vh(this.persistenceKey,this.ps),this.vs=function(u){return`firestore_sequence_number_${u}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new Tl),this.Cs=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.xs=function(u){return`firestore_online_state_${u}`}(this.persistenceKey),this.Os=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const n of e){if(n===this.ps)continue;const s=this.getItem(vh(this.persistenceKey,n));if(s){const i=ka.Rs(n,s);i&&(this.Ss=this.Ss.insert(i.clientId,i))}}this.Ns();const t=this.storage.getItem(this.xs);if(t){const n=this.Ls(t);n&&this.Bs(n)}for(const n of this.bs)this.ws(n);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((n,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,n){this.qs(e,t,n),this.Qs(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){const s=this.storage.getItem(Mo(this.persistenceKey,e));if(s){const i=Ls.Rs(e,s);i&&(n=i.state)}}return t&&this.Ks.fs(e),this.Ns(),n}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Mo(this.persistenceKey,e))}updateQueryState(e,t,n){this.$s(e,t,n)}handleUserChange(e,t,n){t.forEach(s=>{this.Qs(s)}),this.currentUser=e,n.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return F("SharedClientState","READ",e,t),t}setItem(e,t){F("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){F("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const t=e;if(t.storageArea===this.storage){if(F("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Ds)return void Be("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Cs.test(t.key)){if(t.newValue==null){const n=this.Gs(t.key);return this.zs(n,null)}{const n=this.js(t.key,t.newValue);if(n)return this.zs(n.clientId,n)}}else if(this.Fs.test(t.key)){if(t.newValue!==null){const n=this.Hs(t.key,t.newValue);if(n)return this.Js(n)}}else if(this.Ms.test(t.key)){if(t.newValue!==null){const n=this.Ys(t.key,t.newValue);if(n)return this.Zs(n)}}else if(t.key===this.xs){if(t.newValue!==null){const n=this.Ls(t.newValue);if(n)return this.Bs(n)}}else if(t.key===this.vs){const n=function(i){let a=ft.oe;if(i!=null)try{const c=JSON.parse(i);ee(typeof c=="number"),a=c}catch(c){Be("SharedClientState","Failed to read sequence number from WebStorage",c)}return a}(t.newValue);n!==ft.oe&&this.sequenceNumberHandler(n)}else if(t.key===this.Os){const n=this.Xs(t.newValue);await Promise.all(n.map(s=>this.syncEngine.eo(s)))}}}else this.bs.push(t)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,n){const s=new Ea(this.currentUser,e,t,n),i=_h(this.persistenceKey,this.currentUser,e);this.setItem(i,s.Vs())}Qs(e){const t=_h(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){const t={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(t))}$s(e,t,n){const s=Mo(this.persistenceKey,e),i=new Ls(e,t,n);this.setItem(s,i.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const n=this.Gs(e);return ka.Rs(n,t)}Hs(e,t){const n=this.Fs.exec(e),s=Number(n[1]),i=n[2]!==void 0?n[2]:null;return Ea.Rs(new at(i),s,t)}Ys(e,t){const n=this.Ms.exec(e),s=Number(n[1]);return Ls.Rs(s,t)}Ls(e){return Tc.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);F("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const n=t?this.Ss.insert(e,t):this.Ss.remove(e),s=this.ks(this.Ss),i=this.ks(n),a=[],c=[];return i.forEach(u=>{s.has(u)||a.push(u)}),s.forEach(u=>{i.has(u)||c.push(u)}),this.syncEngine.io(a,c).then(()=>{this.Ss=n})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=hc();return e.forEach((n,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class Bp{constructor(){this.so=new Tl,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Tl,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cI{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wh{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){F("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){F("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gi=null;function Fo(){return Gi===null?Gi=function(){return 268435456+Math.round(2147483648*Math.random())}():Gi++,"0x"+Gi.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uI={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dI{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const it="WebChannelConnection";class hI extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+t.host,this.vo=`projects/${s}/databases/${i}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${i}`}get Fo(){return!1}Mo(t,n,s,i,a){const c=Fo(),u=this.xo(t,n.toUriEncodedString());F("RestConnection",`Sending RPC '${t}' ${c}:`,u,s);const d={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(d,i,a),this.No(t,u,d,s).then(m=>(F("RestConnection",`Received RPC '${t}' ${c}: `,m),m),m=>{throw Hs("RestConnection",`RPC '${t}' ${c} failed with error: `,m,"url: ",u,"request:",s),m})}Lo(t,n,s,i,a,c){return this.Mo(t,n,s,i,a)}Oo(t,n,s){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Xr}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((i,a)=>t[a]=i),s&&s.headers.forEach((i,a)=>t[a]=i)}xo(t,n){const s=uI[t];return`${this.Do}/v1/${n}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,s){const i=Fo();return new Promise((a,c)=>{const u=new gf;u.setWithCredentials(!0),u.listenOnce(xf.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Yi.NO_ERROR:const m=u.getResponseJson();F(it,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(m)),a(m);break;case Yi.TIMEOUT:F(it,`RPC '${e}' ${i} timed out`),c(new B(M.DEADLINE_EXCEEDED,"Request time out"));break;case Yi.HTTP_ERROR:const p=u.getStatus();if(F(it,`RPC '${e}' ${i} failed with status:`,p,"response text:",u.getResponseText()),p>0){let x=u.getResponseJson();Array.isArray(x)&&(x=x[0]);const b=x==null?void 0:x.error;if(b&&b.status&&b.message){const w=function(N){const D=N.toLowerCase().replace(/_/g,"-");return Object.values(M).indexOf(D)>=0?D:M.UNKNOWN}(b.status);c(new B(w,b.message))}else c(new B(M.UNKNOWN,"Server responded with status "+u.getStatus()))}else c(new B(M.UNAVAILABLE,"Connection failed."));break;default:W()}}finally{F(it,`RPC '${e}' ${i} completed.`)}});const d=JSON.stringify(s);F(it,`RPC '${e}' ${i} sending request:`,s),u.send(t,"POST",d,n,15)})}Bo(e,t,n){const s=Fo(),i=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=vf(),c=bf(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(u.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Oo(u.initMessageHeaders,t,n),u.encodeInitMessageHeaders=!0;const m=i.join("");F(it,`Creating RPC '${e}' stream ${s}: ${m}`,u);const p=a.createWebChannel(m,u);let x=!1,b=!1;const w=new dI({Io:N=>{b?F(it,`Not sending because RPC '${e}' stream ${s} is closed:`,N):(x||(F(it,`Opening RPC '${e}' stream ${s} transport.`),p.open(),x=!0),F(it,`RPC '${e}' stream ${s} sending:`,N),p.send(N))},To:()=>p.close()}),k=(N,D,V)=>{N.listen(D,P=>{try{V(P)}catch(U){setTimeout(()=>{throw U},0)}})};return k(p,ks.EventType.OPEN,()=>{b||(F(it,`RPC '${e}' stream ${s} transport opened.`),w.yo())}),k(p,ks.EventType.CLOSE,()=>{b||(b=!0,F(it,`RPC '${e}' stream ${s} transport closed`),w.So())}),k(p,ks.EventType.ERROR,N=>{b||(b=!0,Hs(it,`RPC '${e}' stream ${s} transport errored:`,N),w.So(new B(M.UNAVAILABLE,"The operation could not be completed")))}),k(p,ks.EventType.MESSAGE,N=>{var D;if(!b){const V=N.data[0];ee(!!V);const P=V,U=P.error||((D=P[0])===null||D===void 0?void 0:D.error);if(U){F(it,`RPC '${e}' stream ${s} received error:`,U);const L=U.status;let G=function(v){const E=Ge[v];if(E!==void 0)return op(E)}(L),I=U.message;G===void 0&&(G=M.INTERNAL,I="Unknown error status: "+L+" with message "+U.message),b=!0,w.So(new B(G,I)),p.close()}else F(it,`RPC '${e}' stream ${s} received:`,V),w.bo(V)}}),k(c,yf.STAT_EVENT,N=>{N.stat===al.PROXY?F(it,`RPC '${e}' stream ${s} detected buffering proxy`):N.stat===al.NOPROXY&&F(it,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{w.wo()},0),w}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zp(){return typeof window<"u"?window:null}function ra(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ja(r){return new bw(r,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $p{constructor(e,t,n=1e3,s=1.5,i=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=s,this.Qo=i,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),s=Math.max(0,t-n);s>0&&F("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gp{constructor(e,t,n,s,i,a,c,u){this.ui=e,this.Ho=n,this.Jo=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=c,this.listener=u,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new $p(e,t)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,t){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():t&&t.code===M.RESOURCE_EXHAUSTED?(Be(t.toString()),Be("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):t&&t.code===M.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(t)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,s])=>{this.Yo===t&&this.P_(n,s)},n=>{e(()=>{const s=new B(M.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(s)})})}P_(e,t){const n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{n(()=>this.I_(s))}),this.stream.onMessage(s=>{n(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return F("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(F("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class mI extends Gp{constructor(e,t,n,s,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,s,a),this.serializer=i}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=ww(this.serializer,e),n=function(i){if(!("targetChange"in i))return re.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?re.min():a.readTime?ht(a.readTime):re.min()}(e);return this.listener.d_(t,n)}A_(e){const t={};t.database=yl(this.serializer),t.addTarget=function(i,a){let c;const u=a.target;if(c=xa(u)?{documents:pp(i,u)}:{query:gp(i,u)._t},c.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){c.resumeToken=up(i,a.resumeToken);const d=gl(i,a.expectedCount);d!==null&&(c.expectedCount=d)}else if(a.snapshotVersion.compareTo(re.min())>0){c.readTime=zr(i,a.snapshotVersion.toTimestamp());const d=gl(i,a.expectedCount);d!==null&&(c.expectedCount=d)}return c}(this.serializer,e);const n=Tw(this.serializer,e);n&&(t.labels=n),this.a_(t)}R_(e){const t={};t.database=yl(this.serializer),t.removeTarget=e,this.a_(t)}}class fI extends Gp{constructor(e,t,n,s,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,s,a),this.serializer=i}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return ee(!!e.streamToken),this.lastStreamToken=e.streamToken,ee(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){ee(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=Iw(e.writeResults,e.commitTime),n=ht(e.commitTime);return this.listener.g_(n,t)}p_(){const e={};e.database=yl(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>va(this.serializer,n))};this.a_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pI extends class{}{constructor(e,t,n,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new B(M.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.Mo(e,xl(t,n),s,i,a)).catch(i=>{throw i.name==="FirebaseError"?(i.code===M.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new B(M.UNKNOWN,i.toString())})}Lo(e,t,n,s,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,c])=>this.connection.Lo(e,xl(t,n),s,a,c,i)).catch(a=>{throw a.name==="FirebaseError"?(a.code===M.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new B(M.UNKNOWN,a.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class gI{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Be(t),this.D_=!1):F("OnlineStateTracker",t)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xI{constructor(e,t,n,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=i,this.k_._o(a=>{n.enqueueAndForget(async()=>{dr(this)&&(F("RemoteStore","Restarting streams for network reachability change."),await async function(u){const d=Q(u);d.L_.add(4),await bi(d),d.q_.set("Unknown"),d.L_.delete(4),await Xa(d)}(this))})}),this.q_=new gI(n,s)}}async function Xa(r){if(dr(r))for(const e of r.B_)await e(!0)}async function bi(r){for(const e of r.B_)await e(!1)}function Za(r,e){const t=Q(r);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),Ac(t)?kc(t):ns(t).r_()&&Ec(t,e))}function Gr(r,e){const t=Q(r),n=ns(t);t.N_.delete(e),n.r_()&&qp(t,e),t.N_.size===0&&(n.r_()?n.o_():dr(t)&&t.q_.set("Unknown"))}function Ec(r,e){if(r.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(re.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ns(r).A_(e)}function qp(r,e){r.Q_.xe(e),ns(r).R_(e)}function kc(r){r.Q_=new pw({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>r.N_.get(e)||null,tt:()=>r.datastore.serializer.databaseId}),ns(r).start(),r.q_.v_()}function Ac(r){return dr(r)&&!ns(r).n_()&&r.N_.size>0}function dr(r){return Q(r).L_.size===0}function Kp(r){r.Q_=void 0}async function yI(r){r.q_.set("Online")}async function bI(r){r.N_.forEach((e,t)=>{Ec(r,e)})}async function vI(r,e){Kp(r),Ac(r)?(r.q_.M_(e),kc(r)):r.q_.set("Unknown")}async function _I(r,e,t){if(r.q_.set("Online"),e instanceof cp&&e.state===2&&e.cause)try{await async function(s,i){const a=i.cause;for(const c of i.targetIds)s.N_.has(c)&&(await s.remoteSyncer.rejectListen(c,a),s.N_.delete(c),s.Q_.removeTarget(c))}(r,e)}catch(n){F("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Aa(r,n)}else if(e instanceof na?r.Q_.Ke(e):e instanceof lp?r.Q_.He(e):r.Q_.We(e),!t.isEqual(re.min()))try{const n=await Mp(r.localStore);t.compareTo(n)>=0&&await function(i,a){const c=i.Q_.rt(a);return c.targetChanges.forEach((u,d)=>{if(u.resumeToken.approximateByteSize()>0){const m=i.N_.get(d);m&&i.N_.set(d,m.withResumeToken(u.resumeToken,a))}}),c.targetMismatches.forEach((u,d)=>{const m=i.N_.get(u);if(!m)return;i.N_.set(u,m.withResumeToken(ze.EMPTY_BYTE_STRING,m.snapshotVersion)),qp(i,u);const p=new Wt(m.target,u,d,m.sequenceNumber);Ec(i,p)}),i.remoteSyncer.applyRemoteEvent(c)}(r,t)}catch(n){F("RemoteStore","Failed to raise snapshot:",n),await Aa(r,n)}}async function Aa(r,e,t){if(!Rn(e))throw e;r.L_.add(1),await bi(r),r.q_.set("Offline"),t||(t=()=>Mp(r.localStore)),r.asyncQueue.enqueueRetryable(async()=>{F("RemoteStore","Retrying IndexedDB access"),await t(),r.L_.delete(1),await Xa(r)})}function Hp(r,e){return e().catch(t=>Aa(r,t,e))}async function ts(r){const e=Q(r),t=An(e);let n=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;wI(e);)try{const s=await lI(e.localStore,n);if(s===null){e.O_.length===0&&t.o_();break}n=s.batchId,II(e,s)}catch(s){await Aa(e,s)}Wp(e)&&Qp(e)}function wI(r){return dr(r)&&r.O_.length<10}function II(r,e){r.O_.push(e);const t=An(r);t.r_()&&t.V_&&t.m_(e.mutations)}function Wp(r){return dr(r)&&!An(r).n_()&&r.O_.length>0}function Qp(r){An(r).start()}async function TI(r){An(r).p_()}async function EI(r){const e=An(r);for(const t of r.O_)e.m_(t.mutations)}async function kI(r,e,t){const n=r.O_.shift(),s=pc.from(n,e,t);await Hp(r,()=>r.remoteSyncer.applySuccessfulWrite(s)),await ts(r)}async function AI(r,e){e&&An(r).V_&&await async function(n,s){if(function(a){return hw(a)&&a!==M.ABORTED}(s.code)){const i=n.O_.shift();An(n).s_(),await Hp(n,()=>n.remoteSyncer.rejectFailedWrite(i.batchId,s)),await ts(n)}}(r,e),Wp(r)&&Qp(r)}async function Ih(r,e){const t=Q(r);t.asyncQueue.verifyOperationInProgress(),F("RemoteStore","RemoteStore received new credentials");const n=dr(t);t.L_.add(3),await bi(t),n&&t.q_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),await Xa(t)}async function El(r,e){const t=Q(r);e?(t.L_.delete(2),await Xa(t)):e||(t.L_.add(2),await bi(t),t.q_.set("Unknown"))}function ns(r){return r.K_||(r.K_=function(t,n,s){const i=Q(t);return i.w_(),new mI(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(r.datastore,r.asyncQueue,{Eo:yI.bind(null,r),Ro:bI.bind(null,r),mo:vI.bind(null,r),d_:_I.bind(null,r)}),r.B_.push(async e=>{e?(r.K_.s_(),Ac(r)?kc(r):r.q_.set("Unknown")):(await r.K_.stop(),Kp(r))})),r.K_}function An(r){return r.U_||(r.U_=function(t,n,s){const i=Q(t);return i.w_(),new fI(n,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(r.datastore,r.asyncQueue,{Eo:()=>Promise.resolve(),Ro:TI.bind(null,r),mo:AI.bind(null,r),f_:EI.bind(null,r),g_:kI.bind(null,r)}),r.B_.push(async e=>{e?(r.U_.s_(),await ts(r)):(await r.U_.stop(),r.O_.length>0&&(F("RemoteStore",`Stopping write stream with ${r.O_.length} pending writes`),r.O_=[]))})),r.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sc{constructor(e,t,n,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=s,this.removalCallback=i,this.deferred=new Jt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,s,i){const a=Date.now()+n,c=new Sc(e,t,a,s,i);return c.start(n),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new B(M.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Nc(r,e){if(Be("AsyncQueue",`${e}: ${r}`),Rn(r))return new B(M.UNAVAILABLE,`${e}: ${r}`);throw r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pr{constructor(e){this.comparator=e?(t,n)=>e(t,n)||K.comparator(t.key,n.key):(t,n)=>K.comparator(t.key,n.key),this.keyedMap=As(),this.sortedSet=new Ce(this.comparator)}static emptySet(e){return new Pr(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Pr)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=n.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const n=new Pr;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Th{constructor(){this.W_=new Ce(K.comparator)}track(e){const t=e.doc.key,n=this.W_.get(t);n?e.type!==0&&n.type===3?this.W_=this.W_.insert(t,e):e.type===3&&n.type!==1?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.W_=this.W_.remove(t):e.type===1&&n.type===2?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):W():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}}class qr{constructor(e,t,n,s,i,a,c,u,d){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=c,this.excludesMetadataChanges=u,this.hasCachedResults=d}static fromInitialDocuments(e,t,n,s,i){const a=[];return t.forEach(c=>{a.push({type:0,doc:c})}),new qr(e,t,Pr.emptySet(t),a,n,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ga(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==n[s].type||!t[s].doc.isEqual(n[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SI{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class NI{constructor(){this.queries=Eh(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(t,n){const s=Q(t),i=s.queries;s.queries=Eh(),i.forEach((a,c)=>{for(const u of c.j_)u.onError(n)})})(this,new B(M.ABORTED,"Firestore shutting down"))}}function Eh(){return new Cn(r=>Hf(r),Ga)}async function Yp(r,e){const t=Q(r);let n=3;const s=e.query;let i=t.queries.get(s);i?!i.H_()&&e.J_()&&(n=2):(i=new SI,n=e.J_()?0:1);try{switch(n){case 0:i.z_=await t.onListen(s,!0);break;case 1:i.z_=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(a){const c=Nc(a,`Initialization of query '${Tr(e.query)}' failed`);return void e.onError(c)}t.queries.set(s,i),i.j_.push(e),e.Z_(t.onlineState),i.z_&&e.X_(i.z_)&&Rc(t)}async function Jp(r,e){const t=Q(r),n=e.query;let s=3;const i=t.queries.get(n);if(i){const a=i.j_.indexOf(e);a>=0&&(i.j_.splice(a,1),i.j_.length===0?s=e.J_()?0:1:!i.H_()&&e.J_()&&(s=2))}switch(s){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}}function RI(r,e){const t=Q(r);let n=!1;for(const s of e){const i=s.query,a=t.queries.get(i);if(a){for(const c of a.j_)c.X_(s)&&(n=!0);a.z_=s}}n&&Rc(t)}function CI(r,e,t){const n=Q(r),s=n.queries.get(e);if(s)for(const i of s.j_)i.onError(t);n.queries.delete(e)}function Rc(r){r.Y_.forEach(e=>{e.next()})}var kl,kh;(kh=kl||(kl={})).ea="default",kh.Cache="cache";class Xp{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){const n=[];for(const s of e.docChanges)s.type!==3&&n.push(s);e=new qr(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){if(!e.fromCache||!this.J_())return!0;const n=t!=="Offline";return(!this.options._a||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const t=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}oa(e){e=qr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==kl.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zp{constructor(e){this.key=e}}class eg{constructor(e){this.key=e}}class DI{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=me(),this.mutatedKeys=me(),this.Aa=Qf(e),this.Ra=new Pr(this.Aa)}get Va(){return this.Ta}ma(e,t){const n=t?t.fa:new Th,s=t?t.Ra:this.Ra;let i=t?t.mutatedKeys:this.mutatedKeys,a=s,c=!1;const u=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((m,p)=>{const x=s.get(m),b=gi(this.query,p)?p:null,w=!!x&&this.mutatedKeys.has(x.key),k=!!b&&(b.hasLocalMutations||this.mutatedKeys.has(b.key)&&b.hasCommittedMutations);let N=!1;x&&b?x.data.isEqual(b.data)?w!==k&&(n.track({type:3,doc:b}),N=!0):this.ga(x,b)||(n.track({type:2,doc:b}),N=!0,(u&&this.Aa(b,u)>0||d&&this.Aa(b,d)<0)&&(c=!0)):!x&&b?(n.track({type:0,doc:b}),N=!0):x&&!b&&(n.track({type:1,doc:x}),N=!0,(u||d)&&(c=!0)),N&&(b?(a=a.add(b),i=k?i.add(m):i.delete(m)):(a=a.delete(m),i=i.delete(m)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const m=this.query.limitType==="F"?a.last():a.first();a=a.delete(m.key),i=i.delete(m.key),n.track({type:1,doc:m})}return{Ra:a,fa:n,ns:c,mutatedKeys:i}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,s){const i=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const a=e.fa.G_();a.sort((m,p)=>function(b,w){const k=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return W()}};return k(b)-k(w)}(m.type,p.type)||this.Aa(m.doc,p.doc)),this.pa(n),s=s!=null&&s;const c=t&&!s?this.ya():[],u=this.da.size===0&&this.current&&!s?1:0,d=u!==this.Ea;return this.Ea=u,a.length!==0||d?{snapshot:new qr(this.query,e.Ra,i,a,e.mutatedKeys,u===0,d,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:c}:{wa:c}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new Th,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=me(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});const t=[];return e.forEach(n=>{this.da.has(n)||t.push(new eg(n))}),this.da.forEach(n=>{e.has(n)||t.push(new Zp(n))}),t}ba(e){this.Ta=e.Ts,this.da=me();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return qr.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class PI{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class jI{constructor(e){this.key=e,this.va=!1}}class VI{constructor(e,t,n,s,i,a){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Ca={},this.Fa=new Cn(c=>Hf(c),Ga),this.Ma=new Map,this.xa=new Set,this.Oa=new Ce(K.comparator),this.Na=new Map,this.La=new _c,this.Ba={},this.ka=new Map,this.qa=lr.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function OI(r,e,t=!0){const n=eo(r);let s;const i=n.Fa.get(e);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.Da()):s=await tg(n,e,t,!0),s}async function MI(r,e){const t=eo(r);await tg(t,e,!0,!1)}async function tg(r,e,t,n){const s=await Ta(r.localStore,wt(e)),i=s.targetId,a=r.sharedClientState.addLocalQueryTarget(i,t);let c;return n&&(c=await Cc(r,e,i,a==="current",s.resumeToken)),r.isPrimaryClient&&t&&Za(r.remoteStore,s),c}async function Cc(r,e,t,n,s){r.Ka=(p,x,b)=>async function(k,N,D,V){let P=N.view.ma(D);P.ns&&(P=await Il(k.localStore,N.query,!1).then(({documents:I})=>N.view.ma(I,P)));const U=V&&V.targetChanges.get(N.targetId),L=V&&V.targetMismatches.get(N.targetId)!=null,G=N.view.applyChanges(P,k.isPrimaryClient,U,L);return Al(k,N.targetId,G.wa),G.snapshot}(r,p,x,b);const i=await Il(r.localStore,e,!0),a=new DI(e,i.Ts),c=a.ma(i.documents),u=yi.createSynthesizedTargetChangeForCurrentChange(t,n&&r.onlineState!=="Offline",s),d=a.applyChanges(c,r.isPrimaryClient,u);Al(r,t,d.wa);const m=new PI(e,t,a);return r.Fa.set(e,m),r.Ma.has(t)?r.Ma.get(t).push(e):r.Ma.set(t,[e]),d.snapshot}async function LI(r,e,t){const n=Q(r),s=n.Fa.get(e),i=n.Ma.get(s.targetId);if(i.length>1)return n.Ma.set(s.targetId,i.filter(a=>!Ga(a,e))),void n.Fa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await $r(n.localStore,s.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(s.targetId),t&&Gr(n.remoteStore,s.targetId),Kr(n,s.targetId)}).catch(Nn)):(Kr(n,s.targetId),await $r(n.localStore,s.targetId,!0))}async function FI(r,e){const t=Q(r),n=t.Fa.get(e),s=t.Ma.get(n.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Gr(t.remoteStore,n.targetId))}async function UI(r,e,t){const n=Vc(r);try{const s=await function(a,c){const u=Q(a),d=_e.now(),m=c.reduce((b,w)=>b.add(w.key),me());let p,x;return u.persistence.runTransaction("Locally write mutations","readwrite",b=>{let w=_t(),k=me();return u.cs.getEntries(b,m).next(N=>{w=N,w.forEach((D,V)=>{V.isValidDocument()||(k=k.add(D))})}).next(()=>u.localDocuments.getOverlayedDocuments(b,w)).next(N=>{p=N;const D=[];for(const V of c){const P=uw(V,p.get(V.key).overlayedDocument);P!=null&&D.push(new an(V.key,P,Mf(P.value.mapValue),lt.exists(!0)))}return u.mutationQueue.addMutationBatch(b,d,D,c)}).next(N=>{x=N;const D=N.applyToLocalDocumentSet(p,k);return u.documentOverlayCache.saveOverlays(b,N.batchId,D)})}).then(()=>({batchId:x.batchId,changes:Jf(p)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(s.batchId),function(a,c,u){let d=a.Ba[a.currentUser.toKey()];d||(d=new Ce(ue)),d=d.insert(c,u),a.Ba[a.currentUser.toKey()]=d}(n,s.batchId,t),await Dn(n,s.changes),await ts(n.remoteStore)}catch(s){const i=Nc(s,"Failed to persist write");t.reject(i)}}async function ng(r,e){const t=Q(r);try{const n=await aI(t.localStore,e);e.targetChanges.forEach((s,i)=>{const a=t.Na.get(i);a&&(ee(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?a.va=!0:s.modifiedDocuments.size>0?ee(a.va):s.removedDocuments.size>0&&(ee(a.va),a.va=!1))}),await Dn(t,n,e)}catch(n){await Nn(n)}}function Ah(r,e,t){const n=Q(r);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){const s=[];n.Fa.forEach((i,a)=>{const c=a.view.Z_(e);c.snapshot&&s.push(c.snapshot)}),function(a,c){const u=Q(a);u.onlineState=c;let d=!1;u.queries.forEach((m,p)=>{for(const x of p.j_)x.Z_(c)&&(d=!0)}),d&&Rc(u)}(n.eventManager,e),s.length&&n.Ca.d_(s),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}async function BI(r,e,t){const n=Q(r);n.sharedClientState.updateQueryState(e,"rejected",t);const s=n.Na.get(e),i=s&&s.key;if(i){let a=new Ce(K.comparator);a=a.insert(i,Ue.newNoDocument(i,re.min()));const c=me().add(i),u=new xi(re.min(),new Map,new Ce(ue),a,c);await ng(n,u),n.Oa=n.Oa.remove(i),n.Na.delete(e),jc(n)}else await $r(n.localStore,e,!1).then(()=>Kr(n,e,t)).catch(Nn)}async function zI(r,e){const t=Q(r),n=e.batch.batchId;try{const s=await iI(t.localStore,e);Pc(t,n,null),Dc(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),await Dn(t,s)}catch(s){await Nn(s)}}async function $I(r,e,t){const n=Q(r);try{const s=await function(a,c){const u=Q(a);return u.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let m;return u.mutationQueue.lookupMutationBatch(d,c).next(p=>(ee(p!==null),m=p.keys(),u.mutationQueue.removeMutationBatch(d,p))).next(()=>u.mutationQueue.performConsistencyCheck(d)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(d,m,c)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,m)).next(()=>u.localDocuments.getDocuments(d,m))})}(n.localStore,e);Pc(n,e,t),Dc(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),await Dn(n,s)}catch(s){await Nn(s)}}function Dc(r,e){(r.ka.get(e)||[]).forEach(t=>{t.resolve()}),r.ka.delete(e)}function Pc(r,e,t){const n=Q(r);let s=n.Ba[n.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),n.Ba[n.currentUser.toKey()]=s}}function Kr(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Ma.get(e))r.Fa.delete(n),t&&r.Ca.$a(n,t);r.Ma.delete(e),r.isPrimaryClient&&r.La.gr(e).forEach(n=>{r.La.containsKey(n)||rg(r,n)})}function rg(r,e){r.xa.delete(e.path.canonicalString());const t=r.Oa.get(e);t!==null&&(Gr(r.remoteStore,t),r.Oa=r.Oa.remove(e),r.Na.delete(t),jc(r))}function Al(r,e,t){for(const n of t)n instanceof Zp?(r.La.addReference(n.key,e),GI(r,n)):n instanceof eg?(F("SyncEngine","Document no longer in limbo: "+n.key),r.La.removeReference(n.key,e),r.La.containsKey(n.key)||rg(r,n.key)):W()}function GI(r,e){const t=e.key,n=t.path.canonicalString();r.Oa.get(t)||r.xa.has(n)||(F("SyncEngine","New document in limbo: "+t),r.xa.add(n),jc(r))}function jc(r){for(;r.xa.size>0&&r.Oa.size<r.maxConcurrentLimboResolutions;){const e=r.xa.values().next().value;r.xa.delete(e);const t=new K(Te.fromString(e)),n=r.qa.next();r.Na.set(n,new jI(t)),r.Oa=r.Oa.insert(t,n),Za(r.remoteStore,new Wt(wt($a(t.path)),n,"TargetPurposeLimboResolution",ft.oe))}}async function Dn(r,e,t){const n=Q(r),s=[],i=[],a=[];n.Fa.isEmpty()||(n.Fa.forEach((c,u)=>{a.push(n.Ka(u,e,t).then(d=>{var m;if((d||t)&&n.isPrimaryClient){const p=d?!d.fromCache:(m=t==null?void 0:t.targetChanges.get(u.targetId))===null||m===void 0?void 0:m.current;n.sharedClientState.updateQueryState(u.targetId,p?"current":"not-current")}if(d){s.push(d);const p=Ic.Wi(u.targetId,d);i.push(p)}}))}),await Promise.all(a),n.Ca.d_(s),await async function(u,d){const m=Q(u);try{await m.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>C.forEach(d,x=>C.forEach(x.$i,b=>m.persistence.referenceDelegate.addReference(p,x.targetId,b)).next(()=>C.forEach(x.Ui,b=>m.persistence.referenceDelegate.removeReference(p,x.targetId,b)))))}catch(p){if(!Rn(p))throw p;F("LocalStore","Failed to update sequence numbers: "+p)}for(const p of d){const x=p.targetId;if(!p.fromCache){const b=m.os.get(x),w=b.snapshotVersion,k=b.withLastLimboFreeSnapshotVersion(w);m.os=m.os.insert(x,k)}}}(n.localStore,i))}async function qI(r,e){const t=Q(r);if(!t.currentUser.isEqual(e)){F("SyncEngine","User change. New user:",e.toKey());const n=await Op(t.localStore,e);t.currentUser=e,function(i,a){i.ka.forEach(c=>{c.forEach(u=>{u.reject(new B(M.CANCELLED,a))})}),i.ka.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),await Dn(t,n.hs)}}function KI(r,e){const t=Q(r),n=t.Na.get(e);if(n&&n.va)return me().add(n.key);{let s=me();const i=t.Ma.get(e);if(!i)return s;for(const a of i){const c=t.Fa.get(a);s=s.unionWith(c.view.Va)}return s}}async function HI(r,e){const t=Q(r),n=await Il(t.localStore,e.query,!0),s=e.view.ba(n);return t.isPrimaryClient&&Al(t,e.targetId,s.wa),s}async function WI(r,e){const t=Q(r);return Fp(t.localStore,e).then(n=>Dn(t,n))}async function QI(r,e,t,n){const s=Q(r),i=await function(c,u){const d=Q(c),m=Q(d.mutationQueue);return d.persistence.runTransaction("Lookup mutation documents","readonly",p=>m.Mn(p,u).next(x=>x?d.localDocuments.getDocuments(p,x):C.resolve(null)))}(s.localStore,e);i!==null?(t==="pending"?await ts(s.remoteStore):t==="acknowledged"||t==="rejected"?(Pc(s,e,n||null),Dc(s,e),function(c,u){Q(Q(c).mutationQueue).On(u)}(s.localStore,e)):W(),await Dn(s,i)):F("SyncEngine","Cannot apply mutation batch with id: "+e)}async function YI(r,e){const t=Q(r);if(eo(t),Vc(t),e===!0&&t.Qa!==!0){const n=t.sharedClientState.getAllActiveQueryTargets(),s=await Sh(t,n.toArray());t.Qa=!0,await El(t.remoteStore,!0);for(const i of s)Za(t.remoteStore,i)}else if(e===!1&&t.Qa!==!1){const n=[];let s=Promise.resolve();t.Ma.forEach((i,a)=>{t.sharedClientState.isLocalQueryTarget(a)?n.push(a):s=s.then(()=>(Kr(t,a),$r(t.localStore,a,!0))),Gr(t.remoteStore,a)}),await s,await Sh(t,n),function(a){const c=Q(a);c.Na.forEach((u,d)=>{Gr(c.remoteStore,d)}),c.La.pr(),c.Na=new Map,c.Oa=new Ce(K.comparator)}(t),t.Qa=!1,await El(t.remoteStore,!1)}}async function Sh(r,e,t){const n=Q(r),s=[],i=[];for(const a of e){let c;const u=n.Ma.get(a);if(u&&u.length!==0){c=await Ta(n.localStore,wt(u[0]));for(const d of u){const m=n.Fa.get(d),p=await HI(n,m);p.snapshot&&i.push(p.snapshot)}}else{const d=await Lp(n.localStore,a);c=await Ta(n.localStore,d),await Cc(n,sg(d),a,!1,c.resumeToken)}s.push(c)}return n.Ca.d_(i),s}function sg(r){return qf(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function JI(r){return function(t){return Q(Q(t).persistence).Qi()}(Q(r).localStore)}async function XI(r,e,t,n){const s=Q(r);if(s.Qa)return void F("SyncEngine","Ignoring unexpected query state notification.");const i=s.Ma.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const a=await Fp(s.localStore,Wf(i[0])),c=xi.createSynthesizedRemoteEventForCurrentChange(e,t==="current",ze.EMPTY_BYTE_STRING);await Dn(s,a,c);break}case"rejected":await $r(s.localStore,e,!0),Kr(s,e,n);break;default:W()}}async function ZI(r,e,t){const n=eo(r);if(n.Qa){for(const s of e){if(n.Ma.has(s)&&n.sharedClientState.isActiveQueryTarget(s)){F("SyncEngine","Adding an already active target "+s);continue}const i=await Lp(n.localStore,s),a=await Ta(n.localStore,i);await Cc(n,sg(i),a.targetId,!1,a.resumeToken),Za(n.remoteStore,a)}for(const s of t)n.Ma.has(s)&&await $r(n.localStore,s,!1).then(()=>{Gr(n.remoteStore,s),Kr(n,s)}).catch(Nn)}}function eo(r){const e=Q(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=ng.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=KI.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=BI.bind(null,e),e.Ca.d_=RI.bind(null,e.eventManager),e.Ca.$a=CI.bind(null,e.eventManager),e}function Vc(r){const e=Q(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=zI.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=$I.bind(null,e),e}class si{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Ja(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,t){return null}Ha(e,t){return null}za(e){return Vp(this.persistence,new jp,e.initialUser,this.serializer)}Ga(e){return new Dp(Ya.Zr,this.serializer)}Wa(e){return new Bp}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}si.provider={build:()=>new si};class ig extends si{constructor(e,t,n){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await Vc(this.Ja.syncEngine),await ts(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return Vp(this.persistence,new jp,e.initialUser,this.serializer)}ja(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new Bw(n,e.asyncQueue,t)}Ha(e,t){const n=new b_(t,this.persistence);return new y_(e.asyncQueue,n)}Ga(e){const t=Pp(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?mt.withCacheSize(this.cacheSizeBytes):mt.DEFAULT;return new wc(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,zp(),ra(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new Bp}}class eT extends ig{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ja.syncEngine;this.sharedClientState instanceof Lo&&(this.sharedClientState.syncEngine={no:QI.bind(null,t),ro:XI.bind(null,t),io:ZI.bind(null,t),Qi:JI.bind(null,t),eo:WI.bind(null,t)},await this.sharedClientState.start()),await this.persistence.yi(async n=>{await YI(this.Ja.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())})}Wa(e){const t=zp();if(!Lo.D(t))throw new B(M.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Pp(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Lo(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class ii{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>Ah(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=qI.bind(null,this.syncEngine),await El(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new NI}()}createDatastore(e){const t=Ja(e.databaseInfo.databaseId),n=function(i){return new hI(i)}(e.databaseInfo);return function(i,a,c,u){return new pI(i,a,c,u)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(n,s,i,a,c){return new xI(n,s,i,a,c)}(this.localStore,this.datastore,e.asyncQueue,t=>Ah(this.syncEngine,t,0),function(){return wh.D()?new wh:new cI}())}createSyncEngine(e,t){return function(s,i,a,c,u,d,m){const p=new VI(s,i,a,c,u,d);return m&&(p.Qa=!0),p}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(s){const i=Q(s);F("RemoteStore","RemoteStore shutting down."),i.L_.add(5),await bi(i),i.k_.shutdown(),i.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}ii.provider={build:()=>new ii};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ag{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Be("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tT{constructor(e,t,n,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=s,this.user=at.UNAUTHENTICATED,this.clientId=_f.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async a=>{F("FirestoreClient","Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(n,a=>(F("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Jt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Nc(t,"Failed to shutdown persistence");e.reject(n)}}),e.promise}}async function Uo(r,e){r.asyncQueue.verifyOperationInProgress(),F("FirestoreClient","Initializing OfflineComponentProvider");const t=r.configuration;await e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(async s=>{n.isEqual(s)||(await Op(e.localStore,s),n=s)}),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}async function Nh(r,e){r.asyncQueue.verifyOperationInProgress();const t=await nT(r);F("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>Ih(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,s)=>Ih(e.remoteStore,s)),r._onlineComponents=e}async function nT(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){F("FirestoreClient","Using user provided OfflineComponentProvider");try{await Uo(r,r._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(s){return s.name==="FirebaseError"?s.code===M.FAILED_PRECONDITION||s.code===M.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(t))throw t;Hs("Error using user provided cache. Falling back to memory cache: "+t),await Uo(r,new si)}}else F("FirestoreClient","Using default OfflineComponentProvider"),await Uo(r,new si);return r._offlineComponents}async function og(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(F("FirestoreClient","Using user provided OnlineComponentProvider"),await Nh(r,r._uninitializedComponentsProvider._online)):(F("FirestoreClient","Using default OnlineComponentProvider"),await Nh(r,new ii))),r._onlineComponents}function rT(r){return og(r).then(e=>e.syncEngine)}async function Sl(r){const e=await og(r),t=e.eventManager;return t.onListen=OI.bind(null,e.syncEngine),t.onUnlisten=LI.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=MI.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=FI.bind(null,e.syncEngine),t}function sT(r,e,t={}){const n=new Jt;return r.asyncQueue.enqueueAndForget(async()=>function(i,a,c,u,d){const m=new ag({next:x=>{m.Za(),a.enqueueAndForget(()=>Jp(i,p)),x.fromCache&&u.source==="server"?d.reject(new B(M.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(x)},error:x=>d.reject(x)}),p=new Xp(c,m,{includeMetadataChanges:!0,_a:!0});return Yp(i,p)}(await Sl(r),r.asyncQueue,e,t,n)),n.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lg(r){const e={};return r.timeoutSeconds!==void 0&&(e.timeoutSeconds=r.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rh=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cg(r,e,t){if(!t)throw new B(M.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function iT(r,e,t,n){if(e===!0&&n===!0)throw new B(M.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function Ch(r){if(!K.isDocumentKey(r))throw new B(M.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Dh(r){if(K.isDocumentKey(r))throw new B(M.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function to(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{const e=function(n){return n.constructor?n.constructor.name:null}(r);return e?`a custom ${e} object`:"an object"}}return typeof r=="function"?"a function":W()}function In(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new B(M.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=to(r);throw new B(M.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ph{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new B(M.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new B(M.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}iT("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=lg((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new B(M.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new B(M.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new B(M.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,s){return n.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Oc{constructor(e,t,n,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ph({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new B(M.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new B(M.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ph(e),e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new l_;switch(n.type){case"firstParty":return new d_(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new B(M.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=Rh.get(t);n&&(F("ComponentProvider","Removing Datastore"),Rh.delete(t),n.terminate())}(this),Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pn{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Pn(this.firestore,e,this._query)}}class gt{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Tn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new gt(this.firestore,e,this._key)}}class Tn extends Pn{constructor(e,t,n){super(e,t,$a(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new gt(this.firestore,null,new K(e))}withConverter(e){return new Tn(this.firestore,e,this._path)}}function Fs(r,e,...t){if(r=Ke(r),cg("collection","path",e),r instanceof Oc){const n=Te.fromString(e,...t);return Dh(n),new Tn(r,null,n)}{if(!(r instanceof gt||r instanceof Tn))throw new B(M.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(Te.fromString(e,...t));return Dh(n),new Tn(r.firestore,null,n)}}function ai(r,e,...t){if(r=Ke(r),arguments.length===1&&(e=_f.newId()),cg("doc","path",e),r instanceof Oc){const n=Te.fromString(e,...t);return Ch(n),new gt(r,null,new K(n))}{if(!(r instanceof gt||r instanceof Tn))throw new B(M.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(Te.fromString(e,...t));return Ch(n),new gt(r.firestore,r instanceof Tn?r.converter:null,new K(n))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jh{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new $p(this,"async_queue_retry"),this.Vu=()=>{const n=ra();n&&F("AsyncQueue","Visibility state changed to "+n.visibilityState),this.t_.jo()},this.mu=e;const t=ra();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=ra();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new Jt;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Rn(e))throw e;F("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(n=>{this.Eu=n,this.du=!1;const s=function(a){let c=a.message||"";return a.stack&&(c=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),c}(n);throw Be("INTERNAL UNHANDLED ERROR: ",s),n}).then(n=>(this.du=!1,n))));return this.mu=t,t}enqueueAfterDelay(e,t,n){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const s=Sc.createAndSchedule(this,e,t,n,i=>this.yu(i));return this.Tu.push(s),s}fu(){this.Eu&&W()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function Vh(r){return function(t,n){if(typeof t!="object"||t===null)return!1;const s=t;for(const i of n)if(i in s&&typeof s[i]=="function")return!0;return!1}(r,["next","error","complete"])}class Hr extends Oc{constructor(e,t,n,s){super(e,t,n,s),this.type="firestore",this._queue=new jh,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new jh(e),this._firestoreClient=void 0,await e}}}function aT(r,e,t){t||(t="(default)");const n=Hl(r,"firestore");if(n.isInitialized(t)){const s=n.getImmediate({identifier:t}),i=n.getOptions(t);if($s(i,e))return s;throw new B(M.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new B(M.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new B(M.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return n.initialize({options:e,instanceIdentifier:t})}function no(r){if(r._terminated)throw new B(M.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||oT(r),r._firestoreClient}function oT(r){var e,t,n;const s=r._freezeSettings(),i=function(c,u,d,m){return new U_(c,u,d,m.host,m.ssl,m.experimentalForceLongPolling,m.experimentalAutoDetectLongPolling,lg(m.experimentalLongPollingOptions),m.useFetchStreams)}(r._databaseId,((e=r._app)===null||e===void 0?void 0:e.options.appId)||"",r._persistenceKey,s);r._componentsProvider||!((t=s.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((n=s.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),r._firestoreClient=new tT(r._authCredentials,r._appCheckCredentials,r._queue,i,r._componentsProvider&&function(c){const u=c==null?void 0:c._online.build();return{_offline:c==null?void 0:c._offline.build(u),_online:u}}(r._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Wr(ze.fromBase64String(e))}catch(t){throw new B(M.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Wr(ze.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ro{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new B(M.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Le(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mc{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lc{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new B(M.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new B(M.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ue(this._lat,e._lat)||ue(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fc{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,s){if(n.length!==s.length)return!1;for(let i=0;i<n.length;++i)if(n[i]!==s[i])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lT=/^__.*__$/;class cT{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new an(e,this.data,this.fieldMask,t,this.fieldTransforms):new es(e,this.data,t,this.fieldTransforms)}}class ug{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new an(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function dg(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw W()}}class Uc{constructor(e,t,n,s,i,a){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=s,i===void 0&&this.vu(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new Uc(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const n=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:n,xu:!1});return s.Ou(e),s}Nu(e){var t;const n=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.Fu({path:n,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Sa(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(dg(this.Cu)&&lT.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class uT{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Ja(e)}Qu(e,t,n,s=!1){return new Uc({Cu:e,methodName:t,qu:n,path:Le.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Bc(r){const e=r._freezeSettings(),t=Ja(r._databaseId);return new uT(r._databaseId,!!e.ignoreUndefinedProperties,t)}function hg(r,e,t,n,s,i={}){const a=r.Qu(i.merge||i.mergeFields?2:0,e,t,s);zc("Data must be an object, but it was:",a,n);const c=mg(n,a);let u,d;if(i.merge)u=new pt(a.fieldMask),d=a.fieldTransforms;else if(i.mergeFields){const m=[];for(const p of i.mergeFields){const x=Nl(e,p,t);if(!a.contains(x))throw new B(M.INVALID_ARGUMENT,`Field '${x}' is specified in your field mask but missing from your input data.`);pg(m,x)||m.push(x)}u=new pt(m),d=a.fieldTransforms.filter(p=>u.covers(p.field))}else u=null,d=a.fieldTransforms;return new cT(new ot(c),u,d)}class so extends Mc{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof so}}function dT(r,e,t,n){const s=r.Qu(1,e,t);zc("Data must be an object, but it was:",s,n);const i=[],a=ot.empty();ur(n,(u,d)=>{const m=$c(e,u,t);d=Ke(d);const p=s.Nu(m);if(d instanceof so)i.push(m);else{const x=vi(d,p);x!=null&&(i.push(m),a.set(m,x))}});const c=new pt(i);return new ug(a,c,s.fieldTransforms)}function hT(r,e,t,n,s,i){const a=r.Qu(1,e,t),c=[Nl(e,n,t)],u=[s];if(i.length%2!=0)throw new B(M.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let x=0;x<i.length;x+=2)c.push(Nl(e,i[x])),u.push(i[x+1]);const d=[],m=ot.empty();for(let x=c.length-1;x>=0;--x)if(!pg(d,c[x])){const b=c[x];let w=u[x];w=Ke(w);const k=a.Nu(b);if(w instanceof so)d.push(b);else{const N=vi(w,k);N!=null&&(d.push(b),m.set(b,N))}}const p=new pt(d);return new ug(m,p,a.fieldTransforms)}function mT(r,e,t,n=!1){return vi(t,r.Qu(n?4:3,e))}function vi(r,e){if(fg(r=Ke(r)))return zc("Unsupported field value:",e,r),mg(r,e);if(r instanceof Mc)return function(n,s){if(!dg(s.Cu))throw s.Bu(`${n._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${n._methodName}() is not currently supported inside arrays`);const i=n._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(r,e),null;if(r===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(n,s){const i=[];let a=0;for(const c of n){let u=vi(c,s.Lu(a));u==null&&(u={nullValue:"NULL_VALUE"}),i.push(u),a++}return{arrayValue:{values:i}}}(r,e)}return function(n,s){if((n=Ke(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return rw(s.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){const i=_e.fromDate(n);return{timestampValue:zr(s.serializer,i)}}if(n instanceof _e){const i=new _e(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:zr(s.serializer,i)}}if(n instanceof Lc)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Wr)return{bytesValue:up(s.serializer,n._byteString)};if(n instanceof gt){const i=s.databaseId,a=n.firestore._databaseId;if(!a.isEqual(i))throw s.Bu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:yc(n.firestore._databaseId||s.databaseId,n._key.path)}}if(n instanceof Fc)return function(a,c){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:a.toArray().map(u=>{if(typeof u!="number")throw c.Bu("VectorValues must only contain numeric values.");return mc(c.serializer,u)})}}}}}}(n,s);throw s.Bu(`Unsupported field value: ${to(n)}`)}(r,e)}function mg(r,e){const t={};return Pf(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ur(r,(n,s)=>{const i=vi(s,e.Mu(n));i!=null&&(t[n]=i)}),{mapValue:{fields:t}}}function fg(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof _e||r instanceof Lc||r instanceof Wr||r instanceof gt||r instanceof Mc||r instanceof Fc)}function zc(r,e,t){if(!fg(t)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(t)){const n=to(t);throw n==="an object"?e.Bu(r+" a custom object"):e.Bu(r+" "+n)}}function Nl(r,e,t){if((e=Ke(e))instanceof ro)return e._internalPath;if(typeof e=="string")return $c(r,e);throw Sa("Field path arguments must be of type string or ",r,!1,void 0,t)}const fT=new RegExp("[~\\*/\\[\\]]");function $c(r,e,t){if(e.search(fT)>=0)throw Sa(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new ro(...e.split("."))._internalPath}catch{throw Sa(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function Sa(r,e,t,n,s){const i=n&&!n.isEmpty(),a=s!==void 0;let c=`Function ${e}() called with invalid data`;t&&(c+=" (via `toFirestore()`)"),c+=". ";let u="";return(i||a)&&(u+=" (found",i&&(u+=` in field ${n}`),a&&(u+=` in document ${s}`),u+=")"),new B(M.INVALID_ARGUMENT,c+r+u)}function pg(r,e){return r.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gg{constructor(e,t,n,s,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new gt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new pT(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(io("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class pT extends gg{data(){return super.data()}}function io(r,e){return typeof e=="string"?$c(r,e):e instanceof ro?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xg(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new B(M.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Gc{}class yg extends Gc{}function Bo(r,e,...t){let n=[];e instanceof Gc&&n.push(e),n=n.concat(t),function(i){const a=i.filter(u=>u instanceof qc).length,c=i.filter(u=>u instanceof ao).length;if(a>1||a>0&&c>0)throw new B(M.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const s of n)r=s._apply(r);return r}class ao extends yg{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new ao(e,t,n)}_apply(e){const t=this._parse(e);return bg(e._query,t),new Pn(e.firestore,e.converter,fl(e._query,t))}_parse(e){const t=Bc(e.firestore);return function(i,a,c,u,d,m,p){let x;if(d.isKeyField()){if(m==="array-contains"||m==="array-contains-any")throw new B(M.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if(m==="in"||m==="not-in"){Fh(p,m);const b=[];for(const w of p)b.push(Lh(u,i,w));x={arrayValue:{values:b}}}else x=Lh(u,i,p)}else m!=="in"&&m!=="not-in"&&m!=="array-contains-any"||Fh(p,m),x=mT(c,a,p,m==="in"||m==="not-in");return pe.create(d,m,x)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Oh(r,e,t){const n=e,s=io("where",r);return ao._create(s,n,t)}class qc extends Gc{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new qc(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:ke.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(s,i){let a=s;const c=i.getFlattenedFilters();for(const u of c)bg(a,u),a=fl(a,u)}(e._query,t),new Pn(e.firestore,e.converter,fl(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Kc extends yg{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Kc(e,t)}_apply(e){const t=function(s,i,a){if(s.startAt!==null)throw new B(M.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new B(M.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ti(i,a)}(e._query,this._field,this._direction);return new Pn(e.firestore,e.converter,function(s,i){const a=s.explicitOrderBy.concat([i]);return new Zr(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,t))}}function Mh(r,e="asc"){const t=e,n=io("orderBy",r);return Kc._create(n,t)}function Lh(r,e,t){if(typeof(t=Ke(t))=="string"){if(t==="")throw new B(M.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Kf(e)&&t.indexOf("/")!==-1)throw new B(M.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(Te.fromString(t));if(!K.isDocumentKey(n))throw new B(M.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return Zs(r,new K(n))}if(t instanceof gt)return Zs(r,t._key);throw new B(M.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${to(t)}.`)}function Fh(r,e){if(!Array.isArray(r)||r.length===0)throw new B(M.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function bg(r,e){const t=function(s,i){for(const a of s)for(const c of a.getFlattenedFilters())if(i.indexOf(c.op)>=0)return c.op;return null}(r.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new B(M.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new B(M.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class gT{convertValue(e,t="none"){switch(sr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Oe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(En(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw W()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return ur(e,(s,i)=>{n[s]=this.convertValue(i,t)}),n}convertVectorValue(e){var t,n,s;const i=(s=(n=(t=e.fields)===null||t===void 0?void 0:t.value.arrayValue)===null||n===void 0?void 0:n.values)===null||s===void 0?void 0:s.map(a=>Oe(a.doubleValue));return new Fc(i)}convertGeoPoint(e){return new Lc(Oe(e.latitude),Oe(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=uc(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Js(e));default:return null}}convertTimestamp(e){const t=en(e);return new _e(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Te.fromString(e);ee(vp(n));const s=new rr(n.get(1),n.get(3)),i=new K(n.popFirst(5));return s.isEqual(t)||Be(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vg(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rs{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class _g extends gg{constructor(e,t,n,s,i,a){super(e,t,n,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new sa(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(io("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class sa extends _g{data(e={}){return super.data(e)}}class wg{constructor(e,t,n,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Rs(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new sa(this._firestore,this._userDataWriter,n.key,n,new Rs(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new B(M.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map(c=>{const u=new sa(s._firestore,s._userDataWriter,c.doc.key,c.doc,new Rs(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);return c.doc,{type:"added",doc:u,oldIndex:-1,newIndex:a++}})}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(c=>i||c.type!==3).map(c=>{const u=new sa(s._firestore,s._userDataWriter,c.doc.key,c.doc,new Rs(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,m=-1;return c.type!==0&&(d=a.indexOf(c.doc.key),a=a.delete(c.doc.key)),c.type!==1&&(a=a.add(c.doc),m=a.indexOf(c.doc.key)),{type:xT(c.type),doc:u,oldIndex:d,newIndex:m}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function xT(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return W()}}class Hc extends gT{constructor(e){super(),this.firestore=e}convertBytes(e){return new Wr(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new gt(this.firestore,null,t)}}function Rl(r){r=In(r,Pn);const e=In(r.firestore,Hr),t=no(e),n=new Hc(e);return xg(r._query),sT(t,r._query).then(s=>new wg(e,n,r,s))}function yT(r,e,t){r=In(r,gt);const n=In(r.firestore,Hr),s=vg(r.converter,e,t);return Ig(n,[hg(Bc(n),"setDoc",r._key,s,r.converter!==null,t).toMutation(r._key,lt.none())])}function Uh(r,...e){var t,n,s;r=Ke(r);let i={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||Vh(e[a])||(i=e[a],a++);const c={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Vh(e[a])){const p=e[a];e[a]=(t=p.next)===null||t===void 0?void 0:t.bind(p),e[a+1]=(n=p.error)===null||n===void 0?void 0:n.bind(p),e[a+2]=(s=p.complete)===null||s===void 0?void 0:s.bind(p)}let u,d,m;if(r instanceof gt)d=In(r.firestore,Hr),m=$a(r._key.path),u={next:p=>{e[a]&&e[a](bT(d,r,p))},error:e[a+1],complete:e[a+2]};else{const p=In(r,Pn);d=In(p.firestore,Hr),m=p._query;const x=new Hc(d);u={next:b=>{e[a]&&e[a](new wg(d,x,p,b))},error:e[a+1],complete:e[a+2]},xg(r._query)}return function(x,b,w,k){const N=new ag(k),D=new Xp(b,N,w);return x.asyncQueue.enqueueAndForget(async()=>Yp(await Sl(x),D)),()=>{N.Za(),x.asyncQueue.enqueueAndForget(async()=>Jp(await Sl(x),D))}}(no(d),m,c,u)}function Ig(r,e){return function(n,s){const i=new Jt;return n.asyncQueue.enqueueAndForget(async()=>UI(await rT(n),s,i)),i.promise}(no(r),e)}function bT(r,e,t){const n=t.docs.get(e._key),s=new Hc(r);return new _g(r,s,e._key,n,new Rs(t.hasPendingWrites,t.fromCache),e.converter)}class vT{constructor(e){let t;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),t=e.tabManager):(t=TT(),t._initialize(e)),this._onlineComponentProvider=t._onlineComponentProvider,this._offlineComponentProvider=t._offlineComponentProvider}toJSON(){return{kind:this.kind}}}function _T(r){return new vT(r)}class wT{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=ii.provider,this._offlineComponentProvider={build:t=>new ig(t,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class IT{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=ii.provider,this._offlineComponentProvider={build:t=>new eT(t,e==null?void 0:e.cacheSizeBytes)}}}function TT(r){return new wT(void 0)}function ET(){return new IT}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kT{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Bc(e)}set(e,t,n){this._verifyNotCommitted();const s=zo(e,this._firestore),i=vg(s.converter,t,n),a=hg(this._dataReader,"WriteBatch.set",s._key,i,s.converter!==null,n);return this._mutations.push(a.toMutation(s._key,lt.none())),this}update(e,t,n,...s){this._verifyNotCommitted();const i=zo(e,this._firestore);let a;return a=typeof(t=Ke(t))=="string"||t instanceof ro?hT(this._dataReader,"WriteBatch.update",i._key,t,n,s):dT(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(a.toMutation(i._key,lt.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=zo(e,this._firestore);return this._mutations=this._mutations.concat(new Ha(t._key,lt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new B(M.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function zo(r,e){if((r=Ke(r)).firestore!==e)throw new B(M.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tg(r){return no(r=In(r,Hr)),new kT(r,e=>Ig(r,e))}(function(e,t=!0){(function(s){Xr=s})(Yr),Vr(new Zn("firestore",(n,{instanceIdentifier:s,options:i})=>{const a=n.getProvider("app").getImmediate(),c=new Hr(new c_(n.getProvider("auth-internal")),new m_(n.getProvider("app-check-internal")),function(d,m){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new B(M.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new rr(d.options.projectId,m)}(a,s),a);return i=Object.assign({useFetchStreams:t},i),c._setSettings(i),c},"PUBLIC").setMultipleInstances(!0)),_n(Nd,"4.7.3",e),_n(Nd,"4.7.3","esm2017")})();const Bh={apiKey:"AIzaSyD_kcXStPS3yZxK2tSM4BXuGk2br2z9asc",authDomain:"sadhaka-app.firebaseapp.com",projectId:"sadhaka-app",storageBucket:"sadhaka-app.firebasestorage.app",messagingSenderId:"317105213692",appId:"1:317105213692:web:c895054dd2373fb8c20779"};let $o,qe,et,Wc;try{Bh.apiKey?($o=Nm(Bh),qe=r_($o),et=aT($o,{localCache:_T({tabManager:ET()})}),Wc=new Gt):console.warn("Firebase Config missing. Auth will not work.")}catch(r){console.error("Firebase Initialization Error:",r)}const We={JOURNAL:"sadhaka_journal_v1",TRACKER:"sadhaka_tracker_v1",FAVOURITES:"sadhaka_favourites_v1",PRACTICE_LOG:"sadhaka_practice_log_v1",PREFS:"sadhaka_user_prefs_v1",ONBOARDING:"sadhaka_onboarding_complete",PIN:"sadhaka_security_pin_hash",BIO_ID:"sadhaka_bio_cred_id"},Na=r=>{try{return JSON.parse(JSON.stringify(r))}catch(e){return console.error("Failed to sanitize data for sync",e),r}},_i=async(r,e,t)=>{if(!(!r||!et))try{const n=ai(et,"users",r,e,t.id),i={...Na(t),updatedAt:_e.now()};await yT(n,i,{merge:!0})}catch(n){console.warn(`Failed to sync item to ${e}:`,n)}},AT=async()=>{var e;const r=(e=qe==null?void 0:qe.currentUser)==null?void 0:e.uid;if(!r||!et)return"No user logged in";try{const t=Tg(et);let n=0;const s=(a,c)=>{const u=localStorage.getItem(a);if(u){const d=JSON.parse(u);Array.isArray(d)&&d.forEach(m=>{const p=ai(et,"users",r,c,m.id);t.set(p,{...Na(m),updatedAt:_e.now()},{merge:!0}),n++})}};s(We.JOURNAL,"journal"),s(We.TRACKER,"tracker"),s(We.FAVOURITES,"favourites");const i=localStorage.getItem(We.PREFS);if(i){const a=JSON.parse(i),c=ai(et,"users",r,"settings","preferences");t.set(c,{...Na(a),updatedAt:_e.now()},{merge:!0}),n++}return n>0?(await t.commit(),`Synced ${n} items to cloud.`):"No local data to sync."}catch(t){throw console.error("Force sync failed",t),new Error(t.message)}},ST=async()=>{var e;const r=(e=qe==null?void 0:qe.currentUser)==null?void 0:e.uid;if(!r||!et)return"No user logged in";try{let t=0;const n=async(i,a,c)=>{const u=await Rl(Fs(et,"users",r,i));if(!u.empty){const d=[];u.forEach(p=>d.push({id:p.id,...p.data()})),i==="journal"&&d.sort((p,x)=>new Date(x.date).getTime()-new Date(p.date).getTime()),localStorage.setItem(a,JSON.stringify(d)),window.dispatchEvent(new Event(c));const m=_e.now();localStorage.setItem(`sadhaka_sync_${i}_last`,m.toMillis().toString()),t+=d.length}};return await Promise.all([n("journal",We.JOURNAL,"sadhaka_journal_updated"),n("tracker",We.TRACKER,"sadhaka_tracker_updated"),n("favourites",We.FAVOURITES,"sadhaka_favourites_updated"),n("practiceLog",We.PRACTICE_LOG,"sadhaka_practice_updated")]),(await Rl(Fs(et,"users",r,"settings"))).forEach(i=>{if(i.id==="preferences"){const a=i.data(),c=JSON.parse(localStorage.getItem(We.PREFS)||"{}");localStorage.setItem(We.PREFS,JSON.stringify({...c,...a})),window.dispatchEvent(new Event("sadhaka_prefs_updated")),t++}}),`Restored ${t} items from cloud.`}catch(t){throw console.error("Download failed",t),new Error(t.message)}},NT=async r=>{if(!r||!et)return()=>{};const e=async(m,p)=>{try{const x=localStorage.getItem(m);if(!x)return;const b=JSON.parse(x);if(!Array.isArray(b)||b.length===0)return;const w=Bo(Fs(et,"users",r,p),Oh("updatedAt",">",_e.fromMillis(0)));if((await Rl(Bo(Fs(et,"users",r,p),Mh("updatedAt")))).empty){console.log(`Migrating ${b.length} items from ${p} to cloud...`);const N=Tg(et);b.forEach(D=>{const V=ai(et,"users",r,p,D.id),P=Na(D);N.set(V,{...P,updatedAt:_e.now()})}),await N.commit()}}catch(x){console.warn(`Migration failed for ${p}:`,x.code||x.message)}};e(We.JOURNAL,"journal"),e(We.TRACKER,"tracker"),e(We.FAVOURITES,"favourites");const t=m=>{const p=`sadhaka_sync_${m}_last`,x=localStorage.getItem(p);return x?_e.fromMillis(parseInt(x)):_e.fromMillis(15778368e5)},n=(m,p)=>{const x=`sadhaka_sync_${m}_last`,b=t(m);p.toMillis()>b.toMillis()&&localStorage.setItem(x,p.toMillis().toString())},s=(m,p,x)=>{const b=t(m),w=Bo(Fs(et,"users",r,m),Oh("updatedAt",">",b),Mh("updatedAt","asc"));return Uh(w,{includeMetadataChanges:!0},k=>{if(k.empty)return;const N=k.docChanges();if(N.length!==0)try{const D=localStorage.getItem(p);let V=D?JSON.parse(D):[],P=!1;N.forEach(U=>{const L=U.doc.data(),G=U.doc.id;if(L.updatedAt instanceof _e&&n(m,L.updatedAt),U.type==="added"||U.type==="modified"){const I={id:G,...L},y=V.findIndex(v=>v.id===G);y>-1?V[y]={...V[y],...I}:V.push(I),P=!0}else U.type==="removed"&&(V=V.filter(I=>I.id!==G),P=!0)}),P&&(m==="journal"&&V.sort((U,L)=>new Date(L.date).getTime()-new Date(U.date).getTime()),localStorage.setItem(p,JSON.stringify(V)),window.dispatchEvent(new Event(x)))}catch(D){console.error("Sync merge failed",D)}},k=>{console.warn(`Sync listener error [${m}]:`,k.code)})},i=s("journal",We.JOURNAL,"sadhaka_journal_updated"),a=s("tracker",We.TRACKER,"sadhaka_tracker_updated"),c=s("favourites",We.FAVOURITES,"sadhaka_favourites_updated"),u=s("practiceLog",We.PRACTICE_LOG,"sadhaka_practice_updated"),d=Uh(ai(et,"users",r,"settings","preferences"),{includeMetadataChanges:!0},m=>{if(m.exists()){const p=m.data(),b={...JSON.parse(localStorage.getItem(We.PREFS)||"{}"),...p};localStorage.setItem(We.PREFS,JSON.stringify(b)),window.dispatchEvent(new Event("sadhaka_prefs_updated"))}},m=>{console.warn("Preferences sync error:",m.code)});return()=>{i(),a(),c(),u(),d()}},Eg=S.createContext({currentUser:null,loading:!0,isGuest:!1}),RT=({children:r})=>{const[e,t]=S.useState(null),[n,s]=S.useState(!0),i=S.useRef(null);return S.useEffect(()=>{if(!qe){s(!1);return}const a=Kb(qe,async c=>{if(t(c),s(!1),i.current&&(i.current(),i.current=null),c)try{const u=await NT(c.uid);i.current=u}catch(u){console.error("Failed to init sync",u)}});return()=>{i.current&&i.current(),a()}},[]),o.jsx(Eg.Provider,{value:{currentUser:e,loading:n,isGuest:!1},children:r})},Qc=()=>S.useContext(Eg),CT=({onComplete:r,theme:e,toggleTheme:t})=>{const{preferences:n,updateLocation:s,updateSecuritySettings:i,updateNotificationSettings:a}=Mt(),{location:c}=n,{currentUser:u}=Qc(),[d,m]=S.useState(0),[p,x]=S.useState(!1),[b,w]=S.useState(!1),[k,N]=S.useState(!1),[D,V]=S.useState("options"),[P,U]=S.useState(""),[L,G]=S.useState(""),[I,y]=S.useState(null),[v,E]=S.useState(!1),[T,A]=S.useState("none"),[_,se]=S.useState(!1),[ie,de]=S.useState(!1),[ce,Re]=S.useState(!1);S.useEffect(()=>{fm().then(de),typeof window<"u"&&"Notification"in window&&Notification.permission==="granted"&&w(!0)},[]),S.useEffect(()=>{if(u&&d===1){const Y=setTimeout(()=>m(2),1e3);return()=>clearTimeout(Y)}},[u,d]);const Ee=()=>m(Y=>Y+1),Ae=()=>{T!=="none"?A("none"):D!=="options"&&d===1?(V("options"),y(null)):m(Y=>Y-1)},xe=9,De=async()=>{try{E(!0),await mf(qe,Wc)}catch(Y){y(Y.message)}finally{E(!1)}},H=async()=>{if(!(!P||!L))try{E(!0),D==="email-signup"?await ef(qe,P,L):await tf(qe,P,L)}catch(Y){y(Y.message.replace("Firebase: ",""))}finally{E(!1)}},q=async()=>{x(!0);try{const Y=await Gl();s(Y)}catch{alert("Could not detect location. Please use the default.")}finally{x(!1)}},te=async()=>{N(!0);try{await ym()?(w(!0),a({alarmsEnabled:!0})):Notification.permission==="denied"&&alert("Notifications are blocked by your browser/device settings. Please enable them manually for Sadhaka.")}catch(Y){console.error("Permission request failed",Y)}finally{N(!1)}},he=Y=>{i({pinEnabled:!0,lockType:Y}),se(!0),A("none")},ye=async()=>{await pm()?i({biometricsEnabled:!0}):alert("Biometric enrollment failed.")},ne=()=>o.jsx("div",{className:"flex gap-2",children:Array.from({length:xe+1}).map((Y,ae)=>o.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${d===ae?"w-8 bg-spiritual-600 dark:bg-spiritual-300":"w-2 bg-spiritual-200 dark:bg-spiritual-700"}`},ae))});return o.jsxs("div",{className:"fixed inset-0 z-[60] bg-spiritual-50 dark:bg-spiritual-deep flex flex-col transition-colors duration-500 animate-fade-in overflow-hidden",children:[o.jsx("style",{children:`
        @keyframes wiggle {
            0%, 100% { transform: rotate(-4deg); }
            50% { transform: rotate(4deg); }
        }
        @keyframes sun-arc {
            0% { transform: rotate(-65deg); }
            100% { transform: rotate(65deg); }
        }
        @keyframes ring {
            0% { transform: rotate(0); }
            10% { transform: rotate(15deg); }
            20% { transform: rotate(-15deg); }
            30% { transform: rotate(10deg); }
            40% { transform: rotate(-10deg); }
            50% { transform: rotate(5deg); }
            60% { transform: rotate(-5deg); }
            70% { transform: rotate(0); }
            100% { transform: rotate(0); }
        }
        .animate-ring {
            animation: ring 2s ease-in-out infinite;
            transform-origin: top center;
        }
        @keyframes drop {
            0% { transform: translateY(-50px); opacity: 0; }
            60% { transform: translateY(10px); opacity: 1; }
            80% { transform: translateY(-5px); }
            100% { transform: translateY(0); }
        }
        .animate-drop {
            animation: drop 1s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }
      `}),o.jsx("div",{className:"absolute top-6 right-6 z-20",children:d<xe&&d!==1&&o.jsx("button",{onClick:()=>m(xe),className:"text-sm font-bold text-spiritual-400 uppercase tracking-widest hover:text-spiritual-600 dark:hover:text-spiritual-200 transition-colors",children:"Skip"})}),o.jsx("div",{className:"flex-1 w-full overflow-y-auto overflow-x-hidden relative scrollbar-hide",children:o.jsx("div",{className:"min-h-full flex flex-col items-center justify-center p-6 pb-32 md:pb-12",children:o.jsxs("div",{className:"w-full max-w-md md:max-w-5xl transition-all duration-500",children:[d===0&&o.jsxs("div",{className:"animate-fade-in flex flex-col md:flex-row items-center justify-center gap-8 md:gap-16",children:[o.jsx("div",{className:"animate-float order-1 md:order-1",children:o.jsxs("div",{className:"w-32 h-32 md:w-48 md:h-48 bg-gradient-to-br from-spiritual-100 to-spiritual-50 dark:from-spiritual-800 dark:to-spiritual-900 rounded-[2rem] flex items-center justify-center shadow-2xl relative z-10 rotate-3 hover:rotate-6 transition-transform duration-500",children:[o.jsx("span",{className:"text-6xl md:text-8xl filter drop-shadow-sm",children:""}),o.jsx("div",{className:"absolute -inset-4 border border-spiritual-200 dark:border-spiritual-700 rounded-[2.5rem] opacity-50 animate-pulse-slow"})]})}),o.jsxs("div",{className:"text-center md:text-left order-2 md:order-2 max-w-lg",children:[o.jsx("h1",{className:"text-4xl md:text-6xl font-bold text-spiritual-900 dark:text-spiritual-50 mb-4 md:mb-6",children:"Hari Om!"}),o.jsxs("p",{className:"text-lg md:text-xl text-spiritual-600 dark:text-spiritual-300 leading-relaxed",children:["Welcome to ",o.jsx("span",{className:"font-bold text-spiritual-800 dark:text-spiritual-100",children:"Sadhaka"}),", your personal sanctuary for spiritual growth, inner peace, and daily discipline."]})]})]}),d===1&&o.jsxs("div",{className:"animate-fade-in w-full max-w-md mx-auto",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("div",{className:"w-20 h-20 bg-blue-50 dark:bg-blue-900/30 rounded-full flex items-center justify-center mx-auto mb-4 animate-float",children:o.jsx(Xh,{size:32,className:"text-blue-500 dark:text-blue-400"})}),o.jsx("h2",{className:"text-3xl font-bold text-spiritual-900 dark:text-spiritual-50 mb-2",children:"Identify Yourself"}),o.jsx("p",{className:"text-spiritual-500 dark:text-spiritual-400",children:"Sync your practice across devices."})]}),u?o.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-6 rounded-[2rem] text-center animate-scale-in",children:[o.jsx("div",{className:"w-16 h-16 bg-green-100 dark:bg-green-800 rounded-full flex items-center justify-center mx-auto mb-4",children:o.jsx(Fn,{size:32,className:"text-green-600 dark:text-green-300"})}),o.jsx("h3",{className:"text-xl font-bold text-spiritual-900 dark:text-spiritual-100 mb-1",children:"Welcome back!"}),o.jsx("p",{className:"text-spiritual-600 dark:text-spiritual-300",children:u.email})]}):o.jsxs("div",{className:"bg-white/50 dark:bg-spiritual-800/50 p-6 rounded-[2rem] border border-spiritual-100 dark:border-spiritual-700/50 backdrop-blur-sm shadow-sm space-y-4",children:[D==="options"&&o.jsxs(o.Fragment,{children:[o.jsxs("button",{onClick:De,disabled:v,className:"w-full py-4 bg-white dark:bg-black/30 border border-spiritual-200 dark:border-white/10 rounded-2xl font-bold text-spiritual-700 dark:text-spiritual-300 hover:bg-spiritual-50 dark:hover:bg-white/5 transition-colors flex items-center justify-center gap-3",children:[o.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:o.jsx("path",{fill:"currentColor",d:"M21.35 11.1h-9.17v2.73h6.51c-.33 3.81-3.5 5.44-6.5 5.44C8.36 19.27 5 16.25 5 12c0-4.1 3.2-7.27 7.2-7.27c3.09 0 4.9 1.97 4.9 1.97L19 4.72S16.56 2 12.1 2C6.42 2 2.03 6.8 2.03 12c0 5.05 4.13 10 10.22 10c5.35 0 9.25-3.67 9.25-9.09c0-1.15-.15-1.81-.15-1.81Z"})}),"Continue with Google"]}),o.jsxs("div",{className:"flex items-center gap-3 opacity-60",children:[o.jsx("div",{className:"h-px bg-spiritual-300 dark:bg-spiritual-600 flex-1"}),o.jsx("span",{className:"text-[10px] font-bold text-spiritual-400 uppercase tracking-wider",children:"OR"}),o.jsx("div",{className:"h-px bg-spiritual-300 dark:bg-spiritual-600 flex-1"})]}),o.jsx("button",{onClick:()=>V("email-signin"),className:"w-full py-4 bg-spiritual-800 dark:bg-spiritual-100 text-white dark:text-spiritual-900 rounded-2xl font-bold transition-all",children:"Sign In with Email"}),o.jsx("button",{onClick:()=>V("email-signup"),className:"w-full py-3 text-spiritual-600 dark:text-spiritual-400 font-bold text-sm",children:"Create Account"})]}),(D==="email-signin"||D==="email-signup")&&o.jsxs("div",{className:"space-y-4 animate-slide-in-right",children:[o.jsx("h3",{className:"text-center font-bold text-spiritual-900 dark:text-spiritual-100",children:D==="email-signin"?"Sign In":"Create Account"}),o.jsxs("div",{className:"space-y-3",children:[o.jsx("input",{type:"email",placeholder:"Email",value:P,onChange:Y=>U(Y.target.value),className:"w-full p-4 rounded-xl bg-white dark:bg-black/20 border-none outline-none focus:ring-2 focus:ring-spiritual-gold"}),o.jsx("input",{type:"password",placeholder:"Password",value:L,onChange:Y=>G(Y.target.value),className:"w-full p-4 rounded-xl bg-white dark:bg-black/20 border-none outline-none focus:ring-2 focus:ring-spiritual-gold"})]}),I&&o.jsx("p",{className:"text-red-500 text-xs text-center font-bold",children:I}),o.jsxs("button",{onClick:H,disabled:v,className:"w-full py-4 bg-spiritual-800 dark:bg-spiritual-100 text-white dark:text-spiritual-900 rounded-2xl font-bold shadow-lg flex items-center justify-center gap-2",children:[v?o.jsx("div",{className:"w-5 h-5 border-2 border-t-transparent rounded-full animate-spin"}):o.jsx(oa,{}),D==="email-signin"?"Enter":"Sign Up"]})]})]})]}),d===2&&o.jsxs("div",{className:"animate-fade-in flex flex-col md:flex-row items-center justify-center gap-8 md:gap-16",children:[o.jsxs("div",{className:"relative w-64 h-64 md:w-80 md:h-80 mx-auto animate-float flex-shrink-0",children:[o.jsx("div",{className:"absolute inset-0 bg-spiritual-gold/20 rounded-full blur-xl animate-pulse-slow"}),o.jsx("img",{src:"images/sadguru-mangeshda-darkness-to-light.jpg",onError:Y=>{var be;const ae=Y.currentTarget;ae.style.display="none",(be=ae.parentElement)==null||be.classList.add("flex","items-center","justify-center","bg-spiritual-200","dark:bg-spiritual-800","rounded-full")},alt:"Sadguru Mangeshda",className:"w-full h-full object-cover rounded-full shadow-2xl"})]}),o.jsxs("div",{className:"max-w-lg text-center md:text-left",children:[o.jsx("h2",{className:"text-3xl md:text-4xl font-serif font-bold text-spiritual-900 dark:text-spiritual-50 mb-6",children:"Dedication"}),o.jsx("div",{className:"bg-white/50 dark:bg-spiritual-800/50 p-6 md:p-8 rounded-[2rem] border border-spiritual-100 dark:border-spiritual-700/50 backdrop-blur-sm shadow-sm",children:o.jsxs("p",{className:"text-lg md:text-xl text-spiritual-700 dark:text-spiritual-200 font-medium leading-relaxed italic",children:['"The Sadhaka app is dedicated to all the Sadhakas and fellow disciples of ',o.jsx("span",{className:"text-spiritual-900 dark:text-spiritual-50 font-bold",children:"Sadguru Mangeshda"}),' whose teachings are the main inspiration behind this app."']})})]})]}),d===3&&o.jsxs("div",{className:"animate-fade-in w-full",children:[o.jsxs("div",{className:"text-center mb-8 md:mb-12",children:[o.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-spiritual-900 dark:text-spiritual-50 mb-2",children:"System Access"}),o.jsx("p",{className:"text-spiritual-500 dark:text-spiritual-400 text-lg",children:"Enable Prerana Engine & Panchang."})]}),o.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto",children:[o.jsxs("div",{className:"bg-white/50 dark:bg-spiritual-800/50 p-6 rounded-[2rem] border border-spiritual-100 dark:border-spiritual-700/50 backdrop-blur-sm flex flex-col items-center text-center gap-4",children:[o.jsx("div",{className:`p-4 rounded-full ${b?"bg-green-100 text-green-600":"bg-orange-100 text-orange-500"}`,children:b?o.jsx(Fn,{size:32}):o.jsx("div",{className:"animate-ring",children:o.jsx(Da,{size:32})})}),o.jsxs("div",{children:[o.jsx("h3",{className:"font-bold text-xl text-spiritual-900 dark:text-spiritual-100",children:"Prerana Notifications"}),o.jsx("p",{className:"text-sm text-spiritual-500 dark:text-spiritual-400 mt-2",children:"Get timely nudges for Brahma Muhurta, Sunsets, and Habits."})]}),o.jsxs("button",{onClick:te,disabled:b||k,className:`w-full py-3 rounded-xl font-bold transition-all flex items-center justify-center gap-2 ${b?"bg-transparent text-green-600 cursor-default":"bg-spiritual-800 dark:bg-spiritual-100 text-white dark:text-spiritual-900 shadow-md hover:scale-105"}`,children:[k&&o.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),b?"Enabled":k?"Requesting...":"Allow Notifications"]})]}),o.jsxs("div",{className:"bg-white/50 dark:bg-spiritual-800/50 p-6 rounded-[2rem] border border-spiritual-100 dark:border-spiritual-700/50 backdrop-blur-sm flex flex-col items-center text-center gap-4",children:[o.jsx("div",{className:"p-4 bg-indigo-100 text-indigo-500 rounded-full",children:o.jsx("div",{className:"animate-drop",children:o.jsx(Ol,{size:32})})}),o.jsxs("div",{children:[o.jsx("h3",{className:"font-bold text-xl text-spiritual-900 dark:text-spiritual-100",children:"Location Services"}),o.jsx("p",{className:"text-sm text-spiritual-500 dark:text-spiritual-400 mt-2",children:"Required for accurate Solar Clock and Panchang timings."})]}),o.jsxs("div",{className:"w-full flex flex-col gap-2",children:[o.jsxs("button",{onClick:q,disabled:p,className:"w-full py-3 bg-spiritual-800 dark:bg-spiritual-100 text-white dark:text-spiritual-900 rounded-xl font-bold shadow-md hover:scale-105 transition-all flex items-center justify-center gap-2",children:[p?o.jsx("div",{className:"w-4 h-4 border-2 border-t-transparent rounded-full animate-spin"}):o.jsx(Ml,{size:18}),c?"Update Location":"Auto-Detect"]}),o.jsx("p",{className:"text-xs font-bold text-spiritual-400",children:c?c.name:"Default: New Delhi"})]})]})]})]}),d===4&&o.jsxs("div",{className:"animate-fade-in w-full max-w-2xl mx-auto text-center",children:[o.jsxs("div",{className:"mb-8",children:[o.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-spiritual-900 dark:text-spiritual-50 mb-2",children:"Atmosphere"}),o.jsx("p",{className:"text-spiritual-500 dark:text-spiritual-400 text-lg",children:"Choose your visual preference."})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[o.jsxs("button",{onClick:()=>e==="dark"&&t(),className:`p-8 rounded-[2.5rem] border-2 transition-all duration-300 relative overflow-hidden group text-center ${e==="light"?"border-spiritual-600 bg-spiritual-100 shadow-xl scale-105":"border-transparent bg-white opacity-60 hover:opacity-100"}`,children:[o.jsx("div",{className:"w-16 h-16 mx-auto bg-orange-100 rounded-full flex items-center justify-center text-orange-500 mb-4 shadow-sm",children:o.jsx(Us,{size:32})}),o.jsx("span",{className:"font-bold text-xl text-spiritual-800 block",children:"Day"}),e==="light"&&o.jsx("div",{className:"absolute top-4 right-4 text-spiritual-600",children:o.jsx(Fn,{size:20})})]}),o.jsxs("button",{onClick:()=>e==="light"&&t(),className:`p-8 rounded-[2.5rem] border-2 transition-all duration-300 relative overflow-hidden group text-center ${e==="dark"?"border-spiritual-300 bg-spiritual-800 shadow-xl scale-105":"border-transparent bg-spiritual-900 opacity-60 hover:opacity-100"}`,children:[o.jsx("div",{className:"w-16 h-16 mx-auto bg-indigo-900/50 rounded-full flex items-center justify-center text-indigo-300 mb-4 shadow-sm",children:o.jsx(Qn,{size:32})}),o.jsx("span",{className:"font-bold text-xl text-spiritual-100 block",children:"Night"}),e==="dark"&&o.jsx("div",{className:"absolute top-4 right-4 text-spiritual-300",children:o.jsx(Fn,{size:20})})]})]})]}),d===5&&o.jsx("div",{className:"animate-fade-in w-full max-w-4xl mx-auto flex flex-col items-center gap-12",children:o.jsxs("div",{className:"text-center w-full max-w-lg",children:[o.jsx("h2",{className:"text-3xl font-bold text-spiritual-900 dark:text-spiritual-50 mb-2",children:"Chintan"}),o.jsx("p",{className:"text-lg text-spiritual-600 dark:text-spiritual-300 mb-6 leading-relaxed",children:"Reflect & Track your daily discipline"}),o.jsx("div",{className:"relative w-66 h-64 flex items-center justify-center animate-float",children:o.jsxs("div",{className:"w-48 h-60 bg-white dark:bg-spiritual-800 rounded-xl shadow-xl transform -rotate-3 flex flex-col p-6 gap-4 border border-gray-100 dark:border-white/10 relative",children:[o.jsx("div",{className:"w-full h-3 bg-gray-100 dark:bg-white/10 rounded-full"}),o.jsx("div",{className:"w-3/4 h-3 bg-gray-100 dark:bg-white/10 rounded-full"}),o.jsx("div",{className:"w-full h-3 bg-gray-100 dark:bg-white/10 rounded-full"}),o.jsx("div",{className:"w-5/6 h-3 bg-gray-100 dark:bg-white/10 rounded-full"}),o.jsx("div",{className:"mt-auto text-red-400",children:o.jsx(v0,{size:24,fill:"currentColor"})}),o.jsx("div",{className:"absolute bottom-6 right-6 text-xs font-bold text-gray-300 dark:text-gray-600",children:"Dec 31"}),o.jsx("div",{className:"absolute -top-4 -right-4 w-12 h-12 bg-amber-600 rounded-full flex items-center justify-center shadow-lg text-white",children:o.jsx(Fn,{size:20,strokeWidth:3})})]})}),o.jsxs("div",{className:"space-y-4 text-left",children:[o.jsxs("div",{className:"flex items-center gap-4 bg-white/50 dark:bg-spiritual-800/50 p-4 rounded-xl border border-spiritual-100 dark:border-spiritual-700/50",children:[o.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center shrink-0",children:o.jsx(Zh,{size:20})}),o.jsxs("div",{className:"text-left",children:[o.jsx("span",{className:"block font-bold text-spiritual-900 dark:text-spiritual-100",children:"Daily Reflection"}),o.jsx("span",{className:"text-xs text-spiritual-500 dark:text-spiritual-400",children:"Reflect on Intention, Reaction & Balance."})]})]}),o.jsxs("div",{className:"flex items-center gap-4 bg-white/50 dark:bg-spiritual-800/50 p-4 rounded-xl border border-spiritual-100 dark:border-spiritual-700/50",children:[o.jsx("div",{className:"w-10 h-10 rounded-full bg-violet-100 text-violet-600 flex items-center justify-center shrink-0",children:o.jsx(_0,{size:20})}),o.jsxs("div",{className:"text-left",children:[o.jsx("span",{className:"block font-bold text-spiritual-900 dark:text-spiritual-100",children:"Spiritual Calendar"}),o.jsx("span",{className:"text-xs text-spiritual-500 dark:text-spiritual-400",children:"Entries are stamped with daily accomplishments and mood."})]})]}),o.jsxs("div",{className:"flex items-center gap-4 bg-white/50 dark:bg-spiritual-800/50 p-4 rounded-xl border border-spiritual-100 dark:border-spiritual-700/50",children:[o.jsx("div",{className:"w-10 h-10 rounded-full bg-amber-100 text-amber-600 flex items-center justify-center shrink-0",children:o.jsx(w0,{size:20})}),o.jsxs("div",{className:"text-left",children:[o.jsx("span",{className:"block font-bold text-spiritual-900 dark:text-spiritual-100",children:"Simhvalokana"}),o.jsx("span",{className:"text-xs text-spiritual-500 dark:text-spiritual-400",children:`"The Lion's Gaze"  Insights & trends.`})]})]})]})]})}),d===6&&o.jsxs("div",{className:"animate-fade-in w-full text-center max-w-2xl mx-auto",children:[o.jsx("h2",{className:"text-3xl font-bold text-spiritual-900 dark:text-spiritual-50 mb-4",children:"Svdhyya (Practice)"}),o.jsx("p",{className:"text-lg text-spiritual-600 dark:text-spiritual-300 mb-10",children:"A complete library of tools to aid your discipline and inner growth."}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"p-6 bg-white dark:bg-spiritual-800 rounded-3xl shadow-sm border border-spiritual-100 dark:border-spiritual-700 flex flex-col items-center gap-3 hover:scale-105 transition-transform",children:[o.jsx(Bs,{size:32,className:"text-sky-500"}),o.jsx("span",{className:"font-bold text-spiritual-800 dark:text-spiritual-100",children:"Pranayama"})]}),o.jsxs("div",{className:"p-6 bg-white dark:bg-spiritual-800 rounded-3xl shadow-sm border border-spiritual-100 dark:border-spiritual-700 flex flex-col items-center gap-3 hover:scale-105 transition-transform",children:[o.jsx(zs,{size:32,className:"text-orange-500"}),o.jsx("span",{className:"font-bold text-spiritual-800 dark:text-spiritual-100",children:"Yoga Asana"})]}),o.jsxs("div",{className:"p-6 bg-white dark:bg-spiritual-800 rounded-3xl shadow-sm border border-spiritual-100 dark:border-spiritual-700 flex flex-col items-center gap-3 hover:scale-105 transition-transform",children:[o.jsx(tm,{size:32,className:"text-indigo-500"}),o.jsx("span",{className:"font-bold text-spiritual-800 dark:text-spiritual-100",children:"Dhyana"})]}),o.jsxs("div",{className:"p-6 bg-white dark:bg-spiritual-800 rounded-3xl shadow-sm border border-spiritual-100 dark:border-spiritual-700 flex flex-col items-center gap-3 hover:scale-105 transition-transform",children:[o.jsx("span",{className:"text-2xl",children:""}),o.jsx("span",{className:"font-bold text-spiritual-800 dark:text-spiritual-100",children:"Mantra Japa"})]})]})]}),d===7&&o.jsxs("div",{className:"animate-fade-in w-full flex flex-col md:flex-row items-center justify-center gap-12 md:gap-20",children:[o.jsxs("div",{className:"w-48 h-48 md:w-64 md:h-64 relative animate-float flex-shrink-0 order-1",children:[o.jsx("div",{className:"absolute inset-0 border-[8px] border-spiritual-100 dark:border-spiritual-700/50 rounded-full"}),o.jsx("div",{className:"absolute inset-4 border-[6px] border-spiritual-200 dark:border-spiritual-600/50 rounded-full border-t-spiritual-gold dark:border-t-spiritual-gold rotate-45 transition-transform duration-1000"}),o.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:o.jsx("div",{className:"w-6 h-6 bg-spiritual-gold rounded-full shadow-[0_0_20px_rgba(197,160,89,0.5)] animate-pulse"})}),o.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2 bg-white dark:bg-spiritual-800 p-2 rounded-full shadow-sm",children:o.jsx(Qt,{size:20,className:"text-spiritual-400 dark:text-spiritual-300"})}),o.jsx("div",{className:"absolute bottom-6 right-2 bg-white dark:bg-spiritual-800 p-2 rounded-full shadow-sm",children:o.jsx(zs,{size:18,className:"text-orange-400"})}),o.jsx("div",{className:"absolute bottom-6 left-2 bg-white dark:bg-spiritual-800 p-2 rounded-full shadow-sm",children:o.jsx(Bs,{size:18,className:"text-sky-400"})})]}),o.jsxs("div",{className:"max-w-md text-center md:text-left order-2",children:[o.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-spiritual-900 dark:text-spiritual-50 mb-3",children:"The Mandala"}),o.jsx("p",{className:"text-lg text-spiritual-500 dark:text-spiritual-400 leading-relaxed mb-6",children:"A living symbol of your daily alignment on your home screen."}),o.jsxs("div",{className:"bg-white/50 dark:bg-spiritual-800/50 p-6 rounded-[2rem] text-left space-y-4 text-sm border border-spiritual-100 dark:border-spiritual-700/50",children:[o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:"w-8 h-8 rounded-full border-2 border-spiritual-300 flex items-center justify-center shrink-0",children:o.jsx("div",{className:"w-full h-full rounded-full border-t-2 border-t-spiritual-gold"})}),o.jsxs("div",{children:[o.jsx("span",{className:"block font-bold text-spiritual-800 dark:text-spiritual-100",children:"Outer Rings"}),o.jsx("span",{className:"text-spiritual-500 dark:text-spiritual-400 text-xs",children:"Complete as you finish daily habits."})]})]}),o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:"w-8 h-8 flex items-center justify-center shrink-0 bg-spiritual-100 dark:bg-spiritual-700/50 rounded-full",children:o.jsx(I0,{size:16,className:"text-spiritual-500"})}),o.jsxs("div",{children:[o.jsx("span",{className:"block font-bold text-spiritual-800 dark:text-spiritual-100",children:"Inner Shapes"}),o.jsx("span",{className:"text-spiritual-500 dark:text-spiritual-400 text-xs",children:"Fill up with Yoga, Breath & Meditation."})]})]}),o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsx("div",{className:"w-8 h-8 flex items-center justify-center shrink-0 bg-spiritual-100 dark:bg-spiritual-700/50 rounded-full",children:o.jsx("div",{className:"w-3 h-3 rounded-full bg-spiritual-gold shadow-glow"})}),o.jsxs("div",{children:[o.jsx("span",{className:"block font-bold text-spiritual-800 dark:text-spiritual-100",children:"The Bindu (Center)"}),o.jsx("span",{className:"text-spiritual-500 dark:text-spiritual-400 text-xs",children:"Glows with your daily journal mood."})]})]})]})]})]}),d===8&&o.jsxs("div",{className:"animate-fade-in w-full max-w-lg mx-auto text-center",children:[o.jsx("div",{className:"w-24 h-24 md:w-32 md:h-32 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-8 shadow-glow animate-float",children:_?o.jsx(Qt,{size:48,className:"text-green-600 dark:text-green-400 md:scale-125"}):o.jsx(T0,{size:48,className:"text-green-600 dark:text-green-400 md:scale-125",strokeWidth:1.5})}),_?o.jsxs("div",{className:"animate-scale-in",children:[o.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-spiritual-900 dark:text-spiritual-50 mb-6",children:"Sanctuary Secured"}),o.jsx("p",{className:"text-lg text-spiritual-600 dark:text-spiritual-300 font-medium",children:"Your space is now private."}),ie&&!n.security.biometricsEnabled&&o.jsx("div",{className:"mt-6",children:o.jsxs("button",{onClick:ye,className:"flex items-center gap-2 mx-auto px-6 py-3 bg-white dark:bg-spiritual-800 rounded-xl border border-spiritual-100 dark:border-spiritual-700 shadow-sm hover:shadow-md transition-all",children:[o.jsx(Ll,{size:20,className:"text-spiritual-500"}),o.jsx("span",{className:"font-bold text-spiritual-800 dark:text-spiritual-100",children:"Enable Biometrics"})]})})]}):o.jsxs(o.Fragment,{children:[T==="none"&&o.jsxs(o.Fragment,{children:[o.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-spiritual-900 dark:text-spiritual-50 mb-6",children:"Your Private Sanctuary"}),o.jsxs("div",{className:"bg-white/50 dark:bg-spiritual-800/50 p-6 md:p-8 rounded-[2rem] border border-spiritual-100 dark:border-spiritual-700/50 backdrop-blur-sm mb-8",children:[o.jsx("p",{className:"text-lg text-spiritual-600 dark:text-spiritual-300 font-medium leading-relaxed mb-6",children:"Data is synced to your account, but you can add a local lock to ensure only you can open the app on this device."}),o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsxs("button",{onClick:()=>A("pin"),className:"p-4 bg-white dark:bg-spiritual-900 rounded-xl border border-spiritual-100 dark:border-spiritual-700 hover:border-green-500 hover:shadow-md transition-all flex flex-col items-center gap-2",children:[o.jsx(Ho,{size:24,className:"text-spiritual-500"}),o.jsx("span",{className:"font-bold text-spiritual-800 dark:text-spiritual-100",children:"Set PIN"})]}),o.jsxs("button",{onClick:()=>A("passphrase"),className:"p-4 bg-white dark:bg-spiritual-900 rounded-xl border border-spiritual-100 dark:border-spiritual-700 hover:border-green-500 hover:shadow-md transition-all flex flex-col items-center gap-2",children:[o.jsx(nm,{size:24,className:"text-spiritual-500"}),o.jsx("span",{className:"font-bold text-spiritual-800 dark:text-spiritual-100",children:"Passphrase"})]})]})]})]}),T==="pin"&&o.jsx("div",{className:"bg-white/80 dark:bg-spiritual-900/80 p-6 rounded-[2.5rem] shadow-xl border border-spiritual-100 dark:border-spiritual-700 animate-slide-in-bottom",children:o.jsx(zl,{mode:"setup",onSuccess:()=>he("pin"),onCancel:()=>A("none")})}),T==="passphrase"&&o.jsx("div",{className:"bg-white/80 dark:bg-spiritual-900/80 p-6 rounded-[2.5rem] shadow-xl border border-spiritual-100 dark:border-spiritual-700 animate-slide-in-bottom",children:o.jsx($l,{mode:"setup",onSuccess:()=>he("passphrase"),onCancel:()=>A("none")})})]})]}),d===9&&o.jsxs("div",{className:"animate-fade-in w-full max-w-2xl mx-auto",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("div",{className:"w-20 h-20 bg-red-50 dark:bg-red-900/20 rounded-full flex items-center justify-center mx-auto mb-4 animate-float",children:o.jsx(E0,{size:32,className:"text-red-500/80 dark:text-red-400"})}),o.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-spiritual-900 dark:text-spiritual-50 mb-2",children:"Legal Disclaimer"}),o.jsx("p",{className:"text-spiritual-500 dark:text-spiritual-400",children:"Please review and accept to continue."})]}),o.jsx("div",{className:"bg-white/50 dark:bg-spiritual-800/50 p-6 md:p-8 rounded-[2rem] border border-spiritual-100 dark:border-spiritual-700/50 backdrop-blur-sm shadow-sm mb-8",children:o.jsxs("div",{className:"space-y-4 text-sm md:text-base text-spiritual-700 dark:text-spiritual-300 font-medium leading-relaxed",children:[o.jsxs("p",{children:[o.jsx("span",{className:"font-bold",children:"1."})," THE DEVELOPER'S OR DISTRIBUTOR'S OF THIS APP SHALL NOT BE LIABLE FOR ANY DIRECT, INDIRECT, PUNITIVE, INCIDENTAL, SPECIAL CONSEQUENTIAL OR ANY DAMAGES WHATSOEVER ARISING OUT OF OR IN ANY WAY CONNECTED WITH THE USE OF THIS APP."]}),o.jsxs("p",{children:[o.jsx("span",{className:"font-bold",children:"2."})," AS A USER OF THIS APP, I ASSUME THE WHOLE AND SOLE LIABILITY FOR ANY AND ALL CONSEQUENCES FROM ITS USE."]}),o.jsxs("p",{children:[o.jsx("span",{className:"font-bold",children:"3."})," THE USER SHALL NOT COPY, REPLICATE, MODIFY, MISUSE OR REDISTRIBUTE ANY PART OF THIS APPLICATION content, design or concept of this application."]})]})}),o.jsx("div",{className:"flex justify-center",children:o.jsxs("label",{className:"flex items-center gap-3 cursor-pointer group p-4 rounded-xl hover:bg-spiritual-100/50 dark:hover:bg-white/5 transition-colors",children:[o.jsx("div",{className:`w-6 h-6 rounded-md border-2 flex items-center justify-center transition-all ${ce?"bg-spiritual-800 border-spiritual-800 dark:bg-spiritual-100 dark:border-spiritual-100":"border-spiritual-300 dark:border-spiritual-500"}`,children:ce&&o.jsx(Fn,{size:14,className:"text-white dark:text-spiritual-900",strokeWidth:3})}),o.jsx("input",{type:"checkbox",className:"hidden",checked:ce,onChange:Y=>Re(Y.target.checked)}),o.jsx("span",{className:"font-bold text-spiritual-800 dark:text-spiritual-100 select-none",children:"I have read and I agree to the disclaimer"})]})})]})]})})}),o.jsx("div",{className:"w-full p-6 pb-8 safe-area-pb border-t border-spiritual-100/50 dark:border-white/5 bg-spiritual-50/90 dark:bg-spiritual-deep/90 backdrop-blur-lg z-10",children:o.jsxs("div",{className:"max-w-md md:max-w-2xl mx-auto flex flex-col gap-6",children:[o.jsx("div",{className:"flex justify-center",children:o.jsx(ne,{})}),d!==xe&&d!==1&&o.jsx("button",{onClick:Ee,className:"w-full py-5 bg-spiritual-800 dark:bg-spiritual-100 text-white dark:text-spiritual-900 rounded-[2rem] font-bold text-xl shadow-xl hover:bg-spiritual-900 dark:hover:bg-white hover:scale-[1.02] transition-all active:scale-95 flex items-center justify-center gap-3 group",children:d===0?o.jsxs(o.Fragment,{children:["Begin Journey ",o.jsx(oa,{size:24})]}):o.jsxs(o.Fragment,{children:["Continue ",o.jsx(Dt,{size:24})]})}),d===xe&&o.jsx("button",{onClick:r,disabled:!ce,className:`w-full py-5 rounded-[2rem] font-bold text-xl transition-all active:scale-95 border-2 ${ce?"bg-spiritual-800 dark:bg-spiritual-100 text-white dark:text-spiritual-900 border-spiritual-800 dark:border-spiritual-100 shadow-xl hover:scale-[1.02]":"bg-transparent border-spiritual-200 dark:border-spiritual-700 text-spiritual-300 dark:text-spiritual-600 cursor-not-allowed"}`,children:"Enter Sanctuary"}),d>0&&T==="none"&&!_&&o.jsxs("button",{onClick:Ae,className:"text-spiritual-500 dark:text-spiritual-400 font-bold text-sm flex items-center justify-center gap-1 hover:text-spiritual-800 dark:hover:text-spiritual-200 transition-colors",children:[o.jsx(rm,{size:16})," Back"]})]})})]})},DT=[{id:"kriya-pranayam",title:"Kriya Pranayam",description:"Practice Kundalini Pranayams as per Kriya syllabus",isUnguided:!0,config:{inhale:0,holdIn:0,exhale:0,holdOut:0},theme:{primary:"text-amber-400",secondary:"bg-amber-900",gradient:"from-amber-900 to-black",accent:"text-amber-400",text:"text-amber-100",blob:"bg-amber-500",ring:"border-amber-400/30",ghostRing:"border-amber-500/10",core:"bg-amber-400/20",button:"bg-amber-600 hover:bg-amber-500"},meta:{level:"advanced",category:["spiritual","energy"],bestTime:"morning",mechanism:"thoracic"}},{id:wr.BOX,title:"Box Breathing",description:"Equal duration for all phases. Great for focus and stress relief.",config:{inhale:4,holdIn:4,exhale:4,holdOut:4},theme:{primary:"text-sky-600 dark:text-sky-400",secondary:"bg-sky-100 dark:bg-sky-900/30",gradient:"from-sky-900 via-sky-950 to-slate-900",accent:"text-sky-400",text:"text-sky-100",blob:"bg-sky-500",ring:"border-sky-400/30",ghostRing:"border-sky-500/10",core:"bg-sky-400/20",button:"bg-sky-600 hover:bg-sky-500"},meta:{level:"beginner",category:["focus","calm"],bestTime:"any",ratio:"1:1:1:1"}},{id:wr.RELAX_4_7_8,title:"4-7-8 Breathing",description:"Extended exhale for sleep & relaxation.",config:{inhale:4,holdIn:7,exhale:8,holdOut:0},theme:{primary:"text-indigo-600 dark:text-indigo-400",secondary:"bg-indigo-100 dark:bg-indigo-900/30",gradient:"from-indigo-900 via-indigo-950 to-slate-900",accent:"text-indigo-400",text:"text-indigo-100",blob:"bg-indigo-500",ring:"border-indigo-400/30",ghostRing:"border-indigo-500/10",core:"bg-indigo-400/20",button:"bg-indigo-600 hover:bg-indigo-500"},meta:{level:"beginner",category:["sleep","calm"],bestTime:"pre-sleep",ratio:"1:1.75:2"}},{id:wr.DEEP_BELLY,title:"Deep Breathing",description:"Simple rhythmic diaphragmatic breathing to ground yourself.",config:{inhale:4,holdIn:0,exhale:4,holdOut:0},theme:{primary:"text-emerald-600 dark:text-emerald-400",secondary:"bg-emerald-100 dark:bg-emerald-900/30",gradient:"from-emerald-900 via-emerald-950 to-slate-900",accent:"text-emerald-400",text:"text-emerald-100",blob:"bg-emerald-500",ring:"border-emerald-400/30",ghostRing:"border-emerald-500/10",core:"bg-emerald-400/20",button:"bg-emerald-600 hover:bg-emerald-500"},meta:{level:"beginner",category:["calm","balance"],bestTime:"any",mechanism:"abdominal"}},{id:wr.ANULOM_VILOM,title:"Anulom Vilom",description:"Alternate nostril breathing for balancing energy channels.",config:{inhale:4,holdIn:4,exhale:4,holdOut:0},instructionCycles:[{inhale:"Inhale from Left",holdIn:"Hold",exhale:"Exhale from Right"},{inhale:"Inhale from Right",holdIn:"Hold",exhale:"Exhale from Left"}],theme:{primary:"text-amber-600 dark:text-amber-400",secondary:"bg-amber-100 dark:bg-amber-900/30",gradient:"from-amber-900 via-amber-950 to-slate-900",accent:"text-amber-400",text:"text-amber-100",blob:"bg-amber-500",ring:"border-amber-400/30",ghostRing:"border-amber-500/10",core:"bg-amber-400/20",button:"bg-amber-600 hover:bg-amber-500"},meta:{level:"beginner",category:["balance","focus"],bestTime:"any",mechanism:"alternate_nostril"}},{id:wr.KAPALBHATI,title:"Kapalbhati",description:"Skull Shining Breath. Rapid, forceful exhalation cycles.",config:{inhale:0,holdIn:0,exhale:1.2,holdOut:0},theme:{primary:"text-orange-600 dark:text-orange-400",secondary:"bg-orange-100 dark:bg-orange-900/30",gradient:"from-orange-700 via-red-900 to-slate-950",accent:"text-orange-400",text:"text-orange-100",blob:"bg-orange-500",ring:"border-orange-400/30",ghostRing:"border-orange-500/10",core:"bg-orange-400/20",button:"bg-orange-600 hover:bg-orange-500"},meta:{level:"intermediate",category:["energy","healing"],bestTime:"morning",mechanism:"abdominal",contraindications:["high_bp","pregnancy","heart_conditions"]}}],PT=[{id:"kriya-asana",title:"Kriya Asana",description:"Practice of Kriya Hatha Yoga - Siddha Asansas as per syllabus",benefit:"Streamline the flow for energy.",isUnguided:!0,theme:{primary:"text-amber-400",secondary:"bg-amber-900",gradient:"bg-amber-900",accent:"text-amber-400",text:"text-amber-100"},meta:{level:"advanced",category:["spiritual","energy"],bestTime:"morning",postureTypes:["sitting","standing"]},steps:[]},{id:"surya",title:"Suryanamaskar Sequence",description:"The Sun Salutation. A classic flow of 12 poses.",benefit:"Full body workout, improves flexibility and circulation.",theme:{primary:"text-orange-600 dark:text-orange-400",secondary:"bg-orange-100 dark:bg-orange-900/30",gradient:"bg-orange-900",accent:"text-orange-400",text:"text-orange-100"},meta:{level:"intermediate",category:["energy","flexibility","strength"],bestTime:"morning",postureTypes:["standing","prone","inversion"],bodyFocus:["full-body","spine","hamstrings"]},steps:[{name:"Namaskarasan",instruction:"Stand straight. Spine erect. Feet together. Palms together at the chest.",imageType:"pranamasana",duration:20},{name:"Taadasan",instruction:"Breathing in, lift your arms up and back, keeping the biceps close to the ears.",imageType:"hastauttanasana-rt",duration:20},{name:"Hastapadasan",instruction:"Breathing out, bend forward from the waist. Bring hands down to the floor.",imageType:"hastapadasana-rt",duration:20},{name:"Ek-Paad-Prasarnasan",instruction:"Breathing in, push your right leg back. Look up.",imageType:"ashwa-rt",duration:20},{name:"Dandasan",instruction:"Hold breath and bring the left leg back. Keep body in a straight line.",imageType:"dandasana",duration:20},{name:"Ashtanga-Pranipaatasan",instruction:"Gently bring your knees down, then chest and chin. Hips slightly up.",imageType:"ashtanga",duration:20},{name:"Bhujangasan",instruction:"Slide forward and raise the chest up into Cobra pose. Look up.",imageType:"bhujangasana",duration:20},{name:"Adho Mukha Svanasana",instruction:"Breathing out, lift the hips and the tailbone up to make an inverted V.",imageType:"parvatasana",duration:20},{name:"Ek-Paad-Prasarnasan",instruction:"Breathing in, bring the right foot forward between the two hands.",imageType:"ashwa-lt",duration:20},{name:"Hastapadasana",instruction:"Breathing out, bring the left foot forward. Keep palms on the floor.",imageType:"hastapadasana-lt",duration:20},{name:"Taadasan",instruction:"Breathing in, roll the spine up. Hands go up and back.",imageType:"hastauttanasana-lt",duration:20},{name:"Dakshasan",instruction:"Exhale and return to standing position, arms by your side.",imageType:"samasthiti",duration:20}]},{id:"veerabhadrasana",title:"Veerabhadrasan Sequence",description:"Foundational balancing and strength poses for stability.",benefit:"Improves balance, leg strength, and hip flexibility.",theme:{primary:"text-slate-600 dark:text-slate-400",secondary:"bg-slate-100 dark:bg-slate-800/30",gradient:"bg-slate-900",accent:"text-slate-400",text:"text-slate-100"},meta:{level:"intermediate",category:["strength","balance"],bestTime:"morning",postureTypes:["standing","balancing"],bodyFocus:["hips","knees","shoulders"]},steps:[{name:"Stand Tall",instruction:"Get ready. Stand straight. Spine erect. Feet together. Arms by your side.",imageType:"samasthiti",duration:20},{name:"Get Ready",instruction:"Stand with feet 2 feet apart. Inhale, raise arms to shoulder level.",imageType:"kativakrasana",duration:20},{name:"Veerabhadrasana I (Warrior 1)",instruction:"Slowly turn your hip to your left. Bend left knee to 90 degrees. right leg stretched back, Hands stretched out",imageType:"veerabhadrasana-1-lt",duration:20},{name:"Veerabhadrasana II (Warrior 2)",instruction:"Smoothly move to the next position. Raise arms overhead, palms touching each other. Stretch back as per capacity.",imageType:"veerabhadrasana-2-lt",duration:20},{name:"Veerabhadrasana III (Warrior 3)",instruction:"Smoothly Shift your weight to left leg. Hinge forward, lifting right leg back. Arms reach forward. Body in a T-shape.",imageType:"veerabhadrasana-3-lt",duration:20},{name:"Landing",instruction:"Slowly return to the landing position. Feet apart. Hands spread out.",imageType:"kativakrasana",duration:20},{name:"Rest",instruction:"Come back to normal position. Close your eyes and feel the stability.",imageType:"samasthiti",duration:20},{name:"Get Ready",instruction:"Get ready. Stand with feet 2 feet apart. Inhale, raise arms to shoulder level.",imageType:"kativakrasana",duration:20},{name:"Veerabhadrasana I (Warrior 1)",instruction:"Slowly turn your hip to your right. Bend right knee to 90 degrees. left leg stretched back, Hands stretched out",imageType:"veerabhadrasana-1-rt",duration:20},{name:"Veerabhadrasana II (Warrior 2)",instruction:"Smoothly move to the next position. Raise arms overhead, palms touching each other. Stretch back as per capacity.",imageType:"veerabhadrasana-2-rt",duration:20},{name:"Veerabhadrasana III (Warrior 3)",instruction:"Smoothly Shift your weight to right leg. Hinge forward, lifting left leg back. Arms reach forward. Body in a T-shape.",imageType:"veerabhadrasana-3-rt",duration:20},{name:"Landing",instruction:"Slowly return to the landing position. Feet apart. Hands spread out.",imageType:"kativakrasana",duration:20},{name:"Rest",instruction:"Come back to normal position. Close your eyes and feel the stability.",imageType:"samasthiti",duration:20}]},{id:"trikonasana",title:"Trikonasana",description:"For balancing and strength poses for stability.",benefit:"Improves balance, leg strength, and hip flexibility.",theme:{primary:"text-red-600 dark:text-red-400",secondary:"bg-red-100 dark:bg-red-900/30",gradient:"bg-red-900",accent:"text-red-400",text:"text-red-100"},meta:{level:"beginner",category:["flexibility","balance"],bestTime:"any",postureTypes:["standing"],bodyFocus:["hips","spine"]},steps:[{name:"Stand Tall",instruction:"Get ready. Stand straight. Spine erect. Feet together. Arms by your side.",imageType:"samasthiti",duration:20},{name:"Trikonasana (Triangle)",instruction:"Step feet wide. Turn right foot out. Reach right hand down, try to touch the ground, left hand up to sky. Gaze up.",imageType:"trikonasana-rt",duration:20},{name:"Rest",instruction:"Return to standing. Close your eyes and feel the stability.",imageType:"samasthiti",duration:20},{name:"Trikonasana (Triangle)",instruction:"Step feet wide. Turn left foot out. Reach left hand down, try to touch the ground, right hand up to sky. Gaze up.",imageType:"trikonasana-lt",duration:20},{name:"Rest",instruction:"Return to standing. Close your eyes and feel the stability.",imageType:"samasthiti",duration:20}]},{id:"vrikshasana",title:"Vrikshasana",description:"For balancing and strength poses for stability.",benefit:"Improves balance, leg strength, and hip flexibility.",theme:{primary:"text-teal-600 dark:text-teal-400",secondary:"bg-teal-100 dark:bg-teal-900/30",gradient:"bg-teal-900",accent:"text-teal-400",text:"text-teal-100"},meta:{level:"beginner",category:["balance","focus"],bestTime:"any",postureTypes:["standing","balancing"],bodyFocus:["hips","knees","core"]},steps:[{name:"Stand Tall",instruction:"Get Ready. Stand straight. Spine erect. Feet together. Arms by your side.",imageType:"samasthiti",duration:20},{name:"Vrikshasana (Tree Pose)",instruction:"Shift weight to left leg. Place right foot on left inner thigh. Hands in prayer above head.",imageType:"vrikshasana-rt",duration:20},{name:"Rest",instruction:"Return to standing. Close your eyes and feel the stability.",imageType:"samasthiti",duration:20},{name:"Vrikshasana (Tree Pose)",instruction:"Shift weight to right leg. Place left foot on right inner thigh. Hands in prayer above head.",imageType:"vrikshasana-lt",duration:20},{name:"Rest",instruction:"Return to standing. Close your eyes and feel the stability.",imageType:"samasthiti",duration:20}]},{id:"tadasana",title:"Taadasana Sequence",description:"Palm Tree Pose. The foundation of all standing poses.",benefit:"Corrects posture, strengthens thighs, knees, and ankles.",theme:{primary:"text-cyan-600 dark:text-cyan-400",secondary:"bg-cyan-100 dark:bg-cyan-900/30",gradient:"bg-cyan-900",accent:"text-cyan-400",text:"text-cyan-100"},meta:{level:"beginner",category:["balance","strength"],bestTime:"morning",postureTypes:["standing"],bodyFocus:["full-body","spine"]},steps:[{name:"Stand Tall",instruction:"Stand with feet slightly apart. Weight balanced evenly on both feet. Chest out. Neck straight",imageType:"samasthiti",duration:20},{name:"Interlock Fingers",instruction:"Inhale, raise your arms above your head and interlock your fingers.",imageType:"tadasana",duration:20},{name:"Stretch Up",instruction:"Turn palms upward. Lift your heels and stand on your toes. Stretch the whole body up.",imageType:"hastauttanasana-rt",duration:20},{name:"Hold & Breathe",instruction:"Hold the pose for 15-30 seconds while breathing gently.",imageType:"hastauttanasana-lt",duration:20},{name:"Normal Position",instruction:"Exhale and return to standing position, arms by your side.",imageType:"samasthiti",duration:20}]},{id:"kati",title:"Kativakrasana",description:"Standing Spinal Twist.",benefit:"Relieves constipation and back pain. Makes the spine flexible.",theme:{primary:"text-blue-600 dark:text-blue-400",secondary:"bg-blue-100 dark:bg-blue-900/30",gradient:"bg-blue-900",accent:"text-blue-400",text:"text-blue-100"},meta:{level:"beginner",category:["flexibility","healing"],bestTime:"any",postureTypes:["standing","twisting"],bodyFocus:["spine"]},steps:[{name:"Stand Tall",instruction:"Stand straight. Weight balanced evenly on both feet. Chest out. Neck straight",imageType:"samasthiti",duration:20},{name:"Get Ready",instruction:"Feet slightly apart. Inhale and raise arms to shoulder level.",imageType:"kativakrasana-ft",duration:20},{name:"Twist Left",instruction:"Exhale and twist to the left. Move around from your waist with both hands turning left.",imageType:"kativakrasana-l",duration:20},{name:"Look Back",instruction:"Turn neck to look over the left shoulder. Keep feet firmly planted.",imageType:"kativakrasana-l",duration:20},{name:"Center",instruction:"Come back to the the center. Keep normal breath.",imageType:"kativakrasana-ft",duration:20},{name:"Normal Position",instruction:"Bring your hands down to the normal position. Relax..",imageType:"samasthiti",duration:20},{name:"Get Ready",instruction:"Again. Inhale, raise arms to shoulder level.",imageType:"kativakrasana-ft",duration:20},{name:"Twist Right",instruction:"Exhale and twist to the right. Move around from your waist with both hands turning right.",imageType:"kativakrasana-r",duration:20},{name:"Look Back",instruction:"Turn neck to look over the right shoulder. Keep feet firmly planted.",imageType:"kativakrasana-r",duration:20},{name:"Center",instruction:"Come back to the the center. Keep normal breath.",imageType:"kativakrasana-ft",duration:20},{name:"Normal Position",instruction:"Bring your hands down to the normal position. Relax.",imageType:"samasthiti",duration:20}]},{id:"markat",title:"Markatasana",description:"Monkey Pose (Spinal Twist).",benefit:"Excellent for the back, hips, and digestive system.",theme:{primary:"text-indigo-600 dark:text-indigo-400",secondary:"bg-indigo-100 dark:bg-indigo-900/30",gradient:"bg-indigo-900",accent:"text-indigo-400",text:"text-indigo-100"},meta:{level:"beginner",category:["flexibility","calm"],bestTime:"any",postureTypes:["supine","twisting"],bodyFocus:["spine","hips"]},steps:[{name:"Lie Down",instruction:"Lie flat on your back. Spread arms at shoulder level.",imageType:"markatasana",duration:20},{name:"Bend left",instruction:"Bend left knee and bring it to the center. Keep right leg straight.",imageType:"markatasana-kb-l",duration:20},{name:"Twist Left",instruction:"Drop the knee to the right side. Turn your head to the left. Feel the twist.",imageType:"markatasana-rt",duration:20},{name:"Normal position",instruction:"Come back to normal position.",imageType:"markatasana",duration:20},{name:"Bend Right",instruction:"Now Bend the right knee and bring it to the center. Keep left leg straight.",imageType:"markatasana-kb-r",duration:20},{name:"Twist right",instruction:"Drop the knee to the left side. Head turns right. Hold",imageType:"markatasana-lt",duration:20},{name:"Normal position",instruction:"Come back to normal position. Relax.",imageType:"markatasana",duration:20}]},{id:"hasta",title:"Hastapaadasana",description:"Standing Forward Bend.",benefit:"Stretches hamstrings and back muscles. Calms the mind.",theme:{primary:"text-rose-600 dark:text-rose-400",secondary:"bg-rose-100 dark:bg-rose-900/30",gradient:"bg-rose-900",accent:"text-rose-400",text:"text-rose-100"},meta:{level:"beginner",category:["flexibility","calm"],bestTime:"any",postureTypes:["standing"],bodyFocus:["hamstrings","spine"]},steps:[{name:"Stand Tall",instruction:"Stand with feet slightly apart. Weight balanced evenly on both feet. Chest out. Neck straight",imageType:"samasthiti",duration:20},{name:"Stretch Up",instruction:"Inhale and lift arms straight up.",imageType:"tadasana",duration:20},{name:"Exhale Down",instruction:"Exhale and bend forward from the hips, not the waist.",imageType:"hastapadasana-rt",duration:20},{name:"Touch Floor",instruction:"Try to touch the floor or hold your ankles. Keep legs straight.",imageType:"hastapadasana-rt",duration:20},{name:"Stretch Up",instruction:"Again Inhale and lift arms straight up.",imageType:"tadasana",duration:20},{name:"Release",instruction:"Come back to normal position. Relax.",imageType:"samasthiti",duration:20}]}],jT=[{id:"kriya-mantra",title:"Kriya Mantra",sanskritTitle:"Mantra Japa",description:"Gurumantra or Shabri Mantra Japa.",deity:"Universal",meaning:"Silent repetition of Gurumantra or Shabri Mantra",isUnguided:!0,meta:{level:"advanced",category:["spiritual","devotion"],bestTime:"any",rishi:"-",chandas:"-",devata:"-",bija:"-",shakti:"-",keelak:"-"},sanskritLine:"",baseDuration:0,theme:{primary:"text-amber-400",secondary:"bg-amber-900",gradient:"from-amber-900 to-black",accent:"text-amber-200",text:"text-white",textHighlight:"text-white"},syllables:[]},{id:"gayatri",title:"Gayatri Mantra",sanskritTitle:" ",description:"The foremost mantra in Hinduism, dedicated to Savitr, the Sun deity.",deity:"Savitr (Sun)",meaning:"We meditate on the glory of the Creator; Who has created the Universe; Who is worthy of Worship; Who is the embodiment of Knowledge and Light; Who is the remover of all Sin and Ignorance; May He enlighten our Intellect.",meta:{level:"intermediate",category:["spiritual","focus","healing"],bestTime:"morning",rishi:"Vishwamitra",chandas:"Gayatri (24)",devata:"Savitr",bija:"Tat",shakti:"Vareya",keelak:"Prachodayt"},sanskritLine:" : :          :  ",baseDuration:15,rootNote:"D3",theme:{primary:"text-orange-600 dark:text-orange-400",secondary:"bg-orange-100 dark:bg-orange-900/30",gradient:"from-orange-500 to-amber-600",accent:"text-amber-200",text:"text-white",textHighlight:"text-white"},syllables:[{text:"Om",textDevanagari:"",durationRatio:2,spaceAfter:!0,note:"D3"},{text:"Bhr",textDevanagari:"",durationRatio:2,spaceAfter:!0,note:"F#3"},{text:"Bhu",textDevanagari:"",durationRatio:1,note:"E3"},{text:"va",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"F#3"},{text:"Sva",textDevanagari:"",durationRatio:2,spaceAfter:!0,note:"A3"},{text:"|",durationRatio:2,type:"punctuation",note:"A3"},{text:"Tat",textDevanagari:"",durationRatio:1,note:"A3"},{text:"sa",textDevanagari:"",durationRatio:1,note:"A3"},{text:"vi",textDevanagari:"",durationRatio:1,note:"G3"},{text:"tur",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"F#3"},{text:"va",textDevanagari:"",durationRatio:1,note:"F#3"},{text:"re",textDevanagari:"",durationRatio:1,note:"E3"},{text:"ya",textDevanagari:"",durationRatio:2,spaceAfter:!0,note:"D3"},{text:"|",durationRatio:2,type:"punctuation",note:"D3"},{text:"Bhar",textDevanagari:"",durationRatio:1,note:"D3"},{text:"go",textDevanagari:"",durationRatio:2,spaceAfter:!0,note:"E3"},{text:"de",textDevanagari:"",durationRatio:1,note:"F#3"},{text:"va",textDevanagari:"",durationRatio:1,note:"G3"},{text:"sya",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"F#3"},{text:"dh",textDevanagari:"",durationRatio:2,note:"E3"},{text:"ma",textDevanagari:"",durationRatio:1,note:"E3"},{text:"hi",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"D3"},{text:"|",durationRatio:2,type:"punctuation",note:"D3"},{text:"Dhi",textDevanagari:"",durationRatio:1,note:"D3"},{text:"yo",textDevanagari:"",durationRatio:2,spaceAfter:!0,note:"E3"},{text:"yo",textDevanagari:"",durationRatio:2,spaceAfter:!0,note:"F#3"},{text:"na",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"G3"},{text:"pra",textDevanagari:"",durationRatio:1,note:"A3"},{text:"cho",textDevanagari:"",durationRatio:2,note:"F#3"},{text:"da",textDevanagari:"",durationRatio:1,note:"E3"},{text:"yt",textDevanagari:"",durationRatio:2,spaceAfter:!0,note:"D3"},{text:"||",durationRatio:4,type:"punctuation",note:"D3"}]},{id:"mahamrityunjaya",title:"Maha Mrityunjaya",sanskritTitle:" ",description:"The Great Death-Conquering Mantra, for healing and liberation.",deity:"Lord Shiva",meaning:"We worship the Three-Eyed One (Lord Shiva), who is fragrant and nourishes all beings. May He liberate us from death for the sake of immortality, even as the cucumber is severed from bondage to the creeper.",meta:{level:"intermediate",category:["healing","protection","spiritual"],bestTime:"any",rishi:"Vashistha",chandas:"Anushtubh (32)",devata:"Rudra/Shiva",bija:"Om J Sa",shakti:"Vareya",keelak:"mmtt"},sanskritLine:"            ",baseDuration:20,rootNote:"C3",theme:{primary:"text-indigo-600 dark:text-indigo-400",secondary:"bg-indigo-100 dark:bg-indigo-900/30",gradient:"from-slate-800 to-indigo-900",accent:"text-indigo-300",text:"text-white",textHighlight:"text-indigo-100"},syllables:[{text:"Om",textDevanagari:"",durationRatio:2,spaceAfter:!0,note:"C3"},{text:"Try",textDevanagari:"",durationRatio:1,note:"D#3"},{text:"am",textDevanagari:"",durationRatio:1,note:"D#3"},{text:"ba",textDevanagari:"",durationRatio:1,note:"D3"},{text:"ka",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"C3"},{text:"ya",textDevanagari:"",durationRatio:1,note:"D3"},{text:"j",textDevanagari:"",durationRatio:2,note:"D#3"},{text:"ma",textDevanagari:"",durationRatio:1,note:"F3"},{text:"he",textDevanagari:"",durationRatio:2,spaceAfter:!0,note:"D#3"},{text:"|",durationRatio:2,type:"punctuation",note:"D#3"},{text:"Su",textDevanagari:"",durationRatio:1,note:"G3"},{text:"gan",textDevanagari:"",durationRatio:1,note:"F3"},{text:"dhi",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"D#3"},{text:"pu",textDevanagari:"",durationRatio:1,note:"F3"},{text:"i",textDevanagari:"",durationRatio:1,note:"G3"},{text:"var",textDevanagari:"",durationRatio:1,note:"G3"},{text:"dha",textDevanagari:"",durationRatio:1,note:"F3"},{text:"nam",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"D#3"},{text:"|",durationRatio:2,type:"punctuation",note:"D#3"},{text:"Ur",textDevanagari:"",durationRatio:1,note:"C4"},{text:"v",textDevanagari:"",durationRatio:2,note:"A#3"},{text:"ru",textDevanagari:"",durationRatio:1,note:"G3"},{text:"ka",textDevanagari:"",durationRatio:1,note:"F3"},{text:"mi",textDevanagari:"",durationRatio:1,note:"D#3"},{text:"va",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"F3"},{text:"ban",textDevanagari:"",durationRatio:1,note:"G3"},{text:"dha",textDevanagari:"",durationRatio:1,note:"F3"},{text:"nn",textDevanagari:"",durationRatio:2,spaceAfter:!0,note:"D#3"},{text:"|",durationRatio:2,type:"punctuation",note:"D#3"},{text:"M",textDevanagari:"",durationRatio:1,note:"G3"},{text:"tyor",textDevanagari:"",durationRatio:1,note:"F3"},{text:"mu",textDevanagari:"",durationRatio:1,note:"D#3"},{text:"k",textDevanagari:"",durationRatio:2,note:"D3"},{text:"ya",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"C3"},{text:"mm",textDevanagari:"",durationRatio:2,spaceAfter:!0,note:"D#3"},{text:"",textDevanagari:"",durationRatio:1,note:"D3"},{text:"tt",textDevanagari:"",durationRatio:2,spaceAfter:!0,note:"C3"},{text:"||",durationRatio:4,type:"punctuation",note:"C3"}]},{id:"hare_krishna",title:"Hare Krishna",sanskritTitle:"  ",description:"The Maha Mantra for liberation and divine connection.",deity:"Radha-Krishna",meaning:"O Energy of the Lord (Hare), O All-Attractive Lord (Krishna), O Supreme Enjoyer (Rama), please engage me in Your service.",meta:{level:"beginner",category:["devotion","energy","joy"],bestTime:"any",rishi:"Brahma",chandas:"Anushtubh (32)",devata:"Radha-Krishna",bija:"Hare",shakti:"Krishna / Rama",keelak:"The names themselves"},sanskritLine:"                   ",baseDuration:18,rootNote:"E3",theme:{primary:"text-emerald-600 dark:text-emerald-400",secondary:"bg-emerald-100 dark:bg-emerald-900/30",gradient:"from-teal-600 to-emerald-800",accent:"text-yellow-200",text:"text-white",textHighlight:"text-emerald-50"},syllables:[{text:"Ha",textDevanagari:"",durationRatio:1,note:"G3"},{text:"re",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"G3"},{text:"K",textDevanagari:"",durationRatio:1,note:"F#3"},{text:"a",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"G3"},{text:"|",durationRatio:2,type:"punctuation",note:"A3"},{text:"Ha",textDevanagari:"",durationRatio:1,note:"A3"},{text:"re",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"A3"},{text:"K",textDevanagari:"",durationRatio:1,note:"G3"},{text:"a",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"A3"},{text:"|",durationRatio:2,type:"punctuation",note:"A3"},{text:"K",textDevanagari:"",durationRatio:1,note:"B3"},{text:"a",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"B3"},{text:"K",textDevanagari:"",durationRatio:1,note:"A3"},{text:"a",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"B3"},{text:"Ha",textDevanagari:"",durationRatio:1,note:"G3"},{text:"re",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"G3"},{text:"Ha",textDevanagari:"",durationRatio:1,note:"F#3"},{text:"re",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"G3"},{text:"|",durationRatio:2,type:"punctuation",note:"G3"},{text:"Ha",textDevanagari:"",durationRatio:1,note:"G3"},{text:"re",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"G3"},{text:"R",textDevanagari:"",durationRatio:2,note:"F#3"},{text:"ma",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"G3"},{text:"|",durationRatio:2,type:"punctuation",note:"A3"},{text:"Ha",textDevanagari:"",durationRatio:1,note:"A3"},{text:"re",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"A3"},{text:"R",textDevanagari:"",durationRatio:2,note:"G3"},{text:"ma",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"A3"},{text:"|",durationRatio:2,type:"punctuation",note:"A3"},{text:"R",textDevanagari:"",durationRatio:2,note:"B3"},{text:"ma",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"B3"},{text:"R",textDevanagari:"",durationRatio:2,note:"A3"},{text:"ma",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"B3"},{text:"Ha",textDevanagari:"",durationRatio:1,note:"G3"},{text:"re",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"G3"},{text:"Ha",textDevanagari:"",durationRatio:1,note:"F#3"},{text:"re",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"E3"},{text:"||",durationRatio:4,type:"punctuation",note:"E3"}]},{id:"om_namah_shivaya",title:"Om Namah Shivaya",sanskritTitle:"  ",description:"The five-syllable mantra of Lord Shiva.",deity:"Lord Shiva",meaning:"I bow to Shiva. The five syllables Na-Ma-Shi-Va-Ya represent earth, water, fire, air, and space.",meta:{level:"beginner",category:["peace","calm","spiritual"],bestTime:"any",rishi:"Vamadeva",chandas:"Panchakshari (5)",devata:"Shiva",bija:"Na",shakti:"i",keelak:"Ya"},sanskritLine:"   ",baseDuration:6,rootNote:"C#3",theme:{primary:"text-blue-600 dark:text-blue-400",secondary:"bg-blue-100 dark:bg-blue-900/30",gradient:"from-blue-900 to-black",accent:"text-white",text:"text-white",textHighlight:"text-blue-200"},syllables:[{text:"Om",textDevanagari:"",durationRatio:3,spaceAfter:!0,note:"C#3"},{text:"Na",textDevanagari:"",durationRatio:1,note:"D#3"},{text:"ma",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"F3"},{text:"Shi",textDevanagari:"",durationRatio:1,note:"G#3"},{text:"v",textDevanagari:"",durationRatio:2,note:"A#3"},{text:"ya",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"G#3"},{text:"||",durationRatio:4,type:"punctuation",note:"C#3"}]},{id:"ganesha",title:"Ganesha Mantra",sanskritTitle:"   ",description:"Mantra for removing obstacles and new beginnings.",deity:"Ganesha",meaning:"Salutations to the Remover of Obstacles, Lord Ganesha.",meta:{level:"beginner",category:["focus","strength"],bestTime:"morning",rishi:"Ganaka",chandas:"Nichrut Gayatri",devata:"Ganesha",bija:"Ga",shakti:"Ga Bija syllable)",keelak:"Nama"},sanskritLine:"    ",baseDuration:6,rootNote:"C3",theme:{primary:"text-red-600 dark:text-red-400",secondary:"bg-red-100 dark:bg-red-900/30",gradient:"from-red-600 to-orange-700",accent:"text-yellow-300",text:"text-white",textHighlight:"text-yellow-100"},syllables:[{text:"Om",textDevanagari:"",durationRatio:2,spaceAfter:!0,note:"C3"},{text:"Ga",textDevanagari:"",durationRatio:2,spaceAfter:!0,note:"D3"},{text:"Ga",textDevanagari:"",durationRatio:1,note:"E3"},{text:"a",textDevanagari:"",durationRatio:1,note:"E3"},{text:"pa",textDevanagari:"",durationRatio:1,note:"D3"},{text:"ta",textDevanagari:"",durationRatio:1,note:"D3"},{text:"ye",textDevanagari:"",durationRatio:2,spaceAfter:!0,note:"C3"},{text:"Na",textDevanagari:"",durationRatio:1,note:"D3"},{text:"ma",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"C3"},{text:"||",durationRatio:4,type:"punctuation",note:"C3"}]},{id:"vasudevaya",title:"Vishnu Mantra",sanskritTitle:"   ",description:"Mantra for preservation and compassion.",deity:"Lord Vishnu",meaning:"I bow to the Lord who lives in the hearts of all beings.",meta:{level:"beginner",category:["balance","protection","spiritual"],bestTime:"any",rishi:"Narada",chandas:"Dvadashakshari (12)",devata:"Vishnu",bija:"Om",shakti:"Vasudev (Liberating power of Lord Vishnu)",keelak:"Namo Bhagavate (complete surrender)"},sanskritLine:"    ",baseDuration:9,rootNote:"F3",theme:{primary:"text-sky-600 dark:text-sky-400",secondary:"bg-sky-100 dark:bg-sky-900/30",gradient:"from-sky-600 to-blue-800",accent:"text-yellow-300",text:"text-white",textHighlight:"text-white"},syllables:[{text:"Om",textDevanagari:"",durationRatio:2,spaceAfter:!0,note:"F3"},{text:"Na",textDevanagari:"",durationRatio:1,note:"G3"},{text:"mo",textDevanagari:"",durationRatio:2,spaceAfter:!0,note:"A3"},{text:"Bha",textDevanagari:"",durationRatio:1,note:"A#3"},{text:"ga",textDevanagari:"",durationRatio:1,note:"A3"},{text:"va",textDevanagari:"",durationRatio:1,note:"G3"},{text:"te",textDevanagari:"",durationRatio:2,spaceAfter:!0,note:"A3"},{text:"V",textDevanagari:"",durationRatio:2,note:"C4"},{text:"su",textDevanagari:"",durationRatio:1,note:"A#3"},{text:"de",textDevanagari:"",durationRatio:2,note:"A3"},{text:"v",textDevanagari:"",durationRatio:2,note:"G3"},{text:"ya",textDevanagari:"",durationRatio:1,spaceAfter:!0,note:"F3"},{text:"||",durationRatio:4,type:"punctuation",note:"F3"}]}],VT=[{id:"kriya-dhyana",title:"Kriya Dhyana",description:"Practice kundalini kriyas as per Kriya syllabus.",author:"-",durationDisplay:"-",duration:0,category:"Spiritual",isUnguided:!0,url:"",theme:{primary:"text-amber-400",secondary:"bg-amber-900",gradient:"from-amber-900 to-black",accent:"text-amber-400",text:"text-white"},meta:{level:"advanced",category:["spiritual"],bestTime:"any",style:"kriya"}},{id:"1",title:"Expansion",description:"A guided journey to expand your consciousness beyond physical limits.",author:"Dr. Mangeshda",durationDisplay:"07:57",duration:477,category:"Focus",url:"https://www.mangeshda.org/sites/default/files/2025-12/Guided%20Meditation%20IDY%202020.mp3",theme:{primary:"text-amber-600 dark:text-amber-400",secondary:"bg-amber-100 dark:bg-amber-900/30",gradient:"from-amber-200 to-orange-100",accent:"text-amber-600",text:"text-spiritual-900"},meta:{level:"beginner",category:["focus","spiritual"],bestTime:"morning",style:"visualization"}},{id:"2",title:"Body Scanning",description:"Systematic relaxation technique to release tension from every part of the body.",author:"Dr. Mangeshda",durationDisplay:"06:08",duration:368,category:"Relaxation",url:"https://www.mangeshda.org/sites/default/files/2025-12/Body%20Scan%20Meditation.mp3",theme:{primary:"text-indigo-600 dark:text-indigo-400",secondary:"bg-indigo-100 dark:bg-indigo-900/30",gradient:"from-indigo-200 to-blue-100",accent:"text-indigo-600",text:"text-spiritual-900"},meta:{level:"beginner",category:["calm","sleep","healing"],bestTime:"pre-sleep",style:"vipassana"}},{id:"3",title:"Rising Sun",description:"Harness the energy of the sun to revitalize your prana.",author:"Dr. Mangeshda",durationDisplay:"16:03",duration:963,category:"Energy",url:"https://www.mangeshda.org/sites/default/files/2020-05/Rising%20Sun.mp3",theme:{primary:"text-emerald-600 dark:text-emerald-400",secondary:"bg-emerald-100 dark:bg-emerald-900/30",gradient:"from-emerald-200 to-teal-100",accent:"text-emerald-600",text:"text-spiritual-900"},meta:{level:"beginner",category:["energy","healing"],bestTime:"morning",style:"visualization"}},{id:"4",title:"Mystic Cave",description:"A visualization journey into the cave of the heart.",author:"Dr. Mangeshda",durationDisplay:"19:59",duration:1199,category:"Spiritual",url:"https://www.mangeshda.org/sites/default/files/2020-05/Mystic%20Cave%2001.mp3",theme:{primary:"text-purple-600 dark:text-purple-400",secondary:"bg-purple-100 dark:bg-purple-900/30",gradient:"from-purple-200 to-pink-100",accent:"text-purple-600",text:"text-spiritual-900"},meta:{level:"intermediate",category:["spiritual","calm"],bestTime:"any",style:"visualization"}}],OT=[{id:"none",name:"Silence",url:""},{id:"rain",name:"Rain",url:"audio/rain.ogg"},{id:"stream",name:"Stream",url:"audio/stream.ogg"},{id:"forest",name:"Forest",url:"audio/fotest.ogg"},{id:"ocean",name:"Waves",url:"audio/waves.ogg"},{id:"fire",name:"Fire",url:"audio/fire.ogg"},{id:"wind",name:"Wind",url:"audio/wind.ogg"}],MT=[{id:"classic",name:"Classic",description:"Standard calming tones",soundType:"sine",frequencies:{inhale:330,hold:311,exhale:293}},{id:"solfeggio",name:"Healing (528Hz)",description:"528Hz Solfeggio frequencies",soundType:"bell",frequencies:{inhale:528,hold:417,exhale:396}},{id:"earth",name:"Deep Earth",description:"Low grounding frequencies",soundType:"triangle",frequencies:{inhale:196,hold:164,exhale:146}},{id:"cosmic",name:"Cosmic",description:"High ethereal tones",soundType:"sine",frequencies:{inhale:880,hold:784,exhale:659}},{id:"gong",name:"Gong",description:"Deep resonant tone (220Hz)",soundType:"bell",frequencies:{inhale:220,hold:220,exhale:220}}],LT=[{id:"1",title:"Practical tip to conquer laziness",description:"Overcoming Tamas guna",url:"https://www.youtube.com/embed/Qk2SqIe9dOM"},{id:"2",title:"Experiences with Mahavataar Babaji",description:"Spiritual experiences and stories",url:"https://www.youtube.com/embed/JqctIFOA5pA"},{id:"3",title:"Qualities of a good sadhak",description:"How to become a sincere seeker",url:"https://www.youtube.com/embed/u_o5SQ76-PA"},{id:"4",title:"Concept of God and Godliness",description:"The path of Kriya Yoga",url:"https://www.youtube.com/embed/6QRLw8XyK-Q"},{id:"5",title:"Disciple and Master Story",description:"Zen wisdom",url:"https://www.youtube.com/embed/1NG8UFZFHYQ"},{id:"6",title:"Receiving Guru's grace",description:"Scripting a successful life",url:"https://www.youtube.com/embed/-jN5d7ol5_c"},{id:"7",title:"Ashta-siddhis explained",description:"Supernatural powers in Yoga",url:"https://www.youtube.com/embed/oKsFN4l7Pkw"},{id:"8",title:"Working on ones ego",description:"Practical spiritual approach",url:"https://www.youtube.com/embed/BG453YdjkjU"},{id:"9",title:"Charging your body battery",description:"Kriya Yoga techniques",url:"https://www.youtube.com/embed/0rC87s_Nwuk"},{id:"10",title:"Refining Kriya Yoga practice",description:"Reaching higher levels",url:"https://www.youtube.com/embed/WLbI-PT2M1E"},{id:"11",title:"Repairing damage with Kriya",description:"Healing aspects",url:"https://www.youtube.com/embed/dTGgPGfNCn8"},{id:"12",title:"Opening the door within",description:"Experiencing the infinite",url:"https://www.youtube.com/embed/EScKnIvyUNE"},{id:"13",title:"Mastering your breath",description:"Pranayama secrets",url:"https://www.youtube.com/embed/wX9g_1R4jS8"},{id:"14",title:"Overcoming disturbances",description:"Focus during Sadhana",url:"https://www.youtube.com/embed/9_NdJg5z3B0"}],zn={version:8,breathwork:DT,meditation:VT,yoga:PT,mantras:jT,ambientSounds:OT,chimeThemes:MT,videos:LT},kg=S.createContext(void 0),FT=({children:r})=>{const[e,t]=S.useState([]),n=S.useCallback(i=>{t(a=>a.filter(c=>c.id!==i))},[]),s=S.useCallback((i,a="success")=>{const c=Date.now().toString(),u={id:c,message:i,type:a};t(d=>[...d,u]),setTimeout(()=>{n(c)},3e3)},[n]);return o.jsx(kg.Provider,{value:{toasts:e,showToast:s,removeToast:n},children:r})},Ag=()=>{const r=S.useContext(kg);if(!r)throw new Error("useToastContext must be used within a ToastProvider");return r},Sg=()=>{const{showToast:r}=Ag();return{showToast:r}},Ng=S.createContext({library:zn,isLoading:!1,checkForUpdates:async()=>{}}),Go="sadhaka_library_data_v1",UT=({children:r})=>{const[e,t]=S.useState(zn),[n,s]=S.useState(!1);Sg(),S.useEffect(()=>{(()=>{const c=localStorage.getItem(Go);if(c)try{const u=JSON.parse(c);u.version&&u.version>=zn.version?t(u):(t(zn),localStorage.setItem(Go,JSON.stringify(zn)))}catch(u){console.error("Failed to parse stored library",u),t(zn)}else localStorage.setItem(Go,JSON.stringify(zn))})()},[]);const i=async()=>{};return o.jsx(Ng.Provider,{value:{library:e,isLoading:n,checkForUpdates:i},children:r})},BT=()=>S.useContext(Ng),je={JOURNAL:"sadhaka_journal_v1",TRACKER:"sadhaka_tracker_v1",FAVOURITES:"sadhaka_favourites_v1",PRACTICE_LOG:"sadhaka_practice_log_v1",PREFS:"sadhaka_user_prefs_v1",ONBOARDING:"sadhaka_onboarding_complete"},wi=()=>{var r;return(r=qe==null?void 0:qe.currentUser)==null?void 0:r.uid},cr=()=>{const r=localStorage.getItem(je.JOURNAL);if(!r)return[];try{return JSON.parse(r).map(t=>{if(t.q1!==void 0)return t;let n="",s="",i="";if(t.text)try{const a=JSON.parse(t.text);typeof a=="object"&&a!==null?(n=a.q1||"",s=a.q2||"",i=a.q3||""):n=t.text}catch{n=t.text}return{...t,q1:n,q2:s,q3:i,text:void 0}})}catch(e){return console.error("Failed to load journal entries",e),[]}},zT=r=>{const e=cr(),t=e.findIndex(n=>n.id===r.id);t>=0?e[t]=r:e.push(r),e.sort((n,s)=>new Date(s.date).getTime()-new Date(n.date).getTime()),localStorage.setItem(je.JOURNAL,JSON.stringify(e)),window.dispatchEvent(new Event("sadhaka_journal_updated")),_i(wi(),"journal",r)},Ik=r=>{const t=cr().filter(n=>n.id!==r);localStorage.setItem(je.JOURNAL,JSON.stringify(t)),window.dispatchEvent(new Event("sadhaka_journal_updated"))},Tk=()=>{localStorage.removeItem(je.JOURNAL),window.dispatchEvent(new Event("sadhaka_journal_updated"))},$T=()=>{localStorage.clear(),window.dispatchEvent(new Event("sadhaka_journal_updated")),window.dispatchEvent(new Event("sadhaka_tracker_updated")),window.dispatchEvent(new Event("sadhaka_favourites_updated")),window.dispatchEvent(new Event("sadhaka_practice_updated")),window.dispatchEvent(new Event("sadhaka_prefs_updated"))},GT=()=>{localStorage.removeItem(je.JOURNAL),localStorage.removeItem(je.TRACKER),localStorage.removeItem(je.FAVOURITES),localStorage.removeItem(je.PRACTICE_LOG),localStorage.removeItem(je.PREFS),window.dispatchEvent(new Event("sadhaka_journal_updated")),window.dispatchEvent(new Event("sadhaka_tracker_updated")),window.dispatchEvent(new Event("sadhaka_favourites_updated")),window.dispatchEvent(new Event("sadhaka_practice_updated")),window.dispatchEvent(new Event("sadhaka_prefs_updated"))},rs=()=>{const r=localStorage.getItem(je.TRACKER);return r?JSON.parse(r):[]},qT=r=>{const e=rs(),t=e.findIndex(n=>n.id===r.id);t>=0?e[t]=r:e.push(r),localStorage.setItem(je.TRACKER,JSON.stringify(e)),window.dispatchEvent(new Event("sadhaka_tracker_updated")),_i(wi(),"tracker",r)},KT=r=>{const t=rs().filter(n=>n.id!==r);localStorage.setItem(je.TRACKER,JSON.stringify(t)),window.dispatchEvent(new Event("sadhaka_tracker_updated"))},HT=()=>{const r=rs();if(r.length===0)return!1;const e=new Date,t=new Date;t.setDate(e.getDate()-1);const n=e.toISOString().split("T")[0],s=t.toISOString().split("T")[0];let i=!1;const a=r.map(c=>{let u=c.streak;if(!c.completedDates||c.completedDates.length===0)return c.streak!==0?(i=!0,{...c,streak:0}):c;const d=[...c.completedDates].sort((m,p)=>p.localeCompare(m));if(d[0]!==n&&d[0]!==s)c.streak!==0&&(u=0,i=!0);else{let m=0,p=new Date(d[0]+"T00:00:00.000Z");for(const x of d){const b=p.toISOString().split("T")[0];if(x===b)m++,p.setUTCDate(p.getUTCDate()-1);else break}m!==c.streak&&(u=m,i=!0)}return{...c,streak:u}});return i&&(localStorage.setItem(je.TRACKER,JSON.stringify(a)),window.dispatchEvent(new Event("sadhaka_tracker_updated")),a.forEach(c=>_i(wi(),"tracker",c))),i},Rg=()=>{const r=localStorage.getItem(je.FAVOURITES);return r?JSON.parse(r):[]},Ek=r=>{const e=Rg(),t=e.find(s=>s.id===r.id&&s.type===r.type);let n;return t?n=e.filter(s=>!(s.id===r.id&&s.type===r.type)):n=[...e,r],localStorage.setItem(je.FAVOURITES,JSON.stringify(n)),window.dispatchEvent(new Event("sadhaka_favourites_updated")),t||_i(wi(),"favourites",r),n},oo=()=>{const r=localStorage.getItem(je.PRACTICE_LOG);return r?JSON.parse(r):[]},kk=r=>{const e=oo();e.push(r),localStorage.setItem(je.PRACTICE_LOG,JSON.stringify(e)),window.dispatchEvent(new Event("sadhaka_practice_updated")),_i(wi(),"practiceLog",r)},WT=()=>{const r={metadata:{version:1,exportDate:new Date().toISOString(),appName:"Sadhaka"},preferences:JSON.parse(localStorage.getItem(je.PREFS)||"null"),journal:cr(),tracker:rs(),favourites:Rg(),practiceLog:oo(),onboardingComplete:localStorage.getItem(je.ONBOARDING)==="true"};return JSON.stringify(r,null,2)},QT=r=>{try{const e=JSON.parse(r);if(!e.metadata||e.metadata.appName!=="Sadhaka")throw new Error("Invalid backup");return e.preferences&&localStorage.setItem(je.PREFS,JSON.stringify(e.preferences)),e.journal&&localStorage.setItem(je.JOURNAL,JSON.stringify(e.journal)),e.tracker&&localStorage.setItem(je.TRACKER,JSON.stringify(e.tracker)),e.favourites&&localStorage.setItem(je.FAVOURITES,JSON.stringify(e.favourites)),e.practiceLog&&localStorage.setItem(je.PRACTICE_LOG,JSON.stringify(e.practiceLog)),e.onboardingComplete&&localStorage.setItem(je.ONBOARDING,"true"),window.dispatchEvent(new Event("sadhaka_journal_updated")),window.dispatchEvent(new Event("sadhaka_tracker_updated")),window.dispatchEvent(new Event("sadhaka_favourites_updated")),window.dispatchEvent(new Event("sadhaka_prefs_updated")),!0}catch(e){return console.error("Import failed",e),!1}},Ak=r=>{if(!r.length)return"";const t=[["Date","Mood","Intention","Interaction","Balance","Completed Disciplines","Maasa","Vaar","Tithi","Paksha","Special Day"].join(",")];for(const n of r){const s=n.panchang||{tithi:"",vaar:"",maasa:"",specialDay:""};let i=s.tithi||"",a="";if(i.includes("(")){const u=i.split("(");i=u[0].trim(),a=u[1].replace(")","").trim()}const c=[n.date,n.mood,`"${(n.q1||"").replace(/"/g,'""')}"`,`"${(n.q2||"").replace(/"/g,'""')}"`,`"${(n.q3||"").replace(/"/g,'""')}"`,`"${(n.completedDisciplines||[]).join(";")}"`,`"${s.maasa||""}"`,`"${s.vaar||""}"`,`"${i}"`,`"${a}"`,`"${s.specialDay||""}"`];t.push(c.join(","))}return t.join(`
`)},Sk=r=>0,YT=r=>{const t=oo().filter(n=>{const s=new Date(n.date),i=s.getTimezoneOffset();return new Date(s.getTime()-i*60*1e3).toISOString().split("T")[0]===r});return{breathwork:t.filter(n=>n.type==="breathwork").reduce((n,s)=>n+s.durationSeconds,0),meditation:t.filter(n=>n.type==="meditation").reduce((n,s)=>n+s.durationSeconds,0),yoga:t.filter(n=>n.type==="yoga").reduce((n,s)=>n+s.durationSeconds,0),mantra:t.filter(n=>n.type==="mantra").reduce((n,s)=>n+s.durationSeconds,0),mantraCount:t.filter(n=>n.type==="mantra").reduce((n,s)=>n+(s.count||0),0)}},Cl={celestial:{name:"Celestial",notes:[261.63,329.63,392,493.88],type:"sine",interval:1500,decay:1.5},temple:{name:"Temple Bells",notes:[110,164.81],type:"triangle",interval:3500,decay:3},sunrise:{name:"Sunrise",notes:[293.66,329.63,369.99,440,587.33],type:"sine",interval:800,decay:1.2},cosmic:{name:"Cosmic Drift",notes:[196,220,246.94,293.66],type:"sine",interval:2e3,decay:4},pulse:{name:"Energy Pulse",notes:[440,444,440,436],type:"sine",interval:200,decay:.5}},qo={A2:110,"A#2":116.54,B2:123.47,C3:130.81,"C#3":138.59,D3:146.83,"D#3":155.56,E3:164.81,F3:174.61,"F#3":185,G3:196,"G#3":207.65,A3:220,"A#3":233.08,B3:246.94,C4:261.63,"C#4":277.18,D4:293.66,"D#4":311.13,E4:329.63,F4:349.23,"F#4":369.99,G4:392,"G#4":415.3,A4:440,"A#4":466.16,B4:493.88,C5:523.25};class JT{constructor(){xr(this,"ctx",null);xr(this,"alarmInterval",null);xr(this,"noteIndex",0);xr(this,"droneOscillators",[]);xr(this,"droneGain",null)}init(){return this.ctx||(this.ctx=new(window.AudioContext||window.webkitAudioContext)),this.ctx.state==="suspended"&&this.ctx.resume(),this.ctx}playMantraNote(e,t,n,s="sine"){const i=this.init();if(!i||!qo[e])return;const a=qo[e],c=i.currentTime,u=i.createGain();if(u.connect(i.destination),s==="veena"){const d=i.createOscillator();d.type="sawtooth",d.frequency.value=a;const m=i.createBiquadFilter();m.type="lowpass",m.Q.value=8,d.connect(m).connect(u);const p=i.createOscillator();p.type="sine",p.frequency.value=a*2;const x=i.createGain();x.gain.value=.15,p.connect(x).connect(u);const b=n*.35;u.gain.setValueAtTime(0,c),u.gain.linearRampToValueAtTime(b,c+.02),u.gain.exponentialRampToValueAtTime(.001,c+t+1),m.frequency.setValueAtTime(a*6,c),m.frequency.exponentialRampToValueAtTime(a,c+.35),d.start(c),p.start(c);const w=c+t+1.5;d.stop(w),p.stop(w)}else if(s==="harmonium"){const d=i.createOscillator();d.type="sawtooth",d.frequency.value=a;const m=i.createOscillator();m.type="sawtooth",m.frequency.value=a,m.detune.value=5;const p=i.createBiquadFilter();p.type="lowpass",p.frequency.value=1200,p.Q.value=.8,d.connect(p),m.connect(p),p.connect(u);const x=n*.3;u.gain.setValueAtTime(0,c),u.gain.linearRampToValueAtTime(x,c+.2),u.gain.setValueAtTime(x,c+t*.9),u.gain.linearRampToValueAtTime(.001,c+t+.6),d.start(c),m.start(c);const b=c+t+.7;d.stop(b),m.stop(b)}else{const d=i.createOscillator();d.type="sine",d.frequency.value=a;const m=i.createOscillator();m.type="triangle",m.frequency.value=a;const p=i.createGain(),x=i.createGain();d.connect(p).connect(u),m.connect(x).connect(u);const b=n*.4;u.gain.setValueAtTime(0,c),u.gain.linearRampToValueAtTime(b,c+.15),u.gain.setValueAtTime(b,c+t*.8),u.gain.exponentialRampToValueAtTime(.001,c+t+1.5),p.gain.value=.8,x.gain.value=.2,d.start(c),m.start(c),d.stop(c+t+2),m.stop(c+t+2)}}startDrone(e="C#3",t){const n=this.init();if(!n||this.droneOscillators.length>0)return;const s=qo[e]||138.59,i=s*1.5,a=s*2;this.droneGain=n.createGain(),this.droneGain.connect(n.destination);const c=t*.2;this.droneGain.gain.setValueAtTime(0,n.currentTime),this.droneGain.gain.linearRampToValueAtTime(c,n.currentTime+3);const u=(d,m,p)=>{const x=n.createOscillator();x.type=m,x.frequency.value=d;const b=n.createGain();b.gain.value=p,x.connect(b).connect(this.droneGain),x.start(),this.droneOscillators.push(x)};u(s,"sine",.6),u(i,"sine",.4),u(a,"sine",.2)}stopDrone(){if(this.droneGain&&this.ctx){const e=this.ctx.currentTime;this.droneGain.gain.cancelScheduledValues(e),this.droneGain.gain.setValueAtTime(this.droneGain.gain.value,e),this.droneGain.gain.exponentialRampToValueAtTime(.001,e+1.5);const t=[...this.droneOscillators];this.droneOscillators=[],setTimeout(()=>{var n;t.forEach(s=>s.stop()),(n=this.droneGain)==null||n.disconnect(),this.droneGain=null},1600)}else this.droneOscillators.forEach(e=>e.stop()),this.droneOscillators=[]}playChime(e=432,t="sine",n=2,s=1){const i=this.init();if(!i)return;const a=i.currentTime,c=i.createGain();if(c.connect(i.destination),t==="bell"){const u=e,d=i.createOscillator();d.type="sine",d.frequency.value=u;const m=i.createGain();d.connect(m).connect(c);const p=i.createOscillator();p.type="sine",p.frequency.value=u*1.015;const x=i.createGain();p.connect(x).connect(c);const b=i.createOscillator();b.type="triangle",b.frequency.value=u*2.7;const w=i.createGain();b.connect(w).connect(c),c.gain.setValueAtTime(0,a),c.gain.linearRampToValueAtTime(1*s,a+.1),c.gain.exponentialRampToValueAtTime(.001,a+n),m.gain.setValueAtTime(.5,a),x.gain.setValueAtTime(.4,a),w.gain.setValueAtTime(.15,a),w.gain.exponentialRampToValueAtTime(.001,a+n*.4),[d,p,b].forEach(k=>{k.start(a),k.stop(a+n)})}else{const u=i.createOscillator(),d=c;if(u.type=t,u.frequency.setValueAtTime(e,a),t==="sine"){const m=i.createOscillator();m.type="triangle",m.frequency.setValueAtTime(e*2,a);const p=i.createGain();p.gain.value=.15,m.connect(p).connect(d),m.start(a),m.stop(a+n)}d.gain.setValueAtTime(0,a),d.gain.linearRampToValueAtTime(.6*s,a+.05),d.gain.exponentialRampToValueAtTime(1e-5,a+n),u.connect(d),u.start(a),u.stop(a+n)}}startAlarm(e="celestial",t=1){const n=this.init();if(!n)return;this.stopAlarm();const s=Cl[e]||Cl.celestial;this.noteIndex=0;const i=()=>{n.state==="suspended"&&n.resume();const a=n.createOscillator(),c=n.createGain();a.connect(c),c.connect(n.destination);const u=s.notes[this.noteIndex];a.type=s.type,a.frequency.value=u;const d=n.currentTime;if(s.type==="sine"){const m=n.createOscillator();m.type="triangle",m.frequency.value=u*2;const p=n.createGain();p.gain.setValueAtTime(0,d),p.gain.linearRampToValueAtTime(.15*t,d+.2),p.gain.exponentialRampToValueAtTime(.001,d+s.decay),m.connect(p),p.connect(n.destination),m.start(d),m.stop(d+s.decay+.5)}c.gain.setValueAtTime(0,d),c.gain.linearRampToValueAtTime(.7*t,d+.2),c.gain.exponentialRampToValueAtTime(.001,d+s.decay),a.start(d),a.stop(d+s.decay+.5),this.noteIndex=(this.noteIndex+1)%s.notes.length};i(),this.alarmInterval=setInterval(i,s.interval)}stopAlarm(){this.alarmInterval&&(clearInterval(this.alarmInterval),this.alarmInterval=null)}}const ss=new JT,Cg=(r,e,t,n)=>ss.playChime(r,e,t,n),Dg=(r,e)=>ss.startAlarm(r,e),Wn=()=>ss.stopAlarm(),Nk=(r,e,t,n="sine")=>ss.playMantraNote(r,e,t,n),Rk=(r,e)=>ss.startDrone(r,e),Ck=()=>ss.stopDrone(),XT=[{label:"Slow",value:"slow"},{label:"Normal",value:"normal"},{label:"Fast",value:"fast"}],ZT=[{label:"Slow",value:"slow"},{label:"Normal",value:"normal"},{label:"Fast",value:"fast"}],eE=({onClose:r})=>{var Z;const{preferences:e,toggleTheme:t,updateLocation:n,updateDefaults:s,updateGoals:i,updateAudioSettings:a,updateNotificationSettings:c,updateSecuritySettings:u,toggleWidget:d,reorderWidget:m}=Mt(),{theme:p,location:x,defaults:b,goals:w,audio:k,notifications:N,security:D,dashboardLayout:V}=e,{library:P}=BT(),{currentUser:U}=Qc(),[L,G]=S.useState("alignment"),[I,y]=S.useState([]),[v,E]=S.useState(null),T=S.useRef(null),[A,_]=S.useState(!1),[se,ie]=S.useState(!1),de=S.useRef(null),ce=S.useRef(null),[Re,Ee]=S.useState(null),[Ae,xe]=S.useState(null),[De,H]=S.useState(null);S.useEffect(()=>{fm().then(_)},[]),S.useEffect(()=>{const O=()=>{const J=window.speechSynthesis.getVoices(),oe=J.filter(Ie=>Ie.lang.startsWith("en"));y(oe.length>0?oe:J)};O(),window.speechSynthesis.onvoiceschanged!==void 0&&(window.speechSynthesis.onvoiceschanged=O)},[]),S.useEffect(()=>()=>{Wn(),de.current&&de.current.pause(),ce.current&&clearTimeout(ce.current)},[]);const q=O=>{const J=I.find(ct=>ct.voiceURI===O);if(!J)return;window.speechSynthesis.cancel();const oe=`Hi, I am ${J.name}. I am here to help.`,Ie=new SpeechSynthesisUtterance(oe);Ie.voice=J,Ie.volume=1,Ie.rate=.9,window.speechSynthesis.speak(Ie)},te=O=>{v===O?(Wn(),E(null)):(Wn(),Dg(O,k.masterVolume),E(O),setTimeout(()=>{Wn(),E(null)},5e3))},he=O=>{a({ambienceId:O}),de.current&&(de.current.pause(),de.current=null),ce.current&&clearTimeout(ce.current);const J=P.ambientSounds.find(oe=>oe.id===O);if(J&&J.url){const oe=new Audio(J.url);oe.volume=k.masterVolume,oe.play().catch(Ie=>console.debug("Preview play failed",Ie)),de.current=oe,ce.current=setTimeout(()=>{de.current===oe&&(oe.pause(),de.current=null)},5e3)}},ye=O=>{a({chimeThemeId:O});const J=P.chimeThemes.find(oe=>oe.id===O);J&&Cg(J.frequencies.inhale,J.soundType,5,k.masterVolume)},ne=O=>{G(L===O?null:O)},Y=async()=>{try{const O=await Gl();n(O)}catch{alert("Could not detect location. Please select manually.")}},ae=()=>{const O=WT(),J=new Blob([O],{type:"application/json"}),oe=window.URL.createObjectURL(J),Ie=document.createElement("a");Ie.href=oe,Ie.download=`sadhaka-backup-${new Date().toISOString().split("T")[0]}.json`,Ie.click(),window.URL.revokeObjectURL(oe),Ee("Complete Backup exported.")},be=O=>{var Ie;const J=(Ie=O.target.files)==null?void 0:Ie[0];if(!J)return;const oe=new FileReader;oe.onload=ct=>{var Lt;const bt=(Lt=ct.target)==null?void 0:Lt.result;bt&&(QT(bt)?(Ee("Restored successfully. Reloading..."),setTimeout(()=>{window.location.reload()},1e3)):Ee("Failed to restore. Invalid file."))},oe.readAsText(J),O.target.value=""},tt=()=>{var O;(O=T.current)==null||O.click()},nt=async()=>{ie(!0),Ee("Uploading local data to cloud...");try{const O=await AT();Ee(O)}catch(O){Ee(`Upload failed: ${O.message}`)}finally{ie(!1)}},yt=async()=>{ie(!0),Ee("Downloading data from cloud...");try{const O=await ST();Ee(O),setTimeout(()=>window.location.reload(),1500)}catch(O){Ee(`Download failed: ${O.message}`)}finally{ie(!1)}},Tt=()=>{H({title:"Factory Reset App?",message:"This will permanently delete ALL your data (Journal, Habits, Practice History) and settings. This action cannot be undone.",confirmText:"Delete Everything",onConfirm:()=>{$T(),setTimeout(()=>{window.location.reload()},500)}})},Rt=()=>{H({title:"Sign Out?",message:"You will need to sign in again to access your data.",confirmText:"Sign Out",onConfirm:()=>{Hb(qe),GT(),r()}})},$=()=>{localStorage.removeItem("sadhaka_onboarding_complete"),setTimeout(()=>{window.location.reload()},300)},we=()=>{D.lockType!=="none"?xe({type:D.lockType==="passphrase"?"passphrase-verify":"pin-verify"}):xe({type:"method-select"})},Ve=()=>{xe({type:"method-select"})},He=O=>{O==="none"?(sx(),u({pinEnabled:!1,lockType:"none",biometricsEnabled:!1}),xe(null)):O==="pin"?xe({type:"pin-setup"}):O==="passphrase"&&xe({type:"passphrase-setup"})},$e=O=>{u({pinEnabled:!0,lockType:O}),xe(null)},kt=async()=>{D.biometricsEnabled?u({biometricsEnabled:!1}):await pm()?u({biometricsEnabled:!0}):alert("Biometric enrollment failed or was cancelled.")},Ct={solarClock:"Solar Clock (Circadian)",mandala:"The Mandala",moodRadial:"The Ankush",quote:"Prerana (Inspiration)",quickActions:"Quick Actions",panchang:"The Panchang",compass:"The Compass",prerana:"Prerana Notifications"};return o.jsxs("div",{className:"fixed inset-0 bg-spiritual-deep/80 backdrop-blur-md z-[80] flex justify-end animate-fade-in",children:[o.jsxs("div",{className:"bg-white dark:bg-slate-900 w-full max-w-md h-full shadow-2xl flex flex-col border-l border-white/10 animate-slide-in-right",children:[o.jsxs("div",{className:"p-6 border-b border-spiritual-100 dark:border-slate-800 flex justify-between items-center bg-spiritual-50 dark:bg-slate-900/50",children:[o.jsx("div",{children:o.jsx("h2",{className:"text-2xl font-bold text-spiritual-900 dark:text-spiritual-100 font-serif",children:"Preferences"})}),o.jsx("button",{onClick:r,className:"p-3 bg-spiritual-100 dark:bg-spiritual-800 rounded-full hover:bg-spiritual-200 dark:hover:bg-spiritual-700 transition-colors",children:o.jsx(Qr,{size:24,className:"text-spiritual-600 dark:text-spiritual-300"})})]}),U&&o.jsx("div",{className:"p-6 pb-2 border-b border-spiritual-100 dark:border-slate-800",children:o.jsxs("div",{className:"flex items-center gap-4 bg-spiritual-50 dark:bg-slate-800/50 p-4 rounded-2xl",children:[o.jsx("div",{className:"w-10 h-10 rounded-full bg-spiritual-800 dark:bg-spiritual-100 flex items-center justify-center text-white dark:text-spiritual-900 font-bold text-lg",children:((Z=U.email)==null?void 0:Z[0].toUpperCase())||"U"}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("p",{className:"text-sm font-bold text-spiritual-900 dark:text-spiritual-100 truncate",children:U.email}),o.jsx("p",{className:"text-xs text-green-500 font-bold",children:"Cloud Sync Active"})]}),o.jsx("button",{onClick:Rt,className:"p-2 text-spiritual-400 hover:text-red-500 transition-colors",title:"Sign Out",children:o.jsx(k0,{size:20})})]})}),o.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-8",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("button",{onClick:t,className:"bg-spiritual-50 dark:bg-slate-800/50 rounded-2xl p-4 border border-spiritual-100 dark:border-slate-700 flex flex-col gap-3 items-start transition-all hover:border-spiritual-300 dark:hover:border-slate-600",children:[o.jsx("div",{className:`p-2 rounded-full ${p==="light"?"text-spiritual-900 bg-spiritual-200":"text-spiritual-100 bg-spiritual-700"}`,children:p==="light"?o.jsx(Us,{size:20}):o.jsx(Qn,{size:20})}),o.jsxs("div",{className:"text-left",children:[o.jsx("span",{className:"block text-sm font-bold text-spiritual-900 dark:text-spiritual-100",children:p==="light"?"Light Mode":"Dark Mode"}),o.jsx("span",{className:"text-[10px] text-spiritual-500 dark:text-spiritual-400 uppercase tracking-wider",children:"Appearance"})]})]}),o.jsxs("button",{onClick:()=>c({alarmsEnabled:!N.alarmsEnabled}),className:`rounded-2xl p-4 border flex flex-col gap-3 items-start transition-all ${N.alarmsEnabled?"bg-spiritual-800 dark:bg-spiritual-100 border-transparent":"bg-spiritual-50 dark:bg-slate-800/50 border-spiritual-100 dark:border-slate-700"}`,children:[o.jsx("div",{className:`p-2 rounded-full ${N.alarmsEnabled?"text-spiritual-gold bg-white/10 dark:bg-spiritual-200":"text-spiritual-400 bg-spiritual-200 dark:bg-spiritual-800"}`,children:N.alarmsEnabled?o.jsx(Da,{size:20}):o.jsx(A0,{size:20})}),o.jsxs("div",{className:"text-left",children:[o.jsx("span",{className:`block text-sm font-bold ${N.alarmsEnabled?"text-white dark:text-spiritual-900":"text-spiritual-900 dark:text-spiritual-100"}`,children:N.alarmsEnabled?"Alarms On":"Alarms Off"}),o.jsx("span",{className:`text-[10px] uppercase tracking-wider ${N.alarmsEnabled?"text-spiritual-300 dark:text-spiritual-500":"text-spiritual-500 dark:text-spiritual-400"}`,children:"Notifications"})]})]}),o.jsxs("button",{onClick:we,className:`col-span-2 rounded-2xl p-4 border flex items-center gap-4 transition-all ${D.lockType!=="none"?"bg-spiritual-800 dark:bg-spiritual-100 border-transparent":"bg-spiritual-50 dark:bg-slate-800/50 border-spiritual-100 dark:border-slate-700"}`,children:[o.jsx("div",{className:`p-2 rounded-full ${D.lockType!=="none"?"text-spiritual-gold bg-white/10 dark:bg-spiritual-200":"text-spiritual-400 bg-spiritual-200 dark:bg-spiritual-800"}`,children:D.lockType!=="none"?o.jsx(Vl,{size:20}):o.jsx(qu,{size:20})}),o.jsxs("div",{className:"text-left flex-1",children:[o.jsx("span",{className:`block text-sm font-bold ${D.lockType!=="none"?"text-white dark:text-spiritual-900":"text-spiritual-900 dark:text-spiritual-100"}`,children:D.lockType==="none"?"No Lock":D.lockType==="pin"?"Secured with PIN":"Secured with Passphrase"}),o.jsx("span",{className:`text-[10px] uppercase tracking-wider ${D.lockType!=="none"?"text-spiritual-300 dark:text-spiritual-500":"text-spiritual-500 dark:text-spiritual-400"}`,children:"Sanctuary Protection"})]}),o.jsx("div",{className:D.lockType!=="none"?"text-white/50 dark:text-spiritual-900/50":"text-spiritual-400",children:o.jsx(Dt,{size:20})})]})]}),o.jsx("hr",{className:"border-spiritual-100 dark:border-slate-800"}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("button",{onClick:()=>ne("layout"),className:"w-full flex items-center justify-between py-2 group",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(Ho,{size:18,className:"text-spiritual-400 group-hover:text-spiritual-600 dark:group-hover:text-spiritual-300 transition-colors"}),o.jsx("h3",{className:"text-sm font-bold text-spiritual-600 dark:text-spiritual-300 uppercase tracking-widest",children:"Dashboard Layout"})]}),L==="layout"?o.jsx(un,{size:16,className:"text-spiritual-400"}):o.jsx(Bt,{size:16,className:"text-spiritual-400"})]}),L==="layout"&&o.jsx("div",{className:"bg-spiritual-50 dark:bg-slate-800/30 rounded-2xl p-5 space-y-3 animate-fade-in",children:V==null?void 0:V.map((O,J)=>o.jsxs("div",{className:"flex items-center justify-between bg-white/40 dark:bg-white/5 p-3 rounded-xl border border-spiritual-100 dark:border-slate-700/50",children:[o.jsx("span",{className:"text-sm font-bold text-spiritual-800 dark:text-spiritual-200 flex-1 truncate mr-2",children:Ct[O.id]||O.id}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("div",{className:"flex flex-col gap-1 mr-2",children:[o.jsx("button",{onClick:()=>m(O.id,-1),disabled:J===0,className:"p-1 rounded bg-spiritual-100 dark:bg-slate-700 hover:bg-spiritual-200 dark:hover:bg-slate-600 disabled:opacity-30 disabled:cursor-not-allowed text-spiritual-600 dark:text-spiritual-300 transition-colors",children:o.jsx(un,{size:12})}),o.jsx("button",{onClick:()=>m(O.id,1),disabled:J===V.length-1,className:"p-1 rounded bg-spiritual-100 dark:bg-slate-700 hover:bg-spiritual-200 dark:hover:bg-slate-600 disabled:opacity-30 disabled:cursor-not-allowed text-spiritual-600 dark:text-spiritual-300 transition-colors",children:o.jsx(Bt,{size:12})})]}),o.jsx("button",{onClick:()=>d(O.id),className:`w-12 h-7 rounded-full p-1 transition-colors ${O.isEnabled?"bg-spiritual-800 dark:bg-spiritual-100":"bg-gray-300 dark:bg-slate-700"}`,children:o.jsx("div",{className:`w-5 h-5 rounded-full bg-white shadow-sm transform transition-transform ${O.isEnabled?"translate-x-5":"translate-x-0"}`})})]})]},O.id))})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("button",{onClick:()=>ne("alignment"),className:"w-full flex items-center justify-between py-2 group",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(Ol,{size:18,className:"text-spiritual-400 group-hover:text-spiritual-600 dark:group-hover:text-spiritual-300 transition-colors"}),o.jsx("h3",{className:"text-sm font-bold text-spiritual-600 dark:text-spiritual-300 uppercase tracking-widest",children:"Location & Time"})]}),L==="alignment"?o.jsx(un,{size:16,className:"text-spiritual-400"}):o.jsx(Bt,{size:16,className:"text-spiritual-400"})]}),L==="alignment"&&o.jsxs("div",{className:"bg-spiritual-50 dark:bg-slate-800/30 rounded-2xl p-5 space-y-5 animate-fade-in",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("p",{className:"text-xs text-spiritual-400 font-bold uppercase tracking-wider mb-1",children:"Current"}),o.jsx("p",{className:"font-serif font-bold text-lg text-spiritual-900 dark:text-spiritual-50",children:(x==null?void 0:x.name)||"Not Set"}),o.jsx("p",{className:"text-xs text-spiritual-500 font-mono",children:(x==null?void 0:x.timezone)||"UTC"})]}),o.jsx("button",{onClick:Y,className:"p-3 bg-spiritual-200/50 dark:bg-slate-700 rounded-xl hover:bg-spiritual-200 dark:hover:bg-slate-600 transition-colors text-spiritual-700 dark:text-spiritual-200",title:"Detect GPS",children:o.jsx(Ml,{size:20})})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-xs font-bold text-spiritual-400 uppercase mb-3",children:"Presets"}),o.jsx("div",{className:"grid grid-cols-2 gap-2 overflow-y-auto max-h-[160px] scrollbar-hide",children:ux.map(O=>o.jsx("button",{onClick:()=>n(O),className:`px-3 py-2.5 rounded-lg text-sm font-medium text-left truncate transition-colors ${(x==null?void 0:x.name)===O.name?"bg-spiritual-800 text-white":"bg-white dark:bg-slate-900 text-spiritual-600 dark:text-spiritual-300 hover:bg-spiritual-100 dark:hover:bg-slate-700"}`,children:O.name},O.name))})]})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("button",{onClick:()=>ne("sensory"),className:"w-full flex items-center justify-between py-2 group",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(tm,{size:18,className:"text-spiritual-400 group-hover:text-spiritual-600 dark:group-hover:text-spiritual-300 transition-colors"}),o.jsx("h3",{className:"text-sm font-bold text-spiritual-600 dark:text-spiritual-300 uppercase tracking-widest",children:"Sensory"})]}),L==="sensory"?o.jsx(un,{size:16,className:"text-spiritual-400"}):o.jsx(Bt,{size:16,className:"text-spiritual-400"})]}),L==="sensory"&&o.jsxs("div",{className:"bg-spiritual-50 dark:bg-slate-800/30 rounded-2xl p-5 space-y-6 animate-fade-in",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between items-center mb-3",children:[o.jsx("span",{className:"text-sm font-medium text-spiritual-700 dark:text-spiritual-300",children:"Master Volume"}),o.jsxs("span",{className:"text-xs font-mono text-spiritual-500",children:[Math.round(k.masterVolume*100),"%"]})]}),o.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:k.masterVolume,onChange:O=>a({masterVolume:parseFloat(O.target.value)}),className:"w-full h-1.5 bg-spiritual-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:bg-spiritual-gold [&::-webkit-slider-thumb]:rounded-full"})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-xs font-bold text-spiritual-400 uppercase tracking-wider mb-3 block",children:"Alarm Tone"}),o.jsx("div",{className:"grid grid-cols-1 gap-2",children:Object.entries(Cl).map(([O,J])=>o.jsxs("div",{className:`flex items-center justify-between p-3 rounded-xl border transition-colors ${k.alarmToneId===O?"bg-white dark:bg-slate-700 border-spiritual-300 dark:border-slate-500 shadow-sm":"bg-transparent border-transparent hover:bg-spiritual-100 dark:hover:bg-slate-800"}`,children:[o.jsxs("div",{className:"flex-1 flex items-center gap-3 cursor-pointer",onClick:()=>a({alarmToneId:O}),children:[o.jsx("div",{className:`w-4 h-4 rounded-full border-2 flex items-center justify-center ${k.alarmToneId===O?"border-spiritual-gold":"border-spiritual-300"}`,children:k.alarmToneId===O&&o.jsx("div",{className:"w-2 h-2 rounded-full bg-spiritual-gold"})}),o.jsx("span",{className:"text-sm font-medium text-spiritual-800 dark:text-spiritual-200",children:J.name})]}),o.jsx("button",{onClick:()=>te(O),className:`p-2 rounded-full transition-colors ${v===O?"bg-spiritual-200 dark:bg-slate-600 text-spiritual-800 dark:text-white":"text-spiritual-400 hover:text-spiritual-600 dark:hover:text-spiritual-300"}`,children:v===O?o.jsx(S0,{size:16,className:"animate-pulse"}):o.jsx(N0,{size:16})})]},O))})]}),o.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-spiritual-100 dark:border-slate-700",children:[o.jsx("span",{className:"text-sm font-medium text-spiritual-700 dark:text-spiritual-300",children:"Voice Guidance"}),o.jsx("button",{onClick:()=>a({voiceEnabled:!k.voiceEnabled}),className:`w-12 h-7 rounded-full p-1 transition-colors ${k.voiceEnabled?"bg-spiritual-gold":"bg-gray-300 dark:bg-slate-700"}`,children:o.jsx("div",{className:`w-5 h-5 rounded-full bg-white shadow-sm transform transition-transform ${k.voiceEnabled?"translate-x-5":"translate-x-0"}`})})]}),k.voiceEnabled&&o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2 text-spiritual-700 dark:text-spiritual-300",children:[o.jsx(R0,{size:14,className:"text-spiritual-400"}),o.jsx("span",{className:"text-sm font-medium",children:"Voice"})]}),o.jsxs("div",{className:"relative",children:[o.jsxs("select",{value:k.voiceURI||"",onChange:O=>{const J=O.target.value;a({voiceURI:J}),q(J)},className:"w-full appearance-none bg-white dark:bg-slate-900 border border-spiritual-200 dark:border-slate-700 rounded-lg px-4 py-2 pr-8 text-sm font-medium text-spiritual-800 dark:text-spiritual-200 focus:outline-none focus:ring-1 focus:ring-spiritual-400",children:[I.length===0&&o.jsx("option",{value:"",children:"Default System Voice"}),I.map(O=>o.jsx("option",{value:O.voiceURI,children:O.name},O.voiceURI))]}),o.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none",children:o.jsx(Bt,{size:14,className:"text-spiritual-400"})})]})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-xs font-bold text-spiritual-400 uppercase tracking-wider mb-3 block",children:"Default Ambience"}),o.jsx("div",{className:"grid grid-cols-3 gap-2",children:P.ambientSounds.map(O=>o.jsx("button",{onClick:()=>he(O.id),className:`px-2 py-2 rounded-lg text-xs font-bold transition-colors truncate ${k.ambienceId===O.id?"bg-spiritual-gold text-white":"bg-white dark:bg-slate-900 text-spiritual-600 dark:text-spiritual-300 hover:bg-spiritual-100 dark:hover:bg-slate-700"}`,children:O.name},O.id))})]}),o.jsxs("div",{children:[o.jsx("span",{className:"text-xs font-bold text-spiritual-400 uppercase tracking-wider mb-3 block",children:"Transition Chimes"}),o.jsx("div",{className:"grid grid-cols-2 gap-2",children:P.chimeThemes.map(O=>o.jsx("button",{onClick:()=>ye(O.id),className:`px-3 py-2 rounded-lg text-xs font-bold transition-colors ${k.chimeThemeId===O.id?"bg-spiritual-800 text-white":"bg-white dark:bg-slate-900 text-spiritual-600 dark:text-spiritual-300 hover:bg-spiritual-100 dark:hover:bg-slate-700"}`,children:O.name},O.id))})]})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("button",{onClick:()=>ne("goals"),className:"w-full flex items-center justify-between py-2 group",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(sm,{size:18,className:"text-spiritual-400 group-hover:text-spiritual-600 dark:group-hover:text-spiritual-300 transition-colors"}),o.jsx("h3",{className:"text-sm font-bold text-spiritual-600 dark:text-spiritual-300 uppercase tracking-widest",children:"Daily Practice Durations"})]}),L==="goals"?o.jsx(un,{size:16,className:"text-spiritual-400"}):o.jsx(Bt,{size:16,className:"text-spiritual-400"})]}),L==="goals"&&o.jsxs("div",{className:"bg-spiritual-50 dark:bg-slate-800/30 rounded-2xl p-5 space-y-6 animate-fade-in",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsxs("div",{className:"flex items-center gap-2 text-spiritual-700 dark:text-spiritual-300",children:[o.jsx(Bs,{size:14,className:"text-spiritual-400"})," ",o.jsx("span",{className:"text-sm font-medium",children:"Pranayama"})]}),o.jsxs("span",{className:"text-xs font-mono text-spiritual-500",children:[w.breathworkMinutes," min"]})]}),o.jsx("input",{type:"range",min:"1",max:"60",step:"1",value:w.breathworkMinutes,onChange:O=>i({breathworkMinutes:parseInt(O.target.value)}),className:"w-full h-1.5 bg-spiritual-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:bg-spiritual-gold [&::-webkit-slider-thumb]:rounded-full"})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsxs("div",{className:"flex items-center gap-2 text-spiritual-700 dark:text-spiritual-300",children:[o.jsx(Wo,{size:14,className:"text-spiritual-400"})," ",o.jsx("span",{className:"text-sm font-medium",children:"Dhyana"})]}),o.jsxs("span",{className:"text-xs font-mono text-spiritual-500",children:[w.meditationMinutes," min"]})]}),o.jsx("input",{type:"range",min:"1",max:"60",step:"1",value:w.meditationMinutes,onChange:O=>i({meditationMinutes:parseInt(O.target.value)}),className:"w-full h-1.5 bg-spiritual-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:bg-spiritual-gold [&::-webkit-slider-thumb]:rounded-full"})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsxs("div",{className:"flex items-center gap-2 text-spiritual-700 dark:text-spiritual-300",children:[o.jsx(zs,{size:14,className:"text-spiritual-400"})," ",o.jsx("span",{className:"text-sm font-medium",children:"Asana"})]}),o.jsxs("span",{className:"text-xs font-mono text-spiritual-500",children:[w.yogaMinutes," min"]})]}),o.jsx("input",{type:"range",min:"1",max:"60",step:"1",value:w.yogaMinutes,onChange:O=>i({yogaMinutes:parseInt(O.target.value)}),className:"w-full h-1.5 bg-spiritual-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:bg-spiritual-gold [&::-webkit-slider-thumb]:rounded-full"})]}),o.jsxs("div",{children:[o.jsxs("div",{className:"flex justify-between items-center mb-2",children:[o.jsxs("div",{className:"flex items-center gap-2 text-spiritual-700 dark:text-spiritual-300",children:[o.jsx(Qo,{size:14,className:"text-spiritual-400"})," ",o.jsx("span",{className:"text-sm font-medium",children:"Mantra Japa"})]}),o.jsxs("span",{className:"text-xs font-mono text-spiritual-500",children:[w.mantraMinutes||15," min"]})]}),o.jsx("input",{type:"range",min:"1",max:"60",step:"1",value:w.mantraMinutes||15,onChange:O=>i({mantraMinutes:parseInt(O.target.value)}),className:"w-full h-1.5 bg-spiritual-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:bg-spiritual-gold [&::-webkit-slider-thumb]:rounded-full"})]})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("button",{onClick:()=>ne("practice"),className:"w-full flex items-center justify-between py-2 group",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(la,{size:18,className:"text-spiritual-400 group-hover:text-spiritual-600 dark:group-hover:text-spiritual-300 transition-colors"}),o.jsx("h3",{className:"text-sm font-bold text-spiritual-600 dark:text-spiritual-300 uppercase tracking-widest",children:"Practice Flow"})]}),L==="practice"?o.jsx(un,{size:16,className:"text-spiritual-400"}):o.jsx(Bt,{size:16,className:"text-spiritual-400"})]}),L==="practice"&&o.jsxs("div",{className:"bg-spiritual-50 dark:bg-slate-800/30 rounded-2xl p-5 space-y-6 animate-fade-in",children:[o.jsxs("div",{children:[o.jsx("div",{className:"flex justify-between items-center mb-3",children:o.jsx("span",{className:"text-sm font-medium text-spiritual-700 dark:text-spiritual-300",children:"Default Yoga Pace"})}),o.jsx("div",{className:"flex gap-2",children:XT.map(O=>o.jsx("button",{onClick:()=>s({yogaPace:O.value}),className:`flex-1 py-2 rounded-lg text-xs font-bold transition-colors ${b.yogaPace===O.value?"bg-spiritual-800 text-white":"bg-white dark:bg-slate-900 text-spiritual-600 dark:text-spiritual-300 hover:bg-spiritual-100 dark:hover:bg-slate-700"}`,children:O.label},O.value))})]}),o.jsxs("div",{children:[o.jsx("div",{className:"flex justify-between items-center mb-3",children:o.jsx("span",{className:"text-sm font-medium text-spiritual-700 dark:text-spiritual-300",children:"Mantra Chanting Speed"})}),o.jsx("div",{className:"flex gap-2",children:ZT.map(O=>o.jsx("button",{onClick:()=>s({mantraSpeed:O.value}),className:`flex-1 py-2 rounded-lg text-xs font-bold transition-colors ${b.mantraSpeed===O.value?"bg-spiritual-800 text-white":"bg-white dark:bg-slate-900 text-spiritual-600 dark:text-spiritual-300 hover:bg-spiritual-100 dark:hover:bg-slate-700"}`,children:O.label},O.value))})]})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("button",{onClick:()=>ne("data"),className:"w-full flex items-center justify-between py-2 group",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(C0,{size:18,className:"text-spiritual-400 group-hover:text-spiritual-600 dark:group-hover:text-spiritual-300 transition-colors"}),o.jsx("h3",{className:"text-sm font-bold text-spiritual-600 dark:text-spiritual-300 uppercase tracking-widest",children:"Data & Privacy"})]}),L==="data"?o.jsx(un,{size:16,className:"text-spiritual-400"}):o.jsx(Bt,{size:16,className:"text-spiritual-400"})]}),L==="data"&&o.jsxs("div",{className:"bg-spiritual-50 dark:bg-slate-800/30 rounded-2xl p-5 space-y-4 animate-fade-in",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsxs("button",{onClick:nt,disabled:se,className:"p-3 bg-blue-50 dark:bg-blue-900/10 text-blue-600 dark:text-blue-400 rounded-xl font-bold text-xs flex flex-col items-center justify-center gap-2 hover:bg-blue-100 dark:hover:bg-blue-900/20 transition-colors",children:[o.jsx(D0,{size:20,className:se?"animate-spin":""}),se?"Syncing...":"Force Upload"]}),o.jsxs("button",{onClick:yt,disabled:se,className:"p-3 bg-indigo-50 dark:bg-indigo-900/10 text-indigo-600 dark:text-indigo-400 rounded-xl font-bold text-xs flex flex-col items-center justify-center gap-2 hover:bg-indigo-100 dark:hover:bg-indigo-900/20 transition-colors",children:[o.jsx(P0,{size:20,className:se?"animate-pulse":""}),"Restore from Cloud"]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[o.jsxs("button",{onClick:ae,className:"p-3 bg-white dark:bg-slate-900 rounded-xl border border-spiritual-100 dark:border-slate-700 flex flex-col items-center justify-center gap-2 hover:bg-spiritual-100 dark:hover:bg-slate-800 transition-colors",children:[o.jsx(j0,{size:20,className:"text-spiritual-600 dark:text-spiritual-300"}),o.jsx("span",{className:"text-xs font-bold text-spiritual-600 dark:text-spiritual-300",children:"Backup"})]}),o.jsxs("button",{onClick:tt,className:"p-3 bg-white dark:bg-slate-900 rounded-xl border border-spiritual-100 dark:border-slate-700 flex flex-col items-center justify-center gap-2 hover:bg-spiritual-100 dark:hover:bg-slate-800 transition-colors cursor-pointer",children:[o.jsx(V0,{size:20,className:"text-spiritual-600 dark:text-spiritual-300"}),o.jsx("span",{className:"text-xs font-bold text-spiritual-600 dark:text-spiritual-300",children:"Restore"})]}),o.jsx("input",{type:"file",accept:".json,application/json,text/plain",ref:T,className:"hidden",onChange:be})]}),o.jsxs("button",{onClick:Tt,className:"w-full py-3 bg-red-50 dark:bg-red-900/10 text-red-500 rounded-xl font-bold text-sm flex items-center justify-center gap-2 hover:bg-red-100 dark:hover:bg-red-900/20 transition-colors",children:[o.jsx(O0,{size:16})," Clear All Data"]}),Re&&o.jsx("p",{className:"text-center text-xs text-spiritual-500 font-medium pt-2 animate-fade-in",children:Re})]})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsxs("button",{onClick:()=>ne("help"),className:"w-full flex items-center justify-between py-2 group",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(M0,{size:18,className:"text-spiritual-400 group-hover:text-spiritual-600 dark:group-hover:text-spiritual-300 transition-colors"}),o.jsx("h3",{className:"text-sm font-bold text-spiritual-600 dark:text-spiritual-300 uppercase tracking-widest",children:"Help & Guide"})]}),L==="help"?o.jsx(un,{size:16,className:"text-spiritual-400"}):o.jsx(Bt,{size:16,className:"text-spiritual-400"})]}),L==="help"&&o.jsxs("div",{className:"bg-spiritual-50 dark:bg-slate-800/30 rounded-2xl p-5 space-y-4 animate-fade-in",children:[o.jsx("div",{className:"flex items-start gap-3 p-1",children:o.jsx("p",{className:"text-xs text-spiritual-500 dark:text-spiritual-400 leading-relaxed",children:"Revisit the introduction to understand the features and philosophy of Sadhaka."})}),o.jsxs("button",{onClick:$,className:"w-full py-3 bg-white dark:bg-slate-900 border border-spiritual-200 dark:border-slate-700 text-spiritual-800 dark:text-spiritual-200 rounded-xl font-bold text-sm flex items-center justify-center gap-2 hover:bg-spiritual-50 dark:hover:bg-slate-800 transition-colors",children:[o.jsx(L0,{size:16})," Replay Introduction"]})]})]})]})]}),Ae&&o.jsx("div",{className:"fixed inset-0 z-[100] bg-spiritual-deep/95 backdrop-blur-xl flex flex-col items-center justify-center p-6 animate-fade-in",children:o.jsxs("div",{className:"w-full max-w-sm",children:[Ae.type==="method-select"&&o.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-[2.5rem] p-8 shadow-2xl border border-white/10 animate-fade-in",children:[o.jsx("h3",{className:"text-xl font-bold text-center mb-6 text-spiritual-900 dark:text-spiritual-100",children:"Lock Method"}),o.jsxs("div",{className:"space-y-3",children:[o.jsxs("button",{onClick:()=>He("none"),className:`w-full p-4 rounded-xl flex items-center gap-3 border ${D.lockType==="none"?"border-spiritual-800 bg-spiritual-50 dark:bg-spiritual-800":"border-spiritual-200 dark:border-slate-700 hover:bg-spiritual-50 dark:hover:bg-slate-800"}`,children:[o.jsx(qu,{size:20,className:"text-spiritual-500"}),o.jsx("span",{className:"font-bold text-spiritual-800 dark:text-spiritual-200",children:"None"})]}),o.jsxs("button",{onClick:()=>He("pin"),className:`w-full p-4 rounded-xl flex items-center gap-3 border ${D.lockType==="pin"?"border-spiritual-800 bg-spiritual-50 dark:bg-spiritual-800":"border-spiritual-200 dark:border-slate-700 hover:bg-spiritual-50 dark:hover:bg-slate-800"}`,children:[o.jsx(Ho,{size:20,className:"text-spiritual-500"}),o.jsx("span",{className:"font-bold text-spiritual-800 dark:text-spiritual-200",children:"4-Digit PIN"})]}),o.jsxs("button",{onClick:()=>He("passphrase"),className:`w-full p-4 rounded-xl flex items-center gap-3 border ${D.lockType==="passphrase"?"border-spiritual-800 bg-spiritual-50 dark:bg-spiritual-800":"border-spiritual-200 dark:border-slate-700 hover:bg-spiritual-50 dark:hover:bg-slate-800"}`,children:[o.jsx(nm,{size:20,className:"text-spiritual-500"}),o.jsx("span",{className:"font-bold text-spiritual-800 dark:text-spiritual-200",children:"Passphrase"})]})]}),D.lockType!=="none"&&A&&o.jsx("div",{className:"mt-6 pt-6 border-t border-spiritual-100 dark:border-slate-800",children:o.jsxs("button",{onClick:kt,className:`w-full p-4 rounded-xl flex items-center gap-3 border transition-colors ${D.biometricsEnabled?"bg-spiritual-100 dark:bg-spiritual-900 border-spiritual-800 dark:border-spiritual-100":"border-spiritual-200 dark:border-slate-700 hover:bg-spiritual-50 dark:hover:bg-slate-800"}`,children:[o.jsx(Ll,{size:20,className:D.biometricsEnabled?"text-spiritual-800 dark:text-white":"text-spiritual-400"}),o.jsxs("div",{className:"text-left flex-1",children:[o.jsx("span",{className:"block font-bold text-spiritual-800 dark:text-spiritual-200",children:"Biometrics"}),o.jsx("span",{className:"text-[10px] text-spiritual-500 dark:text-spiritual-400 uppercase tracking-wider",children:D.biometricsEnabled?"Enabled":"Disabled"})]}),o.jsx("div",{className:`w-10 h-6 rounded-full p-1 transition-colors ${D.biometricsEnabled?"bg-green-500":"bg-gray-300 dark:bg-slate-600"}`,children:o.jsx("div",{className:`w-4 h-4 bg-white rounded-full shadow-sm transform transition-transform ${D.biometricsEnabled?"translate-x-4":"translate-x-0"}`})})]})}),o.jsx("button",{onClick:()=>xe(null),className:"w-full mt-6 py-3 text-spiritual-500 hover:text-spiritual-800 dark:hover:text-white font-bold text-sm",children:"Cancel"})]}),(Ae.type==="pin-verify"||Ae.type==="pin-setup")&&o.jsx(zl,{mode:Ae.type==="pin-setup"?"setup":"verify",onSuccess:()=>Ae.type==="pin-verify"?Ve():$e("pin"),onCancel:()=>xe(null)}),(Ae.type==="passphrase-verify"||Ae.type==="passphrase-setup")&&o.jsx($l,{mode:Ae.type==="passphrase-setup"?"setup":"verify",onSuccess:()=>Ae.type==="passphrase-verify"?Ve():$e("passphrase"),onCancel:()=>xe(null)})]})}),De&&o.jsx("div",{className:"fixed inset-0 bg-spiritual-deep/80 backdrop-blur-md z-[90] flex items-center justify-center p-4 animate-fade-in",children:o.jsxs("div",{className:"bg-white dark:bg-slate-900 w-full max-w-sm rounded-[2.5rem] p-8 shadow-2xl border border-white/10",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("div",{className:"w-16 h-16 bg-red-50 dark:bg-red-900/20 rounded-full flex items-center justify-center mx-auto mb-6",children:o.jsx(im,{size:32,className:"text-red-500"})}),o.jsx("h3",{className:"text-2xl font-bold text-spiritual-900 dark:text-spiritual-100 mb-2",children:De.title}),o.jsx("p",{className:"text-spiritual-500 dark:text-spiritual-400 mb-8",children:De.message})]}),o.jsxs("div",{className:"flex flex-col gap-3",children:[o.jsx("button",{onClick:()=>{De.onConfirm(),H(null)},className:"w-full py-4 bg-red-500 text-white rounded-2xl font-bold hover:bg-red-600 transition-colors shadow-lg shadow-red-500/20",children:De.confirmText}),o.jsx("button",{onClick:()=>H(null),className:"w-full py-3 text-spiritual-500 dark:text-spiritual-400 font-bold hover:bg-spiritual-100 dark:hover:bg-spiritual-800 rounded-2xl transition-colors",children:"Cancel"})]})]})})]})},tE=({onUnlock:r})=>{const{preferences:e}=Mt(),t=e.security.lockType||"pin",n=e.security.biometricsEnabled,[s,i]=S.useState(!1),a=async()=>{i(!1),await ox()?r():i(!0)};return S.useEffect(()=>{if(n){const c=setTimeout(a,500);return()=>clearTimeout(c)}},[n]),o.jsxs("div",{className:"fixed inset-0 z-[100] bg-spiritual-50 dark:bg-spiritual-deep flex flex-col items-center justify-center",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-spiritual-100 via-white to-spiritual-50 dark:from-slate-900 dark:via-spiritual-deep dark:to-black"}),o.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-spiritual-gold/10 rounded-full blur-[80px] animate-pulse-slow"}),o.jsxs("div",{className:"relative z-10 w-full max-w-md flex flex-col items-center",children:[o.jsxs("div",{className:"mb-8 text-center opacity-60",children:[o.jsx("h1",{className:"text-3xl font-bold font-serif text-spiritual-900 dark:text-spiritual-50",children:"Sadhaka"}),o.jsx("p",{className:"text-sm uppercase tracking-[0.3em] text-spiritual-500",children:"Sanctuary Lock"})]}),n&&o.jsxs("div",{className:"mb-8",children:[o.jsx("button",{onClick:a,className:"w-16 h-16 rounded-full bg-spiritual-800 dark:bg-spiritual-100 text-white dark:text-spiritual-900 flex items-center justify-center shadow-glow animate-float hover:scale-110 transition-transform",children:o.jsx(Ll,{size:32})}),s&&o.jsx("p",{className:"text-xs text-red-500 mt-3 font-bold text-center",children:"Biometrics Failed. Use Code."})]}),t==="passphrase"?o.jsx($l,{mode:"verify",onSuccess:r}):o.jsx(zl,{mode:"verify",onSuccess:r})]})]})},Pg=Math.PI,ia=Pg/180,nE=180/Pg,rE=24.1;function Dl(r){return Math.sin(r*ia)}function is(r){return r.getTime()/864e5+24405875e-1}function Xn(r){return r-Math.floor(r/360)*360}function oi(r){return Xn(r-rE)}function lo(r){const e=r-2451545,t=357.529+.98560028*e,s=280.459+.98564736*e+1.915*Dl(t)+.02*Dl(2*t);return Xn(s)}function co(r){const e=r-2451545,t=218.316+13.176396*e,n=134.963+13.064993*e,s=t+6.289*Dl(n);return Xn(s)}function sE(r,e,t){let i=280.46061837+360.98564736629*(is(t)-2451545);i=Xn(i);let a=i+e;a=Xn(a);const c=23.4392911,u=a*ia,d=r*ia,m=c*ia,p=Math.cos(u),x=-Math.sin(u)*Math.cos(m)+Math.tan(d)*Math.sin(m);let b=Math.atan2(p,x)*nE;b=Xn(b);const w=oi(b),k=Math.floor(w/30),N=w%30;return{index:k+1,name:jg[k],degree:N}}const iE=["Ashwini","Bharani","Krittika","Rohini","Mrigashirsha","Ardra","Punarvasu","Pushya","Ashlesha","Magha","Purva Phalguni","Uttara Phalguni","Hasta","Chitra","Swati","Vishakha","Anuradha","Jyeshtha","Mula","Purva Ashadha","Uttara Ashadha","Shravana","Dhanishta","Shatabhisha","Purva Bhadrapada","Uttara Bhadrapada","Revati"],aE=["Vishkumbha","Priti","Ayushman","Saubhagya","Sobhana","Atiganda","Sukarma","Dhriti","Shula","Ganda","Vriddhi","Dhruva","Vyaghata","Harshana","Vajra","Siddhi","Vyatipata","Variyan","Parigha","Shiva","Siddha","Sadhya","Shubha","Shukla","Brahma","Indra","Vaidhriti"],jg=["Aries (Mesha)","Taurus (Vrishabha)","Gemini (Mithuna)","Cancer (Karka)","Leo (Simha)","Virgo (Kanya)","Libra (Tula)","Scorpio (Vrishchika)","Sagittarius (Dhanu)","Capricorn (Makara)","Aquarius (Kumbha)","Pisces (Meena)"],oE=["Bava","Balava","Kaulava","Taitila","Gara","Vanija","Vishti","Shakuni","Chatushpada","Naga","Kimstughna"],lE=["Chaitra","Vaisakha","Jyeshtha","Ashadha","Shravana","Bhadrapada","Ashvina","Kartika","Margashirsha","Pausha","Magha","Phalguna"],zh=[{type:"lunar_fixed",monthIndex:1,tithiIndex:1,name:"Gudi Padwa / Ugadi",description:"Hindu New Year",isFestival:!0},{type:"lunar_fixed",monthIndex:1,tithiIndex:9,name:"Ram Navami",description:"Birth of Lord Rama",isFestival:!0},{type:"lunar_fixed",monthIndex:1,tithiIndex:15,name:"Hanuman Jayanti",description:"Birth of Lord Hanuman",isFestival:!0},{type:"lunar_fixed",monthIndex:2,tithiIndex:3,name:"Akshaya Tritiya",description:"Day of Eternal Prosperity",isFestival:!0},{type:"lunar_fixed",monthIndex:4,tithiIndex:11,name:"Ashadhi Ekadashi",description:"Great Ekadashi of Pandharpur",isFestival:!0},{type:"lunar_fixed",monthIndex:4,tithiIndex:15,name:"Guru Purnima",description:"Honoring the Guru",isFestival:!0},{type:"lunar_fixed",monthIndex:5,tithiIndex:23,name:"Janmashtami",description:"Birth of Lord Krishna",isFestival:!0},{type:"lunar_fixed",monthIndex:6,tithiIndex:4,name:"Ganesh Chaturthi",description:"Festival of Lord Ganesha",isFestival:!0},{type:"lunar_fixed",monthIndex:7,tithiIndex:10,name:"Dussehra",description:"Victory of Good over Evil",isFestival:!0},{type:"lunar_fixed",monthIndex:7,tithiIndex:28,name:"Dhanteras",description:"Worship of Wealth & Health",isFestival:!0},{type:"lunar_fixed",monthIndex:7,tithiIndex:30,name:"Diwali (Lakshmi Puja)",description:"Festival of Lights",isFestival:!0},{type:"lunar_fixed",monthIndex:8,tithiIndex:11,name:"Kartiki Ekadashi",description:"Awakening of Vishnu",isFestival:!0},{type:"lunar_fixed",monthIndex:9,tithiIndex:15,name:"Datta Jayanti",description:"Incarnation of Lord Dattattreya",isFestival:!0},{type:"lunar_fixed",monthIndex:11,tithiIndex:29,name:"Maha Shivratri",description:"Great Night of Shiva",isFestival:!0},{type:"lunar_fixed",monthIndex:12,tithiIndex:15,name:"Holi",description:"Festival of Colors",isFestival:!0},{type:"gregorian_fixed",month:0,day:1,name:"New Year's Day",description:"Global Celebration",isFestival:!0},{type:"gregorian_fixed",month:0,day:14,name:"Makar Sankranti",description:"Sun enters Capricorn",isFestival:!0},{type:"gregorian_fixed",month:0,day:26,name:"Republic Day",description:"India Republic Day",isFestival:!0},{type:"gregorian_fixed",month:4,day:1,name:"Labour Day",description:"International Workers' Day",isFestival:!1},{type:"gregorian_fixed",month:5,day:21,name:"Intl. Yoga Day",description:"Celebration of Yoga",isFestival:!0},{type:"gregorian_fixed",month:7,day:15,name:"Independence Day",description:"India Independence Day",isFestival:!0},{type:"gregorian_fixed",month:9,day:2,name:"Gandhi Jayanti",description:"Non-Violence Day",isFestival:!0},{type:"gregorian_fixed",month:9,day:24,name:"Foundations Annual Day",description:"Sadhaka Community Celebration",isFestival:!0},{type:"gregorian_fixed",month:11,day:25,name:"Christmas",description:"Celebration of Spirit",isFestival:!0},{type:"gregorian_fixed",month:11,day:31,name:"New Year's Eve",description:"End of Year Celebration",isFestival:!0},{type:"recurring_tithi",tithiIndices:[11,26],name:"${type} Ekadashi",description:"Fasting day for Lord Vishnu",isFestival:!1},{type:"recurring_tithi",tithiIndices:[13,28],name:"Pradosh Vrat",description:"Sunset worship of Lord Shiva",isFestival:!1},{type:"recurring_tithi",tithiIndices:[15],name:"Purnima",description:"Full Moon - High Energy",isFestival:!0},{type:"recurring_tithi",tithiIndices:[30],name:"Amavasya",description:"New Moon - High Energy",isFestival:!0},{type:"recurring_tithi",tithiIndices:[19],name:"Sankashti Chaturthi",description:"Ganesh worship",isFestival:!1}],cE=r=>{const e=is(r),t=co(e),n=oi(t),s=Math.floor(n/(360/27)),i=["Speed, vitality, and healing abilities","Creation, transformation, birth, and death cycles","Sharpness, purification, fiery power, and determination","Fertility, abundance, creativity, and material growth","Questing, curiosity, seeking knowledge, and emotional fulfillment","Transformation through pain, chaos, and turbulence","Renewal, restoration, and ability to bounce back","Nourishment, support, wisdom, and auspiciousness","Hidden energies, intuition, and transformation","Leadership, authority, heritage, and respect for tradition","Pleasure, relaxation, art, and good fortune","Long-term commitment, stability, and support in partnerships","Craftsmanship, dexterity, skill, and manifestation","Creativity, beauty, brilliance, and artistry","Independence, flexibility, adaptability, and airiness","Ambition, goal-orientation, and focused determination","Loyalty, friendship, and ability to build strong alliances","Authority, power, and ability to protect others","Uncovering hidden truths, destruction, and radical transformation","Invincibility, purification, and emotional healing","Perseverance, integrity, and unchallengeable victory","Listening, learning, knowledge, and divine wisdom","Musical talent, prosperity, abundance, and charisma","Healing, mystery, and scientific/mystical pursuits","Intense transformation, spiritual fire, and overcoming obstacles","Deep wisdom, stability, compassion, and spiritual depth","Guidance, nourishment, and the final journey of the soul"];return{index:s+1,name:iE[s%27],description:i[s%27]||"Moon Constellation"}},uE=r=>{const e=is(r),t=oi(co(e)),n=oi(lo(e)),s=Xn(t+n),i=Math.floor(s/(360/27));return{index:i+1,name:aE[i%27]}},dE=r=>{const e=is(r),t=oi(lo(e)),n=Math.floor(t/30);return{index:n+1,name:jg[n%12]}},hE=(r,e)=>{const t=["Ravivara (Sun)","Somavara (Mon)","Mangalavara (Tue)","Budhavara (Wed)","Guruvara (Thu)","Shukravara (Fri)","Shanivara (Sat)"];if(e)try{const n=r.toLocaleDateString("en-US",{weekday:"short",timeZone:e}),i={Sun:0,Mon:1,Tue:2,Wed:3,Thu:4,Fri:5,Sat:6}[n];if(i!==void 0)return t[i]}catch(n){console.warn("Invalid timezone for getVaar",n)}return t[r.getDay()]},mE=r=>{const e=is(r),t=lo(e);let s=co(e)-t;s<0&&(s+=360);const i=Math.floor(s/6);let a="";if(i===0)a="Kimstughna";else if(i>=57)i===57&&(a="Shakuni"),i===58&&(a="Chatushpada"),i===59&&(a="Naga");else{const c=(i-1)%7;a=oE[c]}return{index:i+1,name:a}},Sn=r=>{const e=is(r),t=lo(e);let s=co(e)-t;s<0&&(s+=360);const i=Math.floor(s/12)+1,a=i<=15,c=i>15?i-15:i;let d=["Pratipada","Dwitiya","Tritiya","Chaturthi","Panchami","Shashthi","Saptami","Ashtami","Navami","Dashami","Ekadashi","Dwadashi","Trayodashi","Chaturdashi","Purnima/Amavasya"][c-1];return i===15&&(d="Purnima"),i===30&&(d="Amavasya"),{index:i,name:d,type:a?"Shukla":"Krishna"}},Vg=r=>{const t=Sn(r).index*.984,n=new Date(r.getTime()-t*24*60*60*1e3),i=dE(n).index%12;return{index:i+1,name:lE[i]}},Ra=r=>{const e=[],t=new Date(r);t.setHours(12,0,0,0);const n=t.getDate(),s=t.getMonth(),i=zh.find(p=>p.type==="gregorian_fixed"&&p.month===s&&p.day===n);i&&e.push({date:t,title:i.name,description:i.description,isFestival:i.isFestival,type:i.type});const a=new Date(t);a.setHours(6,0,0,0);const c=new Date(t);c.setHours(18,0,0,0);const u=[t,a,c].map(p=>({tithi:Sn(p),month:Vg(p)})),d=[];u.forEach(({tithi:p,month:x})=>{zh.forEach(b=>{if(b.type==="lunar_fixed")b.monthIndex===x.index&&b.tithiIndex===p.index&&d.push({date:t,title:b.name,description:b.description,isFestival:b.isFestival,type:b.type});else if(b.type==="recurring_tithi"&&b.tithiIndices.includes(p.index)){let w=b.name;w.includes("${type}")&&(w=w.replace("${type}",p.type)),d.push({date:t,title:w,description:b.description,isFestival:b.isFestival,type:b.type})}})});const m=new Set;return e.forEach(p=>m.add(p.title)),d.forEach(p=>{if(!m.has(p.title)){const x=p.title==="Purnima",b=Array.from(m).some(w=>w.includes("Purnima")&&w!=="Purnima");x&&b||(m.add(p.title),e.push(p))}}),e},Pl=r=>{let e=Ra(r);if(e=e.filter(u=>u.isFestival),e.length===0)return null;const t=new Date(r);t.setDate(r.getDate()-1);const n=Ra(t),s=[];if(e.forEach(u=>{if(n.some(m=>m.title===u.title)){if(u.type==="lunar_fixed"||u.type==="gregorian_fixed")return;u.type==="recurring_tithi"&&(u.title=`${u.title} (Vriddhi)`,u.description=`${u.description}. Extended Tithi.`,s.push(u))}else s.push(u)}),s.length===0)return null;const i=s.map(u=>u.title).join("  "),c=Array.from(new Set(s.map(u=>u.description))).join(" ");return{name:i,description:c,monthIndex:0,tithiIndex:0}},fE=(r=new Date)=>{const e=[],t=new Date(r);t.setDate(r.getDate()-1);let n=Ra(t);for(let s=0;s<17;s++){const i=new Date(r);i.setDate(r.getDate()+s),i.setHours(12,0,0,0);const a=Ra(i),c=[];if(a.forEach(u=>{if(n.some(m=>m.title===u.title)){if(u.type==="lunar_fixed"||u.type==="gregorian_fixed")return;if(u.type==="recurring_tithi"){const m={...u};m.title=`${u.title} (Vriddhi)`,m.description=`${u.description}. Extended Tithi.`,c.push(m)}}else c.push(u)}),n=a,c.length>0){const u=c.map(p=>p.title),d=Array.from(new Set(c.map(p=>p.description))),m=c.some(p=>p.isFestival);e.push({date:i,title:u.join("  "),description:d.join(" "),isFestival:m})}}return e.sort((s,i)=>s.date.getTime()-i.date.getTime())},Og=r=>{const e=Sn(r);let t=0;e.type==="Shukla"?t=e.index/15*100:t=(30-e.index)/15*100;let n="",s="New Moon";return e.index===30?(n="",s="Amavasya"):e.index===15?(n="",s="Purnima"):e.index<8?(n="",s="Waxing Crescent"):e.index<15?(n="",s="Waxing Gibbous"):e.index<23?(n="",s="Waning Gibbous"):(n="",s="Waning Crescent"),{phase:s,icon:n,illumination:`${Math.round(t)}%`}},aa=(r,e,t)=>{const n=am.getTimes(t,r,e);return{sunrise:n.sunrise,sunset:n.sunset}},pE=(r,e)=>{const t=new Date(r);for(let n=0;n<120;n++)if(t.setMinutes(t.getMinutes()+15),Sn(t).index!==e)return t;return null},jl=(r,e,t)=>{const n=am.getTimes(t,r,e),s=n.sunrise,i=n.sunset,a=i.getTime()-s.getTime(),c=a/8,u=[],d=new Date(s.getTime()+15*60*1e3),m=new Date(i.getTime()+15*60*1e3);u.push({name:"Sunrise",start:s,end:d,color:"#F97316",type:"neutral",icon:"Sun"}),u.push({name:"Sunset",start:i,end:m,color:"#3B82F6",type:"neutral",icon:"Moon"});const p=new Date(s.getTime()-96*60*1e3),x=new Date(s.getTime()-48*60*1e3);u.push({name:"Brahma Muhurta",start:p,end:x,color:"#818CF8",type:"auspicious"});const b=new Date(s.getTime()+a/2),w=new Date(b.getTime()-24*60*1e3),k=new Date(b.getTime()+24*60*1e3);u.push({name:"Abhijit Muhurat",start:w,end:k,color:"#10B981",type:"auspicious"});const N=t.getDay(),V=[7,1,6,4,5,3,2][N],P=s.getTime()+V*c,U=P+c;u.push({name:"Rahu Kaal",start:new Date(P),end:new Date(U),color:"#EF4444",type:"inauspicious"});const L=Sn(t),G=pE(t,L.index);if(G){const I=new Date(G.getTime()+6e4),y=Sn(I);u.push({name:`Tithi changes to ${y.name}`,start:G,color:"#94A3B8",type:"neutral",icon:"Clock"})}return u.sort((I,y)=>I.start.getTime()-y.start.getTime())},gE=(r,e)=>r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",timeZone:e}),xE=({variant:r="widget"})=>{const{preferences:e}=Mt(),t=e.location||Bl,n=t.coords,[s,i]=S.useState(new Date),[a,c]=S.useState(!1),[u,d]=S.useState(0),[m,p]=S.useState(!0),[x,b]=S.useState(null),[w,k]=S.useState(null),[N,D]=S.useState("from-orange-300 via-sky-300 to-sky-100"),[V,P]=S.useState(!1),U=S.useRef([]),L=S.useRef([{id:1,x:10,y:25,scale:1.2,speed:.04,opacity:.7},{id:2,x:45,y:15,scale:.9,speed:.025,opacity:.5},{id:3,x:80,y:30,scale:.7,speed:.05,opacity:.4},{id:4,x:120,y:20,scale:1,speed:.03,opacity:.6}]),G=S.useRef(0),I=S.useRef({x:0,y:0}),y=80,v=-10,E=160-2*v,T=2*v-160,A=80,_=S.useMemo(()=>[...Array(30)].map((H,q)=>({id:q,top:`${Math.random()*60}%`,left:`${Math.random()*100}%`,size:Math.random()>.8?2:1,opacity:Math.random()*.7+.3,delay:`${Math.random()*5}s`,duration:`${3+Math.random()*4}s`})),[]);S.useEffect(()=>{c(!0);const H=setInterval(()=>i(new Date),1e3*60);return()=>clearInterval(H)},[]);const se=()=>{const H=aa(n.lat,n.lng,s),q=H.sunrise.getTime(),te=H.sunset.getTime(),he=s.getTime();if(he>=q&&he<=te)return{start:q,end:te,type:"day"};{let ye,ne;if(he>te){ye=te;const Y=new Date(s);Y.setDate(Y.getDate()+1),ne=aa(n.lat,n.lng,Y).sunrise.getTime()}else{ne=q;const Y=new Date(s);Y.setDate(Y.getDate()-1),ye=aa(n.lat,n.lng,Y).sunset.getTime()}return{start:ye,end:ne,type:"night"}}};S.useEffect(()=>{const H=se();if(!H)return;const{start:q,end:te,type:he}=H,ye=s.getTime(),ne=(ye-q)/(te-q),Y=45*60*1e3;he==="day"?(p(!0),ne<.1?D("from-sky-300 via-amber-300 to-orange-500 "):ne<.2?D("from-sky-400 via-sky-200 to-amber-100"):ne>.9?D("from-indigo-300 via-purple-400 to-orange-400"):ne>.8?D("from-blue-300 via-sky-200 to-amber-200"):D("from-sky-500 via-sky-300 to-sky-100")):(p(!1),b(Og(s)),k(Sn(s)),ye<q+Y?D("from-indigo-900 via-purple-900 to-orange-900"):ye>te-Y?D("from-slate-900 via-indigo-900 to-purple-800"):D("from-slate-900 via-indigo-950 to-slate-900")),d(Math.max(0,Math.min(1,ne)))},[s,n]);const ie=100*u,de=E*u*u+T*u+A,ce=.6;S.useEffect(()=>{I.current={x:ie,y:de}},[ie,de]);const Re=()=>{if(!w)return"";const H=40,q=50,te=50,he=w.type==="Shukla",ye=w.index;let ne=he?ye/15:(30-ye)/15;ne=Math.max(0,Math.min(1,ne));const Y=H*Math.abs(2*ne-1),ae=H;let be=`M ${q} ${te-H}`;be+=` A ${H} ${H} 0 0 ${he?1:0} ${q} ${te+H}`;let nt=0;return he?nt=ne>.5?1:0:nt=ne>.5?0:1,be+=` A ${Y} ${ae} 0 0 ${nt} ${q} ${te-H}`,be};S.useEffect(()=>{const H=()=>{let q=!1;const te=I.current;L.current.forEach((he,ye)=>{he.x+=he.speed,he.x>120&&(he.x=-20);const ne=U.current[ye];if(ne&&(ne.style.left=`${he.x}%`,ne.style.top=`${he.y}%`,ne.style.transform=`scale(${he.scale})`),m){const Y=Math.abs(he.x-te.x),ae=Math.abs(he.y-te.y);Y<12&&ae<15&&(q=!0)}}),P(q),G.current=requestAnimationFrame(H)};return G.current=requestAnimationFrame(H),()=>cancelAnimationFrame(G.current)},[m]);const Ee=()=>{const H=se();if(!H)return null;const{start:q,end:te}=H,he=te-q,ye=[];let ne=new Date(q);ne.setMinutes(0,0,0),ne.getTime()<q&&ne.setHours(ne.getHours()+1);const Y=2.5;for(;ne.getTime()<te;){const ae=ne.getTime(),be=(ae-q)/he,tt=100*be,nt=E*be*be+T*be+A,yt=100,Tt=2*E*be+T,Rt=yt*Y,we=-Tt,Ve=Rt,He=Math.sqrt(we*we+Ve*Ve),$e=we/He,kt=Ve/He,Ct=$e/Y,Z=kt,O=2,J=tt+O*Ct,oe=nt+O*Z,Ie=tt-O*Ct,ct=nt-O*Z,bt=ae<s.getTime();ye.push(o.jsx("line",{x1:J,y1:oe,x2:Ie,y2:ct,stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",className:`text-white transition-opacity duration-500 ${bt?"opacity-40":"opacity-80"}`,vectorEffect:"non-scaling-stroke"},ae)),ne.setHours(ne.getHours()+1)}return ye},Ae=m?"#FDFCF8":"#0F172A",xe=m?.8:.9,De=r==="hero"?"relative w-full h-full overflow-hidden transition-all duration-1000 group select-none bg-spiritual-50 dark:bg-spiritual-deep":"relative w-full aspect-[2/1] sm:aspect-[2.5/1] rounded-[2.5rem] overflow-hidden shadow-soft border border-white/20 transition-all duration-1000 group select-none bg-spiritual-50 dark:bg-slate-900";return a?o.jsxs("div",{className:De,children:[o.jsx("style",{children:`
            @keyframes spin-slow {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
            @keyframes twinkle {
                0%, 100% { opacity: 0.2; transform: scale(0.8); }
                50% { opacity: 1; transform: scale(1.2); }
            }
            @keyframes shooting-star {
                0% { transform: translateX(0) translateY(0) rotate(-45deg); opacity: 0; }
                10% { opacity: 1; }
                20% { transform: translateX(-100px) translateY(100px) rotate(-45deg); opacity: 0; }
                100% { transform: translateX(-100px) translateY(100px) rotate(-45deg); opacity: 0; }
            }
            @keyframes swell-1 {
                0%, 100% { d: path("M -30 100 V 80 Q 50 75 130 80 T 330 80 V 100 Z"); }
                50% { d: path("M -30 100 V 78 Q 50 85 130 78 T 330 78 V 100 Z"); }
            }
            @keyframes swell-2 {
                0%, 100% { d: path("M -30 100 V 82 Q 60 88 140 82 T 340 82 V 100 Z"); }
                50% { d: path("M -30 100 V 80 Q 60 75 140 80 T 340 80 V 100 Z"); }
            }
            @keyframes swell-3 {
                0%, 100% { d: path("M -30 100 V 85 Q 70 80 150 85 T 350 85 V 100 Z"); }
                50% { d: path("M -30 100 V 82 Q 70 88 150 82 T 350 82 V 100 Z"); }
            }
        `}),o.jsx("div",{className:`absolute inset-0 z-0 bg-gradient-to-b ${N} transition-colors duration-1000`}),o.jsxs("div",{className:"absolute inset-0 z-0 pointer-events-none transition-opacity duration-1000 ease-in-out",style:{opacity:m&&V?.8:0},children:[o.jsx("div",{className:"absolute inset-0 w-full h-full duration-500 ease-in-out",style:{background:`radial-gradient(
                        circle at 50% 100%,
                        transparent 42%, 
                        rgba(148, 0, 211, 0.4) 43%,   
                        rgba(75, 0, 130, 0.4) 44%,    
                        rgba(0, 0, 255, 0.4) 45%,     
                        rgba(0, 255, 0, 0.4) 46%,    
                        rgba(255, 255, 0, 0.4) 47%,   
                        rgba(255, 127, 0, 0.4) 48%,   
                        rgba(255, 0, 0, 0.4) 49%,     
                        transparent 52%
                    )`,filter:"blur(4px)",mixBlendMode:"color-dodge"}}),o.jsx("div",{className:"absolute inset-0 w-full h-full transition-opacity duration-500",style:{background:`radial-gradient(
                        circle at 50% 100%,
                        transparent 42%, 
                        rgba(255, 255, 255, 0.2) 46%,
                        transparent 52%
                    )`,opacity:V?.6:0,mixBlendMode:"overlay",filter:"blur(8px)"}})]}),!m&&o.jsxs("div",{className:"absolute inset-0 z-5 pointer-events-none",children:[_.map(H=>o.jsx("div",{className:"absolute bg-white rounded-full",style:{top:H.top,left:H.left,width:`${H.size}px`,height:`${H.size}px`,opacity:H.opacity,animation:`twinkle ${H.duration} ease-in-out infinite`,animationDelay:H.delay}},H.id)),o.jsx("div",{className:"absolute top-10 right-10 w-20 h-0.5 bg-gradient-to-l from-transparent to-white rounded-full opacity-0",style:{animation:"shooting-star 8s ease-in-out infinite",animationDelay:"3s"}})]}),o.jsxs("svg",{viewBox:"0 0 100 100",preserveAspectRatio:"none",className:"absolute inset-0 w-full h-full pointer-events-none z-20",children:[o.jsx("path",{d:`M 0 ${y} Q 50 ${v} 100 ${y}`,fill:"none",stroke:"currentColor",strokeWidth:"1",strokeDasharray:"4 4",className:"text-white opacity-40",vectorEffect:"non-scaling-stroke"}),Ee()]}),o.jsx("div",{className:"absolute w-16 h-16 -ml-8 -mt-8 flex items-center justify-center z-30 transition-all duration-1000 ease-linear will-change-transform",style:{left:`${ie}%`,top:`${de}%`},children:m?o.jsxs("div",{className:"relative flex items-center justify-center",children:[o.jsxs("div",{className:"absolute w-[400px] h-[400px] flex items-center justify-center pointer-events-none",style:{maskImage:"radial-gradient(circle, black 0%, transparent 70%)",WebkitMaskImage:"radial-gradient(circle, black 0%, transparent 70%)"},children:[o.jsx("div",{className:"absolute inset-0 animate-[spin-slow_60s_linear_infinite]",style:{background:"repeating-conic-gradient(from 0deg, transparent 0%, rgba(255,255,255,0.08) 5%, transparent 10%)"}}),o.jsx("div",{className:"absolute inset-0 animate-[spin-slow_40s_linear_infinite_reverse]",style:{background:"repeating-conic-gradient(from 0deg, transparent 0%, rgba(255,200,100,0.05) 7%, transparent 14%)"}})]}),o.jsx("div",{className:"relative w-7 h-7 rounded-full bg-white z-10",style:{boxShadow:`
                                0 0 10px 2px rgba(255, 223, 0, 0.8),
                                0 0 20px 5px rgba(255, 165, 0, 0.6),
                                0 0 40px 10px rgba(255, 140, 0, 0.4),
                                0 0 60px 15px rgba(255, 255, 255, 0.2)
                            `}})]}):o.jsxs("div",{className:"relative flex items-center justify-center w-full h-full",children:[o.jsx("div",{className:"absolute w-12 h-12 rounded-full bg-indigo-200 blur-xl opacity-10"}),o.jsxs("svg",{viewBox:"0 0 100 100",className:"w-9 h-9 sm:w-10 sm:h-10 drop-shadow-[0_0_12px_rgba(255,255,255,0.25)]",children:[o.jsx("defs",{children:o.jsxs("radialGradient",{id:"earthshine",cx:"50%",cy:"50%",r:"50%",fx:"50%",fy:"50%",children:[o.jsx("stop",{offset:"0%",stopColor:"#334155"}),o.jsx("stop",{offset:"100%",stopColor:"#1e293b"})]})}),o.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"url(#earthshine)",className:"stroke-slate-700/50 stroke-1"}),o.jsx("path",{d:Re(),className:"fill-slate-100"})]})]})}),o.jsx("div",{className:"absolute inset-0 mt-20 z-25 pointer-events-none overflow-hidden",children:L.current.map((H,q)=>o.jsx("div",{ref:te=>{te&&(U.current[q]=te)},className:"absolute top-0 left-0 will-change-transform z-20",style:{opacity:H.opacity},children:o.jsx(F0,{size:48*H.scale,className:"text-white/60 blur-[1px]",fill:"currentColor"})},H.id))}),o.jsxs("div",{className:"absolute inset-0 z-30 pointer-events-none overflow-hidden",children:[o.jsx("div",{className:`absolute w-16 h-8 rounded-full blur-xl transition-all duration-300 ${m?"bg-amber-200/60":"bg-white/30"}`,style:{left:`${ie}%`,top:"80%",opacity:ce,transform:"translateX(-50%) scaleX(2)"}}),o.jsxs("svg",{viewBox:"0 0 300 100",className:"absolute bottom-0 right-0 w-full h-full opacity-90",preserveAspectRatio:"none",children:[o.jsx("path",{style:{animation:"swell-1 12s ease-in-out infinite"},className:"fill-blue-600/30 dark:fill-blue-900/50"}),o.jsx("path",{style:{animation:"swell-2 8s ease-in-out infinite"},className:"fill-blue-500/30 dark:fill-blue-800/40"}),o.jsx("path",{style:{animation:"swell-3 6s ease-in-out infinite"},className:"fill-sky-400/30 dark:fill-sky-700/40"})]})]}),o.jsxs("svg",{viewBox:"0 0 100 100",className:"absolute bottom-0 left-0 w-full h-full z-40 pointer-events-none",preserveAspectRatio:"none",children:[o.jsx("defs",{children:o.jsxs("linearGradient",{id:"fog",x1:"0",y1:"0",x2:"0",y2:"1",children:[o.jsx("stop",{offset:"0%",stopColor:"transparent"}),o.jsx("stop",{offset:"50%",stopColor:Ae,stopOpacity:"0.1"}),o.jsx("stop",{offset:"100%",stopColor:Ae,stopOpacity:xe})]})}),o.jsx("path",{d:"M 40 100 L 65 61 L 93 100 Z",className:`${m?"fill-stone-400":"fill-slate-700"} transition-colors duration-1000`}),o.jsx("path",{d:"M 5 100 L 33 61 L 60 100 Z",className:`${m?"fill-stone-600":"fill-slate-900"} transition-colors duration-1000`}),o.jsx("rect",{x:"0",y:"66",width:"100",height:"34",fill:"url(#fog)"})]}),o.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-end pb-6 z-50",children:o.jsxs("div",{className:"h-1/2 text-center drop-shadow-lg",children:[o.jsx("h2",{className:"text-5xl font-serif font-bold text-white tracking-tight drop-shadow-md",children:gE(s,t.timezone)}),o.jsxs("div",{className:"flex items-center justify-center gap-2 text-white/90 text-xs font-bold uppercase tracking-widest mt-1",children:[o.jsx(Ol,{size:14,fill:"currentColor"}),t.name]})]})}),r==="hero"&&o.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-12 bg-gradient-to-b from-transparent to-spiritual-50 dark:to-spiritual-deep z-[60]"})]}):null},$h=Me.memo(xE),jr=[{label:"Happy",color:"#F59E0B",children:[{label:"Peaceful",color:"#FBBF24",children:[{label:"Tranquil",color:"#FCD34D"},{label:"Pleasant",color:"#FCD34D"},{label:"Fulfilled",color:"#FCD34D"}]},{label:"Content",color:"#FBBF24",children:[{label:"Pleased",color:"#FCD34D"},{label:"Satisfied",color:"#FCD34D"},{label:"Gratified",color:"#FCD34D"}]},{label:"Joyful",color:"#FBBF24",children:[{label:"Delighted",color:"#FCD34D"},{label:"Jovial",color:"#FCD34D"},{label:"Transcendent",color:"#FCD34D"}]},{label:"Cheerful",color:"#FBBF24",children:[{label:"Amused",color:"#FCD34D"},{label:"Playful",color:"#FCD34D"},{label:"Radiant",color:"#FCD34D"}]},{label:"Proud",color:"#FBBF24",children:[{label:"Triumphant",color:"#FCD34D"},{label:"Illustrious",color:"#FCD34D"},{label:"Admired",color:"#FCD34D"}]},{label:"Optimistic",color:"#FBBF24",children:[{label:"Hopeful",color:"#FCD34D"},{label:"Inspired",color:"#FCD34D"},{label:"Confident",color:"#FCD34D"}]},{label:"Excited",color:"#FBBF24",children:[{label:"Enthusiastic",color:"#FCD34D"},{label:"Zealous",color:"#FCD34D"},{label:"Cheeky",color:"#FCD34D"}]},{label:"Euphoric",color:"#FBBF24",children:[{label:"Jubilant",color:"#FCD34D"},{label:"Elated",color:"#FCD34D"},{label:"Blissful",color:"#FCD34D"}]}]},{label:"Love",color:"#EC4899",children:[{label:"Charmed",color:"#F472B6",children:[{label:"Captivated",color:"#F9A8D4"},{label:"Mesmerized",color:"#F9A8D4"},{label:"Rapturous",color:"#F9A8D4"}]},{label:"Romantic",color:"#F472B6",children:[{label:"Passionate",color:"#F9A8D4"},{label:"Enamored",color:"#F9A8D4"},{label:"Vibrant",color:"#F9A8D4"}]},{label:"Affectionate",color:"#F472B6",children:[{label:"Intimate",color:"#F9A8D4"},{label:"Compassionate",color:"#F9A8D4"},{label:"Devoted",color:"#F9A8D4"}]},{label:"Sentimental",color:"#F472B6",children:[{label:"Tender",color:"#F9A8D4"},{label:"Nostalgic",color:"#F9A8D4"},{label:"Sympathetic",color:"#F9A8D4"}]},{label:"Grateful",color:"#F472B6",children:[{label:"Thankful",color:"#F9A8D4"},{label:"Privilaged",color:"#F9A8D4"},{label:"Benevolent",color:"#F9A8D4"}]}]},{label:"Fearful",color:"#EAB308",children:[{label:"Scared",color:"#FACC15",children:[{label:"Helpless",color:"#FDE047"},{label:"Frightened",color:"#FDE047"},{label:"Threatened",color:"#FDE047"}]},{label:"Terrified",color:"#FACC15",children:[{label:"Panicked",color:"#FDE047"},{label:"Hysterical",color:"#FDE047"},{label:"Dreadful",color:"#FDE047"}]},{label:"Insecure",color:"#FACC15",children:[{label:"Inadequate",color:"#FDE047"},{label:"Inferior",color:"#FDE047"},{label:"Insignificant",color:"#FDE047"}]},{label:"Nervous",color:"#FACC15",children:[{label:"Worried",color:"#FDE047"},{label:"Anxious",color:"#FDE047"},{label:"Exposed",color:"#FDE047"}]},{label:"Rejected",color:"#FACC15",children:[{label:"Excluded",color:"#FDE047"},{label:"Persecuted",color:"#FDE047"},{label:"Worthless",color:"#FDE047"}]}]},{label:"Angry",color:"#EF4444",children:[{label:"Let down",color:"#F87171",children:[{label:"Betrayed",color:"#FCA5A5"},{label:"Resentful",color:"#FCA5A5"},{label:"Violated",color:"#FCA5A5"}]},{label:"Humiliated",color:"#F87171",children:[{label:"Disrespected",color:"#FCA5A5"},{label:"Ridiculed",color:"#FCA5A5"},{label:"Insulted",color:"#FCA5A5"}]},{label:"Jealous",color:"#F87171",children:[{label:"Resentful",color:"#FCA5A5"},{label:"Envious",color:"#FCA5A5"},{label:"Bitter",color:"#FCA5A5"}]},{label:"Aggressive",color:"#F87171",children:[{label:"Provoked",color:"#FCA5A5"},{label:"Hostile",color:"#FCA5A5"},{label:"Violent",color:"#FCA5A5"}]},{label:"Enraged",color:"#F87171",children:[{label:"Annoyed",color:"#FCA5A5"},{label:"Indignat",color:"#FCA5A5"},{label:"Infuriated",color:"#FCA5A5"}]},{label:"Frustrated",color:"#F87171",children:[{label:"Expaserated",color:"#FCA5A5"},{label:"Irritated",color:"#FCA5A5"},{label:"Agitated",color:"#FCA5A5"}]},{label:"Distant",color:"#F87171",children:[{label:"Withdrawn",color:"#FCA5A5"},{label:"Numb",color:"#FCA5A5"},{label:"Hateful",color:"#FCA5A5"}]},{label:"Critical",color:"#F87171",children:[{label:"Sceptical",color:"#FCA5A5"},{label:"Dismissive",color:"#FCA5A5"},{label:"Sarcastic",color:"#FCA5A5"}]},{label:"Disgusted",color:"#F87171",children:[{label:"Appalled",color:"#FCA5A5"},{label:"Revolted",color:"#FCA5A5"},{label:"Detestable",color:"#FCA5A5"}]}]},{label:"Sad",color:"#06B6D4",children:[{label:"Lonely",color:"#22D3EE",children:[{label:"Empty",color:"#67E8F9"},{label:"Negleted",color:"#67E8F9"},{label:"Abandoned",color:"#67E8F9"}]},{label:"Vulnerable",color:"#22D3EE",children:[{label:"Victimized",color:"#67E8F9"},{label:"Fragile",color:"#67E8F9"},{label:"Pressured",color:"#67E8F9"}]},{label:"Despair",color:"#22D3EE",children:[{label:"Grief",color:"#67E8F9"},{label:"Miserable",color:"#67E8F9"},{label:"Unhappy",color:"#67E8F9"}]},{label:"Ashamed",color:"#22D3EE",children:[{label:"Remorseful",color:"#67E8F9"},{label:"Guilty",color:"#67E8F9"},{label:"Embarrassed",color:"#67E8F9"}]},{label:"Depressed",color:"#22D3EE",children:[{label:"Empty",color:"#67E8F9"},{label:"Inferior",color:"#67E8F9"},{label:"Disheartened",color:"#67E8F9"}]},{label:"Hurt",color:"#22D3EE",children:[{label:"Agonized",color:"#67E8F9"},{label:"Disturbed",color:"#67E8F9"},{label:"Dismayed",color:"#67E8F9"}]},{label:"Gloomy",color:"#22D3EE",children:[{label:"Hopeless",color:"#67E8F9"},{label:"Depressed",color:"#67E8F9"},{label:"Dissapointed",color:"#67E8F9"}]}]}],Ca=r=>{if(!r)return{found:!1,color:"#C5A059",rootColor:"#C5A059",rootLabel:""};for(const e of jr){if(e.label===r)return{found:!0,color:e.color,rootColor:e.color,rootLabel:e.label};if(e.children){const t=Mg(e,r,e);if(t)return t}}return{found:!1,color:"#C5A059",rootColor:"#C5A059",rootLabel:""}},Mg=(r,e,t)=>{if(r.label===e)return{found:!0,color:r.color,rootColor:t.color,rootLabel:t.label};if(r.children)for(const n of r.children){const s=Mg(n,e,t);if(s)return s}return null},Yc=({onClose:r,title:e,subtitle:t,icon:n,children:s})=>(S.useEffect(()=>{const i=a=>{a.key==="Escape"&&r()};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[r]),Jh.createPortal(o.jsx("div",{className:"fixed inset-0 z-[120] flex items-end justify-center bg-black/40 backdrop-blur-sm animate-fade-in",onClick:r,children:o.jsxs("div",{className:"w-full max-w-2xl bg-black/80 backdrop-blur-xl border-t border-white/10 rounded-t-[3rem] p-8 pb-12 animate-slide-in-bottom shadow-2xl overflow-y-auto max-h-[85vh] relative",onClick:i=>i.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-start mb-8 relative z-10",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[n&&o.jsx("div",{className:"p-3 bg-white/10 rounded-full text-white/80",children:n}),o.jsxs("div",{children:[o.jsx("h3",{className:"text-2xl font-bold text-white",children:e}),t&&o.jsx("p",{className:"text-white/50 text-xs font-bold uppercase tracking-widest",children:t})]})]}),o.jsx("button",{onClick:r,className:"p-2 bg-white/10 hover:bg-white/20 rounded-full text-white transition-colors","aria-label":"Close",children:o.jsx(Qr,{size:24})})]}),o.jsx("div",{className:"relative z-10 space-y-6",children:s})]})}),document.body)),yE=()=>{const r=new Date,e=r.getTimezoneOffset();return new Date(r.getTime()-e*60*1e3).toISOString().split("T")[0]},bE=({onClose:r,trackerItems:e,practiceSummary:t,todayJournal:n,goals:s,initialType:i=null,onNavigate:a})=>{const[c,u]=S.useState(i?"detail":"summary"),[d,m]=S.useState(i),p=yE(),x=S.useMemo(()=>oo(),[]),b=S.useMemo(()=>!d||d==="journal"||d==="sadhana"?[]:x.filter(q=>{const te=new Date(q.date),he=te.getTimezoneOffset();return new Date(te.getTime()-he*60*1e3).toISOString().split("T")[0]===p&&q.type===d}).sort((q,te)=>new Date(te.date).getTime()-new Date(q.date).getTime()),[x,d,p]),w=e,k=e.filter(q=>q.completedDates.includes(p)),N=w.length>0?k.length/w.length:0,D=((s==null?void 0:s.breathworkMinutes)||5)*60,V=((s==null?void 0:s.meditationMinutes)||10)*60,P=((s==null?void 0:s.yogaMinutes)||15)*60,U=((s==null?void 0:s.mantraMinutes)||15)*60,L=Math.min(t.breathwork/D,1),G=Math.min(t.meditation/V,1),I=Math.min(t.yoga/P,1),y=Math.min(t.mantra/U,1),v=Ca((n==null?void 0:n.mood)||""),E=n?v.rootColor:"#C5A059",T=!!n,A=q=>{m(q),u("detail")},_=()=>{u("summary"),m(null)},se=()=>{a&&(r(),a(X.SADHANA))},ie=q=>{if(q==="journal")return{title:"Chintan",icon:o.jsx(Ku,{size:24}),color:"text-spiritual-600 dark:text-spiritual-300",bg:"bg-spiritual-100 dark:bg-spiritual-800",target:1,current:n?1:0};if(q==="sadhana")return{title:"Sdhya",icon:o.jsx(Qt,{size:24}),color:"text-spiritual-800 dark:text-spiritual-100",bg:"bg-spiritual-200 dark:bg-spiritual-700",target:w.length,current:k.length};switch(q){case"breathwork":return{title:"Pranayama",icon:o.jsx(Bs,{size:24}),color:"text-sky-400",bg:"bg-sky-400",target:D,current:t.breathwork};case"meditation":return{title:"Dhyana",icon:o.jsx(Wo,{size:24}),color:"text-indigo-400",bg:"bg-indigo-400",target:V,current:t.meditation};case"yoga":return{title:"Asana",icon:o.jsx(zs,{size:24}),color:"text-orange-400",bg:"bg-orange-400",target:P,current:t.yoga};case"mantra":return{title:"Mantra Japa",icon:o.jsx(Qo,{size:24}),color:"text-amber-400",bg:"bg-amber-400",target:U,current:t.mantra};default:return{title:"",icon:null,color:"",bg:"",target:0,current:0}}},de=q=>{const te=Math.floor(q/60),he=q%60;return te===0?`${he}s`:`${te}m ${he}s`},ce=q=>new Date(q).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),Re=()=>o.jsxs(o.Fragment,{children:[o.jsxs("div",{onClick:()=>A("sadhana"),className:"flex items-center justify-between p-4 bg-white/5 rounded-2xl border border-white/5 cursor-pointer group hover:bg-white/10 transition-colors",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"p-2 bg-white/10 rounded-xl text-white/80 shadow-sm",children:o.jsx(Qt,{size:20})}),o.jsxs("div",{children:[o.jsx("p",{className:"text-xs font-bold text-white/40 uppercase tracking-wider group-hover:text-white/60",children:"Lakya"}),o.jsxs("p",{className:"font-bold text-white",children:[k.length," / ",w.length," Completed"]})]})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("span",{className:"text-xl font-serif font-bold text-white/80",children:[Math.round(N*100),"%"]}),o.jsx(Dt,{size:16,className:"text-white/30 group-hover:translate-x-1 transition-transform"})]})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{onClick:()=>A("breathwork"),className:"space-y-1 cursor-pointer group",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-2 text-sky-400 group-hover:text-sky-300 transition-colors",children:[o.jsx(Bs,{size:16}),o.jsx("span",{className:"text-sm font-bold",children:"Pranayama"}),o.jsx(Dt,{size:14,className:"opacity-0 -ml-1 group-hover:opacity-100 group-hover:ml-0 transition-all"})]}),o.jsxs("span",{className:"font-mono text-sm text-white/40",children:[Math.round(t.breathwork/60)," / ",Math.round(D/60)," mins"]})]}),o.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full overflow-hidden",children:o.jsx("div",{className:"h-full bg-sky-400 rounded-full transition-all duration-1000 ease-out",style:{width:`${L*100}%`}})})]}),o.jsxs("div",{onClick:()=>A("meditation"),className:"space-y-1 cursor-pointer group",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-2 text-indigo-400 group-hover:text-indigo-300 transition-colors",children:[o.jsx(Wo,{size:16}),o.jsx("span",{className:"text-sm font-bold",children:"Dhyana"}),o.jsx(Dt,{size:14,className:"opacity-0 -ml-1 group-hover:opacity-100 group-hover:ml-0 transition-all"})]}),o.jsxs("span",{className:"font-mono text-sm text-white/40",children:[Math.round(t.meditation/60)," / ",Math.round(V/60)," mins"]})]}),o.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full overflow-hidden",children:o.jsx("div",{className:"h-full bg-indigo-400 rounded-full transition-all duration-1000 ease-out",style:{width:`${G*100}%`}})})]}),o.jsxs("div",{onClick:()=>A("yoga"),className:"space-y-1 cursor-pointer group",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-2 text-orange-400 group-hover:text-orange-300 transition-colors",children:[o.jsx(zs,{size:16}),o.jsx("span",{className:"text-sm font-bold",children:"Asana"}),o.jsx(Dt,{size:14,className:"opacity-0 -ml-1 group-hover:opacity-100 group-hover:ml-0 transition-all"})]}),o.jsxs("span",{className:"font-mono text-sm text-white/40",children:[Math.round(t.yoga/60)," / ",Math.round(P/60)," mins"]})]}),o.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full overflow-hidden",children:o.jsx("div",{className:"h-full bg-orange-400 rounded-full transition-all duration-1000 ease-out",style:{width:`${I*100}%`}})})]}),o.jsxs("div",{onClick:()=>A("mantra"),className:"space-y-1 cursor-pointer group",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-2 text-amber-400 group-hover:text-amber-300 transition-colors",children:[o.jsx(Qo,{size:16}),o.jsx("span",{className:"text-sm font-bold",children:"Mantra Japa"}),o.jsx(Dt,{size:14,className:"opacity-0 -ml-1 group-hover:opacity-100 group-hover:ml-0 transition-all"})]}),o.jsxs("span",{className:"font-mono text-sm text-white/40",children:[Math.round(t.mantra/60)," / ",Math.round(U/60)," mins"]})]}),o.jsx("div",{className:"h-1.5 w-full bg-white/10 rounded-full overflow-hidden",children:o.jsx("div",{className:"h-full bg-amber-400 rounded-full transition-all duration-1000 ease-out",style:{width:`${y*100}%`}})})]})]}),o.jsx("div",{onClick:()=>A("journal"),className:"p-4 rounded-2xl bg-white/5 border border-white/5 shadow-sm cursor-pointer group hover:bg-white/10 transition-colors",children:o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("div",{className:"p-2 bg-white/10 rounded-xl text-white/80",children:o.jsx(Ku,{size:20})}),o.jsxs("div",{className:"flex-1",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsx("p",{className:"text-xs font-bold text-white/40 uppercase tracking-wider mb-1",children:"Chintan (Reflection)"}),o.jsx(Dt,{size:14,className:"text-white/40 opacity-0 group-hover:opacity-100 transition-opacity"})]}),T?o.jsxs("div",{children:[o.jsx("p",{className:"font-bold text-white mb-0.5",children:"Entry Recorded"}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:E}}),o.jsxs("span",{className:"text-xs text-white/60",children:["Mood: ",n.mood]})]})]}):o.jsx("p",{className:"text-sm text-white/60 italic",children:'"The unexamined life is not worth living."'})]})]})})]}),Ee=()=>{if(!n)return o.jsx("div",{className:"text-center py-12 opacity-50 border border-dashed border-white/10 rounded-2xl animate-slide-in-right",children:o.jsx("p",{className:"text-sm text-white/60",children:"No reflection recorded for today."})});const{rootColor:q}=Ca(n.mood);return o.jsxs("div",{className:"space-y-6 animate-slide-in-right",children:[o.jsxs("div",{className:"flex items-center gap-2 text-white/50 mb-2 cursor-pointer hover:text-white",onClick:_,children:[o.jsx(Nr,{size:16}),o.jsx("span",{className:"text-xs font-bold uppercase tracking-wider",children:"Back to Overview"})]}),o.jsxs("div",{className:"p-6 bg-white/5 rounded-[2rem] border border-white/10 space-y-4",children:[o.jsxs("div",{className:"flex items-center justify-between",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-spiritual-900 font-bold shadow-lg",style:{backgroundColor:q},children:o.jsx(Pa,{size:18})}),o.jsxs("div",{children:[o.jsx("p",{className:"text-sm font-bold text-white/50 uppercase tracking-wider",children:"Mood"}),o.jsx("p",{className:"text-xl font-bold text-white",children:n.mood})]})]}),o.jsx("span",{className:"text-xs font-mono text-white/30",children:ce(n.date)})]}),o.jsx("hr",{className:"border-white/5"}),o.jsxs("div",{className:"space-y-3 font-serif italic text-lg text-white/90 leading-relaxed",children:[n.q1&&o.jsxs("p",{children:['"',n.q1,'"']}),n.q2&&o.jsxs("p",{children:['"',n.q2,'"']}),n.q3&&o.jsxs("p",{children:['"',n.q3,'"']}),!n.q1&&!n.q2&&!n.q3&&o.jsx("p",{className:"text-white/50 not-italic text-base",children:"No written reflection yet."})]}),n.learning&&o.jsxs("div",{className:"bg-white/5 p-4 rounded-xl border border-white/5",children:[o.jsx("p",{className:"text-xs font-bold text-white/50 uppercase mb-1",children:"Key Learning"}),o.jsx("p",{className:"text-sm text-white/80",children:n.learning})]})]})]})},Ae=()=>o.jsxs("div",{className:"animate-slide-in-right space-y-6",children:[o.jsxs("div",{className:"flex items-center justify-between mb-4",children:[o.jsxs("div",{className:"flex items-center gap-2 text-white/50 cursor-pointer hover:text-white",onClick:_,children:[o.jsx(Nr,{size:16}),o.jsx("span",{className:"text-xs font-bold uppercase tracking-wider",children:"Back"})]}),a&&o.jsxs("button",{onClick:se,className:"flex items-center gap-1.5 text-xs font-bold bg-white/10 hover:bg-white/20 px-3 py-1.5 rounded-full text-white transition-colors",children:[o.jsx("span",{children:"Manage Tracker"}),o.jsx(U0,{size:12})]})]}),o.jsxs("div",{className:"p-6 rounded-[2rem] bg-white/5 border border-white/10 flex flex-col items-center gap-4",children:[o.jsxs("div",{className:"text-center",children:[o.jsx("h3",{className:"text-lg font-bold text-white",children:"Today's Pulse"}),o.jsxs("p",{className:"text-white/40 text-xs uppercase tracking-widest",children:[k.length," of ",w.length," active"]})]}),o.jsxs("div",{className:"flex gap-2",children:[w.map(q=>{const te=q.completedDates.includes(p);return o.jsx("div",{className:`w-3 h-3 rounded-full transition-all duration-500 ${te?"bg-green-400 shadow-[0_0_8px_rgba(74,222,128,0.5)] scale-125":"bg-white/20"}`,title:q.title},q.id)}),w.length===0&&o.jsx("span",{className:"text-white/30 text-xs italic",children:"No habits set"})]})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-xs font-bold text-white/40 uppercase tracking-widest mb-3 pl-1",children:"Goal Trajectory"}),o.jsxs("div",{className:"space-y-3",children:[w.map(q=>{const te=Math.min(q.streak/q.targetDays*100,100),he=q.completedDates.includes(p);return o.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5",children:[o.jsxs("div",{className:"flex justify-between items-start mb-2",children:[o.jsxs("div",{children:[o.jsx("h4",{className:`font-bold text-sm ${he?"text-white":"text-white/70"}`,children:q.title}),o.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[q.reminderTime&&o.jsxs("div",{className:"flex items-center gap-1 text-xs text-white/40 bg-white/5 px-1.5 py-0.5 rounded",children:[o.jsx(B0,{size:10}),o.jsx("span",{children:q.reminderTime})]}),o.jsxs("div",{className:"flex items-center gap-1 text-xs text-amber-400/80",children:[o.jsx(Fl,{size:10,fill:"currentColor"}),o.jsxs("span",{children:["Day ",q.streak," of ",q.targetDays]})]})]})]}),he&&o.jsx(Qt,{size:16,className:"text-green-400"})]}),o.jsxs("div",{className:"h-1.5 w-full bg-white/10 rounded-full overflow-hidden mt-2 relative",children:[o.jsx("div",{className:"h-full bg-gradient-to-r from-amber-600 to-amber-400 rounded-full transition-all duration-1000 ease-out",style:{width:`${te}%`}}),o.jsx("div",{className:"absolute right-0 top-0 bottom-0 w-0.5 bg-white/30 z-10"})]})]},q.id)}),w.length===0&&o.jsxs("div",{className:"text-center py-6 opacity-50 border border-dashed border-white/10 rounded-2xl",children:[o.jsx(sm,{size:24,className:"mx-auto mb-2 text-white/40"}),o.jsx("p",{className:"text-xs text-white/60",children:"No goals set. Set your Sdhy."})]})]})]})]}),xe=()=>{if(d==="journal")return Ee();if(d==="sadhana")return Ae();if(!d)return null;const q=ie(d);return q.bg&&q.bg.replace("bg-","bg-").replace("400","900/30"),o.jsxs("div",{className:"animate-slide-in-right space-y-6",children:[o.jsxs("div",{className:"flex items-center gap-2 text-white/50 mb-2 cursor-pointer hover:text-white",onClick:_,children:[o.jsx(Nr,{size:16}),o.jsx("span",{className:"text-xs font-bold uppercase tracking-wider",children:"Back"})]}),o.jsxs("div",{className:"p-6 rounded-[2rem] border border-white/10 flex items-center justify-between relative overflow-hidden",children:[o.jsx("div",{className:`absolute inset-0 ${q.bg} opacity-20`}),o.jsxs("div",{className:"relative z-10",children:[o.jsxs("p",{className:"text-white/60 text-xs font-bold uppercase tracking-widest mb-1",children:[q.title," Today"]}),o.jsxs("p",{className:"text-3xl font-bold text-white font-mono",children:[Math.round(q.current/60)," ",o.jsx("span",{className:"text-base text-white/50 font-sans font-normal",children:"mins"})]}),o.jsxs("p",{className:"text-xs text-white/40 mt-1",children:["Target: ",Math.round(q.target/60)," mins"]})]}),o.jsx("div",{className:`relative z-10 p-4 rounded-2xl bg-white/10 backdrop-blur-md ${q.color}`,children:q.icon})]}),o.jsxs("div",{children:[o.jsx("p",{className:"text-xs font-bold text-white/40 uppercase tracking-widest mb-3 pl-1",children:"Session History"}),b.length===0?o.jsx("div",{className:"text-center py-8 opacity-50 border border-dashed border-white/10 rounded-2xl",children:o.jsx("p",{className:"text-sm text-white/60",children:"No sessions recorded today."})}):o.jsx("div",{className:"space-y-3",children:b.map((te,he)=>o.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5 flex items-center justify-between",children:[o.jsxs("div",{children:[o.jsx("p",{className:"font-bold text-white text-sm",children:te.title}),o.jsx("p",{className:"text-xs text-white/40 mt-0.5",children:ce(te.date)})]}),o.jsx("span",{className:"font-mono text-sm text-white/80",children:de(te.durationSeconds)})]},he))})]})]})},De=c==="summary"?"Practice Status":d?ie(d).title:"Details",H=c==="summary"?o.jsx(om,{size:24}):null;return o.jsx(Yc,{onClose:r,title:De,subtitle:c==="summary"?"Today's Attainment ":"Detailed Breakdown",icon:H,children:c==="summary"?Re():xe()})},vE=()=>{const r=new Date,e=r.getTimezoneOffset();return new Date(r.getTime()-e*60*1e3).toISOString().split("T")[0]},_E=({trackerItems:r,onNavigate:e})=>{const{preferences:t}=Mt(),{goals:n}=t,[s,i]=S.useState({breathwork:0,meditation:0,yoga:0,mantra:0,mantraCount:0}),[a,c]=S.useState(null),[u,d]=S.useState(!1),[m,p]=S.useState(null),[x,b]=S.useState(270),[w,k]=S.useState(!0),[N,D]=S.useState(!1),[V,P]=S.useState(null),U=S.useRef(0),L=S.useRef(null),G=S.useRef(null),I=S.useRef(0),y=S.useRef(.15),v=.15,E=vE(),T=S.useCallback(()=>{i(YT(E));const O=cr().find(J=>J.date.split("T")[0]===E);c(O||null)},[E]);S.useEffect(()=>(T(),window.addEventListener("sadhaka_journal_updated",T),window.addEventListener("sadhaka_practice_updated",T),()=>{window.removeEventListener("sadhaka_journal_updated",T),window.removeEventListener("sadhaka_practice_updated",T)}),[T,r]),S.useEffect(()=>{const Z=()=>{N||(w?y.current<v?y.current+=.005:y.current>v&&(y.current=v):y.current=0,y.current>0&&b(O=>(O+y.current)%360)),I.current=requestAnimationFrame(Z)};return I.current=requestAnimationFrame(Z),()=>cancelAnimationFrame(I.current)},[w,N]),S.useEffect(()=>{if(!w&&!N){const Z=setTimeout(()=>{Date.now()-U.current>5e3&&k(!0)},5e3);return()=>clearTimeout(Z)}},[w,N]);const A=r,_=r.filter(Z=>Z.completedDates.includes(E)),se=A.length>0?_.length/A.length:0,ie=((n==null?void 0:n.breathworkMinutes)||5)*60,de=((n==null?void 0:n.meditationMinutes)||10)*60,ce=((n==null?void 0:n.yogaMinutes)||15)*60,Re=((n==null?void 0:n.mantraMinutes)||15)*60,Ee=Math.min(s.breathwork/ie,1),Ae=Math.min(s.meditation/de,1),xe=Math.min(s.yoga/ce,1),De=Math.min(s.mantra/Re,1),H=Ca((a==null?void 0:a.mood)||""),q=a?H.rootColor:"#C5A059",te=!!a,he=A.length>0&&_.length===A.length,ye=Ee>=1&&Ae>=1&&xe>=1&&De>=1,ne=he&&ye&&te,Y=280,ae=Y/2,be=100,tt=2*Math.PI*be,nt=tt-se*tt,yt=(Z,O,J,oe,Ie=0)=>{const ct=[];for(let bt=0;bt<oe;bt++){const Lt=(bt*360/oe+Ie)*(Math.PI/180);ct.push(`${Z+J*Math.cos(Lt)},${O+J*Math.sin(Lt)}`)}return ct.join(" ")},Tt=x*(Math.PI/180),Rt=ae+be*Math.cos(Tt),$=ae+be*Math.sin(Tt),we=(Z,O)=>{if(!G.current)return{angle:0,dist:0};const J=G.current.getBoundingClientRect(),oe=Z-J.left-J.width/2,Ie=O-J.top-J.height/2;let ct=Math.atan2(Ie,oe)*(180/Math.PI);ct<0&&(ct+=360);const bt=Y/J.width,Lt=Math.sqrt(oe*oe+Ie*Ie)*bt;return{angle:ct,dist:Lt}},Ve=Z=>{Z.preventDefault(),Z.stopPropagation(),Z.currentTarget.setPointerCapture(Z.pointerId);const{angle:O}=we(Z.clientX,Z.clientY);b(O),L.current={x:Z.clientX,y:Z.clientY},y.current=0,k(!1),D(!0),U.current=Date.now()},He=Z=>{if(N){Z.preventDefault(),Z.stopPropagation();const{angle:O}=we(Z.clientX,Z.clientY);b(O),U.current=Date.now()}},$e=Z=>{Z.preventDefault(),Z.stopPropagation();const{dist:O}=we(Z.clientX,Z.clientY);let J=0;if(L.current){const oe=Z.clientX-L.current.x,Ie=Z.clientY-L.current.y;J=Math.sqrt(oe*oe+Ie*Ie)}N&&(D(!1),U.current=Date.now(),Z.currentTarget.hasPointerCapture(Z.pointerId)&&Z.currentTarget.releasePointerCapture(Z.pointerId),J<10?(p("sadhana"),d(!0),k(!1)):(k(!0),y.current=0)),L.current=null},kt=Z=>{N||(p(Z),d(!0))},Ct=()=>{p(null),d(!0)};return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"relative overflow-hidden rounded-[2.5rem] p-6 shadow-soft border border-white dark:border-spiritual-700 group select-none transition-all duration-500 hover:shadow-lg",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-spiritual-100 via-white to-spiritual-200 dark:from-spiritual-800 dark:via-spiritual-900 dark:to-black opacity-80"}),o.jsx("div",{className:"absolute top-0 right-0 w-56 h-56 bg-amber-100/50 dark:bg-amber-900/20 rounded-full blur-[60px] -mr-10 -mt-10 animate-float pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity duration-700"}),o.jsx("div",{className:"absolute bottom-0 left-0 w-48 h-48 bg-spiritual-gold/10 rounded-full blur-[60px] -ml-10 -mb-10 pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity duration-700"}),o.jsx("div",{className:`absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 h-64 rounded-full blur-[80px] animate-pulse-slow transition-opacity duration-1000 pointer-events-none ${ne?"bg-spiritual-gold/80 opacity-85":"bg-spiritual-200/30 dark:bg-spiritual-800/30 opacity-30"}`}),o.jsxs("div",{className:"flex justify-between items-start relative z-10 mb-4",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center gap-2 text-spiritual-500 dark:text-spiritual-400 mb-1",children:[o.jsx(om,{size:14,className:"text-spiritual-gold"}),o.jsx("span",{className:"text-xs font-bold uppercase tracking-widest",children:"The Mandala"})]}),o.jsx("h2",{className:"text-2xl font-bold text-spiritual-900 dark:text-spiritual-50",children:"Practice Status"}),o.jsx("p",{className:"text-xs text-spiritual-500 dark:text-spiritual-400 font-medium mt-1",children:N?"Orienting...":"Tap shapes to reveal..."})]}),o.jsx("button",{onClick:Ct,className:"p-3 text-spiritual-300 hover:text-spiritual-500 dark:hover:text-spiritual-200 transition-colors rounded-full hover:bg-spiritual-100 dark:hover:bg-spiritual-800","aria-label":"Practice Info",children:o.jsx(li,{size:20})})]}),o.jsx("div",{className:"relative w-full flex justify-center z-10",children:o.jsxs("div",{ref:G,className:"relative w-full aspect-square",children:[o.jsxs("svg",{width:"100%",height:"100%",viewBox:`0 0 ${Y} ${Y}`,className:"overflow-visible",children:[o.jsx("defs",{children:o.jsxs("filter",{id:"glow",x:"-40%",y:"-40%",width:"180%",height:"180%",children:[o.jsx("feGaussianBlur",{stdDeviation:"4",result:"blur"}),o.jsx("feComposite",{in:"SourceGraphic",in2:"blur",operator:"over"})]})}),o.jsx("circle",{cx:ae,cy:ae,r:be,fill:"none",stroke:"currentColor",className:`text-spiritual-200 dark:text-spiritual-600 transition-opacity duration-1000 ${ne?"opacity-30":"opacity-100"}`,strokeWidth:"1",strokeDasharray:"4 4"}),o.jsx("circle",{cx:ae,cy:ae,r:be,fill:"none",stroke:"currentColor",className:"text-spiritual-200 dark:text-spiritual-600",strokeWidth:"2"}),o.jsx("circle",{cx:ae,cy:ae,r:be,fill:"none",stroke:"currentColor",className:`${ne?"text-yellow-400 drop-shadow-[0_0_8px_rgba(250,204,21,0.5)]":"text-spiritual-600 dark:text-spiritual-300"} transition-all duration-1000 ease-out`,strokeWidth:ne?3:2,strokeDasharray:tt,strokeDashoffset:nt,strokeLinecap:"round",transform:`rotate(-90 ${ae} ${ae})`}),o.jsx("circle",{cx:ae,cy:ae,r:be,fill:"none",stroke:"transparent",strokeWidth:"40",className:"cursor-pointer",style:{touchAction:"none"},onPointerDown:Ve,onPointerMove:He,onPointerUp:$e,onPointerCancel:$e}),o.jsxs("g",{className:"pointer-events-auto",style:{touchAction:"none"},children:[o.jsx("polygon",{onClick:Z=>{Z.stopPropagation(),kt("yoga")},points:yt(ae,ae,80,6,30),fill:xe>0?"currentColor":"transparent",stroke:"currentColor",strokeWidth:"1.5",className:`
                                ${ne?"text-yellow-500/10 stroke-yellow-400/50":"text-orange-200/40 dark:text-orange-900/40 stroke-orange-300 dark:stroke-orange-700"} 
                                hover:fill-orange-400/20 hover:scale-110
                                transition-all duration-300 ease-out origin-center cursor-pointer 
                            `}),o.jsx("polygon",{onClick:Z=>{Z.stopPropagation(),kt("meditation")},points:yt(ae,ae,55,4,0),fill:Ae>0?"currentColor":"transparent",stroke:"currentColor",strokeWidth:"1.5",className:`
                                ${ne?"text-yellow-400/20 stroke-yellow-300/50":"text-indigo-200/40 dark:text-indigo-900/40 stroke-indigo-300 dark:stroke-indigo-700"} 
                                hover:fill-indigo-400/20 hover:scale-110
                                transition-all duration-300 ease-out origin-center cursor-pointer
                            `}),o.jsx("circle",{onClick:Z=>{Z.stopPropagation(),kt("mantra")},cx:ae,cy:ae,r:40,fill:De>0?"currentColor":"transparent",stroke:"currentColor",strokeWidth:"1.5",className:`
                                ${ne?"text-yellow-300/20 stroke-yellow-200/50":"text-amber-200/40 dark:text-amber-900/40 stroke-amber-500 dark:stroke-amber-600"} 
                                hover:fill-amber-400/20 hover:scale-110
                                transition-all duration-300 ease-out origin-center cursor-pointer 
                            `}),o.jsx("polygon",{onClick:Z=>{Z.stopPropagation(),kt("breathwork")},points:yt(ae,ae,35,3,-90),fill:Ee>0?"currentColor":"transparent",stroke:"currentColor",strokeWidth:"1.5",className:`
                                ${ne?"text-yellow-200/30 stroke-yellow-100/50":"text-sky-200/40 dark:text-sky-900/40 stroke-sky-300 dark:stroke-sky-700"} 
                                hover:fill-sky-400/20 hover:scale-110
                                transition-all duration-300 ease-out origin-center cursor-pointer
                            `})]}),o.jsxs("g",{onClick:Z=>{Z.stopPropagation(),kt("journal")},className:"cursor-pointer group pointer-events-auto",style:{touchAction:"none"},children:[o.jsx("circle",{cx:ae,cy:ae,r:10,fill:"transparent"}),o.jsx("circle",{cx:ae,cy:ae,r:te?6:4,fill:te?q:"none",stroke:te?ne?"#FFF":"none":"currentColor",strokeWidth:te?ne?2:0:1,className:`transition-all duration-700 ${te?"":"text-spiritual-300"} origin-center group-hover:scale-125 group-active:scale-95`,filter:te||ne?"url(#glow)":""})]})]}),o.jsxs("div",{className:"absolute w-12 h-12 -ml-6 -mt-6 rounded-full flex items-center justify-center cursor-pointer z-20 group",style:{left:`${Rt/Y*100}%`,top:`${$/Y*100}%`,transition:N?"none":"left 0.05s linear, top 0.05s linear",pointerEvents:"auto",touchAction:"none"},onPointerDown:Ve,onPointerMove:He,onPointerUp:$e,onPointerCancel:$e,children:[o.jsx("div",{className:"absolute inset-0 rounded-full bg-spiritual-gold/30 animate-pulse-slow transition-all duration-500"}),o.jsx("div",{className:`relative w-4 h-4 rounded-full shadow-[0_0_15px_rgba(197,160,89,0.9)] transition-all duration-300 bg-spiritual-gold group-hover:scale-125 ${N?"scale-150":""}`})]})]})})]}),u&&o.jsx(bE,{onClose:()=>{d(!1),p(null)},trackerItems:r,practiceSummary:s,todayJournal:a,goals:n,initialType:m,onNavigate:e})]})},wE=Me.memo(_E),Cs=(r,e,t,n)=>{const s=(n-90)*Math.PI/180;return{x:r+t*Math.cos(s),y:e+t*Math.sin(s)}},IE=(r,e,t,n,s,i)=>{const a=Cs(r,e,n,i),c=Cs(r,e,n,s),u=Cs(r,e,t,i),d=Cs(r,e,t,s),m=i-s<=180?"0":"1";return["M",a.x,a.y,"A",n,n,0,m,0,c.x,c.y,"L",d.x,d.y,"A",t,t,0,m,1,u.x,u.y,"Z"].join(" ")},TE=({onSelect:r,onClose:e,initialMood:t})=>{const[n,s]=S.useState(()=>{if(t){const L=jr.find(G=>G.label===t);return L?[L]:[]}return[]}),[i,a]=S.useState(!1),[c,u]=S.useState(null),d=n.length>0?n[n.length-1]:null,m=d?d.children||[]:jr,p=360,x=p/2,b=p/2,w=p/2-10,k=70,N=3,D=L=>{L.children&&L.children.length>0?(a(!0),setTimeout(()=>{s([...n,L]),u(null),a(!1)},250)):r(L.label)},V=()=>{if(n.length===0){e();return}a(!0),setTimeout(()=>{s(n.slice(0,-1)),a(!1)},250)},P=()=>{n.length>0?V():e()},U=()=>{const L=m.length,G=360/L;return m.map((I,y)=>{const v=y*G+N/2,E=(y+1)*G-N/2,T=v+(G-N)/2,A=k+(w-k)*.6,_=Cs(x,b,A,T);let se=T;T>180&&(se+=180);const ie=c===y;return o.jsxs("g",{onClick:()=>D(I),onMouseEnter:()=>u(y),onMouseLeave:()=>u(null),onTouchStart:()=>u(y),onTouchEnd:()=>u(null),className:"cursor-pointer group",style:{transformOrigin:"center",transition:"transform 0.3s ease-out",touchAction:"manipulation"},children:[o.jsx("path",{d:IE(x,b,k+4,w,v,E),fill:I.color,fillOpacity:ie?.9:.6,stroke:"white",strokeOpacity:ie?.8:.3,strokeWidth:"1",className:"transition-all duration-300 ease-out origin-center",style:{transform:ie?"scale(1.03)":"scale(1)"}}),o.jsx("text",{x:_.x,y:_.y,textAnchor:"middle",dominantBaseline:"middle",fill:"white",fontSize:L>8?"10":"12",fontWeight:"700",transform:`rotate(${se-90}, ${_.x}, ${_.y})`,className:"pointer-events-none uppercase tracking-wider drop-shadow-md",children:I.label})]},y)})};return Jh.createPortal(o.jsxs("div",{className:"fixed inset-0 z-[100] bg-spiritual-deep/90 backdrop-blur-xl flex flex-col items-center justify-center p-6 animate-fade-in text-base antialiased",children:[o.jsxs("div",{className:"absolute top-6 left-6 right-6 flex justify-between items-center z-20",children:[o.jsx("button",{onClick:V,className:"p-3 bg-white/10 dark:bg-black/20 rounded-full hover:bg-white/20 dark:hover:bg-black/40 transition-colors text-white border border-white/10",children:o.jsx(Nr,{size:24})}),o.jsx("h3",{className:"text-lg font-bold text-white font-serif tracking-wide drop-shadow-sm",children:"The Ankush"}),o.jsx("div",{className:"w-12"})]}),o.jsxs("div",{className:"absolute top-24 left-0 right-0 flex justify-center gap-2 z-10 pointer-events-none",children:[o.jsx("span",{className:"text-white/50 font-medium",children:"I feel, therefore I am..."}),n.map((L,G)=>o.jsxs(Me.Fragment,{children:[o.jsx("span",{className:"text-white/30",children:">"}),o.jsx("span",{className:"font-bold text-white drop-shadow-md",style:{color:L.color},children:L.label})]},G)),n.length===0&&o.jsx("span",{className:"text-white/30 animate-pulse",children:"..."})]}),o.jsx("div",{className:`relative transition-all duration-500 ease-out ${i?"scale-90 opacity-0 blur-sm":"scale-100 opacity-100 blur-0"}`,children:o.jsxs("svg",{width:p,height:p,viewBox:`0 0 ${p} ${p}`,className:"drop-shadow-2xl",children:[U(),o.jsx("foreignObject",{x:x-k,y:b-k,width:k*2,height:k*2,children:o.jsx("div",{className:`w-full h-full rounded-full flex flex-col items-center justify-center 
                                   bg-gradient-to-br from-white/20 to-white/5 
                                   backdrop-blur-xl border border-white/20 
                                   shadow-[inset_0_0_20px_rgba(255,255,255,0.1)]
                                   text-white transition-all hover:bg-white/20 hover:scale-105 active:scale-95 cursor-pointer group`,onClick:P,children:n.length>0?o.jsxs(o.Fragment,{children:[o.jsx(Nr,{size:18,className:"text-white/70 mb-1 group-hover:-translate-x-1 transition-transform"}),o.jsx("span",{className:"text-[10px] font-bold text-white uppercase tracking-wide px-2 text-center leading-tight drop-shadow-sm",children:"Back"})]}):o.jsxs(o.Fragment,{children:[o.jsx(Qr,{size:18,className:"text-white/70 mb-1 group-hover:scale-110 transition-transform"}),o.jsx("span",{className:"text-[10px] font-bold text-white uppercase tracking-wide px-2 text-center leading-tight drop-shadow-sm",children:"Close"})]})})})]})}),o.jsx("div",{className:"absolute bottom-12 text-center",children:o.jsx("p",{className:"text-xs font-bold uppercase tracking-[0.2em] text-white/40",children:d?"Refine Emotion":"Select Emotion"})})]}),document.body)},EE=()=>{var E;const[r,e]=S.useState(!1),[t,n]=S.useState(!1),[s,i]=S.useState(null),[a,c]=S.useState(null),[u,d]=S.useState(null),m=S.useCallback(()=>{const T=new Date,A=T.getTimezoneOffset(),_=new Date(T.getTime()-A*60*1e3).toISOString().split("T")[0],ie=cr().find(de=>de.date.split("T")[0]===_);c(ie?ie.mood:null)},[]);S.useEffect(()=>(m(),window.addEventListener("sadhaka_journal_updated",m),()=>window.removeEventListener("sadhaka_journal_updated",m)),[m]);const p=T=>{const A=new Date,_=A.getTimezoneOffset(),se=new Date(A.getTime()-_*60*1e3).toISOString().split("T")[0],de=cr().find(Re=>Re.date.split("T")[0]===se),ce=de?{...de,mood:T}:{id:Date.now().toString(),date:new Date(`${se}T00:00:00.000Z`).toISOString(),mood:T,tags:[],reaction:"neutral",madeSomeoneSmile:!1,q1:"",q2:"",q3:"",learning:"",completedDisciplines:[]};zT(ce),e(!1),i(null)},x=T=>{i(T),e(!0)},b=()=>{i(null),e(!0)},w=260,k=w/2,N=w/2,D=110,V=118,P=65,U=2,L=(T,A,_,se)=>{const ie=(se-90)*Math.PI/180;return{x:T+_*Math.cos(ie),y:A+_*Math.sin(ie)}},G=(T,A,_,se,ie,de)=>{const ce=L(T,A,se,de),Re=L(T,A,se,ie),Ee=L(T,A,_,de),Ae=L(T,A,_,ie),xe=de-ie<=180?"0":"1";return["M",ce.x,ce.y,"A",se,se,0,xe,0,Re.x,Re.y,"L",Ae.x,Ae.y,"A",_,_,0,xe,1,Ee.x,Ee.y,"Z"].join(" ")},{rootLabel:I}=Ca(a||""),y=u||(a?"Edit":"Log"),v=u?(E=jr.find(T=>T.label===u))==null?void 0:E.color:"currentColor";return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"relative overflow-hidden rounded-[2.5rem] p-6 shadow-soft border border-white dark:border-spiritual-700 group transition-all duration-500 hover:shadow-lg",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-spiritual-100 via-white to-spiritual-200 dark:from-spiritual-800 dark:via-spiritual-900 dark:to-black opacity-80"}),o.jsx("div",{className:"absolute top-0 right-0 w-56 h-56 bg-indigo-100/50 dark:bg-indigo-900/20 rounded-full blur-[60px] -mr-10 -mt-10 animate-float pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity duration-700"}),o.jsx("div",{className:"absolute bottom-0 left-0 w-48 h-48 bg-spiritual-gold/10 rounded-full blur-[60px] -ml-10 -mb-10 pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity duration-700"}),o.jsxs("div",{className:"flex justify-between items-start relative z-10 mb-2",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center gap-2 text-spiritual-500 dark:text-spiritual-400 mb-1",children:[o.jsx(Hu,{size:14,className:"text-spiritual-gold"}),o.jsx("span",{className:"text-xs font-bold uppercase tracking-widest",children:"The Ankush"})]}),o.jsx("h2",{className:"text-2xl font-bold text-spiritual-900 dark:text-spiritual-50",children:a||"Mood status"})]}),o.jsxs("div",{className:"flex items-center gap-2",children:[a&&o.jsx("div",{className:"bg-spiritual-100 dark:bg-spiritual-800 p-2 rounded-full animate-pulse",children:o.jsx(Sr,{size:16,className:"text-spiritual-600 dark:text-spiritual-300"})}),o.jsx("button",{onClick:()=>n(!0),className:"p-3 text-spiritual-300 hover:text-spiritual-500 dark:hover:text-spiritual-200 transition-colors rounded-full hover:bg-spiritual-100 dark:hover:bg-spiritual-800","aria-label":"About Mood Tracking",children:o.jsx(li,{size:20})})]})]}),o.jsx("div",{className:"relative z-10 flex items-center justify-center -mb-4",children:o.jsxs("svg",{width:w,height:w,viewBox:`0 0 ${w} ${w}`,children:[jr.map((T,A)=>{const se=360/jr.length,ie=A*se+U/2,de=(A+1)*se-U/2,ce=I===T.label,Re=u===T.label,Ee=Re?V:D;return o.jsx("g",{onClick:()=>x(T.label),onMouseEnter:()=>d(T.label),onMouseLeave:()=>d(null),onTouchStart:()=>d(T.label),onTouchEnd:()=>d(null),className:"cursor-pointer",style:{touchAction:"manipulation"},children:o.jsx("path",{d:G(k,N,P,Ee,ie,de),fill:T.color,fillOpacity:ce||Re?1:.3,className:"transition-all duration-300 ease-out",stroke:ce?"white":"none",strokeWidth:ce?2:0})},A)}),o.jsx("foreignObject",{x:k-30,y:N-30,width:"60",height:"60",className:"pointer-events-none",children:o.jsx("div",{className:"w-full h-full rounded-full bg-white/50 dark:bg-black/20 backdrop-blur-sm flex items-center justify-center shadow-inner transition-colors duration-300",style:u?{backgroundColor:"rgba(255,255,255,0.8)"}:{},children:o.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-center px-1 transition-all duration-300",style:{color:v,transform:u?"scale(1.1)":"scale(1)"},children:y})})}),o.jsx("circle",{cx:k,cy:N,r:P-5,fill:"transparent",className:"cursor-pointer",onClick:b})]})})]}),r&&o.jsx(TE,{initialMood:s,onSelect:p,onClose:()=>{e(!1),i(null)}}),t&&o.jsxs(Yc,{onClose:()=>n(!1),title:"The Ankush",subtitle:"Science & Symbolism",icon:o.jsx(Hu,{size:24}),children:[o.jsx("div",{className:"p-6 bg-white/5 rounded-3xl border border-white/5",children:o.jsx("p",{className:"text-lg text-white/80 leading-relaxed font-medium",children:"'The Ankush' depicted in the hands of Ganpati represents the tool of mindfulness and introspection to bring the turbulent mind under conscious control and guide it toward the path of wisdom."})}),o.jsx("div",{className:"p-6 bg-white/5 rounded-3xl border border-white/5",children:o.jsxs("p",{className:"text-lg text-white/80 leading-relaxed font-medium",children:["In the mechanism established by neuroscience, called ",o.jsx("strong",{className:"text-white",children:"affect labeling"}),", describing your feelings is a process to help manage emotions. It is observed as increasing activity in the brain's reasoning and language centers (prefrontal cortex) while decreasing activity in the brain's emotional alarm center (amygdala)."]})}),o.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5",children:[o.jsx("p",{className:"italic text-white/60 text-sm",children:'"Practical Application"'}),o.jsx("p",{className:"mt-2 text-sm text-white/80",children:"Use The Ankush as a practical tool to keep your emotional quotient (EQ) in check. In 3 taps narrow down on your emotional spectrum and describe what you are feeling."})]})]})]})},kE=Me.memo(EE),Lg=S.createContext(void 0),Ko="sadhaka_dismissed_notifs",Gh="sadhaka_last_notif_clear",AE=({children:r})=>{const[e,t]=S.useState([]),[n,s]=S.useState(null),[i,a]=S.useState(()=>{try{const w=localStorage.getItem(Ko);return w?new Set(JSON.parse(w)):new Set}catch{return new Set}}),{preferences:c}=Mt(),u=S.useRef(0);S.useEffect(()=>{const w=localStorage.getItem(Gh),k=new Date().toDateString();w!==k&&(a(new Set),localStorage.setItem(Gh,k),localStorage.removeItem(Ko))},[]),S.useEffect(()=>{localStorage.setItem(Ko,JSON.stringify(Array.from(i)))},[i]),S.useEffect(()=>{const w=setInterval(()=>{const k=Date.now();t(N=>{let D=!1;const V=N.map(P=>P.category==="alarm"&&P.status==="active"&&P.expiryTime&&k>P.expiryTime?(D=!0,(n==null?void 0:n.id)===P.id&&(Wn(),s(null)),{...P,status:"missed",requiresFullScreen:!1,message:`Missed: ${P.message.replace("Time for ","")}`,subMessage:"It happens. You can still practice anytime.",color:"text-red-400"}):P.category!=="alarm"&&P.status==="active"&&P.expiryTime&&k>P.expiryTime?(D=!0,{...P,status:"past"}):P);return D?V:N})},1e3);return()=>clearInterval(w)},[n]);const d=S.useCallback(w=>{t(k=>{if(k.some(D=>D.id===w.id)||i.has(w.id))return k;if(w.requiresSystemNotification&&mx(w.title,w.subMessage||w.message,w.id),w.requiresFullScreen)s(w),Dg(c.audio.alarmToneId,c.audio.masterVolume);else{const D=Date.now();D-u.current>5e3&&(Cg(528,"sine",2,c.audio.masterVolume),u.current=D)}return[...k,w].sort((D,V)=>V.priority-D.priority)})},[c.audio.masterVolume,c.audio.alarmToneId,i]),m=S.useCallback(w=>{(n==null?void 0:n.id)===w&&(Wn(),s(null)),a(k=>{const N=new Set(k);return N.add(w),N}),t(k=>k.filter(N=>N.id!==w))},[n]),p=S.useCallback(()=>{t([])},[]),x=S.useCallback(()=>{n&&m(n.id)},[n,m]),b=S.useCallback(()=>{n&&(Wn(),s(null),t(w=>w.filter(k=>k.id!==n.id)))},[n]);return o.jsx(Lg.Provider,{value:{notifications:e,dismissedIds:i,activeOverlay:n,addNotification:d,removeNotification:m,clearAll:p,dismissOverlay:x,completeOverlay:b},children:r})},Jc=()=>{const r=S.useContext(Lg);if(!r)throw new Error("useNotifications must be used within a NotificationProvider");return r},SE=()=>o.jsxs("div",{className:"relative overflow-hidden rounded-[2.5rem] p-8 shadow-soft border border-white dark:border-spiritual-700 group transition-all duration-500 hover:shadow-lg",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-spiritual-50 via-white to-spiritual-100 dark:from-slate-900 dark:via-spiritual-900 dark:to-black opacity-90 transition-opacity"}),o.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-spiritual-gold/20 rounded-full blur-[50px] -mr-10 -mt-10 animate-pulse-slow opacity-0 group-hover:opacity-100 transition-opacity duration-700"}),o.jsxs("div",{className:"relative z-10",children:[o.jsx("div",{className:"absolute -top-2 -left-2 opacity-10 text-spiritual-900 dark:text-spiritual-100 transform -rotate-12",children:o.jsx(z0,{size:40,fill:"currentColor"})}),o.jsx("p",{className:"font-serif text-lg md:text-xl italic leading-relaxed text-spiritual-800 dark:text-spiritual-100 text-center relative px-2",children:`"In today's day, in all the interactions I will practice unconditional love and unconditional forgiveness."`})]})]}),qh=Me.memo(SE),Kh={cosmic:{element:"akasha",gradient:"from-indigo-950 via-violet-900 to-slate-950",iconColor:"text-violet-300",textColor:"text-violet-50",subTextColor:"text-violet-200/70",accentColor:"bg-violet-500",Icon:Sr},behavior:{element:"prithvi",gradient:"from-emerald-900 via-green-900 to-stone-900",iconColor:"text-emerald-300",textColor:"text-emerald-50",subTextColor:"text-emerald-200/70",accentColor:"bg-emerald-500",Icon:$0},insight:{element:"jala",gradient:"from-cyan-900 via-blue-900 to-slate-900",iconColor:"text-cyan-300",textColor:"text-cyan-50",subTextColor:"text-cyan-200/70",accentColor:"bg-cyan-500",Icon:Qn},alert:{element:"agni",gradient:"from-red-950 via-orange-900 to-stone-950",iconColor:"text-orange-300",textColor:"text-orange-50",subTextColor:"text-orange-200/70",accentColor:"bg-orange-500",Icon:Fl},alarm:{element:"vayu",gradient:"from-slate-900 via-slate-800 to-black",iconColor:"text-red-400",textColor:"text-white",subTextColor:"text-slate-400",accentColor:"bg-red-500",Icon:la}},NE=()=>o.jsxs("div",{className:"absolute inset-0 overflow-hidden opacity-40 pointer-events-none",children:[o.jsx("div",{className:"absolute top-0 left-0 w-full h-full animate-[drift_60s_linear_infinite]",children:o.jsxs("svg",{viewBox:"0 0 400 200",className:"w-full h-full text-violet-200",fill:"currentColor",children:[o.jsx("circle",{cx:"20",cy:"40",r:"1.5",opacity:"0.6"}),o.jsx("circle",{cx:"150",cy:"20",r:"1",opacity:"0.4"}),o.jsx("circle",{cx:"300",cy:"80",r:"2",opacity:"0.7"}),o.jsx("circle",{cx:"350",cy:"30",r:"1.5",opacity:"0.5"}),o.jsx("circle",{cx:"80",cy:"150",r:"1",opacity:"0.3"})]})}),o.jsx("div",{className:"absolute -right-10 -top-10 w-48 h-48 rounded-full bg-violet-500/10 blur-3xl animate-pulse-slow"}),o.jsx("div",{className:"absolute bottom-0 left-20 w-32 h-32 rounded-full bg-indigo-400/10 blur-2xl"})]}),RE=()=>o.jsxs("div",{className:"absolute inset-0 overflow-hidden opacity-20 pointer-events-none",children:[o.jsxs("svg",{viewBox:"0 0 400 200",className:"absolute bottom-0 left-0 w-full h-full text-emerald-300",fill:"none",stroke:"currentColor",strokeWidth:"1",children:[o.jsx("path",{d:"M0 200 Q50 150 40 100 T100 20",className:"animate-[sway_8s_ease-in-out_infinite]",strokeOpacity:"0.3"}),o.jsx("path",{d:"M30 200 Q80 140 70 80",className:"animate-[sway_10s_ease-in-out_infinite_reverse]",strokeOpacity:"0.2"}),o.jsx("path",{d:"M380 200 Q330 150 340 80",className:"animate-[sway_9s_ease-in-out_infinite]",strokeOpacity:"0.3"}),o.jsx("path",{d:"M40 100 Q60 80 80 100 Q60 120 40 100",fill:"currentColor",fillOpacity:"0.1",className:"animate-[pulse_4s_infinite]"}),o.jsx("path",{d:"M340 80 Q360 60 380 80 Q360 100 340 80",fill:"currentColor",fillOpacity:"0.1",className:"animate-[pulse_5s_infinite]"})]}),o.jsx("div",{className:"absolute bottom-0 right-0 w-64 h-64 bg-emerald-900/40 rounded-full blur-3xl"})]}),CE=()=>o.jsxs("div",{className:"absolute inset-0 overflow-hidden opacity-30 pointer-events-none",children:[o.jsxs("svg",{viewBox:"0 0 400 200",className:"absolute inset-0 w-full h-full text-cyan-300",preserveAspectRatio:"none",children:[o.jsx("path",{d:"M0 100 Q100 80 200 100 T400 100 V200 H0 Z",fill:"url(#grad-water)",className:"animate-[wave_10s_linear_infinite]",opacity:"0.2"}),o.jsx("path",{d:"M0 130 Q150 150 300 130 T600 130 V200 H0 Z",fill:"url(#grad-water)",className:"animate-[wave_15s_linear_infinite_reverse]",opacity:"0.3"}),o.jsx("defs",{children:o.jsxs("linearGradient",{id:"grad-water",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[o.jsx("stop",{offset:"0%",stopColor:"currentColor",stopOpacity:"0.4"}),o.jsx("stop",{offset:"100%",stopColor:"currentColor",stopOpacity:"0"})]})})]}),o.jsx("div",{className:"absolute top-10 right-16 w-12 h-12 rounded-full bg-cyan-100/10 blur-xl animate-pulse-slow"})]}),DE=()=>o.jsxs("div",{className:"absolute inset-0 overflow-hidden opacity-30 pointer-events-none",children:[o.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 w-64 h-32 bg-orange-500/20 blur-[50px] animate-pulse"}),o.jsxs("svg",{viewBox:"0 0 400 200",className:"absolute inset-0 w-full h-full text-orange-200",children:[o.jsx("circle",{cx:"100",cy:"180",r:"1",className:"animate-[rise_4s_linear_infinite]",fill:"currentColor",opacity:"0.6"}),o.jsx("circle",{cx:"200",cy:"190",r:"1.5",className:"animate-[rise_5s_linear_infinite]",fill:"currentColor",opacity:"0.8",style:{animationDelay:"1s"}}),o.jsx("circle",{cx:"300",cy:"170",r:"1",className:"animate-[rise_3s_linear_infinite]",fill:"currentColor",opacity:"0.5",style:{animationDelay:"2s"}}),o.jsx("g",{stroke:"currentColor",strokeWidth:"1",strokeOpacity:"0.2",transform:"translate(200, 250)",children:[0,45,90,135,180].map(r=>o.jsx("line",{x1:"0",y1:"0",x2:"0",y2:"-150",transform:`rotate(${r})`},r))})]})]}),PE=({onNavigate:r})=>{const{notifications:e,removeNotification:t}=Jc(),[n,s]=S.useState(0),[i,a]=S.useState(!1),c=S.useRef(null),u=e.filter(V=>!V.requiresFullScreen);if(S.useEffect(()=>{if(u.length>1&&!i)return c.current=setInterval(()=>{s(V=>(V+1)%u.length)},8e3),()=>clearInterval(c.current);c.current&&clearInterval(c.current)},[u.length,i]),S.useEffect(()=>{n>=u.length&&u.length>0&&s(u.length-1)},[u.length,n]),u.length===0)return o.jsx(qh,{});const d=u[n];if(!d)return o.jsx(qh,{});const m=Kh[d.category]||Kh.cosmic,p=m.Icon,x=()=>{d.actionLink&&r&&r(d.actionLink)},b=d.status==="missed",w=d.status==="past";let k="";b?k="grayscale brightness-75 bg-red-900/20":w&&(k="grayscale brightness-75 opacity-80");const N=()=>b?"MISSED":w?"ENDED":d.id.startsWith("special_occasion")?"Special Occasion":d.id.startsWith("goal_risk")?"Goal Risk Alert":d.category.toUpperCase(),D=d.actionLabel||(b?"Try Now":"Take Action");return o.jsxs("div",{className:`relative overflow-hidden rounded-[2.5rem] p-0 shadow-soft border border-white dark:border-spiritual-700 group transition-all duration-500 hover:shadow-lg min-h-[160px] flex flex-col justify-center select-none ${k}`,onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:[o.jsx("style",{children:`
                @keyframes drift { 0% { transform: translateX(0) translateY(0); } 100% { transform: translateX(-50px) translateY(-20px); } }
                @keyframes sway { 0%, 100% { transform: rotate(0deg) translateX(0); } 50% { transform: rotate(2deg) translateX(5px); } }
                @keyframes wave { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
                @keyframes rise { 0% { transform: translateY(0); opacity: 0; } 20% { opacity: 1; } 100% { transform: translateY(-100px); opacity: 0; } }
            `}),o.jsx("div",{className:`absolute inset-0 bg-gradient-to-br ${m.gradient} transition-colors duration-1000`}),o.jsx("div",{className:"absolute inset-0 transition-opacity duration-1000",children:!b&&!w&&o.jsxs(o.Fragment,{children:[m.element==="akasha"&&o.jsx(NE,{}),m.element==="prithvi"&&o.jsx(RE,{}),m.element==="jala"&&o.jsx(CE,{}),m.element==="agni"&&o.jsx(DE,{})]})}),o.jsx("div",{className:"absolute inset-0 backdrop-blur-[1px] bg-black/10 dark:bg-black/30"}),o.jsxs("div",{className:"relative z-10 flex items-start gap-5 p-6 sm:p-8",children:[o.jsx("div",{className:"p-3.5 bg-white/10 backdrop-blur-md rounded-2xl shadow-inner border border-white/10 shrink-0",children:o.jsx(p,{size:24,className:b?"text-red-400":m.iconColor,"aria-hidden":"true"})}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"flex justify-between items-start",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-1.5",children:[o.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${b?"bg-red-500":m.accentColor} ${!w&&"animate-pulse"}`}),o.jsx("span",{className:`text-[10px] font-bold uppercase tracking-[0.2em] ${m.subTextColor}`,children:N()})]}),o.jsx("button",{onClick:V=>{V.stopPropagation(),t(d.id)},className:`p-2 -mr-3 -mt-3 rounded-full hover:bg-white/20 transition-all ${m.subTextColor} hover:text-white flex items-center justify-center`,title:"Dismiss","aria-label":"Dismiss notification",children:o.jsx(Qr,{size:18})})]}),o.jsx("h3",{className:`text-lg font-bold leading-tight mb-2 ${m.textColor} drop-shadow-sm font-serif`,children:d.message}),o.jsx("p",{className:`text-sm font-medium leading-relaxed ${m.subTextColor}`,children:d.subMessage}),d.actionLink&&o.jsxs("button",{onClick:x,className:`mt-4 flex items-center gap-1.5 text-xs font-bold px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/20 transition-all ${m.textColor}`,children:[D," ",o.jsx(Dt,{size:12})]})]})]}),u.length>1&&o.jsx("div",{className:"absolute bottom-4 left-0 right-0 flex justify-center gap-2 z-20",children:u.map((V,P)=>o.jsx("button",{onClick:()=>s(P),className:`h-2 rounded-full transition-all duration-500 ${P===n?`w-6 ${m.accentColor}`:"w-2 bg-white/20 hover:bg-white/40"}`},V.id))})]})},jE=({onNavigate:r,onSetRoutine:e})=>o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("button",{onClick:()=>{e("morning"),r(X.ROUTINE)},className:"relative overflow-hidden rounded-[2.5rem] p-6 shadow-soft border border-white dark:border-spiritual-700 group flex flex-col items-center justify-center gap-3 min-h-[140px] hover:scale-[1.02] active:scale-95 transition-all duration-500 hover:shadow-lg",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-orange-50 via-white to-orange-100 dark:from-orange-900/40 dark:via-spiritual-900 dark:to-black opacity-90"}),o.jsx("div",{className:"absolute top-0 right-0 w-24 h-24 bg-orange-400/20 rounded-full blur-[40px] -mr-6 -mt-6 opacity-0 group-hover:opacity-100 transition-opacity duration-700"}),o.jsxs("div",{className:"relative z-10 flex flex-col items-center",children:[o.jsx("div",{className:"w-14 h-14 rounded-2xl bg-white/60 dark:bg-white/10 backdrop-blur-sm flex items-center justify-center text-orange-500 dark:text-orange-300 shadow-sm mb-2 group-hover:scale-110 transition-transform",children:o.jsx(Us,{size:28})}),o.jsx("span",{className:"font-bold text-spiritual-900 dark:text-spiritual-50",children:"Start Day"})]})]}),o.jsxs("button",{onClick:()=>{e("evening"),r(X.ROUTINE)},className:"relative overflow-hidden rounded-[2.5rem] p-6 shadow-soft border border-white dark:border-spiritual-700 group flex flex-col items-center justify-center gap-3 min-h-[140px] hover:scale-[1.02] active:scale-95 transition-all duration-500 hover:shadow-lg",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-indigo-50 via-white to-indigo-100 dark:from-indigo-900/40 dark:via-spiritual-900 dark:to-black opacity-90"}),o.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-indigo-400/20 rounded-full blur-[40px] -ml-6 -mb-6 opacity-0 group-hover:opacity-100 transition-opacity duration-700"}),o.jsxs("div",{className:"relative z-10 flex flex-col items-center",children:[o.jsx("div",{className:"w-14 h-14 rounded-2xl bg-white/60 dark:bg-white/10 backdrop-blur-sm flex items-center justify-center text-indigo-500 dark:text-indigo-300 shadow-sm mb-2 group-hover:scale-110 transition-transform",children:o.jsx(Qn,{size:28})}),o.jsx("span",{className:"font-bold text-spiritual-900 dark:text-spiritual-50",children:"End Day"})]})]})]}),VE=Me.memo(jE),OE=({onNavigate:r,onShowInfo:e})=>o.jsx("div",{className:"grid grid-cols-1 gap-4",children:o.jsxs("div",{onClick:r,className:"relative w-full overflow-hidden rounded-[2.5rem] p-6 shadow-soft border border-white dark:border-spiritual-700 group flex items-center justify-between transition-all duration-500 hover:shadow-lg text-left cursor-pointer",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-emerald-50 via-white to-emerald-100 dark:from-emerald-900/30 dark:via-spiritual-900 dark:to-black opacity-90"}),o.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-48 h-48 bg-emerald-400/10 rounded-full blur-[50px] opacity-0 group-hover:opacity-100 transition-opacity duration-700"}),o.jsxs("div",{className:"relative z-10 flex items-center gap-5",children:[o.jsx("div",{className:"w-16 h-16 rounded-2xl bg-white/60 dark:bg-white/10 backdrop-blur-sm flex items-center justify-center text-emerald-600 dark:text-emerald-400 shadow-sm group-hover:rotate-45 transition-transform duration-500",children:o.jsx(Pa,{size:32})}),o.jsxs("div",{className:"text-left",children:[o.jsx("span",{className:"font-bold block text-xl text-spiritual-900 dark:text-spiritual-50",children:"Alignment"}),o.jsx("span",{className:"text-sm text-spiritual-500 dark:text-spiritual-400 font-medium",children:"Find your true north"})]})]}),o.jsxs("div",{className:"relative z-10 flex items-center gap-3",children:[o.jsx("button",{onClick:t=>{t.stopPropagation(),e()},className:"p-2 text-emerald-600/70 dark:text-emerald-400/70 hover:text-emerald-800 dark:hover:text-emerald-200 transition-colors rounded-full hover:bg-emerald-100/50 dark:hover:bg-white/10","aria-label":"Info",children:o.jsx(li,{size:20})}),o.jsx("div",{className:"bg-white/50 dark:bg-white/10 px-4 py-2 rounded-xl text-xs font-bold uppercase tracking-widest text-emerald-700 dark:text-emerald-300 backdrop-blur-sm group-hover:bg-emerald-100 dark:group-hover:bg-emerald-900/50 transition-colors",children:"Open"})]})]})}),ME=Me.memo(OE),LE={Ashwini:o.jsx("path",{d:"M30 80 Q25 50 40 30 Q50 15 70 20 Q85 25 80 40 Q75 55 60 55 L60 80 Z M60 30 Q62 25 65 28"}),Bharani:o.jsx("path",{d:"M20 25 L80 25 L50 85 Z M50 45 L50 55"}),Krittika:o.jsx("path",{d:"M50 15 Q65 40 50 85 Q35 40 50 15 M50 15 L50 85"}),Rohini:o.jsx("path",{d:"M20 50 A30 30 0 1 1 80 50 A30 30 0 1 1 20 50 M50 50 L50 20 M50 50 L80 50 M50 50 L50 80 M50 50 L20 50"}),Mrigashirsha:o.jsx("path",{d:"M30 30 L30 20 Q40 10 50 25 Q60 10 70 20 L70 30 Q70 60 50 85 Q30 60 30 30 M30 30 L70 30"}),Ardra:o.jsx("path",{d:"M50 15 Q80 50 80 70 A30 30 0 1 1 20 70 Q20 50 50 15"}),Punarvasu:o.jsx("path",{d:"M20 30 Q50 10 80 30 M50 20 L50 85 M20 30 L20 85 M80 30 L80 85 M25 50 L75 50"}),Pushya:o.jsx("path",{d:"M50 50 M20 50 A30 30 0 1 1 80 50 A30 30 0 1 1 20 50 M50 20 L50 80 M20 50 L80 50 M29 29 L71 71 M29 71 L71 29"}),Ashlesha:o.jsx("path",{d:"M30 80 Q80 80 80 50 Q80 20 50 20 Q30 20 30 40 Q30 60 50 60 L70 60"}),Magha:o.jsx("path",{d:"M25 40 L75 40 L85 80 L15 80 Z M50 40 L50 20 M25 40 L25 25 M75 40 L75 25"}),"Purva Phalguni":o.jsx("path",{d:"M20 30 L80 30 L80 50 L20 50 Z M25 50 L25 80 M75 50 L75 80"}),"Uttara Phalguni":o.jsx("path",{d:"M20 30 L80 30 L80 50 L20 50 Z M25 50 L25 80 M75 50 L75 80 M30 30 L30 20 M70 30 L70 20"}),Hasta:o.jsx("path",{d:"M30 80 L30 50 Q30 20 40 20 Q45 20 45 40 Q45 15 55 15 Q60 15 60 40 Q60 18 70 18 Q75 18 75 40 Q75 25 85 25 Q90 25 90 50 L85 80 Z"}),Chitra:o.jsx("path",{d:"M50 10 L80 50 L50 90 L20 50 Z M50 10 L50 90 M20 50 L80 50"}),Swati:o.jsx("path",{d:"M50 90 Q50 50 20 40 M50 90 Q50 40 80 30 M50 90 L50 20 M30 30 A5 5 0 1 1 40 30"}),Vishakha:o.jsx("path",{d:"M20 80 L20 40 A30 30 0 0 1 80 40 L80 80 M20 40 L80 40"}),Anuradha:o.jsx("path",{d:"M50 90 L50 20 M20 40 L80 40 M35 20 L65 20 M30 50 Q50 70 70 50"}),Jyeshtha:o.jsx("path",{d:"M50 20 L50 80 M30 30 L70 30 M30 30 Q10 40 10 60 Q10 80 30 80 L70 80 Q90 80 90 60 Q90 40 70 30"}),Mula:o.jsx("path",{d:"M50 20 L50 80 M50 80 L30 95 M50 80 L70 95 M30 40 L70 40 M30 40 L20 20 M70 40 L80 20"}),"Purva Ashadha":o.jsx("path",{d:"M20 20 L80 20 L65 80 L35 80 Z M35 50 L65 50"}),"Uttara Ashadha":o.jsx("path",{d:"M40 20 Q70 20 80 50 Q85 80 50 80 Q30 80 30 50 L40 20"}),Shravana:o.jsx("path",{d:"M30 30 Q80 10 80 50 Q80 90 30 70 Q45 50 30 30"}),Dhanishta:o.jsx("path",{d:"M30 20 L70 20 L50 50 L70 80 L30 80 L50 50 Z M50 50 L20 50"}),Shatabhisha:o.jsx("path",{d:"M50 50 m-35 0 a 35,35 0 1,0 70,0 a 35,35 0 1,0 -70,0 M50 50 m-25 0 a 25,25 0 1,0 50,0 a 25,25 0 1,0 -50,0"}),"Purva Bhadrapada":o.jsx("path",{d:"M30 20 L30 80 M70 20 L70 80 M30 50 L70 50 M20 30 L40 30 M60 30 L80 30"}),"Uttara Bhadrapada":o.jsx("path",{d:"M30 20 L30 80 M70 20 L70 80 M30 50 L70 50 M20 70 L40 70 M60 70 L80 70"}),Revati:o.jsx("path",{d:"M20 50 Q50 20 80 50 Q50 80 20 50 M70 50 A 5 5 0 1 1 70 51 M80 50 L95 35 M80 50 L95 65"})},Hh=({name:r,className:e})=>{const t=LE[r||"Ashwini"];return o.jsx("svg",{viewBox:"0 0 100 100",className:e,fill:"none",stroke:"currentColor",strokeWidth:"6",strokeLinecap:"round",strokeLinejoin:"round",children:t||o.jsx("path",{d:"M50 15 L60 40 L85 40 L65 60 L75 85 L50 70 L25 85 L35 60 L15 40 L40 40 Z"})})},FE=()=>{const{showToast:r}=Sg(),[e,t]=S.useState(new Date),[n,s]=S.useState(null),i=n||e,a=!!n,{preferences:c,updateLocation:u}=Mt(),d=c.location||Bl,[m,p]=S.useState(!1),[x,b]=S.useState(0),w=S.useRef(null),[k,N]=S.useState(!1),[D,V]=S.useState({sunrise:"--:--",sunset:"--:--"}),[P,U]=S.useState(null),[L,G]=S.useState(null),[I,y]=S.useState(null),[v,E]=S.useState(null),[T,A]=S.useState(null),[_,se]=S.useState(""),[ie,de]=S.useState(null),[ce,Re]=S.useState([]),[Ee,Ae]=S.useState([]),[xe,De]=S.useState(null),[H,q]=S.useState(null),[te,he]=S.useState(Notification.permission);S.useEffect(()=>{let $;return a||($=setInterval(()=>t(new Date),6e4)),()=>{$&&clearInterval($)}},[a]);const ye=$=>{const we=new Date(i);we.setDate(we.getDate()+$),s(we)},ne=$=>{if(!$.target.value)return;const[we,Ve,He]=$.target.value.split("-").map(Number),$e=new Date(we,Ve-1,He,12,0,0);s($e),p(!1)},Y=$=>{$==="live"?(s(null),t(new Date)):(s(new Date),r(`Time-Travel Mode: Data calculated for ${d.name}`,"info"))},ae=async()=>{N(!0);try{const $=await Gl();u($),r(`Location updated to ${$.name}`)}catch{r("Could not detect location","error")}finally{N(!1)}},be=$=>{try{return $.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0,timeZone:(d==null?void 0:d.timezone)||void 0})}catch{return"--:--"}},tt=$=>{try{return $.toLocaleDateString("en-US",{day:"numeric",month:"short",timeZone:(d==null?void 0:d.timezone)||void 0})}catch{return"--"}},nt=$=>{const we=new Date;return $.getDate()===we.getDate()&&$.getMonth()===we.getMonth()&&$.getFullYear()===we.getFullYear()&&!a?`Today, ${tt($)}`:$.toLocaleDateString("en-US",{weekday:"short",day:"numeric",month:"short",timeZone:(d==null?void 0:d.timezone)||void 0})};S.useEffect(()=>{const{coords:$,timezone:we}=d,Ve=aa($.lat,$.lng,i);V({sunrise:be(Ve.sunrise),sunset:be(Ve.sunset)}),U(Og(i)),G(Sn(i)),y(cE(i)),E(uE(i)),A(mE(i)),se(hE(i,we)),de(Vg(i)),Re(fE(i)),Ae(jl($.lat,$.lng,i)),De(Pl(i)),q(sE($.lat,$.lng,i))},[i,d]);const yt=async()=>{const $=await ym();he($?"granted":"denied")},Tt=()=>{if(w.current){const{scrollLeft:$,clientWidth:we}=w.current,Ve=Math.round($/we);b(Ve)}},Rt=$=>{w.current&&w.current.scrollTo({left:$*w.current.clientWidth,behavior:"smooth"})};return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"relative rounded-[2.5rem] p-6 sm:p-8 text-spiritual-800 dark:text-spiritual-100 shadow-soft border border-white dark:border-spiritual-700 overflow-hidden group transition-all duration-500 hover:shadow-lg",children:[o.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-spiritual-100 via-white to-spiritual-200 dark:from-spiritual-800 dark:via-spiritual-900 dark:to-black opacity-80"}),o.jsx("div",{className:"absolute top-0 right-0 w-56 h-56 bg-pastel-blue/50 dark:bg-blue-900/20 rounded-full blur-[60px] -mr-10 -mt-10 animate-float pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity duration-700"}),o.jsx("div",{className:"absolute bottom-0 left-0 w-48 h-48 bg-spiritual-gold/10 rounded-full blur-[60px] -ml-10 -mb-10 pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity duration-700"}),o.jsxs("div",{className:"flex justify-between items-start mb-6 relative z-10",children:[o.jsxs("div",{children:[o.jsxs("div",{className:"flex items-center gap-2 text-spiritual-500 dark:text-spiritual-400 mb-1",children:[o.jsx(Sr,{size:14,className:"text-spiritual-gold"}),o.jsx("span",{className:"text-xs font-bold uppercase tracking-widest",children:"The Panchang"})]}),o.jsx("h2",{className:"text-2xl font-bold text-spiritual-900 dark:text-spiritual-50 mb-1",children:"Cosmic Status"}),o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsxs("button",{onClick:ae,disabled:k,className:"flex items-center gap-1 text-spiritual-400 dark:text-spiritual-500 hover:text-spiritual-600 dark:hover:text-spiritual-300 transition-colors",title:"Update Location",children:[k?o.jsx("div",{className:"w-3 h-3 rounded-full border-2 border-current border-t-transparent animate-spin"}):o.jsx(Ml,{size:12}),o.jsx("span",{className:"text-xs font-bold uppercase tracking-wide truncate max-w-[120px]",children:d.name})]}),te==="default"&&o.jsx("button",{onClick:yt,className:"bg-spiritual-100 dark:bg-spiritual-800 p-1 rounded-full text-spiritual-500 hover:text-spiritual-800 transition-colors",title:"Enable Notifications",children:o.jsx(Da,{size:12})})]})]}),o.jsxs("div",{className:"bg-white/60 dark:bg-white/10 p-1 rounded-xl flex shadow-sm border border-white/50 dark:border-white/5 backdrop-blur-md",children:[o.jsx("button",{onClick:()=>Y("live"),className:`px-4 py-3 rounded-lg text-xs font-bold transition-all ${a?"text-spiritual-500 dark:text-spiritual-400 hover:bg-white/50 dark:hover:bg-white/10":"bg-spiritual-800 dark:bg-spiritual-100 text-white dark:text-spiritual-900 shadow-md"}`,children:"Live"}),o.jsx("button",{onClick:()=>Y("almanac"),className:`px-4 py-3 rounded-lg text-xs font-bold transition-all ${a?"bg-spiritual-800 dark:bg-spiritual-100 text-white dark:text-spiritual-900 shadow-md":"text-spiritual-500 dark:text-spiritual-400 hover:bg-white/50 dark:hover:bg-white/10"}`,children:"Almanac"})]})]}),a&&o.jsxs("div",{className:"relative z-10 flex items-center justify-between bg-white/40 dark:bg-white/5 rounded-2xl p-1 mb-6 border border-white/40 dark:border-white/5 backdrop-blur-md animate-fade-in",children:[o.jsx("button",{onClick:()=>ye(-1),className:"p-3 rounded-xl hover:bg-white/50 dark:hover:bg-white/10 transition-colors text-spiritual-600 dark:text-spiritual-300",children:o.jsx(rm,{size:20})}),o.jsxs("button",{onClick:()=>p(!0),className:"flex items-center gap-2 px-5 py-2 rounded-xl hover:bg-white/50 dark:hover:bg-white/10 transition-colors",children:[o.jsx(Ao,{size:18,className:"text-spiritual-gold"}),o.jsx("span",{className:"text-base font-bold text-spiritual-800 dark:text-spiritual-100",children:nt(i)})]}),o.jsx("button",{onClick:()=>ye(1),className:"p-3 rounded-xl hover:bg-white/50 dark:hover:bg-white/10 transition-colors text-spiritual-600 dark:text-spiritual-300",children:o.jsx(Dt,{size:20})})]}),xe&&o.jsxs("div",{className:"relative z-10 mb-6 bg-gradient-to-r from-amber-100 to-orange-100 dark:from-amber-900/40 dark:to-orange-900/40 rounded-[2rem] p-5 border border-amber-200 dark:border-amber-700/50 shadow-sm flex items-center justify-between overflow-hidden",children:[o.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-amber-400/20 rounded-full blur-2xl -mr-10 -mt-10"}),o.jsxs("div",{className:"relative z-10 flex-1",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o.jsx(Fl,{size:16,className:"text-amber-500 fill-amber-500 animate-pulse"}),o.jsx("span",{className:"text-xs font-bold text-amber-700 dark:text-amber-300 uppercase tracking-widest",children:"Special Occasion"})]}),o.jsx("h3",{className:"text-2xl font-bold text-spiritual-900 dark:text-spiritual-50",children:xe.name}),o.jsx("p",{className:"text-sm text-spiritual-600 dark:text-spiritual-300 font-medium",children:xe.description})]}),o.jsx("div",{className:"relative z-10 p-3 bg-white/40 dark:bg-white/10 rounded-full backdrop-blur-sm",children:o.jsx(Sr,{size:24,className:"text-amber-500"})})]}),o.jsxs("div",{ref:w,onScroll:Tt,className:"flex overflow-x-auto snap-x snap-mandatory scrollbar-hide relative z-10 gap-0",style:{scrollBehavior:"smooth"},children:[o.jsxs("div",{className:"min-w-full snap-center px-1 flex flex-col gap-4",children:[o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"bg-white/60 dark:bg-spiritual-800/60 rounded-[1.5rem] p-4 backdrop-blur-md flex items-center gap-3 border border-white/40 dark:border-white/5 shadow-sm",children:[o.jsx("div",{className:"p-2.5 bg-orange-100 dark:bg-orange-900/30 rounded-xl text-orange-500 dark:text-orange-300",children:o.jsx(Us,{size:20,strokeWidth:2})}),o.jsxs("div",{className:"flex flex-col",children:[o.jsx("span",{className:"text-xs font-bold text-spiritual-400 uppercase tracking-wider mb-0.5",children:"Sunrise"}),o.jsx("span",{className:"text-lg font-bold",children:D.sunrise})]})]}),o.jsxs("div",{className:"bg-white/60 dark:bg-spiritual-800/60 rounded-[1.5rem] p-4 backdrop-blur-md flex items-center gap-3 border border-white/40 dark:border-white/5 shadow-sm",children:[o.jsx("div",{className:"p-2.5 bg-indigo-100 dark:bg-indigo-900/30 rounded-xl text-indigo-500 dark:text-indigo-300",children:o.jsx(Qn,{size:20,strokeWidth:2})}),o.jsxs("div",{className:"flex flex-col",children:[o.jsx("span",{className:"text-xs font-bold text-spiritual-400 uppercase tracking-wider mb-0.5",children:"Sunset"}),o.jsx("span",{className:"text-lg font-bold",children:D.sunset})]})]})]}),o.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[o.jsxs("div",{className:"bg-violet-50/50 dark:bg-violet-900/10 rounded-[2rem] p-5 border border-violet-100 dark:border-violet-800/30 backdrop-blur-md relative overflow-hidden group hover:bg-violet-50 dark:hover:bg-violet-900/20 transition-colors",children:[o.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-5 text-violet-500",children:o.jsx(Hh,{name:I==null?void 0:I.name,className:"w-24 h-24"})}),o.jsxs("div",{className:"relative z-10",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[o.jsx(Sr,{size:14,className:"text-violet-500"}),o.jsx("span",{className:"text-xs font-bold text-violet-600 dark:text-violet-300 uppercase tracking-widest",children:"Nakshatra"})]}),o.jsxs("div",{className:"flex flex-col gap-1",children:[o.jsx("div",{className:"w-16 h-16 rounded-2xl bg-violet-100 dark:bg-violet-800/50 text-violet-600 dark:text-violet-300 flex items-center justify-center mb-2 shadow-sm p-3",children:o.jsx(Hh,{name:I==null?void 0:I.name,className:"w-full h-full"})}),o.jsx("h3",{className:"text-xl font-bold text-spiritual-900 dark:text-spiritual-50",children:I==null?void 0:I.name}),o.jsx("p",{className:"text-sm text-spiritual-500 dark:text-spiritual-400 font-medium leading-relaxed",children:I==null?void 0:I.description})]})]})]}),o.jsxs("div",{className:"bg-blue-50/50 dark:bg-blue-900/10 rounded-[2rem] p-5 border border-blue-100 dark:border-blue-800/30 backdrop-blur-md relative overflow-hidden group hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors",children:[o.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-5 text-blue-500",children:o.jsx("span",{className:"text-6xl",children:P==null?void 0:P.icon})}),o.jsxs("div",{className:"relative z-10",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[o.jsx(Qn,{size:14,className:"text-blue-500"}),o.jsx("span",{className:"text-xs font-bold text-blue-600 dark:text-blue-300 uppercase tracking-widest",children:"Tithi"})]}),o.jsxs("div",{className:"flex flex-col flex-1 gap-4",children:[o.jsx("div",{className:"text-6xl filter drop-shadow-sm",children:P==null?void 0:P.icon}),o.jsxs("div",{className:"flex flex-col flex-1 gap-4",children:[o.jsx("h3",{className:"text-xl font-bold text-spiritual-900 dark:text-spiritual-50",children:L==null?void 0:L.name}),o.jsxs("p",{className:"text-sm text-spiritual-500 dark:text-spiritual-400 font-medium leading-relaxed",children:[L==null?void 0:L.type," Paksha"]}),o.jsxs("p",{className:"text-sm text-spiritual-500 dark:text-spiritual-400 font-medium leading-relaxed",children:[(L==null?void 0:L.type)==="Shukla"?"Waxing":"Waning","  ",P==null?void 0:P.illumination]})]})]})]})]})]}),o.jsxs("div",{className:"bg-white/40 dark:bg-white/5 rounded-[2rem] p-5 border border-white/40 dark:border-white/5 backdrop-blur-md flex flex-col justify-center gap-3",children:[o.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-spiritual-100 dark:border-white/5",children:[o.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[o.jsx(G0,{size:16,className:"text-rose-400"}),o.jsx("span",{className:"text-sm font-bold text-spiritual-600 dark:text-spiritual-300",children:"Maasa"})]}),o.jsx("span",{className:"text-sm font-medium text-spiritual-800 dark:text-spiritual-100 text-right truncate ml-2",children:ie==null?void 0:ie.name})]}),o.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-spiritual-100 dark:border-white/5",children:[o.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[o.jsx(Pa,{size:16,className:"text-emerald-400"}),o.jsx("span",{className:"text-sm font-bold text-spiritual-600 dark:text-spiritual-300",children:"Lagna"})]}),o.jsx("span",{className:"text-sm font-medium text-spiritual-800 dark:text-spiritual-100 text-right truncate ml-2",children:H?`${H.name} (${Math.round(H.degree)})`:"--"})]}),o.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-spiritual-100 dark:border-white/5",children:[o.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[o.jsx(Ao,{size:16,className:"text-orange-400"}),o.jsx("span",{className:"text-sm font-bold text-spiritual-600 dark:text-spiritual-300",children:"Vaar"})]}),o.jsx("span",{className:"text-sm font-medium text-spiritual-800 dark:text-spiritual-100 text-right truncate ml-2",children:_})]}),o.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-spiritual-100 dark:border-white/5",children:[o.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[o.jsx(q0,{size:16,className:"text-teal-400"}),o.jsx("span",{className:"text-sm font-bold text-spiritual-600 dark:text-spiritual-300",children:"Yoga"})]}),o.jsx("span",{className:"text-sm font-medium text-spiritual-800 dark:text-spiritual-100 text-right truncate ml-2",children:v==null?void 0:v.name})]}),o.jsxs("div",{className:"flex justify-between items-center",children:[o.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[o.jsx(li,{size:16,className:"text-blue-400"}),o.jsx("span",{className:"text-sm font-bold text-spiritual-600 dark:text-spiritual-300",children:"Karana"})]}),o.jsx("span",{className:"text-sm font-medium text-spiritual-800 dark:text-spiritual-100 text-right truncate ml-2",children:T==null?void 0:T.name})]})]})]}),o.jsxs("div",{className:"min-w-full snap-center px-1",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-4 opacity-70 px-1",children:[o.jsx(la,{size:14,className:"text-spiritual-gold"}),o.jsx("span",{className:"text-xs font-bold text-spiritual-500 dark:text-spiritual-300 uppercase tracking-widest",children:a?"Day Schedule":"Day at a Glance"})]}),o.jsx("div",{className:"bg-white/30 dark:bg-white/5 rounded-[2rem] p-1 border border-white/30 dark:border-white/5 backdrop-blur-sm h-full max-h-[380px] overflow-hidden",children:o.jsxs("div",{className:"space-y-1 relative h-full overflow-y-auto pr-1 scrollbar-hide",children:[o.jsx("div",{className:"absolute left-[36px] top-4 bottom-4 w-0.5 bg-spiritual-200 dark:bg-spiritual-700/50 z-0"}),Ee.map(($,we)=>{const Ve=$.end?$.end.getTime()<e.getTime():$.start.getTime()<e.getTime(),He=!a&&$.start.getTime()<=e.getTime()&&($.end?$.end.getTime()>e.getTime():!0);let $e=o.jsx(la,{size:14});return $.type==="auspicious"&&($e=o.jsx(Qt,{size:14})),$.type==="inauspicious"&&($e=o.jsx(im,{size:14})),$.name==="Sunrise"&&($e=o.jsx(Us,{size:14})),$.name==="Sunset"&&($e=o.jsx(Qn,{size:14})),o.jsxs("div",{className:`relative z-10 flex items-center gap-4 p-3 rounded-2xl transition-all ${He?"bg-white dark:bg-spiritual-800 shadow-md border border-spiritual-100 dark:border-spiritual-600":"hover:bg-white/40 dark:hover:bg-white/5"}`,children:[o.jsxs("div",{className:`flex flex-col items-end min-w-[60px] text-xs font-mono font-bold ${Ve&&!a?"opacity-40":"text-spiritual-600 dark:text-spiritual-300"}`,children:[o.jsx("span",{children:be($.start)}),$.end&&o.jsx("span",{className:"text-spiritual-400 opacity-80",children:be($.end)})]}),o.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center border-2 shrink-0 transition-transform ${He?"scale-110 shadow-glow":""} ${Ve&&!a?"opacity-50 grayscale scale-90":""}`,style:{backgroundColor:$.color+"20",borderColor:$.color,color:$.color},children:$e}),o.jsxs("div",{className:`flex-1 ${Ve&&!a?"opacity-50":""}`,children:[o.jsx("h4",{className:"text-sm font-bold text-spiritual-900 dark:text-spiritual-50",children:$.name}),He&&o.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[o.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"}),o.jsx("span",{className:"text-xs font-bold text-green-600 dark:text-green-400 uppercase tracking-wide",children:"Happening Now"})]})]})]},we)})]})})]}),o.jsxs("div",{className:"min-w-full snap-center px-1 flex flex-col",children:[o.jsxs("div",{className:"flex items-center gap-2 mb-4 opacity-70 px-1",children:[o.jsx(Ao,{size:14,className:"text-spiritual-gold"}),o.jsx("span",{className:"text-xs font-bold text-spiritual-500 dark:text-spiritual-300 uppercase tracking-widest",children:"Upcoming Days"})]}),o.jsx("div",{className:"space-y-1 relative",children:ce.length>0?o.jsx("div",{className:"grid grid-cols-1 gap-2",children:ce.map(($,we)=>o.jsxs("div",{className:`flex items-center justify-between text-base p-4 rounded-2xl border transition-colors cursor-default ${$.isFestival?"bg-amber-50 dark:bg-amber-900/20 border-amber-200 dark:border-amber-800":"bg-white/40 dark:bg-white/5 border-spiritual-100/50 dark:border-white/5 hover:bg-white/60 dark:hover:bg-white/10"}`,children:[o.jsxs("div",{className:"flex flex-col",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[$.isFestival&&o.jsx(K0,{size:12,className:"text-amber-500 fill-amber-500"}),o.jsx("span",{className:`font-bold text-sm ${$.isFestival?"text-amber-800 dark:text-amber-200":"text-spiritual-900 dark:text-spiritual-50"}`,children:$.title})]}),o.jsx("span",{className:`text-xs ${$.isFestival?"text-amber-600 dark:text-amber-400":"text-spiritual-500 dark:text-spiritual-400"}`,children:$.description})]}),o.jsx("div",{className:"text-right flex-shrink-0 ml-2",children:o.jsx("span",{className:`block text-xs font-bold px-2 py-1 rounded-lg ${$.isFestival?"bg-amber-100 text-amber-900 dark:bg-amber-800 dark:text-amber-100":"text-spiritual-800 dark:text-spiritual-200 bg-white/50 dark:bg-white/10"}`,children:tt($.date)})})]},we))}):o.jsx("div",{className:"text-center p-8 text-spiritual-400 dark:text-spiritual-500 text-sm italic bg-white/20 dark:bg-white/5 rounded-2xl",children:"No upcoming major events found."})})]})]}),o.jsx("div",{className:"flex justify-center gap-4 mt-6 relative z-10 pb-2",children:[0,1,2].map($=>o.jsx("button",{onClick:()=>Rt($),className:`h-3 rounded-full transition-all duration-300 ${x===$?"w-8 bg-spiritual-800 dark:bg-spiritual-100":"w-3 bg-spiritual-300 dark:bg-spiritual-700"} p-1`,style:{boxSizing:"content-box"},"aria-label":`Go to slide ${$+1}`},$))})]}),m&&Yh.createPortal(o.jsx("div",{className:"fixed inset-0 bg-spiritual-deep/80 backdrop-blur-md z-[70] flex items-center justify-center p-4 animate-fade-in",onClick:()=>p(!1),children:o.jsxs("div",{className:"bg-white dark:bg-slate-900 w-full max-w-sm rounded-[2.5rem] p-6 shadow-2xl border border-white/10",onClick:$=>$.stopPropagation(),children:[o.jsxs("div",{className:"flex justify-between items-center mb-6",children:[o.jsx("h3",{className:"text-2xl font-bold text-spiritual-900 dark:text-spiritual-100",children:"Select Date"}),o.jsx("button",{onClick:()=>p(!1),className:"p-3 bg-spiritual-100 dark:bg-spiritual-800 rounded-full text-spiritual-500 hover:text-spiritual-900 transition-colors",children:o.jsx(Qr,{size:20})})]}),o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"p-4 bg-spiritual-50 dark:bg-slate-800 rounded-2xl border border-spiritual-100 dark:border-slate-700",children:[o.jsx("label",{className:"block text-xs font-bold text-spiritual-400 uppercase tracking-wider mb-2",children:"Pick a Day"}),o.jsx("input",{type:"date",onChange:ne,className:"w-full p-2 rounded-xl bg-transparent border-none font-bold text-lg text-spiritual-900 dark:text-spiritual-100 focus:outline-none"})]}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{onClick:()=>{ye(-1),p(!1)},className:"flex-1 py-3 bg-spiritual-100 dark:bg-slate-800 text-spiritual-700 dark:text-spiritual-200 rounded-xl font-bold text-sm hover:bg-spiritual-200 dark:hover:bg-slate-700 transition-colors",children:"Yesterday"}),o.jsx("button",{onClick:()=>{ye(1),p(!1)},className:"flex-1 py-3 bg-spiritual-100 dark:bg-slate-800 text-spiritual-700 dark:text-spiritual-200 rounded-xl font-bold text-sm hover:bg-spiritual-200 dark:hover:bg-slate-700 transition-colors",children:"Tomorrow"})]}),o.jsxs("button",{onClick:()=>{Y("live"),p(!1)},className:"w-full py-3 bg-spiritual-800 dark:bg-spiritual-700 text-white rounded-xl font-bold text-sm hover:bg-spiritual-900 transition-colors flex items-center justify-center gap-2",children:[o.jsx(H0,{size:16})," Return to Today"]})]})]})}),document.body)]})},Fg=Me.memo(FE),UE=Object.freeze(Object.defineProperty({__proto__:null,default:Fg},Symbol.toStringTag,{value:"Module"})),BE=({onClose:r})=>o.jsxs(Yc,{onClose:r,title:"Spiritual Directions",subtitle:"Alignment & Significance",icon:o.jsx(Pa,{size:24}),children:[o.jsx("div",{className:"p-6 bg-white/5 rounded-3xl border border-white/5",children:o.jsx("p",{className:"text-lg text-white/80 leading-relaxed font-medium",children:"Directions are deeply significant for spiritual practice, acting as a framework to align the individual's energy with the cosmic forces."})}),o.jsx("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5",children:o.jsxs("p",{className:"text-sm italic text-white/60",children:[o.jsx("span",{className:"font-bold text-white/90",children:"Note:"})," While sleeping, the feet should not point to the south."]})}),o.jsxs("div",{children:[o.jsx("h4",{className:"text-xs font-bold text-white/40 uppercase tracking-widest mb-3",children:"The 10 Directions (Dashodikpal)"}),o.jsx("div",{className:"space-y-2",children:[{dir:"East (Purva)",desc:"Enlightenment and New Beginnings"},{dir:"West (Paschim)",desc:"Introspection and Transformation"},{dir:"North (Uttar)",desc:"Wisdom and Abundance"},{dir:"South (Dakshin)",desc:"Grounding and Strength"},{dir:"Northeast (Ishanya)",desc:"Overall Auspiciousness & Most potent"},{dir:"Southeast (Agneya)",desc:"Health and Energy"},{dir:"Southwest (Nairuttya)",desc:"Stability"},{dir:"Northwest (Vayavya)",desc:"Movement & change"},{dir:"Upward (Urdhva)",desc:"Knowledge, upward flow of consciousness"},{dir:"Downward (Adah)",desc:"Gravitational foundation"}].map((e,t)=>o.jsxs("div",{className:"flex gap-4 p-3 bg-white/5 rounded-2xl border border-white/5 hover:bg-white/10 transition-colors",children:[o.jsx("span",{className:"font-bold text-white/90 w-32 shrink-0 text-sm",children:e.dir}),o.jsx("span",{className:"text-sm text-white/60 font-medium",children:e.desc})]},t))})]})]}),zE=({trackerItems:r,onNavigate:e,onSetRoutine:t,onShowSettings:n})=>{const{preferences:s}=Mt(),{dashboardLayout:i}=s,[a,c]=S.useState(!1),d=[...i||[]].sort((b,w)=>b.order-w.order).filter(b=>b.isEnabled),m=d.length>0&&d[0].id==="solarClock",p=m?d.slice(1):d,x=b=>{switch(b){case"solarClock":return o.jsx($h,{variant:"widget"});case"mandala":return o.jsx(wE,{trackerItems:r,onNavigate:e});case"moodRadial":return o.jsx(kE,{});case"quote":return o.jsx(PE,{onNavigate:e});case"quickActions":return o.jsx(VE,{onNavigate:e,onSetRoutine:t});case"compass":return o.jsx(ME,{onNavigate:()=>e(X.COMPASS),onShowInfo:()=>c(!0)});case"panchang":return o.jsx(Fg,{});default:return null}};return o.jsxs("div",{className:"animate-fade-in pb-40",children:[m?o.jsxs("div",{className:"relative w-full h-[45vh] min-h-[350px] max-h-[500px] mb-8",children:[o.jsx("div",{className:"absolute inset-0",children:o.jsx($h,{variant:"hero"})}),o.jsx("div",{className:"absolute inset-0 flex flex-col justify-between p-6 pt-10 z-50 pointer-events-none",children:o.jsxs("div",{className:"flex justify-between items-start pointer-events-auto md:max-w-6xl md:mx-auto w-full",children:[o.jsxs("div",{className:"text-white drop-shadow-lg",children:[o.jsx("h1",{className:"text-5xl font-bold tracking-tight mb-1",children:"Sankalp"}),o.jsx("p",{className:"text-xl font-medium opacity-95",children:new Date().toLocaleDateString(void 0,{weekday:"long",month:"long",day:"numeric"})})]}),o.jsx("button",{onClick:n,className:"w-12 h-12 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center text-white hover:bg-white/30 transition-colors shadow-lg border border-white/20","aria-label":"Settings",children:o.jsx(Wu,{size:28,strokeWidth:1.5})})]})})]}):o.jsxs("div",{className:"flex justify-between items-end pt-8 mb-8 max-w-6xl mx-auto px-6",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-5xl font-bold text-spiritual-900 dark:text-spiritual-50 transition-colors tracking-tight mb-2",children:"Sankalp"}),o.jsx("p",{className:"text-xl text-spiritual-600 dark:text-spiritual-300 font-medium",children:new Date().toLocaleDateString(void 0,{weekday:"long",month:"long",day:"numeric"})})]}),o.jsx("div",{className:"flex items-center gap-3 mb-2",children:o.jsx("button",{onClick:n,className:"w-14 h-14 rounded-full glass text-spiritual-700 dark:text-spiritual-200 flex items-center justify-center shadow-soft hover:scale-105 transition-transform bg-white/50 dark:bg-slate-800/50","aria-label":"Settings",children:o.jsx(Wu,{size:32,strokeWidth:1.5})})})]}),o.jsx("div",{className:"flex flex-col gap-8 max-w-3xl mx-auto px-6",children:p.map(b=>o.jsx("div",{children:x(b.id)},b.id))}),a&&o.jsx(BE,{onClose:()=>c(!1)})]})},$E=Me.memo(zE),GE=()=>{const[r,e]=S.useState(!0),[t,n]=S.useState(!1),[s,i]=S.useState(""),[a,c]=S.useState(""),[u,d]=S.useState(null),[m,p]=S.useState(null),[x,b]=S.useState(!1),w=async N=>{N.preventDefault(),d(null),b(!0);try{t?(await $b(qe,s),p("Password reset link sent to email."),n(!1)):r?await tf(qe,s,a):await ef(qe,s,a)}catch(D){d(D.message.replace("Firebase: ",""))}finally{b(!1)}},k=async()=>{try{await mf(qe,Wc)}catch(N){d(N.message)}};return o.jsxs("div",{className:"min-h-screen bg-spiritual-50 dark:bg-spiritual-deep flex flex-col items-center justify-center p-6 animate-fade-in",children:[o.jsxs("div",{className:"text-center mb-8",children:[o.jsx("div",{className:"w-20 h-20 bg-spiritual-800 dark:bg-spiritual-100 rounded-[2rem] flex items-center justify-center mx-auto mb-6 shadow-xl rotate-3",children:o.jsx("span",{className:"text-4xl",children:""})}),o.jsx("h1",{className:"text-4xl font-bold text-spiritual-900 dark:text-spiritual-50 mb-2",children:"Sadhaka"}),o.jsx("p",{className:"text-spiritual-500 dark:text-spiritual-400 font-medium tracking-wide",children:t?"Recover Access":r?"Sign In to Sanctuary":"Begin Your Journey"})]}),o.jsxs("div",{className:"w-full max-w-sm bg-white dark:bg-white/5 p-8 rounded-[2.5rem] shadow-soft border border-spiritual-100 dark:border-white/10 relative overflow-hidden",children:[o.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-spiritual-gold/10 rounded-full blur-3xl -mr-10 -mt-10"}),o.jsxs("form",{onSubmit:w,className:"space-y-5 relative z-10",children:[o.jsxs("div",{className:"space-y-4",children:[o.jsxs("div",{className:"relative",children:[o.jsx(W0,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-spiritual-400",size:20}),o.jsx("input",{type:"email",placeholder:"Email",value:s,onChange:N=>i(N.target.value),className:"w-full pl-12 pr-4 py-4 bg-spiritual-50 dark:bg-black/20 rounded-2xl border-none focus:ring-2 focus:ring-spiritual-gold outline-none text-spiritual-900 dark:text-spiritual-100 placeholder:text-spiritual-300 font-medium transition-all",required:!0})]}),!t&&o.jsxs("div",{className:"relative",children:[o.jsx(Vl,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-spiritual-400",size:20}),o.jsx("input",{type:"password",placeholder:"Password",value:a,onChange:N=>c(N.target.value),className:"w-full pl-12 pr-4 py-4 bg-spiritual-50 dark:bg-black/20 rounded-2xl border-none focus:ring-2 focus:ring-spiritual-gold outline-none text-spiritual-900 dark:text-spiritual-100 placeholder:text-spiritual-300 font-medium transition-all",required:!0})]})]}),u&&o.jsxs("div",{className:"flex items-center gap-2 text-red-500 text-xs font-bold bg-red-50 dark:bg-red-900/10 p-3 rounded-xl",children:[o.jsx(lm,{size:16})," ",u]}),m&&o.jsxs("div",{className:"flex items-center gap-2 text-green-600 text-xs font-bold bg-green-50 dark:bg-green-900/10 p-3 rounded-xl",children:[o.jsx(Qt,{size:16})," ",m]}),o.jsxs("button",{type:"submit",disabled:x,className:"w-full py-4 bg-spiritual-800 dark:bg-spiritual-100 text-white dark:text-spiritual-900 rounded-2xl font-bold text-lg shadow-lg hover:scale-[1.02] active:scale-95 transition-all flex items-center justify-center gap-2",children:[x?o.jsx("div",{className:"w-5 h-5 border-2 border-current border-t-transparent rounded-full animate-spin"}):t?"Send Link":r?"Enter":"Create Account",!x&&o.jsx(oa,{size:20})]})]}),!t&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"flex items-center gap-4 my-6",children:[o.jsx("div",{className:"h-px bg-spiritual-200 dark:bg-white/10 flex-1"}),o.jsx("span",{className:"text-xs font-bold text-spiritual-400 uppercase",children:"OR"}),o.jsx("div",{className:"h-px bg-spiritual-200 dark:bg-white/10 flex-1"})]}),o.jsxs("button",{onClick:k,className:"w-full py-3 bg-white dark:bg-black/30 border border-spiritual-200 dark:border-white/10 rounded-2xl font-bold text-spiritual-700 dark:text-spiritual-300 hover:bg-spiritual-50 dark:hover:bg-white/5 transition-colors flex items-center justify-center gap-2",children:[o.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:o.jsx("path",{fill:"currentColor",d:"M21.35 11.1h-9.17v2.73h6.51c-.33 3.81-3.5 5.44-6.5 5.44C8.36 19.27 5 16.25 5 12c0-4.1 3.2-7.27 7.2-7.27c3.09 0 4.9 1.97 4.9 1.97L19 4.72S16.56 2 12.1 2C6.42 2 2.03 6.8 2.03 12c0 5.05 4.13 10 10.22 10c5.35 0 9.25-3.67 9.25-9.09c0-1.15-.15-1.81-.15-1.81Z"})}),"Continue with Google"]})]}),o.jsx("div",{className:"mt-6 text-center",children:t?o.jsx("button",{onClick:()=>n(!1),className:"text-sm font-bold text-spiritual-600 dark:text-spiritual-300 hover:underline",children:"Back to Login"}):o.jsxs(o.Fragment,{children:[o.jsx("button",{onClick:()=>e(!r),className:"text-sm font-bold text-spiritual-600 dark:text-spiritual-300 hover:underline",children:r?"New here? Create Account":"Already have an account?"}),r&&o.jsx("button",{onClick:()=>n(!0),className:"block w-full mt-2 text-xs font-medium text-spiritual-400 hover:text-spiritual-600 dark:hover:text-spiritual-200",children:"Forgot Password?"})]})})]})]})},qE=r=>{const e=S.useRef(null);S.useEffect(()=>{if(!r)return;const t=async()=>{if("wakeLock"in navigator)try{e.current=await navigator.wakeLock.request("screen")}catch(s){console.debug("Wake Lock request failed:",s)}};t();const n=async()=>{document.visibilityState==="visible"&&await t()};return document.addEventListener("visibilitychange",n),()=>{document.removeEventListener("visibilitychange",n),e.current&&(e.current.release().catch(()=>{}),e.current=null)}},[r])},KE=[X.DASHBOARD,X.PRACTICE_MENU,X.JOURNAL,X.SADHANA,X.GURUKUL],HE=r=>{const[e,t]=S.useState(X.DASHBOARD),[n,s]=S.useState(null),[i,a]=S.useState("morning"),[c,u]=S.useState(!1),[d,m]=S.useState({}),p=S.useRef(X.DASHBOARD);S.useEffect(()=>{p.current=e},[e]);const x=S.useCallback((w,k,N)=>{const D=(N==null?void 0:N.isNested)||!1,V=KE.includes(w),P={view:w,itemId:k||null,options:N||{}};V?window.history.replaceState(P,"",""):window.history.pushState(P,"",""),t(w),s(k||null),u(D),m(N||{})},[]),b=S.useCallback(()=>{window.history.back()},[]);return S.useEffect(()=>{if(!r)return;window.history.state||window.history.replaceState({view:X.DASHBOARD,itemId:null,options:{isNested:!1}},"","");const w=k=>{if(k.state&&k.state.view){t(k.state.view),s(k.state.itemId||null);const N=k.state.options||{};u(N.isNested||!1),m(N)}else t(X.DASHBOARD),s(null),u(!1),m({})};return window.addEventListener("popstate",w),()=>window.removeEventListener("popstate",w)},[r]),S.useEffect(()=>{window.scrollTo(0,0)},[e]),{currentView:e,startItemId:n,routineType:i,setRoutineType:a,isNested:c,navOptions:d,handleNavigate:x,handleBack:b}},Wh=r=>{const e=r.getTimezoneOffset();return new Date(r.getTime()-e*60*1e3).toISOString().split("T")[0]},WE=()=>{const[r,e]=S.useState([]),t=S.useCallback(()=>{e(rs())},[]);S.useEffect(()=>(HT(),t(),window.addEventListener("sadhaka_tracker_updated",t),()=>window.removeEventListener("sadhaka_tracker_updated",t)),[t]);const n=S.useCallback(i=>{const a=new Date,c=new Date;c.setDate(a.getDate()-1);const u=Wh(a),d=Wh(c);e(m=>m.map(x=>{if(x.id===i){const b=x.completedDates.includes(u);let w,k;b?(w=x.completedDates.filter(D=>D!==u),k=Math.max(0,x.streak-1)):(w=[...x.completedDates,u],x.completedDates.includes(d)?k=x.streak+1:k=1);const N={...x,completedDates:w,streak:k};return qT(N),N}return x}))},[]),s=S.useCallback(i=>{KT(i),t()},[t]);return{trackerItems:r,refreshTracker:t,toggleTrackItem:n,handleDeleteItem:s}},qi=(r,e)=>{try{const t={hour:"numeric",hour12:!1,timeZone:e},i=new Intl.DateTimeFormat("en-US",t).formatToParts(r).find(c=>c.type==="hour");return i?parseInt(i.value)%24:r.getHours()}catch{return r.getHours()}},zt=(r,e)=>{try{return r.toLocaleDateString("en-CA",{timeZone:e})}catch{const n=r.getTimezoneOffset();return new Date(r.getTime()-n*60*1e3).toISOString().split("T")[0]}},Qh=(r,e,t)=>{var i,a;if(!r)return!1;const[n,s]=r.split(":").map(Number);try{const c=new Intl.DateTimeFormat("en-US",{hour:"numeric",minute:"numeric",hour12:!1,timeZone:t}).formatToParts(e),u=parseInt(((i=c.find(m=>m.type==="hour"))==null?void 0:i.value)||"0")%24,d=parseInt(((a=c.find(m=>m.type==="minute"))==null?void 0:a.value)||"0");return u===n&&d===s}catch{return!1}},QE=[{id:"practice_alarm",condition:r=>{var n;if(!r.preferences.notifications.alarmsEnabled)return!1;const e=(n=r.preferences.location)==null?void 0:n.timezone,t=zt(r.now,e);return r.trackerItems.some(s=>s.notificationEnabled&&Qh(s.reminderTime,r.now,e)&&!s.completedDates.includes(t))},create:r=>{var s;const e=(s=r.preferences.location)==null?void 0:s.timezone,t=zt(r.now,e);return r.trackerItems.filter(i=>i.notificationEnabled&&Qh(i.reminderTime,r.now,e)&&!i.completedDates.includes(t)).map(i=>({id:`alarm_${i.id}_${t}`,title:"It is time",message:`Time for ${i.title}`,subMessage:"Your spiritual practice awaits.",category:"alarm",priority:10,color:"text-spiritual-gold",timestamp:Date.now(),status:"active",requiresFullScreen:!0,requiresSystemNotification:!0,expiryTime:Date.now()+6e4,actionLink:X.SADHANA,actionLabel:"Start Practice"}))}},{id:"cosmic_timeline",condition:r=>jl(r.location.lat,r.location.lng,r.now).some(t=>{const n=r.now.getTime()-t.start.getTime();return n>=0&&n<6e4}),create:r=>jl(r.location.lat,r.location.lng,r.now).filter(n=>{const s=r.now.getTime()-n.start.getTime();return s>=0&&s<6e4}).map(n=>{let s=`${n.name} has started.`,i="Align with the cosmic rhythm.",a="cosmic",c=7,u=X.PANCHANG,d="View Timing";return n.name==="Sunrise"?(s="Sunrise",i="A new day begins. Offer Arghya and chant Gayatri.",u=X.MANTRA,d="Chant Mantra"):n.name==="Sunset"?(s="Sunset",i="Time to wind down. Perfect for Sandhya Vandanam.",u=X.MANTRA,d="Chant Mantra"):n.name==="Rahu Kaal"?(s="Rahu Kaal",i="Avoid starting new material tasks.",a="alert",c=8,u=X.PANCHANG,d="View Panchang"):n.name==="Brahma Muhurta"?(s="Brahma Muhurta",i="The creator's hour. Best time for deep Dhyana.",c=9,u=X.MEDITATION,d="Meditate"):n.name==="Abhijit Muhurat"&&(s="Abhijit Muhurat",i="Solar energy is at peak. Auspicious time for Sadhana.",u=X.SADHANA,d="Start Sadhana"),{id:`cosmic_${n.name}_${n.start.getTime()}`,title:s,message:s,subMessage:i,category:a,priority:c,timestamp:Date.now(),status:"active",requiresSystemNotification:!0,expiryTime:n.end?n.end.getTime():Date.now()+30*60*1e3,actionLink:u,actionLabel:d}})},{id:"daily_festival",condition:r=>!!Pl(r.now),create:r=>{var i;const e=Pl(r.now),t=(i=r.preferences.location)==null?void 0:i.timezone,n=zt(r.now,t),s=new Date(r.now);return s.setHours(23,59,59,999),[{id:`festival_${n}`,title:(e==null?void 0:e.name)||"Special Day",message:`Today is ${e==null?void 0:e.name}`,subMessage:(e==null?void 0:e.description)||"A special day for celebration.",category:"cosmic",priority:7,color:"text-amber-500",timestamp:Date.now(),status:"active",requiresSystemNotification:!0,expiryTime:s.getTime(),actionLink:X.PANCHANG,actionLabel:"See Details"}]}},{id:"mood_check_noon",condition:r=>{var i;const e=(i=r.preferences.location)==null?void 0:i.timezone,t=qi(r.now,e),n=zt(r.now,e),s=r.journalEntries.some(a=>a.date.startsWith(n));return(t===12||t===13)&&!s},create:r=>{var n;const e=(n=r.preferences.location)==null?void 0:n.timezone;return[{id:`mood_check_${zt(r.now,e)}`,title:"Check-in",message:"Mid-day Check-in",subMessage:"How is your inner state right now?",category:"insight",priority:5,color:"text-sky-500",timestamp:Date.now(),status:"active",requiresSystemNotification:!0,expiryTime:Date.now()+2*60*60*1e3,actionLink:X.JOURNAL,actionLabel:"Log Mood"}]}},{id:"evening_reflection",condition:r=>{var i;const e=(i=r.preferences.location)==null?void 0:i.timezone,t=qi(r.now,e),n=zt(r.now,e),s=r.journalEntries.some(a=>a.date.startsWith(n));return t>=20&&!s},create:r=>{var n;const e=(n=r.preferences.location)==null?void 0:n.timezone;return[{id:`evening_reflection_${zt(r.now,e)}`,title:"Reflection",message:"The day is ending",subMessage:"Have you recorded your Chintan?",category:"insight",priority:6,color:"text-indigo-500",timestamp:Date.now(),status:"active",requiresSystemNotification:!0,expiryTime:Date.now()+8*60*60*1e3,actionLink:X.JOURNAL,actionLabel:"Write Entry"}]}},{id:"goal_risk",condition:r=>{var c;const e=(c=r.preferences.location)==null?void 0:c.timezone,t=qi(r.now,e),n=zt(r.now,e),s=r.trackerItems;if(s.length===0)return!1;const i=s.filter(u=>u.completedDates.includes(n)).length,a=i/s.length;return t>=11&&t<14&&i===0||t>=20&&a<.5},create:r=>{var s;const e=(s=r.preferences.location)==null?void 0:s.timezone,t=qi(r.now,e),n=zt(r.now,e);return t<14?[{id:`goal_risk_morn_${n}`,title:"Gentle Reminder",message:"Morning is passing",subMessage:`${r.trackerItems.length} rituals are pending. Start small.`,category:"behavior",priority:6,color:"text-orange-500",timestamp:Date.now(),status:"active",requiresSystemNotification:!0,expiryTime:Date.now()+3*60*60*1e3,actionLink:X.SADHANA,actionLabel:"View Goals"}]:[{id:`goal_risk_eve_${n}`,title:"Keep going",message:"Goal Streak at Risk",subMessage:"A gentle push now can save your streak.",category:"alert",priority:8,color:"text-red-500",timestamp:Date.now(),status:"active",requiresSystemNotification:!0,expiryTime:Date.now()+4*60*60*1e3,actionLink:X.SADHANA,actionLabel:"Complete Goal"}]}}],YE=()=>{const{addNotification:r,notifications:e,dismissedIds:t}=Jc(),{preferences:n}=Mt(),s=S.useRef(null),i=S.useRef(e);S.useEffect(()=>{i.current=e},[e]),S.useEffect(()=>{const a=()=>{const c=new Date,u=n.location?n.location.coords:Bl.coords,d=cr(),m=rs(),p={now:c,location:u,journalEntries:d,trackerItems:m,preferences:n};QE.forEach(x=>{x.condition(p)&&x.create(p).forEach(k=>{const N=i.current.some(V=>V.id===k.id),D=t.has(k.id);!N&&!D&&r(k)})})};return a(),s.current=setInterval(a,3e4),()=>{s.current&&clearInterval(s.current)}},[n,r,t])},JE=Me.lazy(()=>xt(()=>import("./Breathwork-B5ZUP_b-.js"),__vite__mapDeps([0,1,2,3]))),XE=Me.lazy(()=>xt(()=>import("./Journal-Bp3O11X2.js"),__vite__mapDeps([4,1,5,3]))),ZE=Me.lazy(()=>xt(()=>import("./JournalEntryEditor-SXCVKtD9.js"),__vite__mapDeps([6,1,3]))),ek=Me.lazy(()=>xt(()=>import("./CompassTool-CLwDCtkd.js"),__vite__mapDeps([7,1,3]))),tk=Me.lazy(()=>xt(()=>import("./TrackerSettings-BMEZFy03.js"),__vite__mapDeps([8,1,3]))),nk=Me.lazy(()=>xt(()=>import("./Mindfulness-Bck9g5_0.js"),__vite__mapDeps([9,1,2,3]))),rk=Me.lazy(()=>xt(()=>import("./YogaStretches-DCiTPyey.js"),__vite__mapDeps([10,1,2,3]))),sk=Me.lazy(()=>xt(()=>import("./MantraChanting-BKTpuF28.js"),__vite__mapDeps([11,1,2,3]))),ik=Me.lazy(()=>xt(()=>import("./Sadhana-DJus5JV2.js"),__vite__mapDeps([12,5,3,1]))),ak=Me.lazy(()=>xt(()=>import("./PracticeMenu-QHRmESbo.js"),__vite__mapDeps([13,1,3]))),ok=Me.lazy(()=>xt(()=>import("./Gurukul-DYRSGatH.js"),__vite__mapDeps([14,3,1]))),lk=Me.lazy(()=>xt(()=>import("./RoutineBuilder-C2foYisI.js"),__vite__mapDeps([15,1,5,3]))),ck=Me.lazy(()=>xt(()=>import("./ResourcesView-CYaY1tU7.js"),__vite__mapDeps([16,1,5,3]))),uk=Me.lazy(()=>xt(()=>Promise.resolve().then(()=>UE),void 0)),dk=({hasOnboarded:r,onOnboardComplete:e})=>{const{preferences:t,toggleTheme:n}=Mt(),{theme:s}=t,{currentUser:i,loading:a}=Qc(),[c,u]=S.useState(Jo()),[d,m]=S.useState(!1);qE(!!i),YE();const{currentView:p,startItemId:x,navOptions:b,routineType:w,setRoutineType:k,isNested:N,handleNavigate:D,handleBack:V}=HE(r),{trackerItems:P,refreshTracker:U,toggleTrackItem:L,handleDeleteItem:G}=WE(),{activeOverlay:I,dismissOverlay:y,completeOverlay:v}=Jc(),E=S.useCallback(()=>{m(!0)},[]),T=S.useCallback(()=>{m(!1)},[]),A=S.useCallback(()=>{u(!1)},[]),_=()=>{if(I!=null&&I.id){const ie=I.id.split("_");if(ie.length>=2){const de=ie[1];L(de)}}v()};if(a)return o.jsx(Ju,{});if(!r)return o.jsx(CT,{onComplete:e,theme:s,toggleTheme:n});if(!i)return o.jsx(GE,{});if(c&&Jo())return o.jsx(tE,{onUnlock:A});const se=()=>{if(p===X.DASHBOARD)return o.jsx($E,{trackerItems:P,onNavigate:D,onSetRoutine:k,onShowSettings:E});const ie=(()=>{switch(p){case X.BREATHWORK:return o.jsx(JE,{onClose:V,initialId:x});case X.MEDITATION:return o.jsx(nk,{onClose:V,initialId:x});case X.YOGA:return o.jsx(rk,{onClose:V,initialId:x});case X.MANTRA:return o.jsx(sk,{onClose:V,initialId:x});case X.JOURNAL:return o.jsx(XE,{onBack:N?V:void 0,onNavigate:D});case X.JOURNAL_EDIT:return o.jsx(ZE,{onClose:V,initialEntryId:x,initialDate:b==null?void 0:b.initialDate});case X.COMPASS:return o.jsx(ek,{onClose:()=>D(X.DASHBOARD)});case X.SADHANA:return o.jsx(ik,{trackerItems:P,onToggle:L,onEdit:ce=>D(X.SADHANA_EDIT,ce.id,{isNested:!0}),onAdd:()=>D(X.SADHANA_EDIT,void 0,{isNested:!0}),onBack:N?V:void 0});case X.SADHANA_EDIT:const de=x?P.find(ce=>ce.id===x):void 0;return o.jsx(tk,{onClose:()=>D(X.SADHANA),onSave:U,editItem:de,onDelete:ce=>{G(ce),D(X.SADHANA)}});case X.PRACTICE_MENU:return o.jsx(ak,{onNavigate:D});case X.GURUKUL:return o.jsx(ok,{onNavigate:D});case X.RESOURCES:return o.jsx(ck,{onClose:V});case X.ROUTINE:return o.jsx(lk,{type:w,onClose:()=>D(X.DASHBOARD),onNavigate:D});case X.PANCHANG:return o.jsxs("div",{className:"p-4 md:p-6 pt-8 max-w-2xl mx-auto min-h-screen",children:[o.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[o.jsx("button",{onClick:V,className:"p-3 bg-white dark:bg-white/10 rounded-full shadow-sm hover:scale-105 transition-transform text-spiritual-600 dark:text-spiritual-200",children:o.jsx(Nr,{size:20})}),o.jsx("h1",{className:"text-2xl font-bold text-spiritual-900 dark:text-spiritual-50",children:"Panchang"})]}),o.jsx(uk,{})]});default:return null}})();return o.jsx(S.Suspense,{fallback:o.jsx(Ju,{}),children:o.jsx("div",{className:`w-full min-h-screen ${N?"animate-slide-in-right":"animate-fade-in"}`,children:ie})})};return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"min-h-screen bg-spiritual-50 dark:bg-spiritual-deep text-spiritual-900 dark:text-spiritual-50 transition-colors duration-500 font-sans selection:bg-spiritual-200 dark:selection:bg-spiritual-700",children:[o.jsx("main",{role:"main",children:se()}),p!==X.ROUTINE&&p!==X.SADHANA_EDIT&&p!==X.JOURNAL_EDIT&&p!==X.RESOURCES&&!N&&o.jsx(rx,{currentView:p,onChange:D}),I&&o.jsx("div",{className:"fixed inset-0 z-[100] flex flex-col items-center justify-center bg-spiritual-deep/95 backdrop-blur-xl animate-fade-in p-6",children:o.jsxs("div",{className:"relative z-10 flex flex-col items-center text-center max-w-md w-full",children:[o.jsx("div",{className:"mb-12 relative",children:o.jsx("div",{className:"w-32 h-32 rounded-full bg-gradient-to-br from-spiritual-gold to-spiritual-600 flex items-center justify-center shadow-glow animate-float",children:o.jsx(Da,{size:48,className:"text-white animate-pulse-slow",strokeWidth:2})})}),o.jsx("h2",{className:"text-4xl font-serif font-bold text-white mb-4",children:"It is time"}),o.jsxs("div",{className:"bg-white/10 backdrop-blur-md p-8 rounded-3xl border border-white/10 w-full mb-12",children:[o.jsx("h3",{className:"text-2xl font-bold text-spiritual-100 mb-2",children:I.message}),o.jsx("p",{className:"text-white/60",children:I.subMessage})]}),o.jsxs("div",{className:"flex flex-col w-full gap-4",children:[o.jsxs("button",{onClick:_,className:"w-full py-5 bg-spiritual-gold text-spiritual-900 rounded-2xl font-bold text-lg flex items-center justify-center gap-2",children:[o.jsx(Fn,{size:24})," Begin Practice"]}),o.jsx("button",{onClick:y,className:"w-full py-4 text-spiritual-400 font-medium",children:"Dismiss"})]})]})})]}),d&&o.jsx(eE,{onClose:T})]})},hk=()=>{const[r,e]=S.useState(localStorage.getItem("sadhaka_onboarding_complete")==="true"),t=S.useCallback(()=>{localStorage.setItem("sadhaka_onboarding_complete","true"),e(!0)},[]);return o.jsx(RT,{children:o.jsx(xm,{children:o.jsx(AE,{children:o.jsx(dk,{hasOnboarded:r,onOnboardComplete:t})})})})},mk=({toast:r,onDismiss:e})=>{const t=()=>{switch(r.type){case"success":return o.jsx(Qt,{size:18,className:"text-green-400"});case"error":return o.jsx(lm,{size:18,className:"text-red-400"});default:return o.jsx(li,{size:18,className:"text-blue-400"})}};return o.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 rounded-2xl shadow-lg border border-white/10 backdrop-blur-md bg-spiritual-900/90 text-white min-w-[300px] max-w-[90vw] animate-slide-in-bottom transition-all cursor-pointer hover:bg-spiritual-900",onClick:()=>e(r.id),children:[t(),o.jsx("span",{className:"flex-1 text-sm font-medium",children:r.message}),o.jsx(Qr,{size:14,className:"opacity-50 hover:opacity-100 transition-opacity"})]})},fk=()=>{const{toasts:r,removeToast:e}=Ag();return o.jsx("div",{className:"fixed bottom-24 left-0 right-0 z-[200] flex flex-col items-center gap-2 pointer-events-none",children:o.jsx("div",{className:"flex flex-col gap-2 pointer-events-auto p-4",children:r.map(t=>o.jsx(mk,{toast:t,onDismiss:e},t.id))})})},Ug=document.getElementById("root");if(!Ug)throw new Error("Could not find root element to mount to");const pk=Yo.createRoot(Ug);pk.render(o.jsx(Me.StrictMode,{children:o.jsx(FT,{children:o.jsx(xm,{children:o.jsxs(UT,{children:[o.jsx(hk,{}),o.jsx(fk,{})]})})})}));export{Nk as A,Yc as B,BE as C,Bl as D,oo as E,TE as M,X as V,Mt as a,cr as b,Ca as c,Ik as d,Ak as e,Tk as f,Rg as g,Sg as h,Sk as i,o as j,rs as k,Sn as l,Pl as m,Og as n,hE as o,Cg as p,Vg as q,Ck as r,kk as s,Ek as t,BT as u,Wn as v,zT as w,bk as x,qT as y,Rk as z};
