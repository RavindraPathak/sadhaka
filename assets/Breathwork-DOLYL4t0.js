import{u as Ne,a as ye,r as l,g as Ce,s as Se,j as e,C as Ie,I as ze,H as re,B as Ee,W as E,X as $e,V as Pe,b as Re,c as Ae,P as ie,A as He,t as Te,p as Me}from"./index-BAPzlSzb.js";import{u as qe,S as Le}from"./useAmbience-DbLZPROI.js";import{V as Fe}from"./volume-x-lBVYmZv4.js";import{P as Oe}from"./pause-fANKumkt.js";const Ue=({onClose:D,initialId:C})=>{const{library:$}=Ne(),{preferences:f}=ye(),P=$.breathwork,ne=$.ambientSounds,B=$.chimeThemes,[r,R]=l.useState(null),[m,A]=l.useState(!1),[oe,ce]=l.useState(Ce()),[H,_]=l.useState(0),[k,U]=l.useState(0),[de,G]=l.useState(0),[g,W]=l.useState(0),[T,X]=l.useState(!1),[Q,Y]=l.useState(!1),[J,he]=l.useState(f.audio.ambienceId),[S,xe]=l.useState(f.audio.masterVolume),[N,ue]=l.useState(f.audio.voiceEnabled),[I,me]=l.useState(!0),M=l.useRef(-1);qe(J,m,S);const q=l.useRef(0),j=l.useRef(0),L=l.useRef(0),F=l.useRef(Date.now()),K=l.useRef(null),Z=l.useRef(0);l.useEffect(()=>{K.current=r,Z.current=g},[r,g]);const y=B.find(s=>s.id===f.audio.chimeThemeId)||B[0];l.useEffect(()=>{if(C){const s=P.find(a=>a.id===C);s&&(R(s),F.current=Date.now())}},[C,P]);const O=l.useCallback(()=>{const s=K.current,a=Z.current;if(s&&a>0){const t=Math.floor((Date.now()-F.current)/1e3);Se({id:Date.now().toString(),date:new Date().toISOString(),type:"breathwork",title:s.title,durationSeconds:t>0?t:0})}},[]);l.useEffect(()=>()=>{O(),j.current&&cancelAnimationFrame(j.current),window.speechSynthesis.cancel()},[O]);const pe=l.useCallback(s=>{if(!N||typeof window>"u")return;window.speechSynthesis.cancel();const a=new SpeechSynthesisUtterance(s);if(f.audio.voiceURI){const t=window.speechSynthesis.getVoices().find(i=>i.voiceURI===f.audio.voiceURI);t&&(a.voice=t)}a.rate=.9,a.volume=.7,window.speechSynthesis.speak(a)},[N,f.audio.voiceURI]),ee=s=>{if(!r)return;const{config:a,instructionCycles:t}=r,i=a.inhale*1e3,c=a.holdIn*1e3,o=a.exhale*1e3,p=a.holdOut*1e3,h=i+c+o+p;let x=s-q.current+L.current,b=x%h,w=Math.floor(x/h),n;t&&t.length>0&&(n=t[w%t.length]);const d=[{name:(n==null?void 0:n.inhale)||"Inhale",duration:a.inhale,freq:y.frequencies.inhale},{name:(n==null?void 0:n.holdIn)||"Hold",duration:a.holdIn,freq:y.frequencies.hold},{name:(n==null?void 0:n.exhale)||"Exhale",duration:a.exhale,freq:y.frequencies.exhale},{name:(n==null?void 0:n.holdOut)||"Hold",duration:a.holdOut,freq:y.frequencies.hold}].filter(u=>u.duration>0);let z=0,v=0,V=0;for(let u=0;u<d.length;u++){const le=d[u].duration*1e3;if(b<z+le){v=u,V=b-z;break}z+=le}const ae=d[v].duration*1e3,ve=Math.min(V/ae,1),ke=Math.ceil((ae-V)/1e3);if(_(v),U(ve),G(ke),W(w),v!==M.current){const u=d[v];I&&Me(u.freq,y.soundType,1.5,S),pe(u.name),M.current=v}j.current=requestAnimationFrame(ee)},fe=()=>{m?(A(!1),cancelAnimationFrame(j.current),window.speechSynthesis.pause(),L.current+=performance.now()-q.current):(A(!0),q.current=performance.now(),j.current=requestAnimationFrame(ee),window.speechSynthesis.resume())},be=()=>{A(!1),cancelAnimationFrame(j.current),window.speechSynthesis.cancel(),L.current=0,W(0),_(0),U(0),G(0),M.current=-1},we=()=>{O(),be(),C?D():R(null)},te=(s,a)=>{s&&s.stopPropagation();const t=Te({id:a.id,title:a.title,type:"breathwork"});ce(t)},se=s=>oe.some(a=>a.id===s&&a.type==="breathwork"),ge=()=>{if(!r)return null;const{config:s,theme:a,instructionCycles:t}=r;let i;t&&t.length>0&&(i=t[g%t.length]);const c=[{name:(i==null?void 0:i.inhale)||"Inhale",type:"Inhale",duration:s.inhale},{name:(i==null?void 0:i.holdIn)||"Hold",type:"Hold",duration:s.holdIn},{name:(i==null?void 0:i.exhale)||"Exhale",type:"Exhale",duration:s.exhale},{name:(i==null?void 0:i.holdOut)||"Hold",type:"Hold",duration:s.holdOut}].filter(d=>d.duration>0),o=c[H],p=(o==null?void 0:o.name)||"",h=(o==null?void 0:o.type)||"";let x=1;const b=1,w=1.6,n=d=>-(Math.cos(Math.PI*d)-1)/2;if(h==="Inhale")x=b+(w-b)*n(k);else if(h==="Exhale")x=w-(w-b)*n(k);else if(h==="Hold"){const d=(H-1+c.length)%c.length;x=c[d].type==="Inhale"?w:b}return e.jsxs("div",{className:"relative flex items-center justify-center w-64 h-64 sm:w-80 sm:h-80 md:w-96 md:h-96 landscape:w-56 landscape:h-56 landscape:lg:w-80 landscape:lg:h-80",children:[e.jsx("div",{className:`absolute inset-0 rounded-full ${a.blob} blur-3xl opacity-20 will-change-transform`,style:{transform:`scale(${x*1.2})`}}),e.jsx("div",{className:`w-40 h-40 sm:w-52 sm:h-52 md:w-60 md:h-60 rounded-full ${a.core} backdrop-blur-md border border-white/20 flex items-center justify-center shadow-[0_0_40px_rgba(0,0,0,0.2)] relative z-20 will-change-transform`,style:{transform:`scale(${x})`,boxShadow:m&&(h==="Inhale"||h==="Hold"&&x>1.2)?"0 0 60px rgba(255,255,255,0.3)":"0 0 20px rgba(0,0,0,0.1)"},children:e.jsx("div",{className:"flex flex-col items-center justify-center text-center",children:m?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`text-5xl sm:text-6xl font-light font-serif ${a.text}`,children:de}),p!==h&&e.jsx("span",{className:"text-[10px] sm:text-xs font-bold uppercase tracking-wider text-white/60 mt-1 max-w-[80%]",children:p})]}):e.jsx("span",{className:`text-5xl sm:text-6xl font-light font-serif ${a.text}`,children:e.jsx(E,{size:40,className:"opacity-50 animate-pulse-slow"})})})})]})},je=()=>{if(!r||!m)return null;const{config:s,instructionCycles:a}=r;let t;a&&a.length>0&&(t=a[g%a.length]);const i=[{name:(t==null?void 0:t.inhale)||"Inhale",duration:s.inhale},{name:(t==null?void 0:t.holdIn)||"Hold",duration:s.holdIn},{name:(t==null?void 0:t.exhale)||"Exhale",duration:s.exhale},{name:(t==null?void 0:t.holdOut)||"Hold",duration:s.holdOut}].filter(c=>c.duration>0);return e.jsx("div",{className:"w-full max-w-md px-8 mt-12 landscape:mt-6 mb-4 relative h-12 flex items-center justify-between gap-2",children:i.map((c,o)=>{const p=o===H;return e.jsxs("div",{className:"flex-1 flex flex-col items-center relative group",children:[e.jsx("span",{className:`text-xs font-bold uppercase tracking-widest mb-3 transition-all duration-300 text-center whitespace-nowrap ${p?"text-white scale-110":"text-white/30"}`,children:c.name}),e.jsx("div",{className:"w-full h-1 bg-white/10 rounded-full overflow-hidden relative",children:p&&e.jsx("div",{className:"h-full bg-white rounded-full absolute left-0 top-0 will-change-transform",style:{width:`${k*100}%`}})}),p&&e.jsx("div",{className:"absolute top-[22px] w-3 h-3 bg-white rounded-full shadow-[0_0_10px_rgba(255,255,255,0.8)] z-10 will-change-transform",style:{left:`${k*100}%`,transform:`translate(-50%, 0) translateY(${Math.sin(k*Math.PI)*-8}px)`}})]},o)})})};if(r){const s=r.theme,a=se(r.id);return e.jsxs("div",{className:"fixed inset-0 z-[60] flex flex-col landscape:flex-row bg-spiritual-deep overflow-hidden animate-fade-in",children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-b ${s.bgGradient} transition-colors duration-1000`}),e.jsxs("div",{className:"absolute top-0 left-0 w-full z-30 flex justify-between items-center p-6 pt-8 landscape:pt-6 landscape:p-6 text-white/80",children:[e.jsx("button",{onClick:we,className:"p-3 bg-white/10 rounded-full hover:bg-white/20 transition backdrop-blur-md",children:e.jsx(Ie,{size:24})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>Y(!0),className:`p-3 rounded-full backdrop-blur-md transition-colors ${Q?"bg-white/30 text-white":"bg-white/10 hover:bg-white/20"}`,children:e.jsx(ze,{size:22})}),e.jsx("button",{onClick:()=>X(!T),className:`p-3 rounded-full backdrop-blur-md transition-colors ${T?"bg-white/30 text-white":"bg-white/10 hover:bg-white/20"}`,children:e.jsx(Le,{size:22})}),e.jsx("button",{onClick:t=>te(t,r),className:`p-3 rounded-full backdrop-blur-md transition-colors ${a?"bg-red-500/20 text-red-400":"bg-white/10 hover:bg-white/20"}`,children:e.jsx(re,{size:22,fill:a?"currentColor":"none"})})]})]}),Q&&e.jsxs(Ee,{onClose:()=>Y(!1),title:r.title,subtitle:"Technique Guide",icon:e.jsx(E,{size:24}),children:[e.jsx("div",{className:"p-6 bg-white/5 rounded-3xl border border-white/5",children:e.jsx("p",{className:"text-lg text-white/80 leading-relaxed font-medium",children:r.description})}),e.jsx("div",{className:"p-6 bg-white/5 rounded-3xl border border-white/5",children:e.jsx("p",{className:"text-lg text-white/80 leading-relaxed font-medium",children:" Important : Breathwork should be practiced strictly under the guidance of an authentic teacher. Do not practice holding patterns if you have high blood pressure, heart ailments or during pregnency or menstruation."})}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs font-bold text-white/40 uppercase tracking-widest mb-3",children:"Rhythm Pattern (Seconds)"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5 text-center",children:[e.jsx("span",{className:"block text-2xl font-bold text-white mb-1",children:r.config.inhale}),e.jsx("span",{className:"text-[10px] font-bold text-white/40 uppercase tracking-wider",children:"Inhale"})]}),e.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5 text-center",children:[e.jsx("span",{className:"block text-2xl font-bold text-white mb-1",children:r.config.holdIn}),e.jsx("span",{className:"text-[10px] font-bold text-white/40 uppercase tracking-wider",children:"Hold"})]}),e.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5 text-center",children:[e.jsx("span",{className:"block text-2xl font-bold text-white mb-1",children:r.config.exhale}),e.jsx("span",{className:"text-[10px] font-bold text-white/40 uppercase tracking-wider",children:"Exhale"})]}),e.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5 text-center",children:[e.jsx("span",{className:"block text-2xl font-bold text-white mb-1",children:r.config.holdOut}),e.jsx("span",{className:"text-[10px] font-bold text-white/40 uppercase tracking-wider",children:"Hold"})]})]})]})]}),T&&e.jsxs("div",{className:"absolute top-24 right-6 z-40 w-72 bg-black/60 backdrop-blur-xl border border-white/10 rounded-[2rem] p-6 shadow-2xl animate-slide-in-right",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h4",{className:"text-white font-bold text-lg",children:"Soundscape"}),e.jsx("button",{onClick:()=>X(!1),children:e.jsx($e,{size:20,className:"text-white/50 hover:text-white"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-3 gap-2",children:ne.map(t=>e.jsx("button",{onClick:()=>he(t.id),className:`p-2 rounded-xl text-xs font-bold transition-all ${J===t.id?"bg-white text-spiritual-900":"bg-white/10 text-white/60 hover:bg-white/20"}`,children:t.name},t.id))}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-xs text-white/50 font-bold mb-2",children:[e.jsx("span",{children:"Ambience Vol"}),e.jsxs("span",{children:[Math.round(S*100),"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:S,onChange:t=>xe(parseFloat(t.target.value)),className:"w-full h-1.5 bg-white/20 rounded-full appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:bg-white [&::-webkit-slider-thumb]:rounded-full"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>ue(!N),className:`flex-1 py-3 rounded-xl flex items-center justify-center gap-2 font-bold text-sm transition-colors ${N?"bg-white/20 text-white":"bg-white/5 text-white/40"}`,children:[N?e.jsx(Pe,{size:16}):e.jsx(Fe,{size:16})," Voice"]}),e.jsxs("button",{onClick:()=>me(!I),className:`flex-1 py-3 rounded-xl flex items-center justify-center gap-2 font-bold text-sm transition-colors ${I?"bg-white/20 text-white":"bg-white/5 text-white/40"}`,children:[I?e.jsx(Re,{size:16}):e.jsx(Ae,{size:16})," Chime"]})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center landscape:items-end landscape:pr-12 w-full landscape:w-1/2 pt-20 landscape:pt-0 relative z-10",children:[e.jsxs("div",{className:"landscape:hidden text-center mb-8 px-6",children:[e.jsx("h2",{className:`text-3xl font-bold tracking-[0.2em] uppercase opacity-80 ${s.text}`,children:r.title}),m&&e.jsxs("p",{className:"text-white/40 text-sm mt-2 font-mono tracking-wider",children:["Cycle ",g+1]})]}),ge()]}),e.jsxs("div",{className:"w-full landscape:w-1/2 flex flex-col items-center justify-start landscape:justify-center p-6 landscape:pl-0 landscape:pr-12 pb-12 landscape:pb-0 z-20",children:[e.jsxs("div",{className:"hidden landscape:block text-center mb-6",children:[e.jsx("h2",{className:`text-3xl font-bold tracking-[0.2em] uppercase opacity-80 ${s.text}`,children:r.title}),m&&e.jsxs("p",{className:"text-white/40 text-sm mt-2 font-mono tracking-wider",children:["Cycle ",g+1]})]}),je(),e.jsx("div",{className:"mt-8 landscape:mt-6",children:e.jsx("button",{onClick:fe,className:`w-20 h-20 rounded-full flex items-center justify-center shadow-2xl ${s.button} text-white transition-transform hover:scale-105 active:scale-95 ring-4 ring-white/5`,children:m?e.jsx(Oe,{size:32,fill:"currentColor"}):e.jsx(ie,{size:32,fill:"currentColor",className:"ml-1"})})})]})]})}return e.jsxs("div",{className:"pb-36 min-h-screen bg-spiritual-50 dark:bg-spiritual-deep animate-fade-in flex flex-col",children:[e.jsxs("div",{className:"p-6 pt-8 pb-12 rounded-b-[3rem] shadow-soft relative z-10 flex flex-col gap-6 bg-gradient-to-br from-sky-50 via-white to-sky-100 dark:from-sky-900 dark:via-spiritual-deep dark:to-sky-900/10",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("button",{onClick:D,className:"p-3 bg-white dark:bg-white/10 rounded-full shadow-sm hover:scale-105 transition-transform text-spiritual-600 dark:text-spiritual-200","aria-label":"Back",children:e.jsx(He,{size:24})}),e.jsx("div",{className:"w-12"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-2xl bg-sky-100/50 dark:bg-sky-900/30 text-sky-600 dark:text-sky-400 shadow-sm backdrop-blur-sm",children:e.jsx(E,{size:32,strokeWidth:1.5})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-spiritual-900 dark:text-spiritual-50",children:"Pranayama"}),e.jsx("p",{className:"text-spiritual-500 dark:text-spiritual-400 font-medium",children:"Control the breath, control the mind"})]})]})]}),e.jsx("div",{className:"flex-1 p-6 max-w-2xl mx-auto w-full relative z-20 space-y-5",children:P.map(s=>{const a=se(s.id);return e.jsxs("div",{onClick:()=>{R(s),F.current=Date.now()},className:"relative overflow-hidden bg-white dark:bg-spiritual-900/60 p-6 rounded-[2.5rem] shadow-soft border border-spiritual-100 dark:border-spiritual-700/50 flex items-center gap-6 cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-all group",children:[e.jsx("div",{className:`absolute inset-0 opacity-0 group-hover:opacity-10 transition-opacity bg-gradient-to-br ${s.theme.bgGradient}`}),e.jsx("div",{className:`w-20 h-20 rounded-3xl ${s.theme.iconBg} flex items-center justify-center flex-shrink-0 group-hover:scale-105 transition-transform relative z-10 shadow-md`,children:e.jsx(E,{size:32,className:s.theme.iconColor})}),e.jsxs("div",{className:"flex-1 min-w-0 relative z-10",children:[e.jsx("h3",{className:"text-xl font-bold text-spiritual-900 dark:text-spiritual-100 mb-1",children:s.title}),e.jsx("p",{className:"text-spiritual-500 dark:text-spiritual-400 text-sm line-clamp-2 leading-relaxed",children:s.description})]}),e.jsxs("div",{className:"flex flex-col items-center gap-3 relative z-10",children:[e.jsx("button",{onClick:t=>te(t,s),className:`p-2 rounded-full transition-colors ${a?"text-red-500 bg-red-50 dark:bg-red-900/20":"text-spiritual-300 dark:text-spiritual-600 hover:text-red-400 hover:bg-spiritual-50 dark:hover:bg-spiritual-800"}`,children:e.jsx(re,{size:20,fill:a?"currentColor":"none"})}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-spiritual-50 dark:bg-spiritual-800 flex items-center justify-center text-spiritual-400 dark:text-spiritual-500 group-hover:bg-spiritual-800 group-hover:text-white dark:group-hover:bg-spiritual-100 dark:group-hover:text-spiritual-800 transition-colors",children:e.jsx(ie,{size:16,fill:"currentColor"})})]})]},s.id)})})]})};export{Ue as default};
