import{u as Se,a as Re,g as Ae,z as Ce,r as z,s as $e,j as e,B as Te,t as De,A as Ie,p as ze}from"./index-DuSORXgl.js";import{r,R as ne}from"./vendor-DDTLr4RV.js";import{u as Fe,F as Ee,K as Pe}from"./FilterBar-CBuLBzbj.js";import{a3 as oe,k as ce,P as de,a8 as Me,at as _e,h as Ve,a2 as Oe,af as Be,ak as Le}from"./utils-CwGoM2ch.js";const Ue=[9,21,54,108],ue=[{label:"Slow",val:1.5,id:"slow"},{label:"Normal",val:1,id:"normal"},{label:"Fast",val:.7,id:"fast"}],Ge=1e3,Je=({onClose:F,initialId:j})=>{const{library:m}=Se(),{preferences:d,updateAudioSettings:E}=Re(),[a,C]=r.useState(null),[$,xe]=r.useState("All"),[u,v]=r.useState(!1),he=t=>{var s;return((s=ue.find(l=>l.id===t))==null?void 0:s.val)||1},[H,T]=r.useState(0),[N,me]=r.useState(108),[P,be]=r.useState(he(d.defaults.mantraSpeed)),[K,k]=r.useState(-1),[M,pe]=r.useState(!1),[W,J]=r.useState(!1),[fe,ge]=r.useState(Ae()),[_,Q]=r.useState("IAST"),[y,we]=r.useState(!0),[x,je]=r.useState(!1),[S,V]=r.useState(d.audio.instrumentId||"sine");Fe(d.audio.ambienceId,u,d.audio.masterVolume);const b=r.useRef(0),R=r.useRef(0),p=r.useRef(0),X=r.useRef(Date.now()),f=r.useRef(0),A=r.useRef(!1),O=r.useRef(null),Y=r.useRef(!1),Z=r.useRef(1),D=r.useRef(!0),ee=r.useRef(!1),B=r.useRef(108),g=r.useRef(-1),te=r.useRef("sine"),se=m.chimeThemes.find(t=>t.id===d.audio.chimeThemeId)||m.chimeThemes[0];r.useEffect(()=>{O.current=a,Y.current=u,Z.current=P,D.current=y,ee.current=x,B.current=N,te.current=S},[a,u,P,y,x,N,S]),r.useEffect(()=>{const t=j&&m.mantras.find(s=>s.id===j)||null;C(t)},[j,m.mantras]),r.useEffect(()=>(u&&(a!=null&&a.rootNote)&&x&&!a.isUnguided?Ce(a.rootNote,d.audio.masterVolume*.3):z(),()=>z()),[u,a,x,d.audio.masterVolume]);const re=(t,s)=>{t&&t.stopPropagation();const l=De({id:s.id,title:s.title,type:"mantra"});ge(l)},L=t=>fe.some(s=>s.id===t&&s.type==="mantra"),ae=r.useCallback(()=>{const t=O.current;if(!t||t.isUnguided)return;const s=f.current;if(s>0){const l=Math.round((Date.now()-X.current)/1e3);l>5&&$e({id:Date.now().toString(),date:new Date().toISOString(),type:"mantra",title:`${t.title} (${s}/${B.current})`,durationSeconds:l,count:s})}},[]);r.useEffect(()=>(a?(X.current=Date.now(),T(0),f.current=0,k(-1),g.current=-1,b.current=0,R.current=0,A.current=!1):(v(!1),cancelAnimationFrame(p.current),z()),()=>{ae(),cancelAnimationFrame(p.current),z()}),[a,ae]);const ve=()=>{j?F():C(null)},ie=t=>{const s=O.current;if(!s||!Y.current||s.isUnguided)return;const l=s.baseDuration*1e3*Z.current,U=D.current?Ge:0,i=l+U,c=t-b.current;if(c<l){const o=s.syllables.reduce((n,I)=>n+I.durationRatio,0),le=l/o;let G=0,h=-1;for(let n=0;n<s.syllables.length;n++){const q=s.syllables[n].durationRatio*le;if(c>=G&&c<G+q){h=n;break}G+=q}if(h!==-1&&h!==g.current){const n=s.syllables[h],I=n.type==="punctuation";ee.current&&n.note&&(!I||D.current)&&Ie(n.note,n.durationRatio*le/1e3,d.audio.masterVolume,te.current),g.current=h}h===s.syllables.length-1&&!A.current&&D.current&&(ze(se.frequencies.hold,se.soundType,2.5,d.audio.masterVolume),A.current=!0),k(n=>n!==h?h:n)}else if(c<i)k(o=>o!==-1?-1:o),g.current=-1;else{const o=f.current+1;if(f.current=o,T(o),b.current=t,A.current=!1,g.current=-1,navigator.vibrate&&navigator.vibrate(10),o>=B.current){v(!1),k(-1),navigator.vibrate&&navigator.vibrate([20,50,20]);return}}p.current=requestAnimationFrame(ie)},Ne=()=>{if(u)v(!1),cancelAnimationFrame(p.current),R.current=performance.now();else{if(v(!0),R.current>0){const t=performance.now()-R.current;b.current+=t}else b.current=performance.now();p.current=requestAnimationFrame(ie)}},ke=()=>{v(!1),cancelAnimationFrame(p.current),T(0),f.current=0,k(-1),b.current=0,R.current=0,A.current=!1,g.current=-1};if(!a){const t=m.mantras.filter(i=>{var c;return!!($==="All"||i.deity===$||(c=i.meta)!=null&&c.category&&i.meta.category.map(o=>o.charAt(0).toUpperCase()+o.slice(1)).includes($))}),s=Array.from(new Set(m.mantras.map(i=>i.deity))),l=["All","Spiritual","Healing","Devotion"],U=[...l,...s.filter(i=>!l.includes(i))];return e.jsxs("div",{className:"h-[100dvh] bg-spiritual-50 dark:bg-spiritual-deep animate-fade-in flex flex-col overflow-hidden",children:[e.jsx("div",{className:"flex-none pt-8 pb-4 px-6 rounded-b-[2rem] shadow-soft flex flex-col bg-gradient-to-br from-amber-50 via-white to-amber-100 dark:from-amber-900 dark:via-spiritual-deep dark:to-amber-900/10 z-20",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:F,className:"p-3 bg-white dark:bg-white/10 rounded-full shadow-sm hover:scale-105 transition-transform text-spiritual-600 dark:text-spiritual-200","aria-label":"Back",children:e.jsx(oe,{size:20})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-spiritual-900 dark:text-spiritual-50",children:"Mantra Japa"}),e.jsx("p",{className:"text-xs text-spiritual-500 dark:text-spiritual-400 font-bold uppercase tracking-wider",children:"Recitation & Vibration"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto scrollbar-hide pb-36",children:[e.jsx("div",{className:"sticky top-0 z-40 px-6 py-2 bg-spiritual-50 dark:bg-spiritual-deep mb-4 shadow-sm",children:e.jsx(Ee,{filters:U,selected:$,onSelect:xe})}),e.jsxs("div",{className:"px-6 space-y-5",children:[t.map(i=>{const c=L(i.id);return e.jsxs("div",{onClick:()=>C(i),className:"bg-white dark:bg-spiritual-900/60 p-6 rounded-[2.5rem] shadow-soft border border-spiritual-100 dark:border-spiritual-700/50 flex items-center gap-5 cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-all group relative overflow-hidden",children:[e.jsx("div",{className:`absolute inset-0 opacity-0 group-hover:opacity-10 transition-opacity bg-gradient-to-r ${i.theme.gradient}`}),e.jsx("div",{className:`w-12 h-12 rounded-2xl bg-gradient-to-br ${i.theme.gradient} text-white flex items-center justify-center flex-shrink-0 shadow-md group-hover:scale-105 transition-transform`,children:e.jsx("span",{className:"text-lg font-serif font-bold opacity-90",children:i.sanskritTitle.charAt(0)||"K"})}),e.jsxs("div",{className:"flex-1 min-w-0 relative z-10",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"px-2 py-0.5 rounded-md bg-spiritual-100 dark:bg-spiritual-800 text-[10px] font-bold text-spiritual-500 uppercase tracking-wider",children:i.deity})}),e.jsx("h3",{className:"text-lg font-bold text-spiritual-900 dark:text-spiritual-100",children:i.title}),e.jsx("p",{className:"text-spiritual-500 dark:text-spiritual-400 text-xs truncate",children:i.meaning})]}),e.jsxs("div",{className:"flex flex-col items-center gap-3 relative z-10",children:[e.jsx("button",{onClick:o=>re(o,i),className:`p-2 rounded-full transition-colors ${c?"text-red-500 bg-red-50 dark:bg-red-900/20":"text-spiritual-300 dark:text-spiritual-600 hover:text-red-400 hover:bg-spiritual-50 dark:hover:bg-spiritual-800"}`,children:e.jsx(ce,{size:20,fill:c?"currentColor":"none"})}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-spiritual-50 dark:bg-spiritual-800 flex items-center justify-center text-spiritual-400 dark:text-spiritual-500 group-hover:bg-spiritual-800 group-hover:text-white dark:group-hover:bg-spiritual-100 dark:group-hover:text-spiritual-800 transition-colors",children:e.jsx(de,{size:16,fill:"currentColor"})})]})]},i.id)}),t.length===0&&e.jsx("div",{className:"text-center py-10 opacity-60",children:e.jsx("p",{className:"text-spiritual-500 font-medium",children:"No mantras found for this filter."})})]})]})]})}if(a.isUnguided)return e.jsx(Pe,{title:a.title,category:"mantra",onClose:()=>{j?F():C(null)}});const ye=_==="DEVANAGARI",w=a.meta;return e.jsxs("div",{className:"fixed inset-0 z-[60] flex flex-col landscape:flex-row bg-spiritual-deep overflow-hidden animate-fade-in transition-colors duration-1000",children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-b ${a.theme.gradient} opacity-90 transition-opacity duration-1000`}),e.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm"}),e.jsxs("div",{className:"absolute top-0 left-0 w-full z-30 flex justify-between items-center p-6 pt-8 text-white",children:[e.jsx("button",{onClick:ve,className:"p-3 bg-white/10 hover:bg-white/20 rounded-full backdrop-blur-md transition-colors",children:e.jsx(oe,{size:24})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>J(!0),className:`p-3 rounded-full backdrop-blur-md transition-colors ${W?"bg-white/20":"bg-white/10 hover:bg-white/20"}`,children:e.jsx(Me,{size:20})}),e.jsx("button",{onClick:()=>pe(!M),className:`p-3 rounded-full backdrop-blur-md transition-colors ${M?"bg-white/20":"bg-white/10 hover:bg-white/20"}`,children:e.jsx(_e,{size:20})}),e.jsx("button",{onClick:t=>re(t,a),className:`p-3 rounded-full backdrop-blur-md transition-colors ${L(a.id)?"bg-red-500/20 text-red-400":"bg-white/10 hover:bg-white/20"}`,children:e.jsx(ce,{size:20,fill:L(a.id)?"currentColor":"none"})})]})]}),M&&e.jsx("div",{className:"absolute top-24 right-6 z-40 w-64 bg-black/80 backdrop-blur-xl border border-white/10 rounded-3xl p-5 animate-fade-in",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center pt-2 pb-2 border-b border-white/10",children:[e.jsxs("label",{className:"text-xs font-bold text-white/40 uppercase tracking-widest flex items-center gap-2",children:[e.jsx(Ve,{size:14})," Melodic Guide (Experimental)"]}),e.jsx("button",{onClick:()=>je(!x),className:`w-12 h-6 rounded-full p-1 transition-colors ${x?"bg-white":"bg-white/10"}`,children:e.jsx("div",{className:`w-4 h-4 rounded-full shadow-sm transform transition-transform ${x?"translate-x-6 bg-black":"translate-x-0 bg-white/50"}`})})]}),x&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-white/40 uppercase tracking-widest block mb-2",children:"Instrument Tone"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx("button",{onClick:()=>{V("sine"),E({instrumentId:"sine"})},className:`py-2 rounded-lg text-xs font-bold transition-colors ${S==="sine"?"bg-white text-black":"bg-white/10 text-white/60 hover:bg-white/20"}`,children:"Soft Sine"}),e.jsx("button",{onClick:()=>{V("veena"),E({instrumentId:"veena"})},className:`py-2 rounded-lg text-xs font-bold transition-colors ${S==="veena"?"bg-white text-black":"bg-white/10 text-white/60 hover:bg-white/20"}`,children:"String"}),e.jsx("button",{onClick:()=>{V("harmonium"),E({instrumentId:"harmonium"})},className:`py-2 rounded-lg text-xs font-bold transition-colors ${S==="harmonium"?"bg-white text-black":"bg-white/10 text-white/60 hover:bg-white/20"}`,children:"Reed Organ"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-white/40 uppercase tracking-widest block mb-3",children:"Target Count"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:Ue.map(t=>e.jsx("button",{onClick:()=>{me(t),T(0),f.current=0},className:`py-2 rounded-lg text-xs font-bold transition-colors ${N===t?"bg-white text-black":"bg-white/10 text-white/60 hover:bg-white/20"}`,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-white/40 uppercase tracking-widest block mb-3",children:"Chanting Speed"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:ue.map(t=>e.jsx("button",{onClick:()=>be(t.val),className:`py-2 rounded-lg text-xs font-bold transition-colors ${P===t.val?"bg-white text-black":"bg-white/10 text-white/60 hover:bg-white/20"}`,children:t.label},t.label))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-white/40 uppercase tracking-widest block mb-3",children:"Script"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{onClick:()=>Q("IAST"),className:`py-2 rounded-lg text-xs font-bold transition-colors ${_==="IAST"?"bg-white text-black":"bg-white/10 text-white/60 hover:bg-white/20"}`,children:"Latin"}),e.jsx("button",{onClick:()=>Q("DEVANAGARI"),className:`py-2 rounded-lg text-xs font-bold transition-colors ${_==="DEVANAGARI"?"bg-white text-black":"bg-white/10 text-white/60 hover:bg-white/20"}`,children:"Devanagari"})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-white/10",children:[e.jsx("label",{className:"text-xs font-bold text-white/40 uppercase tracking-widest",children:"Interval Chime"}),e.jsx("button",{onClick:()=>we(!y),className:`w-12 h-6 rounded-full p-1 transition-colors ${y?"bg-white":"bg-white/10"}`,children:e.jsx("div",{className:`w-4 h-4 rounded-full shadow-sm transform transition-transform ${y?"translate-x-6 bg-black":"translate-x-0 bg-white/50"}`})})]})]})}),W&&e.jsxs(Te,{onClose:()=>J(!1),title:a.title,subtitle:"Mantra Details",icon:e.jsx(Oe,{size:24}),children:[e.jsxs("div",{className:"p-6 bg-white/5 rounded-3xl border border-white/5",children:[e.jsx("p",{className:"text-3xl font-serif text-white/90 mb-2 leading-relaxed",children:a.sanskritTitle}),e.jsxs("p",{className:"text-lg text-white/60 italic leading-relaxed",children:['"',a.meaning,'"']})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5",children:[e.jsx("span",{className:"block text-xs font-bold text-white/40 uppercase tracking-widest mb-1",children:"Deity"}),e.jsx("span",{className:"text-lg font-bold text-white",children:a.deity})]}),w.level&&e.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5",children:[e.jsx("span",{className:"block text-xs font-bold text-white/40 uppercase tracking-widest mb-1",children:"Level"}),e.jsx("span",{className:"text-lg font-bold text-white capitalize",children:w.level})]}),w.bestTime&&e.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5",children:[e.jsx("span",{className:"block text-xs font-bold text-white/40 uppercase tracking-widest mb-1",children:"Best Time"}),e.jsx("span",{className:"text-lg font-bold text-white capitalize",children:w.bestTime})]}),w.rishi&&e.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5",children:[e.jsx("span",{className:"block text-xs font-bold text-white/40 uppercase tracking-widest mb-1",children:"Rishi (Seer)"}),e.jsx("span",{className:"text-lg font-bold text-white",children:w.rishi})]})]})]}),e.jsxs("div",{className:"relative z-10 flex-1 flex flex-col items-center justify-center p-6 pt-24 landscape:pt-0 landscape:w-2/3 text-center",children:[e.jsxs("div",{className:"mb-12 landscape:mb-8",children:[e.jsx("h2",{className:"text-4xl font-bold text-white/90 mb-4 font-serif tracking-wide",children:a.sanskritTitle}),e.jsx("p",{className:"text-white/40 text-sm uppercase tracking-[0.2em]",children:a.title})]}),ye?e.jsx("div",{className:"max-w-xl mx-auto min-h-[120px] content-center text-center leading-[3rem] md:leading-[4rem]",children:a.syllables.map((t,s)=>{const l=s===K;return t.type==="punctuation"?e.jsx("span",{className:`mx-3 font-light inline-block transition-all duration-300 ${l?"text-amber-400 scale-125":"text-amber-500/30 scale-100"}`,children:t.text},s):e.jsxs(ne.Fragment,{children:[e.jsx("span",{className:`transition-all duration-200 font-serif text-3xl md:text-4xl inline-block ${l?"text-amber-300 drop-shadow-[0_0_15px_rgba(251,191,36,0.6)]":"text-white/40"}`,children:t.textDevanagari||t.text}),t.spaceAfter&&e.jsx("span",{children:"  "})]},s)})}):e.jsx("div",{className:"flex flex-wrap justify-center items-center gap-x-3 gap-y-4 max-w-xl mx-auto min-h-[120px] content-center",children:a.syllables.map((t,s)=>{const l=s===K;return t.type==="punctuation"?e.jsx("span",{className:`mx-2 font-light inline-block transition-all duration-300 ${l?"text-amber-400 scale-150":"text-white/20 scale-100"}`,children:t.text},s):e.jsx(ne.Fragment,{children:e.jsx("span",{className:`transition-all duration-300 font-serif text-2xl md:text-3xl ${l?`scale-125 ${a.theme.textHighlight} drop-shadow-[0_0_15px_rgba(255,255,255,0.5)]`:"text-white/30 scale-100 blur-[0.5px]"}`,children:t.text})},s)})})]}),e.jsx("div",{className:"relative z-10 bg-black/20 backdrop-blur-xl border-t border-white/5 landscape:border-t-0 landscape:border-l p-8 pb-12 rounded-t-[3rem] landscape:rounded-none landscape:w-1/3 landscape:h-full landscape:flex landscape:flex-col landscape:justify-center landscape:pb-8",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"mb-8 flex items-center gap-8 w-full justify-center",children:[e.jsxs("div",{className:"text-right flex-1",children:[e.jsx("span",{className:"block text-3xl font-bold text-white font-mono",children:H}),e.jsx("span",{className:"text-xs font-bold text-white/30 uppercase tracking-widest",children:"Completed"})]}),e.jsx("div",{className:"relative w-20 h-20 flex items-center justify-center flex-shrink-0",children:e.jsxs("svg",{className:"w-full h-full -rotate-90",viewBox:"0 0 80 80",children:[e.jsx("circle",{cx:"40",cy:"40",r:"36",stroke:"currentColor",strokeWidth:"4",fill:"none",className:"text-white/10"}),e.jsx("circle",{cx:"40",cy:"40",r:"36",stroke:"currentColor",strokeWidth:"4",fill:"none",className:`${a.theme.accent} transition-all duration-500`,strokeDasharray:226,strokeDashoffset:226-226*(H/N),strokeLinecap:"round"}),e.jsx("g",{className:"animate-spin-slow",style:{transformOrigin:"40px 40px",animationDuration:"20s"},children:e.jsx("circle",{cx:"40",cy:"4",r:"5",fill:"white",className:"drop-shadow-[0_0_4px_rgba(255,255,255,0.8)]"})})]})}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("span",{className:"block text-3xl font-bold text-white/50 font-mono",children:N}),e.jsx("span",{className:"text-xs font-bold text-white/30 uppercase tracking-widest",children:"Target"})]})]}),e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsx("button",{onClick:ke,className:"p-4 rounded-full text-white/40 hover:bg-white/10 hover:text-white transition-colors",children:e.jsx(Be,{size:24})}),e.jsx("button",{onClick:Ne,className:`w-20 h-20 rounded-full flex items-center justify-center shadow-2xl transition-transform hover:scale-105 active:scale-95 text-white ${u?"bg-white/10 border border-white/20":"bg-white text-black"}`,children:u?e.jsx(Le,{size:32,fill:"currentColor"}):e.jsx(de,{size:32,fill:"currentColor",className:"ml-1"})}),e.jsx("div",{className:"p-4 w-14"})]})]})})]})};export{Je as default};
