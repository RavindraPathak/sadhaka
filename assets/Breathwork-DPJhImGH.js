import{u as Ie,a as ze,g as Ae,s as Ee,j as e,B as $e,t as Te,p as Re}from"./index-rmReRlAf.js";import{r}from"./vendor-DDTLr4RV.js";import{u as Pe,K as Fe,F as He}from"./FilterBar-BPzZ1Vzq.js";import{r as Me,a6 as Le,ag as qe,k as ne,g as Ue,j as Oe,Y as Ve,W as _,X as _e,V as Be,ah as De,s as Xe,t as Ge,ai as Ke,P as oe,a1 as We}from"./utils-CRISSmvu.js";const et=({onClose:$,initialId:N})=>{var le;const{library:T}=Ie(),{preferences:f}=ze(),R=T.breathwork,ce=T.ambientSounds,B=T.chimeThemes,[i,S]=r.useState(null),[p,P]=r.useState(!1),[de,he]=r.useState(Ae()),[I,xe]=r.useState("All"),[F,D]=r.useState(0),[k,X]=r.useState(0),[ue,G]=r.useState(0),[g,K]=r.useState(0),[H,W]=r.useState(!1),[Y,Q]=r.useState(!1),[J,me]=r.useState(f.audio.ambienceId),[z,pe]=r.useState(f.audio.masterVolume),[y,fe]=r.useState(f.audio.voiceEnabled),[A,be]=r.useState(!0),M=r.useRef(-1);Pe(J,p,z);const L=r.useRef(0),j=r.useRef(0),q=r.useRef(0),U=r.useRef(Date.now()),Z=r.useRef(null),ee=r.useRef(0);r.useEffect(()=>{Z.current=i,ee.current=g},[i,g]);const C=B.find(t=>t.id===f.audio.chimeThemeId)||B[0];r.useEffect(()=>{if(N){const t=R.find(a=>a.id===N);t&&(S(t),U.current=Date.now())}},[N,R]);const O=r.useCallback(()=>{const t=Z.current,a=ee.current;if(t&&!t.isUnguided&&a>0){const s=Math.floor((Date.now()-U.current)/1e3);Ee({id:Date.now().toString(),date:new Date().toISOString(),type:"breathwork",title:t.title,durationSeconds:s>0?s:0})}},[]);r.useEffect(()=>()=>{O(),j.current&&cancelAnimationFrame(j.current),window.speechSynthesis.cancel()},[O]);const we=r.useCallback(t=>{if(!y||typeof window>"u")return;window.speechSynthesis.cancel();const a=new SpeechSynthesisUtterance(t);if(f.audio.voiceURI){const s=window.speechSynthesis.getVoices().find(l=>l.voiceURI===f.audio.voiceURI);s&&(a.voice=s)}a.rate=.9,a.volume=.7,window.speechSynthesis.speak(a)},[y,f.audio.voiceURI]),te=t=>{if(!i||i.isUnguided)return;const{config:a,instructionCycles:s}=i,l=a.inhale*1e3,c=a.holdIn*1e3,o=a.exhale*1e3,h=a.holdOut*1e3,d=l+c+o+h;let x=t-L.current+q.current,b=x%d,w=Math.floor(x/d),n;s&&s.length>0&&(n=s[w%s.length]);const u=[{name:(n==null?void 0:n.inhale)||"Inhale",duration:a.inhale,freq:C.frequencies.inhale},{name:(n==null?void 0:n.holdIn)||"Hold",duration:a.holdIn,freq:C.frequencies.hold},{name:(n==null?void 0:n.exhale)||"Exhale",duration:a.exhale,freq:C.frequencies.exhale},{name:(n==null?void 0:n.holdOut)||"Hold",duration:a.holdOut,freq:C.frequencies.hold}].filter(m=>m.duration>0);let E=0,v=0,V=0;for(let m=0;m<u.length;m++){const re=u[m].duration*1e3;if(b<E+re){v=m,V=b-E;break}E+=re}const ie=u[v].duration*1e3,Ce=Math.min(V/ie,1),Se=Math.ceil((ie-V)/1e3);if(D(v),X(Ce),G(Se),K(w),v!==M.current){const m=u[v];A&&Re(m.freq,C.soundType,1.5,z),we(m.name),M.current=v}j.current=requestAnimationFrame(te)},ge=()=>{p?(P(!1),cancelAnimationFrame(j.current),window.speechSynthesis.pause(),q.current+=performance.now()-L.current):(P(!0),L.current=performance.now(),j.current=requestAnimationFrame(te),window.speechSynthesis.resume())},je=()=>{P(!1),cancelAnimationFrame(j.current),window.speechSynthesis.cancel(),q.current=0,K(0),D(0),X(0),G(0),M.current=-1},ve=()=>{O(),je(),N?$():S(null)},se=(t,a)=>{t&&t.stopPropagation();const s=Te({id:a.id,title:a.title,type:"breathwork"});he(s)},ae=t=>de.some(a=>a.id===t&&a.type==="breathwork"),Ne=()=>{if(!i||i.isUnguided)return null;const{config:t,theme:a,instructionCycles:s}=i;let l;s&&s.length>0&&(l=s[g%s.length]);const c=[{name:(l==null?void 0:l.inhale)||"Inhale",type:"Inhale",duration:t.inhale},{name:(l==null?void 0:l.holdIn)||"Hold",type:"Hold",duration:t.holdIn},{name:(l==null?void 0:l.exhale)||"Exhale",type:"Exhale",duration:t.exhale},{name:(l==null?void 0:l.holdOut)||"Hold",type:"Hold",duration:t.holdOut}].filter(u=>u.duration>0),o=c[F],h=(o==null?void 0:o.name)||"",d=(o==null?void 0:o.type)||"";let x=1;const b=1,w=1.6,n=u=>-(Math.cos(Math.PI*u)-1)/2;if(d==="Inhale")x=b+(w-b)*n(k);else if(d==="Exhale")x=w-(w-b)*n(k);else if(d==="Hold"){const u=(F-1+c.length)%c.length;x=c[u].type==="Inhale"?w:b}return e.jsxs("div",{className:"relative flex items-center justify-center w-64 h-64 sm:w-80 sm:h-80 md:w-96 md:h-96 landscape:w-56 landscape:h-56 landscape:lg:w-80 landscape:lg:h-80",children:[e.jsx("div",{className:`absolute inset-0 rounded-full ${a.blob} blur-3xl opacity-20 will-change-transform`,style:{transform:`scale(${x*1.2})`}}),e.jsx("div",{className:`w-40 h-40 sm:w-52 sm:h-52 md:w-60 md:h-60 rounded-full ${a.core} backdrop-blur-md border border-white/20 flex items-center justify-center shadow-[0_0_40px_rgba(0,0,0,0.2)] relative z-20 will-change-transform`,style:{transform:`scale(${x})`,boxShadow:p&&(d==="Inhale"||d==="Hold"&&x>1.2)?"0 0 60px rgba(255,255,255,0.3)":"0 0 20px rgba(0,0,0,0.1)"},children:e.jsx("div",{className:"flex flex-col items-center justify-center text-center",children:p?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`text-5xl sm:text-6xl font-light font-serif ${a.text}`,children:ue}),h!==d&&e.jsx("span",{className:"text-[10px] sm:text-xs font-bold uppercase tracking-wider text-white/60 mt-1 max-w-[80%]",children:h})]}):e.jsx("span",{className:`text-5xl sm:text-6xl font-light font-serif ${a.text}`,children:e.jsx(_,{size:40,className:"opacity-50 animate-pulse-slow"})})})})]})},ke=()=>{if(!i||!p||i.isUnguided)return null;const{config:t,instructionCycles:a}=i;let s;a&&a.length>0&&(s=a[g%a.length]);const l=[{name:(s==null?void 0:s.inhale)||"Inhale",duration:t.inhale},{name:(s==null?void 0:s.holdIn)||"Hold",duration:t.holdIn},{name:(s==null?void 0:s.exhale)||"Exhale",duration:t.exhale},{name:(s==null?void 0:s.holdOut)||"Hold",duration:t.holdOut}].filter(c=>c.duration>0);return e.jsx("div",{className:"w-full max-w-md px-8 mt-12 landscape:mt-6 mb-4 relative h-12 flex items-center justify-between gap-2",children:l.map((c,o)=>{const h=o===F;return e.jsxs("div",{className:"flex-1 flex flex-col items-center relative group",children:[e.jsx("span",{className:`text-xs font-bold uppercase tracking-widest mb-3 transition-all duration-300 text-center whitespace-nowrap ${h?"text-white scale-110":"text-white/30"}`,children:c.name}),e.jsx("div",{className:"w-full h-1 bg-white/10 rounded-full overflow-hidden relative",children:h&&e.jsx("div",{className:"h-full bg-white rounded-full absolute left-0 top-0 will-change-transform",style:{width:`${k*100}%`}})}),h&&e.jsx("div",{className:"absolute top-[22px] w-3 h-3 bg-white rounded-full shadow-[0_0_10px_rgba(255,255,255,0.8)] z-10 will-change-transform",style:{left:`${k*100}%`,transform:`translate(-50%, 0) translateY(${Math.sin(k*Math.PI)*-8}px)`}})]},o)})})};if(i){if(i.isUnguided)return e.jsx(Fe,{title:i.title,category:"breathwork",onClose:()=>{N?$():S(null)}});const t=i.theme,a=ae(i.id),s=i.meta;return e.jsxs("div",{className:"fixed inset-0 z-[60] flex flex-col landscape:flex-row bg-spiritual-deep overflow-hidden animate-fade-in",children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-b ${t.gradient} transition-colors duration-1000`}),e.jsxs("div",{className:"absolute top-0 left-0 w-full z-30 flex justify-between items-center p-6 pt-8 landscape:pt-6 landscape:p-6 text-white/80",children:[e.jsx("button",{onClick:ve,className:"p-3 bg-white/10 rounded-full hover:bg-white/20 transition backdrop-blur-md",children:e.jsx(Me,{size:24})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>Q(!0),className:`p-3 rounded-full backdrop-blur-md transition-colors ${Y?"bg-white/30 text-white":"bg-white/10 hover:bg-white/20"}`,children:e.jsx(Le,{size:22})}),e.jsx("button",{onClick:()=>W(!H),className:`p-3 rounded-full backdrop-blur-md transition-colors ${H?"bg-white/30 text-white":"bg-white/10 hover:bg-white/20"}`,children:e.jsx(qe,{size:22})}),e.jsx("button",{onClick:l=>se(l,i),className:`p-3 rounded-full backdrop-blur-md transition-colors ${a?"bg-red-500/20 text-red-400":"bg-white/10 hover:bg-white/20"}`,children:e.jsx(ne,{size:22,fill:a?"currentColor":"none"})})]})]}),Y&&e.jsxs($e,{onClose:()=>Q(!1),title:i.title,subtitle:"Technique Guide",icon:e.jsx(_,{size:24}),children:[e.jsx("div",{className:"p-6 bg-white/5 rounded-3xl border border-white/5",children:e.jsx("p",{className:"text-lg text-white/80 leading-relaxed font-medium",children:i.description})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5",children:[e.jsxs("span",{className:"flex items-center gap-2 text-xs font-bold text-white/40 uppercase tracking-widest mb-1",children:[e.jsx(Ue,{size:12})," Level"]}),e.jsx("span",{className:"text-lg font-bold text-white capitalize",children:s.level})]}),e.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5",children:[e.jsxs("span",{className:"flex items-center gap-2 text-xs font-bold text-white/40 uppercase tracking-widest mb-1",children:[e.jsx(Oe,{size:12})," Best Time"]}),e.jsx("span",{className:"text-lg font-bold text-white capitalize",children:((le=s.bestTime)==null?void 0:le.replace("-"," "))||"Any"})]}),s.mechanism&&e.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5",children:[e.jsx("span",{className:"flex items-center gap-2 text-xs font-bold text-white/40 uppercase tracking-widest mb-1",children:"Mechanism"}),e.jsx("span",{className:"text-lg font-bold text-white capitalize",children:s.mechanism.replace("_"," ")})]}),s.ratio&&e.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5",children:[e.jsx("span",{className:"flex items-center gap-2 text-xs font-bold text-white/40 uppercase tracking-widest mb-1",children:"Ratio"}),e.jsx("span",{className:"text-lg font-bold text-white capitalize",children:s.ratio})]})]}),s.contraindications&&s.contraindications.length>0&&e.jsxs("div",{className:"p-5 bg-red-500/10 rounded-2xl border border-red-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ve,{size:16,className:"text-red-400"}),e.jsx("span",{className:"text-xs font-bold text-red-400 uppercase tracking-widest",children:"Contraindications"})]}),e.jsxs("p",{className:"text-sm text-white/80 leading-relaxed",children:["Avoid practice if you have: ",e.jsx("span",{className:"font-bold",children:s.contraindications.map(l=>l.replace("_"," ")).join(", ")}),"."]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs font-bold text-white/40 uppercase tracking-widest mb-3",children:"Rhythm Pattern (Seconds)"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5 text-center",children:[e.jsx("span",{className:"block text-2xl font-bold text-white mb-1",children:i.config.inhale}),e.jsx("span",{className:"text-[10px] font-bold text-white/40 uppercase tracking-wider",children:"Inhale"})]}),e.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5 text-center",children:[e.jsx("span",{className:"block text-2xl font-bold text-white mb-1",children:i.config.holdIn}),e.jsx("span",{className:"text-[10px] font-bold text-white/40 uppercase tracking-wider",children:"Hold"})]}),e.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5 text-center",children:[e.jsx("span",{className:"block text-2xl font-bold text-white mb-1",children:i.config.exhale}),e.jsx("span",{className:"text-[10px] font-bold text-white/40 uppercase tracking-wider",children:"Exhale"})]}),e.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5 text-center",children:[e.jsx("span",{className:"block text-2xl font-bold text-white mb-1",children:i.config.holdOut}),e.jsx("span",{className:"text-[10px] font-bold text-white/40 uppercase tracking-wider",children:"Hold"})]})]})]})]}),H&&e.jsxs("div",{className:"absolute top-24 right-6 z-40 w-72 bg-black/60 backdrop-blur-xl border border-white/10 rounded-[2rem] p-6 shadow-2xl animate-slide-in-right",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h4",{className:"text-white font-bold text-lg",children:"Soundscape"}),e.jsx("button",{onClick:()=>W(!1),children:e.jsx(_e,{size:20,className:"text-white/50 hover:text-white"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-3 gap-2",children:ce.map(l=>e.jsx("button",{onClick:()=>me(l.id),className:`p-2 rounded-xl text-xs font-bold transition-all ${J===l.id?"bg-white text-spiritual-900":"bg-white/10 text-white/60 hover:bg-white/20"}`,children:l.name},l.id))}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-xs text-white/50 font-bold mb-2",children:[e.jsx("span",{children:"Ambience Vol"}),e.jsxs("span",{children:[Math.round(z*100),"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:z,onChange:l=>pe(parseFloat(l.target.value)),className:"w-full h-1.5 bg-white/20 rounded-full appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:bg-white [&::-webkit-slider-thumb]:rounded-full"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>fe(!y),className:`flex-1 py-3 rounded-xl flex items-center justify-center gap-2 font-bold text-sm transition-colors ${y?"bg-white/20 text-white":"bg-white/5 text-white/40"}`,children:[y?e.jsx(Be,{size:16}):e.jsx(De,{size:16})," Voice"]}),e.jsxs("button",{onClick:()=>be(!A),className:`flex-1 py-3 rounded-xl flex items-center justify-center gap-2 font-bold text-sm transition-colors ${A?"bg-white/20 text-white":"bg-white/5 text-white/40"}`,children:[A?e.jsx(Xe,{size:16}):e.jsx(Ge,{size:16})," Chime"]})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center landscape:items-end landscape:pr-12 w-full landscape:w-1/2 pt-20 landscape:pt-0 relative z-10",children:[e.jsxs("div",{className:"landscape:hidden text-center mb-8 px-6",children:[e.jsx("h2",{className:`text-3xl font-bold tracking-[0.2em] uppercase opacity-80 ${t.text}`,children:i.title}),p&&e.jsxs("p",{className:"text-white/40 text-sm mt-2 font-mono tracking-wider",children:["Cycle ",g+1]})]}),Ne()]}),e.jsxs("div",{className:"w-full landscape:w-1/2 flex flex-col items-center justify-start landscape:justify-center p-6 landscape:pl-0 landscape:pr-12 pb-12 landscape:pb-0 z-20",children:[e.jsxs("div",{className:"hidden landscape:block text-center mb-6",children:[e.jsx("h2",{className:`text-3xl font-bold tracking-[0.2em] uppercase opacity-80 ${t.text}`,children:i.title}),p&&e.jsxs("p",{className:"text-white/40 text-sm mt-2 font-mono tracking-wider",children:["Cycle ",g+1]})]}),ke(),e.jsx("div",{className:"mt-8 landscape:mt-6",children:e.jsx("button",{onClick:ge,className:`w-20 h-20 rounded-full flex items-center justify-center shadow-2xl ${t.button} text-white transition-transform hover:scale-105 active:scale-95 ring-4 ring-white/5`,children:p?e.jsx(Ke,{size:32,fill:"currentColor"}):e.jsx(oe,{size:32,fill:"currentColor",className:"ml-1"})})})]})]})}const ye=R.filter(t=>{var a,s;return!!(I==="All"||(a=t.meta)!=null&&a.level&&I===t.meta.level.charAt(0).toUpperCase()+t.meta.level.slice(1)||(s=t.meta)!=null&&s.category&&t.meta.category.map(l=>l.charAt(0).toUpperCase()+l.slice(1)).includes(I))});return e.jsxs("div",{className:"h-[100dvh] bg-spiritual-50 dark:bg-spiritual-deep animate-fade-in flex flex-col overflow-hidden",children:[e.jsx("div",{className:"flex-none pt-8 pb-4 px-6 rounded-b-[2rem] shadow-soft flex flex-col bg-gradient-to-br from-sky-50 via-white to-sky-100 dark:from-sky-900 dark:via-spiritual-deep dark:to-sky-900/10 z-20",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:$,className:"p-3 bg-white dark:bg-white/10 rounded-full shadow-sm hover:scale-105 transition-transform text-spiritual-600 dark:text-spiritual-200","aria-label":"Back",children:e.jsx(We,{size:20})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-spiritual-900 dark:text-spiritual-50",children:"Pranayama"}),e.jsx("p",{className:"text-xs text-spiritual-600 dark:text-spiritual-400 font-bold uppercase tracking-wider",children:"Control the breath"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto scrollbar-hide pb-36",children:[e.jsx("div",{className:"sticky top-0 z-40 px-6 py-2 bg-spiritual-50 dark:bg-spiritual-deep mb-4 shadow-sm",children:e.jsx(He,{filters:["All","Beginner","Intermediate","Advanced","Energy","Calm","Sleep","Focus"],selected:I,onSelect:xe})}),e.jsx("div",{className:"px-6 space-y-5",children:ye.map(t=>{var l,c,o,h,d;const a=ae(t.id);let s="bg-green-500";return((l=t.meta)==null?void 0:l.level)==="intermediate"&&(s="bg-amber-500"),((c=t.meta)==null?void 0:c.level)==="advanced"&&(s="bg-red-500"),e.jsxs("div",{onClick:()=>{S(t),U.current=Date.now()},className:"relative overflow-hidden bg-white dark:bg-spiritual-900/60 p-6 rounded-[2.5rem] shadow-soft border border-spiritual-100 dark:border-spiritual-700/50 flex items-center gap-5 cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-all group",children:[e.jsx("div",{className:`absolute inset-0 opacity-0 group-hover:opacity-10 transition-opacity bg-gradient-to-br ${t.theme.gradient}`}),e.jsx("div",{className:`w-12 h-12 rounded-2xl ${t.theme.secondary} flex items-center justify-center flex-shrink-0 group-hover:scale-105 transition-transform relative z-10 shadow-md`,children:e.jsx(_,{size:24,className:t.theme.primary})}),e.jsxs("div",{className:"flex-1 min-w-0 relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${s}`,title:`Level: ${(o=t.meta)==null?void 0:o.level}`}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-spiritual-400 dark:text-spiritual-500",children:((d=(h=t.meta)==null?void 0:h.category)==null?void 0:d[0])||"General"})]}),e.jsx("h3",{className:"text-lg font-bold text-spiritual-900 dark:text-spiritual-100 mb-1",children:t.title}),e.jsx("p",{className:"text-spiritual-500 dark:text-spiritual-400 text-xs line-clamp-1 leading-relaxed",children:t.description})]}),e.jsxs("div",{className:"flex flex-col items-center gap-3 relative z-10",children:[e.jsx("button",{onClick:x=>se(x,t),className:`p-2 rounded-full transition-colors ${a?"text-red-500 bg-red-50 dark:bg-red-900/20":"text-spiritual-300 dark:text-spiritual-600 hover:text-red-400 hover:bg-spiritual-50 dark:hover:bg-spiritual-800"}`,children:e.jsx(ne,{size:20,fill:a?"currentColor":"none"})}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-spiritual-50 dark:bg-spiritual-800 flex items-center justify-center text-spiritual-400 dark:text-spiritual-500 group-hover:bg-spiritual-800 group-hover:text-white dark:group-hover:bg-spiritual-100 dark:group-hover:text-spiritual-800 transition-colors",children:e.jsx(oe,{size:16,fill:"currentColor"})})]})]},t.id)})})]})]})};export{et as default};
