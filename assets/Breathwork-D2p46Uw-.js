import{u as ye,a as ke,r as l,g as Ce,s as Se,j as e,C as Ie,I as ze,H as ne,B as Ee,W as E,X as $e,V as Pe,b as Re,c as He,P as re,A as Ae,t as Te,p as Me}from"./index-CYQGwMrm.js";import{u as qe,S as Le}from"./useAmbience-7hlfzriY.js";import{V as Oe}from"./volume-x-7Lqm55Mi.js";import{P as Ve}from"./pause-Bh1DJaRG.js";const Ue=({onClose:F,initialId:k})=>{const{library:$}=ye(),{preferences:f}=ke(),P=$.breathwork,ie=$.ambientSounds,B=$.chimeThemes,[n,R]=l.useState(null),[m,H]=l.useState(!1),[oe,ce]=l.useState(Ce()),[A,_]=l.useState(0),[v,U]=l.useState(0),[de,G]=l.useState(0),[g,X]=l.useState(0),[T,W]=l.useState(!1),[Q,Y]=l.useState(!1),[J,he]=l.useState(f.audio.ambienceId),[C,xe]=l.useState(f.audio.masterVolume),[N,ue]=l.useState(f.audio.voiceEnabled),[S,me]=l.useState(!0),M=l.useRef(-1);qe(J,m,C);const q=l.useRef(0),I=l.useRef(0),L=l.useRef(0),O=l.useRef(Date.now()),K=l.useRef(null),Z=l.useRef(0);l.useEffect(()=>{K.current=n,Z.current=g},[n,g]);const y=B.find(s=>s.id===f.audio.chimeThemeId)||B[0];l.useEffect(()=>{if(k){const s=P.find(a=>a.id===k);s&&(R(s),O.current=Date.now())}},[k,P]);const V=l.useCallback(()=>{const s=K.current,a=Z.current;if(s&&a>0){const t=Math.floor((Date.now()-O.current)/1e3);Se({id:Date.now().toString(),date:new Date().toISOString(),type:"breathwork",title:s.title,durationSeconds:t>0?t:0})}},[]);l.useEffect(()=>()=>{V()},[V]);const pe=l.useCallback(s=>{if(!N||typeof window>"u")return;window.speechSynthesis.cancel();const a=new SpeechSynthesisUtterance(s);if(f.audio.voiceURI){const t=window.speechSynthesis.getVoices().find(r=>r.voiceURI===f.audio.voiceURI);t&&(a.voice=t)}a.rate=.9,a.volume=.7,window.speechSynthesis.speak(a)},[N,f.audio.voiceURI]),ee=s=>{if(!n)return;const{config:a,instructionCycles:t}=n,r=a.inhale*1e3,c=a.holdIn*1e3,o=a.exhale*1e3,p=a.holdOut*1e3,h=r+c+o+p;let x=s-q.current+L.current,b=x%h,w=Math.floor(x/h),i;t&&t.length>0&&(i=t[w%t.length]);const d=[{name:(i==null?void 0:i.inhale)||"Inhale",duration:a.inhale,freq:y.frequencies.inhale},{name:(i==null?void 0:i.holdIn)||"Hold",duration:a.holdIn,freq:y.frequencies.hold},{name:(i==null?void 0:i.exhale)||"Exhale",duration:a.exhale,freq:y.frequencies.exhale},{name:(i==null?void 0:i.holdOut)||"Hold",duration:a.holdOut,freq:y.frequencies.hold}].filter(u=>u.duration>0);let z=0,j=0,D=0;for(let u=0;u<d.length;u++){const le=d[u].duration*1e3;if(b<z+le){j=u,D=b-z;break}z+=le}const ae=d[j].duration*1e3,ve=Math.min(D/ae,1),Ne=Math.ceil((ae-D)/1e3);if(_(j),U(ve),G(Ne),X(w),j!==M.current){const u=d[j];S&&Me(u.freq,y.soundType,1.5,C),pe(u.name),M.current=j}I.current=requestAnimationFrame(ee)},fe=()=>{m?(H(!1),cancelAnimationFrame(I.current),window.speechSynthesis.pause(),L.current+=performance.now()-q.current):(H(!0),q.current=performance.now(),I.current=requestAnimationFrame(ee),window.speechSynthesis.resume())},be=()=>{H(!1),cancelAnimationFrame(I.current),window.speechSynthesis.cancel(),L.current=0,X(0),_(0),U(0),G(0),M.current=-1},we=()=>{V(),be(),k?F():R(null)},te=(s,a)=>{s&&s.stopPropagation();const t=Te({id:a.id,title:a.title,type:"breathwork"});ce(t)},se=s=>oe.some(a=>a.id===s&&a.type==="breathwork"),ge=()=>{if(!n)return null;const{config:s,theme:a,instructionCycles:t}=n;let r;t&&t.length>0&&(r=t[g%t.length]);const c=[{name:(r==null?void 0:r.inhale)||"Inhale",type:"Inhale",duration:s.inhale},{name:(r==null?void 0:r.holdIn)||"Hold",type:"Hold",duration:s.holdIn},{name:(r==null?void 0:r.exhale)||"Exhale",type:"Exhale",duration:s.exhale},{name:(r==null?void 0:r.holdOut)||"Hold",type:"Hold",duration:s.holdOut}].filter(d=>d.duration>0),o=c[A],p=(o==null?void 0:o.name)||"",h=(o==null?void 0:o.type)||"";let x=1;const b=1,w=1.6,i=d=>-(Math.cos(Math.PI*d)-1)/2;if(h==="Inhale")x=b+(w-b)*i(v);else if(h==="Exhale")x=w-(w-b)*i(v);else if(h==="Hold"){const d=(A-1+c.length)%c.length;x=c[d].type==="Inhale"?w:b}return e.jsxs("div",{className:"relative flex items-center justify-center w-64 h-64 sm:w-80 sm:h-80 md:w-96 md:h-96 landscape:w-56 landscape:h-56 landscape:lg:w-80 landscape:lg:h-80",children:[e.jsx("div",{className:`absolute inset-0 rounded-full ${a.blob} blur-3xl opacity-20 will-change-transform`,style:{transform:`scale(${x*1.2})`}}),e.jsx("div",{className:`w-40 h-40 sm:w-52 sm:h-52 md:w-60 md:h-60 rounded-full ${a.core} backdrop-blur-md border border-white/20 flex items-center justify-center shadow-[0_0_40px_rgba(0,0,0,0.2)] relative z-20 will-change-transform`,style:{transform:`scale(${x})`,boxShadow:m&&(h==="Inhale"||h==="Hold"&&x>1.2)?"0 0 60px rgba(255,255,255,0.3)":"0 0 20px rgba(0,0,0,0.1)"},children:e.jsx("div",{className:"flex flex-col items-center justify-center text-center",children:m?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`text-5xl sm:text-6xl font-light font-serif ${a.text}`,children:de}),p!==h&&e.jsx("span",{className:"text-[10px] sm:text-xs font-bold uppercase tracking-wider text-white/60 mt-1 max-w-[80%]",children:p})]}):e.jsx("span",{className:`text-5xl sm:text-6xl font-light font-serif ${a.text}`,children:e.jsx(E,{size:40,className:"opacity-50 animate-pulse-slow"})})})})]})},je=()=>{if(!n||!m)return null;const{config:s,instructionCycles:a}=n;let t;a&&a.length>0&&(t=a[g%a.length]);const r=[{name:(t==null?void 0:t.inhale)||"Inhale",duration:s.inhale},{name:(t==null?void 0:t.holdIn)||"Hold",duration:s.holdIn},{name:(t==null?void 0:t.exhale)||"Exhale",duration:s.exhale},{name:(t==null?void 0:t.holdOut)||"Hold",duration:s.holdOut}].filter(c=>c.duration>0);return e.jsx("div",{className:"w-full max-w-md px-8 mt-12 landscape:mt-6 mb-4 relative h-12 flex items-center justify-between gap-2",children:r.map((c,o)=>{const p=o===A;return e.jsxs("div",{className:"flex-1 flex flex-col items-center relative group",children:[e.jsx("span",{className:`text-xs font-bold uppercase tracking-widest mb-3 transition-all duration-300 text-center whitespace-nowrap ${p?"text-white scale-110":"text-white/30"}`,children:c.name}),e.jsx("div",{className:"w-full h-1 bg-white/10 rounded-full overflow-hidden relative",children:p&&e.jsx("div",{className:"h-full bg-white rounded-full absolute left-0 top-0 will-change-transform",style:{width:`${v*100}%`}})}),p&&e.jsx("div",{className:"absolute top-[22px] w-3 h-3 bg-white rounded-full shadow-[0_0_10px_rgba(255,255,255,0.8)] z-10 will-change-transform",style:{left:`${v*100}%`,transform:`translate(-50%, 0) translateY(${Math.sin(v*Math.PI)*-8}px)`}})]},o)})})};if(n){const s=n.theme,a=se(n.id);return e.jsxs("div",{className:"fixed inset-0 z-[60] flex flex-col landscape:flex-row bg-spiritual-deep overflow-hidden animate-fade-in",children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-b ${s.bgGradient} transition-colors duration-1000`}),e.jsxs("div",{className:"absolute top-0 left-0 w-full z-30 flex justify-between items-center p-6 pt-8 landscape:pt-6 landscape:p-6 text-white/80",children:[e.jsx("button",{onClick:we,className:"p-3 bg-white/10 rounded-full hover:bg-white/20 transition backdrop-blur-md",children:e.jsx(Ie,{size:24})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>Y(!0),className:`p-3 rounded-full backdrop-blur-md transition-colors ${Q?"bg-white/30 text-white":"bg-white/10 hover:bg-white/20"}`,children:e.jsx(ze,{size:22})}),e.jsx("button",{onClick:()=>W(!T),className:`p-3 rounded-full backdrop-blur-md transition-colors ${T?"bg-white/30 text-white":"bg-white/10 hover:bg-white/20"}`,children:e.jsx(Le,{size:22})}),e.jsx("button",{onClick:t=>te(t,n),className:`p-3 rounded-full backdrop-blur-md transition-colors ${a?"bg-red-500/20 text-red-400":"bg-white/10 hover:bg-white/20"}`,children:e.jsx(ne,{size:22,fill:a?"currentColor":"none"})})]})]}),Q&&e.jsxs(Ee,{onClose:()=>Y(!1),title:n.title,subtitle:"Technique Guide",icon:e.jsx(E,{size:24}),children:[e.jsx("div",{className:"p-6 bg-white/5 rounded-3xl border border-white/5",children:e.jsx("p",{className:"text-lg text-white/80 leading-relaxed font-medium",children:n.description})}),e.jsx("div",{className:"p-6 bg-white/5 rounded-3xl border border-white/5",children:e.jsx("p",{className:"text-lg text-white/80 leading-relaxed font-medium",children:" Important : Breathwork should be practiced strictly under the guidance of an authentic teacher. Do not practice holding patterns if you have high blood pressure, heart ailments or during pregnency or menstruation."})}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs font-bold text-white/40 uppercase tracking-widest mb-3",children:"Rhythm Pattern (Seconds)"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5 text-center",children:[e.jsx("span",{className:"block text-2xl font-bold text-white mb-1",children:n.config.inhale}),e.jsx("span",{className:"text-[10px] font-bold text-white/40 uppercase tracking-wider",children:"Inhale"})]}),e.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5 text-center",children:[e.jsx("span",{className:"block text-2xl font-bold text-white mb-1",children:n.config.holdIn}),e.jsx("span",{className:"text-[10px] font-bold text-white/40 uppercase tracking-wider",children:"Hold"})]}),e.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5 text-center",children:[e.jsx("span",{className:"block text-2xl font-bold text-white mb-1",children:n.config.exhale}),e.jsx("span",{className:"text-[10px] font-bold text-white/40 uppercase tracking-wider",children:"Exhale"})]}),e.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5 text-center",children:[e.jsx("span",{className:"block text-2xl font-bold text-white mb-1",children:n.config.holdOut}),e.jsx("span",{className:"text-[10px] font-bold text-white/40 uppercase tracking-wider",children:"Hold"})]})]})]})]}),T&&e.jsxs("div",{className:"absolute top-24 right-6 z-40 w-72 bg-black/60 backdrop-blur-xl border border-white/10 rounded-[2rem] p-6 shadow-2xl animate-slide-in-right",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h4",{className:"text-white font-bold text-lg",children:"Soundscape"}),e.jsx("button",{onClick:()=>W(!1),children:e.jsx($e,{size:20,className:"text-white/50 hover:text-white"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-3 gap-2",children:ie.map(t=>e.jsx("button",{onClick:()=>he(t.id),className:`p-2 rounded-xl text-xs font-bold transition-all ${J===t.id?"bg-white text-spiritual-900":"bg-white/10 text-white/60 hover:bg-white/20"}`,children:t.name},t.id))}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-xs text-white/50 font-bold mb-2",children:[e.jsx("span",{children:"Ambience Vol"}),e.jsxs("span",{children:[Math.round(C*100),"%"]})]}),e.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:C,onChange:t=>xe(parseFloat(t.target.value)),className:"w-full h-1.5 bg-white/20 rounded-full appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:bg-white [&::-webkit-slider-thumb]:rounded-full"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>ue(!N),className:`flex-1 py-3 rounded-xl flex items-center justify-center gap-2 font-bold text-sm transition-colors ${N?"bg-white/20 text-white":"bg-white/5 text-white/40"}`,children:[N?e.jsx(Pe,{size:16}):e.jsx(Oe,{size:16})," Voice"]}),e.jsxs("button",{onClick:()=>me(!S),className:`flex-1 py-3 rounded-xl flex items-center justify-center gap-2 font-bold text-sm transition-colors ${S?"bg-white/20 text-white":"bg-white/5 text-white/40"}`,children:[S?e.jsx(Re,{size:16}):e.jsx(He,{size:16})," Chime"]})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center landscape:items-end landscape:pr-12 w-full landscape:w-1/2 pt-20 landscape:pt-0 relative z-10",children:[e.jsxs("div",{className:"landscape:hidden text-center mb-8 px-6",children:[e.jsx("h2",{className:`text-3xl font-bold tracking-[0.2em] uppercase opacity-80 ${s.text}`,children:n.title}),m&&e.jsxs("p",{className:"text-white/40 text-sm mt-2 font-mono tracking-wider",children:["Cycle ",g+1]})]}),ge()]}),e.jsxs("div",{className:"w-full landscape:w-1/2 flex flex-col items-center justify-start landscape:justify-center p-6 landscape:pl-0 landscape:pr-12 pb-12 landscape:pb-0 z-20",children:[e.jsxs("div",{className:"hidden landscape:block text-center mb-6",children:[e.jsx("h2",{className:`text-3xl font-bold tracking-[0.2em] uppercase opacity-80 ${s.text}`,children:n.title}),m&&e.jsxs("p",{className:"text-white/40 text-sm mt-2 font-mono tracking-wider",children:["Cycle ",g+1]})]}),je(),e.jsx("div",{className:"mt-8 landscape:mt-6",children:e.jsx("button",{onClick:fe,className:`w-20 h-20 rounded-full flex items-center justify-center shadow-2xl ${s.button} text-white transition-transform hover:scale-105 active:scale-95 ring-4 ring-white/5`,children:m?e.jsx(Ve,{size:32,fill:"currentColor"}):e.jsx(re,{size:32,fill:"currentColor",className:"ml-1"})})})]})]})}return e.jsxs("div",{className:"p-6 pb-40 animate-fade-in max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-end mb-10 mt-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 text-sky-600 dark:text-sky-400",children:[e.jsx(E,{size:20}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-widest",children:"Pranayama"})]}),e.jsx("h2",{className:"text-4xl font-bold text-spiritual-900 dark:text-spiritual-50 mb-2",children:"Breathwork"}),e.jsx("p",{className:"text-lg text-spiritual-500 dark:text-spiritual-400",children:"Control the breath, control the mind"})]}),e.jsx("button",{onClick:F,className:"w-14 h-14 rounded-full border border-sky-200 dark:border-sky-800 text-sky-400 flex items-center justify-center hover:bg-sky-500 hover:text-white transition-all hover:scale-110",children:e.jsx(Ae,{size:24})})]}),e.jsx("div",{className:"space-y-5",children:P.map(s=>{const a=se(s.id);return e.jsxs("div",{onClick:()=>{R(s),O.current=Date.now()},className:"relative overflow-hidden bg-white dark:bg-spiritual-900/40 p-6 rounded-[2.5rem] shadow-soft border border-spiritual-100 dark:border-spiritual-700/50 flex items-center gap-6 cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-all group",children:[e.jsx("div",{className:`absolute inset-0 opacity-0 group-hover:opacity-10 transition-opacity bg-gradient-to-br ${s.theme.bgGradient}`}),e.jsx("div",{className:`w-20 h-20 rounded-3xl ${s.theme.iconBg} flex items-center justify-center flex-shrink-0 group-hover:scale-105 transition-transform relative z-10 shadow-md`,children:e.jsx(E,{size:32,className:s.theme.iconColor})}),e.jsxs("div",{className:"flex-1 min-w-0 relative z-10",children:[e.jsx("h3",{className:"text-xl font-bold text-spiritual-900 dark:text-spiritual-100 mb-1",children:s.title}),e.jsx("p",{className:"text-spiritual-500 dark:text-spiritual-400 text-sm line-clamp-2 leading-relaxed",children:s.description})]}),e.jsxs("div",{className:"flex flex-col items-center gap-3 relative z-10",children:[e.jsx("button",{onClick:t=>te(t,s),className:`p-2 rounded-full transition-colors ${a?"text-red-500 bg-red-50 dark:bg-red-900/20":"text-spiritual-300 dark:text-spiritual-600 hover:text-red-400 hover:bg-spiritual-50 dark:hover:bg-spiritual-800"}`,children:e.jsx(ne,{size:20,fill:a?"currentColor":"none"})}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-spiritual-50 dark:bg-spiritual-800 flex items-center justify-center text-spiritual-400 dark:text-spiritual-500 group-hover:bg-spiritual-800 group-hover:text-white dark:group-hover:bg-spiritual-100 dark:group-hover:text-spiritual-800 transition-colors",children:e.jsx(re,{size:16,fill:"currentColor"})})]})]},s.id)})})]})};export{Ue as default};
