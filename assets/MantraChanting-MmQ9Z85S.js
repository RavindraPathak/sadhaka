import{u as Se,a as Re,g as Ae,z as Ce,r as F,s as Te,j as e,B as ze,t as De,A as $e,p as Ie}from"./index-Cc3QSN8n.js";import{r as s}from"./vendor-DDTLr4RV.js";import{u as Fe,F as Ee,K as Pe}from"./FilterBar-B3h5HC7S.js";import{a1 as le,k as ne,P as oe,a6 as Me,ah as Ve,X as _e,h as Oe,a0 as Be,ae as Le,aj as Ue}from"./utils-kLxd5vEQ.js";const Ge=[9,21,54,108],ce=[{label:"Slow",val:1.5,id:"slow"},{label:"Normal",val:1,id:"normal"},{label:"Fast",val:.7,id:"fast"}],qe=1e3,Xe=({onClose:E,initialId:j})=>{const{library:m}=Se(),{preferences:o,updateAudioSettings:de}=Re(),[i,T]=s.useState(null),[z,ue]=s.useState("All"),[d,v]=s.useState(!1),xe=t=>{var r;return((r=ce.find(l=>l.id===t))==null?void 0:r.val)||1},[q,D]=s.useState(0),[N,he]=s.useState(108),[P,me]=s.useState(xe(o.defaults.mantraSpeed)),[pe,k]=s.useState(-1),[M,H]=s.useState(!1),[K,W]=s.useState(!1),[be,fe]=s.useState(Ae()),[V,J]=s.useState("IAST"),[y,ge]=s.useState(!0),[u,we]=s.useState(!1),[_,je]=s.useState(o.audio.instrumentId||"sine");Fe(o.audio.ambienceId,d,o.audio.masterVolume);const p=s.useRef(0),S=s.useRef(0),b=s.useRef(0),X=s.useRef(Date.now()),f=s.useRef(0),R=s.useRef(!1),O=s.useRef(null),A=s.useRef(!1),Q=s.useRef(1),$=s.useRef(!0),Y=s.useRef(!1),B=s.useRef(108),g=s.useRef(-1),Z=s.useRef("sine"),ee=m.chimeThemes.find(t=>t.id===o.audio.chimeThemeId)||m.chimeThemes[0];s.useEffect(()=>{O.current=i,A.current=d,Q.current=P,$.current=y,Y.current=u,B.current=N,Z.current=_},[i,d,P,y,u,N,_]),s.useEffect(()=>{const t=j&&m.mantras.find(r=>r.id===j)||null;T(t)},[j,m.mantras]),s.useEffect(()=>(d&&(i!=null&&i.rootNote)&&u&&!i.isUnguided?Ce(i.rootNote,o.audio.masterVolume*.3):F(),()=>F()),[d,i,u,o.audio.masterVolume]);const te=(t,r)=>{t&&t.stopPropagation();const l=De({id:r.id,title:r.title,type:"mantra"});fe(l)},L=t=>be.some(r=>r.id===t&&r.type==="mantra"),se=s.useCallback(()=>{const t=O.current;if(!t||t.isUnguided)return;const r=f.current;if(r>0){const l=Math.round((Date.now()-X.current)/1e3);l>5&&Te({id:Date.now().toString(),date:new Date().toISOString(),type:"mantra",title:`${t.title} (${r}/${B.current})`,durationSeconds:l,count:r})}},[]);s.useEffect(()=>(i?(X.current=Date.now(),D(0),f.current=0,k(-1),g.current=-1,p.current=0,S.current=0,R.current=!1):(v(!1),cancelAnimationFrame(b.current),F()),()=>{se(),cancelAnimationFrame(b.current),F()}),[i,se]);const ve=()=>{j?E():T(null)},re=t=>{const r=O.current;if(!r||!A.current||r.isUnguided)return;const l=r.baseDuration*1e3*Q.current,a=$.current?qe:0,x=l+a,c=t-p.current;if(c<l){const C=r.syllables.reduce((n,G)=>n+G.durationRatio,0),ie=l/C;let U=0,h=-1;for(let n=0;n<r.syllables.length;n++){const I=r.syllables[n].durationRatio*ie;if(c>=U&&c<U+I){h=n;break}U+=I}if(h!==-1&&h!==g.current){const n=r.syllables[h];if(n&&Y.current){const I=!(n.type==="punctuation")||$.current,ae=n.note;I&&typeof ae=="string"&&$e(ae,n.durationRatio*ie/1e3,o.audio.masterVolume,Z.current)}g.current=h}h===r.syllables.length-1&&!R.current&&$.current&&(Ie(ee.frequencies.hold,ee.soundType,2.5,o.audio.masterVolume),R.current=!0),k(h)}else if(c<x)k(-1),g.current=-1;else{const C=f.current+1;if(f.current=C,D(C),p.current=t,R.current=!1,g.current=-1,navigator.vibrate&&navigator.vibrate(10),C>=B.current){v(!1),A.current=!1,k(-1);return}}b.current=requestAnimationFrame(re)},Ne=()=>{if(d)v(!1),A.current=!1,cancelAnimationFrame(b.current),S.current=performance.now();else{if(v(!0),A.current=!0,S.current>0){const t=performance.now()-S.current;p.current+=t}else p.current=performance.now();b.current=requestAnimationFrame(re)}},ke=()=>{v(!1),cancelAnimationFrame(b.current),D(0),f.current=0,k(-1),p.current=0,S.current=0,R.current=!1,g.current=-1};if(!i){const t=Array.from(new Set(m.mantras.map(a=>a.deity))),r=["All","Spiritual","Healing","Devotion"],l=[...r,...t.filter(a=>!r.includes(a))];return e.jsxs("div",{className:"h-[100dvh] bg-spiritual-50 dark:bg-spiritual-deep animate-fade-in flex flex-col overflow-hidden",children:[e.jsx("div",{className:"flex-none pt-8 pb-4 px-6 rounded-b-[2rem] shadow-soft flex items-center justify-between bg-gradient-to-br from-amber-50 via-white to-amber-100 dark:from-amber-900 dark:via-spiritual-deep dark:to-amber-900/10 z-20",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:E,className:"p-3 bg-white dark:bg-white/10 rounded-full shadow-sm hover:scale-105 transition-transform text-spiritual-600 dark:text-spiritual-200",children:e.jsx(le,{size:20})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-spiritual-900 dark:text-spiritual-50",children:"Mantra Japa"}),e.jsx("p",{className:"text-xs text-spiritual-500 dark:text-spiritual-400 font-bold uppercase tracking-wider",children:"Recitation & Vibration"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto scrollbar-hide pb-36",children:[e.jsx("div",{className:"sticky top-0 z-40 px-6 py-2 bg-spiritual-50 dark:bg-spiritual-deep mb-4 shadow-sm",children:e.jsx(Ee,{filters:l,selected:z,onSelect:ue})}),e.jsx("div",{className:"px-6 space-y-5",children:m.mantras.filter(a=>{var x;return z==="All"||a.deity===z||((x=a.meta)==null?void 0:x.category)&&a.meta.category.map(c=>c.charAt(0).toUpperCase()+c.slice(1)).includes(z)}).map(a=>{const x=L(a.id);return e.jsxs("div",{onClick:()=>T(a),className:"bg-white dark:bg-spiritual-900/60 p-6 rounded-[2.5rem] shadow-soft border border-spiritual-100 dark:border-spiritual-700/50 flex items-center gap-5 cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-all group relative overflow-hidden",children:[e.jsx("div",{className:`absolute inset-0 opacity-0 group-hover:opacity-10 transition-opacity bg-gradient-to-r ${a.theme.gradient}`}),e.jsx("div",{className:`w-12 h-12 rounded-2xl bg-gradient-to-br ${a.theme.gradient} text-white flex items-center justify-center flex-shrink-0 shadow-md group-hover:scale-105 transition-transform`,children:e.jsx("span",{className:"text-lg font-serif font-bold opacity-90",children:a.sanskritTitle.charAt(0)||"K"})}),e.jsxs("div",{className:"flex-1 min-w-0 relative z-10",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"px-2 py-0.5 rounded-md bg-spiritual-100 dark:bg-spiritual-800 text-[10px] font-bold text-spiritual-500 uppercase tracking-wider",children:a.deity})}),e.jsx("h3",{className:"text-lg font-bold text-spiritual-900 dark:text-spiritual-100",children:a.title}),e.jsx("p",{className:"text-spiritual-500 dark:text-spiritual-400 text-xs truncate",children:a.meaning})]}),e.jsxs("div",{className:"flex flex-col items-center gap-3 relative z-10",children:[e.jsx("button",{onClick:c=>te(c,a),className:`p-2 rounded-full transition-colors ${x?"text-red-500 bg-red-50 dark:bg-red-900/20":"text-spiritual-300 dark:text-spiritual-600 hover:text-red-400 hover:bg-spiritual-50 dark:hover:bg-spiritual-800"}`,children:e.jsx(ne,{size:20,fill:x?"currentColor":"none"})}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-spiritual-50 dark:bg-spiritual-800 flex items-center justify-center text-spiritual-400 dark:text-spiritual-500 group-hover:bg-spiritual-800 group-hover:text-white dark:group-hover:bg-spiritual-100 dark:group-hover:text-spiritual-800 transition-colors",children:e.jsx(oe,{size:16,fill:"currentColor"})})]})]},a.id)})})]})]})}if(i.isUnguided)return e.jsx(Pe,{title:i.title,category:"mantra",onClose:()=>{j?E():T(null)}});const ye=V==="DEVANAGARI",w=i.meta;return e.jsxs("div",{className:"fixed inset-0 z-[60] flex flex-col landscape:flex-row bg-spiritual-deep overflow-hidden animate-fade-in transition-colors duration-1000",children:[e.jsx("div",{className:`absolute inset-0 bg-gradient-to-b ${i.theme.gradient} opacity-90 transition-opacity duration-1000`}),e.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm"}),e.jsxs("div",{className:"absolute top-0 left-0 w-full z-30 flex justify-between items-center p-6 pt-8 text-white",children:[e.jsx("button",{onClick:ve,className:"p-3 bg-white/10 hover:bg-white/20 rounded-full backdrop-blur-md transition-colors",children:e.jsx(le,{size:24})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>W(!0),className:`p-3 rounded-full backdrop-blur-md transition-colors ${K?"bg-white/20":"bg-white/10 hover:bg-white/20"}`,children:e.jsx(Me,{size:20})}),e.jsx("button",{onClick:()=>H(!M),className:`p-3 rounded-full backdrop-blur-md transition-colors ${M?"bg-white/20":"bg-white/10 hover:bg-white/20"}`,children:e.jsx(Ve,{size:22})}),e.jsx("button",{onClick:t=>te(t,i),className:`p-3 rounded-full backdrop-blur-md transition-colors ${L(i.id)?"bg-red-500/20 text-red-400":"bg-white/10 hover:bg-white/20"}`,children:e.jsx(ne,{size:20,fill:L(i.id)?"currentColor":"none"})})]})]}),M&&e.jsx("div",{className:"absolute top-24 right-6 z-40 w-64 bg-black/80 backdrop-blur-xl border border-white/10 rounded-3xl p-5 animate-fade-in",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h4",{className:"text-white font-bold text-lg",children:"Settings"}),e.jsx("button",{onClick:()=>H(!1),children:e.jsx(_e,{size:20,className:"text-white/50 hover:text-white"})})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 pb-2 border-b border-white/10",children:[e.jsxs("label",{className:"text-xs font-bold text-white/40 uppercase tracking-widest flex items-center gap-2",children:[e.jsx(Oe,{size:14})," Melodic Guide"]}),e.jsx("button",{onClick:()=>we(!u),className:`w-12 h-6 rounded-full p-1 transition-colors ${u?"bg-white":"bg-white/10"}`,children:e.jsx("div",{className:`w-4 h-4 rounded-full shadow-sm transform transition-transform ${u?"translate-x-6 bg-black":"translate-x-0 bg-white/50"}`})})]}),u&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-white/40 uppercase tracking-widest block mb-2",children:"Instrument Tone"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["sine","veena","harmonium"].map(t=>e.jsx("button",{onClick:()=>{je(t),de({instrumentId:t})},className:`py-2 rounded-lg text-[10px] font-bold transition-colors capitalize ${_===t?"bg-white text-black":"bg-white/10 text-white/60 hover:bg-white/20"}`,children:t==="sine"?"Soft":t==="veena"?"String":"Reed"},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-white/40 uppercase tracking-widest block mb-3",children:"Target Count"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:Ge.map(t=>e.jsx("button",{onClick:()=>{he(t),D(0),f.current=0},className:`py-2 rounded-lg text-xs font-bold transition-colors ${N===t?"bg-white text-black":"bg-white/10 text-white/60 hover:bg-white/20"}`,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-white/40 uppercase tracking-widest block mb-3",children:"Chanting Speed"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:ce.map(t=>e.jsx("button",{onClick:()=>me(t.val),className:`py-2 rounded-lg text-[10px] font-bold transition-colors ${P===t.val?"bg-white text-black":"bg-white/10 text-white/60 hover:bg-white/20"}`,children:t.label},t.label))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-white/40 uppercase tracking-widest block mb-3",children:"Script"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{onClick:()=>J("IAST"),className:`py-2 rounded-lg text-xs font-bold transition-colors ${V==="IAST"?"bg-white text-black":"bg-white/10 text-white/60 hover:bg-white/20"}`,children:"Latin"}),e.jsx("button",{onClick:()=>J("DEVANAGARI"),className:`py-2 rounded-lg text-xs font-bold transition-colors ${V==="DEVANAGARI"?"bg-white text-black":"bg-white/10 text-white/60 hover:bg-white/20"}`,children:"Devanagari"})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-white/10",children:[e.jsx("label",{className:"text-xs font-bold text-white/40 uppercase tracking-widest",children:"Interval Chime"}),e.jsx("button",{onClick:()=>ge(!y),className:`w-12 h-6 rounded-full p-1 transition-colors ${y?"bg-white":"bg-white/10"}`,children:e.jsx("div",{className:`w-4 h-4 rounded-full shadow-sm transform transition-transform ${y?"translate-x-6 bg-black":"translate-x-0 bg-white/50"}`})})]})]})}),K&&e.jsxs(ze,{onClose:()=>W(!1),title:i.title,subtitle:"Mantra Details",icon:e.jsx(Be,{size:24}),children:[e.jsxs("div",{className:"p-6 bg-white/5 rounded-3xl border border-white/5",children:[e.jsx("p",{className:"text-3xl font-serif text-white/90 mb-2 leading-relaxed",children:i.sanskritTitle}),e.jsxs("p",{className:"text-lg text-white/60 italic leading-relaxed",children:['"',i.meaning,'"']})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5",children:[e.jsx("span",{className:"block text-xs font-bold text-white/40 uppercase tracking-widest mb-1",children:"Deity"}),e.jsx("span",{className:"text-lg font-bold text-white",children:i.deity})]}),w.level&&e.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5",children:[e.jsx("span",{className:"block text-xs font-bold text-white/40 uppercase tracking-widest mb-1",children:"Level"}),e.jsx("span",{className:"text-lg font-bold text-white capitalize",children:w.level})]}),w.bestTime&&e.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5",children:[e.jsx("span",{className:"block text-xs font-bold text-white/40 uppercase tracking-widest mb-1",children:"Best Time"}),e.jsx("span",{className:"text-lg font-bold text-white capitalize",children:w.bestTime})]}),w.rishi&&e.jsxs("div",{className:"p-4 bg-white/5 rounded-2xl border border-white/5",children:[e.jsx("span",{className:"block text-xs font-bold text-white/40 uppercase tracking-widest mb-1",children:"Rishi (Seer)"}),e.jsx("span",{className:"text-lg font-bold text-white",children:w.rishi})]})]})]}),e.jsxs("div",{className:"relative z-10 flex-1 flex flex-col items-center justify-center p-6 pt-24 landscape:pt-0 landscape:w-2/3 text-center",children:[e.jsxs("div",{className:"mb-12 landscape:mb-8",children:[e.jsx("h2",{className:"text-4xl font-bold text-white/90 mb-4 font-serif tracking-wide",children:i.sanskritTitle}),e.jsx("p",{className:"text-white/40 text-sm uppercase tracking-[0.2em]",children:i.title})]}),e.jsx("div",{className:"flex flex-wrap justify-center items-center gap-y-6 w-full max-w-4xl mx-auto min-h-[120px] content-center px-4",children:i.syllables.map((t,r)=>{const l=r===pe,a=ye&&t.textDevanagari||t.text;return t.type==="punctuation"?e.jsx("span",{className:`mx-2 font-light transition-all duration-300 ${l?"text-amber-400 scale-150":"text-white/20 scale-100"}`,children:a},r):e.jsx("span",{className:`transition-all duration-300 font-serif text-3xl md:text-5xl leading-tight
                                ${l?`${i.theme.textHighlight} drop-shadow-[0_0_20px_rgba(255,255,255,0.7)]`:"text-white/30"}
                                ${t.spaceAfter?"mr-4":""}
                            `,children:a},r)})})]}),e.jsx("div",{className:"relative z-10 bg-black/20 backdrop-blur-xl border-t border-white/5 landscape:border-t-0 landscape:border-l p-8 pb-12 rounded-t-[3rem] landscape:rounded-none landscape:w-1/3 landscape:h-full landscape:flex landscape:flex-col landscape:justify-center landscape:pb-8",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"mb-8 flex items-center gap-8 w-full justify-center",children:[e.jsxs("div",{className:"text-right flex-1",children:[e.jsx("span",{className:"block text-3xl font-bold text-white font-mono",children:q}),e.jsx("span",{className:"text-xs font-bold text-white/30 uppercase tracking-widest",children:"Completed"})]}),e.jsx("div",{className:"relative w-20 h-20 flex items-center justify-center flex-shrink-0",children:e.jsxs("svg",{className:"w-full h-full -rotate-90",viewBox:"0 0 80 80",children:[e.jsx("circle",{cx:"40",cy:"40",r:"36",stroke:"currentColor",strokeWidth:"4",fill:"none",className:"text-white/10"}),e.jsx("circle",{cx:"40",cy:"40",r:"36",stroke:"currentColor",strokeWidth:"4",fill:"none",className:`${i.theme.accent} transition-all duration-500`,strokeDasharray:226,strokeDashoffset:226-226*(q/N),strokeLinecap:"round"}),e.jsx("g",{className:"animate-spin-slow",style:{transformOrigin:"40px 40px",animationDuration:"20s"},children:e.jsx("circle",{cx:"40",cy:"4",r:"5",fill:"white",className:"drop-shadow-[0_0_4px_rgba(255,255,255,0.8)]"})})]})}),e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("span",{className:"block text-3xl font-bold text-white/50 font-mono",children:N}),e.jsx("span",{className:"text-xs font-bold text-white/30 uppercase tracking-widest",children:"Target"})]})]}),e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsx("button",{onClick:ke,className:"p-4 rounded-full text-white/40 hover:bg-white/10 hover:text-white transition-colors",children:e.jsx(Le,{size:24})}),e.jsx("button",{onClick:Ne,className:`w-20 h-20 rounded-full flex items-center justify-center shadow-2xl transition-transform hover:scale-105 active:scale-95 text-white ${d?"bg-white/10 border border-white/20":"bg-white text-black"}`,children:d?e.jsx(Ue,{size:32,fill:"currentColor"}):e.jsx(oe,{size:32,fill:"currentColor",className:"ml-1"})}),e.jsx("div",{className:"p-4 w-14"})]})]})})]})};export{Xe as default};
